<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-http-浏览器缓存/https-加密方式">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.0">
<title data-rh="true">https-加密方式 | Programming tech</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://huiruo.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://huiruo.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://huiruo.github.io/http-浏览器缓存/https-加密方式"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="https-加密方式 | Programming tech"><meta data-rh="true" name="description" content="HTTPS加密"><meta data-rh="true" property="og:description" content="HTTPS加密"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://huiruo.github.io/http-浏览器缓存/https-加密方式"><link data-rh="true" rel="alternate" href="https://huiruo.github.io/http-浏览器缓存/https-加密方式" hreflang="en"><link data-rh="true" rel="alternate" href="https://huiruo.github.io/http-浏览器缓存/https-加密方式" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.d2b88536.css">
<link rel="preload" href="/assets/js/runtime~main.654f7f82.js" as="script">
<link rel="preload" href="/assets/js/main.0a662770.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"dark")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="My Site Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.svg" alt="My Site Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">programming-tech</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/start">Main</a><a class="navbar__item navbar__link" href="/structure-algorithm/">Structure Algorithm</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/huiruo/programming-tech-website/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently dark mode)" aria-label="Switch between dark and light mode (currently dark mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/start">start</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/react-vue异同-react">react-vue异同-react</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/react-vue异同-vue">react-vue异同-vue</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/React/jsx-ast-render阶段">React</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/Vue/vue3/库-状态管理">Vue</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/JavaScript/keys-hasOwnProperty-defineProperty-forin">JavaScript</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/category/解析-解释-编译-事件循环-promise-安全">解析-解释-编译-事件循环-promise-安全</a><button aria-label="Toggle the collapsible sidebar category &#x27;解析-解释-编译-事件循环-promise-安全&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/html-css/requestAnimationFrame/requestAnimationFrame-是宏任务吗">html-css</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/http-浏览器缓存/浏览器请求-渲染的流程-回流重绘">http-浏览器缓存</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/http-浏览器缓存/浏览器请求-渲染的流程-回流重绘">浏览器请求-渲染的流程-回流重绘</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/http-浏览器缓存/浏览器缓存">浏览器缓存</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/http-浏览器缓存/http1.1-http2.0-报文">http1.1-http2.0-报文</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/http-浏览器缓存/reflow-repaint">reflow-repaint</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/http-浏览器缓存/TCP-IP-握手">TCP-IP-握手</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/http-浏览器缓存/https-加密方式">https-加密方式</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/http-浏览器缓存/跨域-反向代理-正向代理">跨域-反向代理-正向代理</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/http-浏览器缓存/辅-DNS查询过程-DNS污染-IP封锁">DNS查询过程-DNS污染-IP封锁</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/http-浏览器缓存/状态码-请求报文之req header-响应报文res header">状态码-请求报文之req header-响应报文res header</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/http-浏览器缓存/鉴权-Token和JWT-cookie-session">鉴权-Token和JWT-cookie-session</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/http-浏览器缓存/http-和js-stream">http-和js-stream</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/http-浏览器缓存/辅-vpn-vps-Proxy以及shadowsocks之间的联系和区别">vpn-vps-Proxy以及shadowsocks之间的联系和区别</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/http-浏览器缓存/WebSocket-Socks5-shadowsocks/00-1-WebSocket和http异同">WebSocket-Socks5-shadowsocks</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/http-浏览器缓存/websocket/客户端">客户端</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/build-webpack/浏览器正常运行流程-静态-同步">webpack</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/build-AST-Babel/AST">AST-Babel</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/build-monorepo-turbopack/monorepo">monorepo-turbopack</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/ssr服务端渲染-nodejs/react-ssr-demo/react18-ssr">ssr服务端渲染-nodejs</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/优化/React">优化</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/C++-V8/v8/v8基础">C++-V8</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/backend/消息队列">backend</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/设计模式/">设计模式</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/正则/00-1-正则-基础">正则</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">http-浏览器缓存</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">https-加密方式</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>https-加密方式</h1></header><h2 class="anchor anchorWithStickyNavbar_LWe7" id="https加密">HTTPS加密<a href="#https加密" class="hash-link" aria-label="Direct link to HTTPS加密" title="Direct link to HTTPS加密">​</a></h2><p>证书验证阶段：</p><ol><li>浏览器发起 HTTPS 请求；</li><li>服务端返回 HTTPS 证书；</li><li>客户端验证证书是否合法，如果不合法则提示告警。</li></ol><p>数据传输阶段:服务器生成一对公钥和私钥；将公钥传给客户端,客户端用公钥加密随机数生成密文，(注意：在https是不会把私钥给浏览器的,这并不安全)</p><ol><li>当证书验证合法后，在本地生成随机数；客户端通过公钥加密随机数，并生成密匙用来后续加密传输数据,并把加密后的随机数传输到服务端</li><li>服务端通过私钥对随机数进行解密；服务端通过客户端传入的随机数构造对称加密算法，对返回结果内容进行解密后。同样也可以用对称密匙加密数据给客户端。</li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="基础加密方法非对称加密">基础加密方法：非对称加密<a href="#基础加密方法非对称加密" class="hash-link" aria-label="Direct link to 基础加密方法：非对称加密" title="Direct link to 基础加密方法：非对称加密">​</a></h3><p>非对称加密算法需要两个密钥：</p><ul><li>公开密钥（publicKey:简称公钥）,公钥用于对数据加密</li><li>私有密钥（privateKey:简称私钥）,私钥用于对数据解密,如果用公钥对数据进行加密，只有用对应的私钥才能解密</li></ul><ul><li>就算公钥被劫持，但客户端使用公钥加密的数据只能用私钥解密。因为加密和解密使用的是两个不同的密钥，所以这种算法叫作非对称加密算法。</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="https中单纯使用非对称加密造成的问题">https中单纯使用非对称加密造成的问题<a href="#https中单纯使用非对称加密造成的问题" class="hash-link" aria-label="Direct link to https中单纯使用非对称加密造成的问题" title="Direct link to https中单纯使用非对称加密造成的问题">​</a></h3><p>问题所在：服务端给客户端发数据时就不能进行加密,只能加密：客户端--&gt;服务端</p><p>客户端可以使用公钥进行加密服务端使用私钥解密，但是服务端给客户端发数据时就不能进行加密了，因为客户端只有公钥，服务端只有私钥，如果要加密，服务端只能把私钥也传给客户端，客户端才能解密，这样肯定不安全。</p><p>解决办法是采用随机数，客户端用公钥加密随机数--&gt;把对称加密的密匙存在本地</p><p>服务端接收加密的随机数，用私钥解密后构建对称的密匙，然后解密</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="为什么数据传输是用对称加密效率">为什么数据传输是用对称加密？效率<a href="#为什么数据传输是用对称加密效率" class="hash-link" aria-label="Direct link to 为什么数据传输是用对称加密？效率" title="Direct link to 为什么数据传输是用对称加密？效率">​</a></h3><p>在 HTTPS 的场景中只有服务端保存了私钥，一对公私钥只能实现单向的加解密，所以HTTPS中内容传输加密采取的是对称加密，而不是非对称加密。</p><p>首先：非对称加密的加解密效率是非常低的，而http的应用场景中通常端与端之间存在大量的交互，非对称加密的效率是无法接受的。</p><p>基础加密方法:对称加密
加密和解密使用的密钥是一样的,具体实现:</p><blockquote><p>在每次发送真实数据之前，客户端先生成一把密钥，然后先把密钥传输给服务端。之后客户端给服务端发送真实数据的时候，会用这把密钥对数据进行加密，服务端收到加密数据之后，用刚才收到的密钥进行解密。</p></blockquote><p>这种加密方式运用在客户端与服务器数据传输安全吗，显然是不安全的，因为密钥也需要被传输，而且是明文传输。
优点</p><ul><li>加密算法与解密算法想同。</li><li>加密算法的优点：加密解密的效率很高；</li><li>加密算法的缺点：容易被劫持，使用时间稍长就会被中间劫持，根据数据规率找破解出加密算法。</li><li>解决方案：可以每次通信都动态协商一个加密算法，但还是有可能被劫持掉。</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="但是非对称加密的方式也并非万无一失在此举个例子">但是，非对称加密的方式也并非万无一失，在此举个例子：<a href="#但是非对称加密的方式也并非万无一失在此举个例子" class="hash-link" aria-label="Direct link to 但是，非对称加密的方式也并非万无一失，在此举个例子：" title="Direct link to 但是，非对称加密的方式也并非万无一失，在此举个例子：">​</a></h3><p>服务器以明文的方式给客户端传输公钥的时候，中间人截取了这把属于服务器的公钥，并且把中间人自己的公钥冒充服务器的公钥传输给了客户端。</p><p>之后客户端就会用中间人的公钥来加密自己生成的密钥。然后把被加密的密钥传输给服务器，这个时候中间人又把密钥给截取了，中间人用自己的私钥对这把被加密的密钥进行解密，解密后中间人就可以获得这把密钥了。</p><p>最后中间人再对这把密钥用刚才服务器的公钥进行加密，再发给服务器。</p><p>毫无疑问，在这个过程中，中间人获取了对称加密中的密钥，在之后服务器和客户端的对称加密传输中，这些加密的数据对中间人来说，和明文没啥区别。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="所以引入了数字证书认证中心">所以引入了，数字证书认证中心<a href="#所以引入了数字证书认证中心" class="hash-link" aria-label="Direct link to 所以引入了，数字证书认证中心" title="Direct link to 所以引入了，数字证书认证中心">​</a></h3><p>非对称性加密之所以不安全，是应为客户端不知道，这把公钥是不是服务器的。
如上所说，为了解决公钥来源的不安全性，引入第三方 数字证书认证中心（CA）</p><ul><li>签名证书：进行身份验证；并且传送公钥信息，公司生成一对密钥之后，拿到权威机构处生成一个签名证书，证书包含：公钥信息，权威机构信息，公司机构信息，有效时间等。</li><li>SSl加密过程：在通信的时候，连接建立之后，服务器先向客户端传送证书，客户端通过证书的信息进行验证：①若身份验证不通过，则可以直接断开连接，若身份验证通过，然后用证书中的公钥加密对称算法的协商过程，最终利用协商好的对称加密算法对数据通信进行加密。</li></ul><p>服务器可以向CA来申请数字证书</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">因此，我们需要找到一种策略来证明这把公钥就是服务器的，而不是别人冒充的,就像身份证一样，唯一标识我们服务器的公钥，解决这个问题的方式就是使用数字证书，具体是这样的.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">互联网世界中充当公理的机构来签发这个证书，它就是CA机构，它是如今互联网世界正常运作的前提，而CA机构颁发的“身份证”就是数字证书：</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">网站在使用HTTPS前，需要向CA机构申领一份数字证书，数字证书里含有证书持有者信息、公钥信息等。服务器把证书传输给浏览器，浏览器从证书里获取公钥就行了，证书就如身份证，证明“该公钥对应该网站”。而这里又有一个显而易见的问题，“证书本身的传输过程中，如何防止被篡改”？即如何证明证书本身的真实性？身份证运用了一些防伪技术，而数字证书怎么防伪呢？</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">我们把证书原本的内容生成一份“签名”，比对证书内容和签名是否一致就能判别是否被篡改。这就是数字证书的“防伪技术”，这里的“签名”就叫数字签名：</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">数字签名的制作过程：</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">CA机构拥有非对称加密的私钥和公钥。</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">CA机构对证书明文数据T进行hash。</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">对hash后的值用私钥加密，得到数字签名S。</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">明文和数字签名共同组成了数字证书，这样一份数字证书就可以颁发给网站了。</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="https是什么">HTTPS是什么？<a href="#https是什么" class="hash-link" aria-label="Direct link to HTTPS是什么？" title="Direct link to HTTPS是什么？">​</a></h2><p>HTTP + 加密 + 认证 + 完整性保护 = HTTPS</p><p>HTTPS 是身披 SSL 外壳的 HTTP,通常，HTTP 直接和 TCP 通信。HTTPS 并非是应用层的一种新协议。只是 HTTP 通信接口部分用 SSL（Secure Socket Layer）和 TLS（Transport Layer Security）协议代替而已。 </p><p>当使用 SSL 时，则演变成先和 SSL 通信，再由 SSL 和 TCP 通信了。简言之，所谓 HTTPS，其实就是身披 SSL 协议这层外壳的 HTTP。</p><p>在采用 SSL 后，HTTP 就拥有了 HTTPS 的加密、证书和完整性保护这些功能。 SSL 是独立于 HTTP 的协议，所以不光是 HTTP 协议，其他运行在应用层的 SMTP 和 Telnet 等协议均可配合 SSL 协议使用。可以说 SSL 是当今世界上应用最为广泛的网络安全技术。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="ssl的基本概念">SSL的基本概念<a href="#ssl的基本概念" class="hash-link" aria-label="Direct link to SSL的基本概念" title="Direct link to SSL的基本概念">​</a></h3><p>SSL/TLS协议提供的服务主要有：</p><ul><li>认证用户和服务器，确保数据发送到正确的客户机和服务器；</li><li>加密数据以防止数据中途被窃取；</li><li>维护数据的完整性，确保数据在传输过程中不被改变。</li></ul><p>SSL（Secure Socket Layer，安全套接字层）/TLS(Transport Layer Security，传输层安全协议)</p><p>TLS 是以SSL 为原型开发的协议，有时会统一称该协议为 SSL。*当前主流的版本是SSL3.0 和 TLS1.0</p><p>SSL位于应用层和传输层之间，所以可以为任何基于TCP等可靠连接的应用层协议提供安全性保证，用于Web浏览器和服务器之间的身份认证和加密数据传输.</p><p>SSL{SSL记录层：位于可靠的传输之上（比如TCP），提供压缩，认证，加密等功能</p><p>SSL握手层：位于ssl记录层之上，提供数据传输前的身份验证，协商算法，交换密钥等功能。}</p><p>（2）SSL/TLS握手阶段（建立通信连接）</p><p>（1）浏览器发出加密通信的请求（ClientHello）</p><p><img loading="lazy" src="/assets/images/图-1-https-ssl过程-6710b2b12dee47f1df2ad6629de35068.jpg" width="1918" height="777" class="img_ev3q">
<img loading="lazy" src="/assets/images/图-2-https-ssl过程1-96b649314fa529655547291c217a4cdd.jpg" width="1918" height="777" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="http与https的区别">Http与Https的区别<a href="#http与https的区别" class="hash-link" aria-label="Direct link to Http与Https的区别" title="Direct link to Http与Https的区别">​</a></h3><ul><li>HTTP:应用层，HTTPS的安全传输机制工作在传输层</li><li>HTTP 无法加密，而HTTPS 对传输的数据进行加密,HTTP 是不安全的，而 HTTPS 是安全的</li><li>HTTP无需证书，而HTTPS 需要CA机构wosign的颁发的SSL证书</li><li>HTTP 标准端口是80 ，而 HTTPS 的标准端口是443</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="数字证书无法篡改的原因">数字证书无法篡改的原因？<a href="#数字证书无法篡改的原因" class="hash-link" aria-label="Direct link to 数字证书无法篡改的原因？" title="Direct link to 数字证书无法篡改的原因？">​</a></h2><p>1.拿到证书，如果伪造证书，但是你没有CA的密钥C2</p><p>2.如果直接使用原数据，可以解密后看数据，证书里面是有host的，如果你的网站的host和证书不一致，也不行</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="总结https-在内容传输的加密上使用的是对称加密非对称加密只作用在证书验证阶段">总结：HTTPS 在内容传输的加密上使用的是对称加密，非对称加密只作用在证书验证阶段<a href="#总结https-在内容传输的加密上使用的是对称加密非对称加密只作用在证书验证阶段" class="hash-link" aria-label="Direct link to 总结：HTTPS 在内容传输的加密上使用的是对称加密，非对称加密只作用在证书验证阶段" title="Direct link to 总结：HTTPS 在内容传输的加密上使用的是对称加密，非对称加密只作用在证书验证阶段">​</a></h3><p>场景1：客户端--&gt;服务端</p><p>客户端用密文加密data，服务端通过私钥对随机数进行解密，然后解密data</p><p>场景2：服务端--&gt;客户端
服务端用随机数构造对称加密算法,加密后传data,客户端用随机数密文解密</p><ul><li><p>优点：安全性高，不容易被破解。</p></li><li><p>缺点：解密效率比较低。</p></li><li><p>对称加密算法和非对称加密算法结合起来：</p><ul><li>将客户端与服务端动态协商对称算法过程用非对称算法加密起来；</li><li>使用协商的对称加密算法对数据通信过程进行加密，这样既保证了安全，也提高了效率。</li></ul></li><li><p>存在的问题：若中间黑客劫持了服务器发送给客户端的公钥，然后将自己的公钥发送给客户端，因为客户端不知道服务端的身份，所以就出现数据被劫持。若客户端能够知道服务无端身份，就不怕劫持了，所以又引进了：签名证书。</p></li></ul><p><img loading="lazy" src="/assets/images/https-加密-证书验证和数据传输阶段-b050a31a398a1c3c1f68858d0a4de5e7.png" width="800" height="777" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="https握手-中间人攻击">https握手-中间人攻击<a href="#https握手-中间人攻击" class="hash-link" aria-label="Direct link to https握手-中间人攻击" title="Direct link to https握手-中间人攻击">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="https的详细握手过程">https的详细握手过程<a href="#https的详细握手过程" class="hash-link" aria-label="Direct link to https的详细握手过程" title="Direct link to https的详细握手过程">​</a></h3><p>https在七层协议里面属于应用层，基于tcp协议</p><p>https握手先经过tcp的三次握手，tcp链接建立好之后，才进入https的对称密钥协商过程，对称密钥协商好之后，就开始正常的收发数据流程。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="wireshark抓网络数据包来解释https的整个详细的握手过程">wireshark抓网络数据包来解释https的整个详细的握手过程<a href="#wireshark抓网络数据包来解释https的整个详细的握手过程" class="hash-link" aria-label="Direct link to wireshark抓网络数据包来解释https的整个详细的握手过程" title="Direct link to wireshark抓网络数据包来解释https的整个详细的握手过程">​</a></h3><p>fiddler 和charles主要是用于抓取应用层协议https/http等上层的应用数据，都是建立链接成功后的数据，而wireshark是可以抓取所有协议的数据包（直接读取网卡数据）,我们的目的是抓取https建立链接成功前的过程，所以我们选择wireshark</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">执行：</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">curl https://www.baidu.com</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>为什么是用curl， 而不是在浏览器打开<a href="https://www.baidu.com" target="_blank" rel="noopener noreferrer">https://www.baidu.com</a></p><p>curl是只发送一个请求，如果是用浏览器打开百度，那百度页面里面的各种资源也会发送请求，容易造成很多不必要的数据包</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="ack消息属于tcp协议里面的确认报文">ack消息属于tcp协议里面的确认报文<a href="#ack消息属于tcp协议里面的确认报文" class="hash-link" aria-label="Direct link to ack消息属于tcp协议里面的确认报文" title="Direct link to ack消息属于tcp协议里面的确认报文">​</a></h3><p>解释说明：tcp三次握手:比如ack，seq,mss,win都代表什么意思
<img loading="lazy" src="/assets/images/01-抓包-065f20ce9d1aea3969309e89b808dce0.png" width="1334" height="64" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="步骤2客户端发送client_hello">步骤2.客户端发送client_hello<a href="#步骤2客户端发送client_hello" class="hash-link" aria-label="Direct link to 步骤2.客户端发送client_hello" title="Direct link to 步骤2.客户端发送client_hello">​</a></h3><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">客户端发送client_hello，包含以下内容（请自行对照上图） 1. 包含TLS版本信息 2. 随机数（用于后续的密钥协商）random_C 3. 加密套件候选列表 4. 压缩算法候选列表 5. 扩展字段 6. 其他</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" src="/assets/images/02-抓包-bd99168c88423e7cd2a62e0543aaaf52.png" width="1308" height="581" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="步骤3服务端发送server_hello">步骤3：服务端发送server_hello<a href="#步骤3服务端发送server_hello" class="hash-link" aria-label="Direct link to 步骤3：服务端发送server_hello" title="Direct link to 步骤3：服务端发送server_hello">​</a></h3><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">服务端收到客户端的client_hello之后，发送server_hello，并返回协商的信息结果</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">1. 选择使用的TLS协议版本 version</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">2. 选择的加密套件 cipher suite</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">3. 选择的压缩算法 compression method</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">4. 随机数 random_S</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">5. 其他</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" src="/assets/images/03-抓包-e9a3204edf00c4a78602a7efaa3eb31e.png" width="1290" height="493" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="服务端发送证书">服务端发送证书<a href="#服务端发送证书" class="hash-link" aria-label="Direct link to 服务端发送证书" title="Direct link to 服务端发送证书">​</a></h3><p>服务端发送完server_hello后，紧接着开始发送自己的证书从图可知：因包含证书的报文长度是3761，所以此报文在tcp这块做了分段，分了3个报文把证书发送完了
<img loading="lazy" src="/assets/images/04-抓包-354a7cc072b828c472a1e8428ebe1a6a.png" width="1347" height="461" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="服务端发送server-key-exchange">服务端发送Server Key Exchange<a href="#服务端发送server-key-exchange" class="hash-link" aria-label="Direct link to 服务端发送Server Key Exchange" title="Direct link to 服务端发送Server Key Exchange">​</a></h3><p>解释说明:对于使用DHE/ECDHE非对称密钥协商算法的SSL握手，将发送该类型握手。RSA算法不会进行该握手流程（DH、ECDH也不会发送server key exchange）,也就是说此报文不一定要发送，视加密算法而定。SSL中的RSA、DHE、ECDHE、ECDH流程与区别可以参考此篇文章
<a href="https://blog.csdn.net/mrpre/article/details/78025940" target="_blank" rel="noopener noreferrer">https://blog.csdn.net/mrpre/article/details/78025940</a></p><p><img loading="lazy" src="/assets/images/05-抓包-43d571780d4d406b124ef2024cab0ab6.png" width="1337" height="441" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="服务端发送server-hello-done">服务端发送Server Hello Done<a href="#服务端发送server-hello-done" class="hash-link" aria-label="Direct link to 服务端发送Server Hello Done" title="Direct link to 服务端发送Server Hello Done">​</a></h3><p>通知客户端 server_hello 信息发送结束
<img loading="lazy" src="/assets/images/06-抓包-4e86d24c7ab0a2f4a5e09c1a6ea49b84.png" width="1299" height="318" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="客户端发送">客户端发送<a href="#客户端发送" class="hash-link" aria-label="Direct link to 客户端发送" title="Direct link to 客户端发送">​</a></h3><p>client_key_exchange+change_cipher_spec+encrypted_handshake_message</p><ol><li>client_key_exchange，合法性验证通过之后，向服务器发送自己的公钥参数，这里客户端实际上已经计算出了密钥</li><li>change_cipher_spec，客户端通知服务器后续的通信都采用协商的通信密钥和加密算法进行加密通信</li><li>encrypted_handshake_message，主要是用来测试密钥的有效性和一致性</li></ol><p><img loading="lazy" src="/assets/images/07-抓包-d12e6e56f6620247a450f6debf7a1e65.png" width="1313" height="562" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="0-8服务端发送new-session-ticket">0-8.服务端发送New Session Ticket<a href="#0-8服务端发送new-session-ticket" class="hash-link" aria-label="Direct link to 0-8.服务端发送New Session Ticket" title="Direct link to 0-8.服务端发送New Session Ticket">​</a></h3><p>服务器给客户端一个会话，用处就是在一段时间之内（超时时间到来之前），双方都以协商的密钥进行通信。
<img loading="lazy" src="/assets/images/08-抓包-b195aa6a5d8048e260034737114addf5.png" width="1305" height="442" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="0-9服务端发送change_cipher_spec">0-9.服务端发送change_cipher_spec<a href="#0-9服务端发送change_cipher_spec" class="hash-link" aria-label="Direct link to 0-9.服务端发送change_cipher_spec" title="Direct link to 0-9.服务端发送change_cipher_spec">​</a></h3><p>服务端解密客户端发送的参数，然后按照同样的算法计算出协商密钥，并通过客户端发送的encrypted_handshake_message验证有效性，验证通过，发送该报文，告知客户端，以后可以拿协商的密钥来通信了
<img loading="lazy" src="/assets/images/09-抓包-a7872ba40cd47e83193c26fbb5d4d94e.png" width="1267" height="299" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="0-10服务端发送encrypted_handshake_message">0-10.服务端发送encrypted_handshake_message<a href="#0-10服务端发送encrypted_handshake_message" class="hash-link" aria-label="Direct link to 0-10.服务端发送encrypted_handshake_message" title="Direct link to 0-10.服务端发送encrypted_handshake_message">​</a></h3><p>目的同样是测试密钥的有效性，客户端发送该报文是为了验证服务端能正常解密，客户端能正常加密，相反：服务端发送该报文是为了验证客户端能正常解密，服务端能正常加密
<img loading="lazy" src="/assets/images/10-抓包-7c6492a69dadcbeffa77e2fe16ea26bb.png" width="1265" height="281" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="0-11完成密钥协商开始发送数据">0-11.完成密钥协商，开始发送数据<a href="#0-11完成密钥协商开始发送数据" class="hash-link" aria-label="Direct link to 0-11.完成密钥协商，开始发送数据" title="Direct link to 0-11.完成密钥协商，开始发送数据">​</a></h3><p>数据同样是分段发送的
<img loading="lazy" src="/assets/images/11-抓包-c5cfd15386ce0ff06271ed93c727bec2.png" width="1350" height="396" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="0-12完成数据发送4次tcp挥手">0-12.完成数据发送，4次tcp挥手<a href="#0-12完成数据发送4次tcp挥手" class="hash-link" aria-label="Direct link to 0-12.完成数据发送，4次tcp挥手" title="Direct link to 0-12.完成数据发送，4次tcp挥手">​</a></h3><p>红框的意思是：客户端或服务器发送的，意味着加密通信因为某些原因需要中断，警告对方不要再发送敏感的数据,服务端数据发送完成也会有此数据包，可不关注</p><p><img loading="lazy" src="/assets/images/12-抓包-dbfd12fe20ef61f53fb124e3e268e608.png" width="1223" height="109" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="0-13总结">0-13.总结<a href="#0-13总结" class="hash-link" aria-label="Direct link to 0-13.总结" title="Direct link to 0-13.总结">​</a></h3><p><img loading="lazy" src="/assets/images/13-总结-fa54e7271b4ea48c0a6c2d9e2318240c.png" width="1240" height="2046" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="用了-https-会被抓包吗">用了 HTTPS 会被抓包吗？<a href="#用了-https-会被抓包吗" class="hash-link" aria-label="Direct link to 用了 HTTPS 会被抓包吗？" title="Direct link to 用了 HTTPS 会被抓包吗？">​</a></h2><p>HTTPS 的数据是加密的，常规下抓包工具代理请求后抓到的包内容是加密状态，无法直接查看。</p><p>为什么charles等抓包工具看到的也是明文的呢？</p><p>浏览器是属于应用层之上的应用吧，所以浏览器控制台的输出都是已经经过tls解密过的。
为什么charles等抓包工具看到的也是明文的呢？是不是也是因为charles是应用层之上的应用呢？不尽然如此！charles在抓包过程中是起到了中间代理的作用，浏览器=====》Charles======》服务器，charles相对于浏览器来说，是服务端，相对于服务端来时，是客户端。charles在抓取https的包时，是需要浏览器先安装并信任自己的证书的（相当于服务器的证书）</p><p>但是，正如前文所说，浏览器只会提示安全风险，如果用户授权仍然可以继续访问网站，完成请求。因此，只要客户端是我们自己的终端，我们授权的情况下，便可以组建中间人网络，而抓包工具便是作为中间人的代理。通常 HTTPS 抓包工具的使用方法是会生成一个证书，用户需要手动把证书安装到客户端中，然后终端发起的所有请求通过该证书完成与抓包工具的交互，然后抓包工具再转发请求到服务器，最后把服务器返回的结果在控制台输出后再返回给终端，从而完成整个请求的闭环。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="既然-https-不能防抓包那-https-有什么意义">既然 HTTPS 不能防抓包，那 HTTPS 有什么意义？<a href="#既然-https-不能防抓包那-https-有什么意义" class="hash-link" aria-label="Direct link to 既然 HTTPS 不能防抓包，那 HTTPS 有什么意义？" title="Direct link to 既然 HTTPS 不能防抓包，那 HTTPS 有什么意义？">​</a></h3><p>HTTPS 可以防止用户在不知情的情况下通信链路被监听，对于主动授信的抓包操作是不提供防护的，因为这个场景用户是已经对风险知情。要防止被抓包，需要采用应用级的安全防护，例如采用私有的对称加密，同时做好移动端的防反编译加固，防止本地算法被破解。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="1为什么需要-ca-认证机构颁发证书">1.为什么需要 CA 认证机构颁发证书？<a href="#1为什么需要-ca-认证机构颁发证书" class="hash-link" aria-label="Direct link to 1.为什么需要 CA 认证机构颁发证书？" title="Direct link to 1.为什么需要 CA 认证机构颁发证书？">​</a></h2><p>HTTP 协议被认为不安全是因为传输过程容易被监听者勾线监听、伪造服务器，而 HTTPS 协议主要解决的便是网络传输的安全性问题。</p><p>首先我们假设不存在认证机构，任何人都可以制作证书，这带来的安全风险便是经典的“中间人攻击”问题。</p><p>1）本地请求被劫持（如DNS劫持等），所有请求均发送到中间人的服务器；
2）中间人服务器返回中间人自己的证书；
3）客户端创建随机数，通过中间人证书的公钥对随机数加密后传送给中间人，然后凭随机数构造对称加密对传输内容进行加密传输；
4）中间人因为拥有客户端的随机数，可以通过对称加密算法进行内容解密；
5）中间人以客户端的请求内容再向正规网站发起请求；
6）因为中间人与服务器的通信过程是合法的，正规网站通过建立的安全通道返回加密后的数据；
7）中间人凭借与正规网站建立的对称加密算法对内容进行解密；
8）中间人通过与客户端建立的对称加密算法对正规内容返回的数据进行加密传输；
9）客户端通过与中间人建立的对称加密算法对返回结果数据进行解密。
由于缺少对证书的验证，所以客户端虽然发起的是 HTTPS 请求，但客户端完全不知道自己的网络已被拦截，传输内容被中间人全部窃取。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-1证书包含什么信息">1-1.证书包含什么信息？<a href="#1-1证书包含什么信息" class="hash-link" aria-label="Direct link to 1-1.证书包含什么信息？" title="Direct link to 1-1.证书包含什么信息？">​</a></h3><p>1）颁发机构信息；
2）公钥；
3）公司信息；
4）域名；
5）有效期；
6）指纹；</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-2浏览器如何验证证书的合法性">1-2.浏览器如何验证证书的合法性？<a href="#1-2浏览器如何验证证书的合法性" class="hash-link" aria-label="Direct link to 1-2.浏览器如何验证证书的合法性？" title="Direct link to 1-2.浏览器如何验证证书的合法性？">​</a></h3><p>浏览器发起 HTTPS 请求时，服务器会返回网站的 SSL 证书，浏览器需要对证书做以下验证：
1）验证域名、有效期等信息是否正确：证书上都有包含这些信息，比较容易完成验证；</p><p>2）判断证书来源是否合法：每份签发证书都可以根据验证链查找到对应的根证书，操作系统、浏览器会在本地存储权威机构的根证书，利用本地根证书可以对对应机构签发证书完成来源验证</p><p>3）判断证书是否被篡改：需要与 CA 服务器进行校验；</p><p>4）判断证书是否已吊销：通过CRL（Certificate Revocation List 证书注销列表）和 OCSP（Online Certificate Status Protocol 在线证书状态协议）实现，其中 OCSP 可用于第3步中以减少与 CA 服务器的交互，提高验证效率。</p><p>以上任意一步都满足的情况下浏览器才认为证书是合法的</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-3既然证书是公开的如果要发起中间人攻击我在官网上下载一份证书作为我的服务器证书那客户端肯定会认同这个证书是合法的如何避免这种证书冒用的情况">1-3.既然证书是公开的，如果要发起中间人攻击，我在官网上下载一份证书作为我的服务器证书，那客户端肯定会认同这个证书是合法的，如何避免这种证书冒用的情况？<a href="#1-3既然证书是公开的如果要发起中间人攻击我在官网上下载一份证书作为我的服务器证书那客户端肯定会认同这个证书是合法的如何避免这种证书冒用的情况" class="hash-link" aria-label="Direct link to 1-3.既然证书是公开的，如果要发起中间人攻击，我在官网上下载一份证书作为我的服务器证书，那客户端肯定会认同这个证书是合法的，如何避免这种证书冒用的情况？" title="Direct link to 1-3.既然证书是公开的，如果要发起中间人攻击，我在官网上下载一份证书作为我的服务器证书，那客户端肯定会认同这个证书是合法的，如何避免这种证书冒用的情况？">​</a></h3><p>其实答案很简单的问题：
其实这就是非加密对称中公私钥的用处，虽然中间人可以得到证书，但私钥是无法获取的，一份公钥是不可能推算出其对应的私钥，中间人即使拿到证书也无法伪装成合法服务端，因为无法对客户端传入的加密数据进行解密。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-2本地随机数被窃取怎么办">1-2.本地随机数被窃取怎么办？<a href="#1-2本地随机数被窃取怎么办" class="hash-link" aria-label="Direct link to 1-2.本地随机数被窃取怎么办？" title="Direct link to 1-2.本地随机数被窃取怎么办？">​</a></h3><p>证书验证是采用非对称加密实现，但是传输过程是采用对称加密，而其中对称加密算法中重要的随机数是由本地生成并且存储于本地的，HTTPS 如何保证随机数不会被窃取？</p><p>其实 HTTPS 并不包含对随机数的安全保证，HTTPS 保证的只是传输过程安全，而随机数存储于本地，本地的安全属于另一安全范畴</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/huiruo/programming-tech-website/programming-tech/http-浏览器缓存/03-https-加密方式.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/http-浏览器缓存/TCP-IP-握手"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">TCP-IP-握手</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/http-浏览器缓存/跨域-反向代理-正向代理"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">跨域-反向代理-正向代理</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#https加密" class="table-of-contents__link toc-highlight">HTTPS加密</a><ul><li><a href="#基础加密方法非对称加密" class="table-of-contents__link toc-highlight">基础加密方法：非对称加密</a></li><li><a href="#https中单纯使用非对称加密造成的问题" class="table-of-contents__link toc-highlight">https中单纯使用非对称加密造成的问题</a></li><li><a href="#为什么数据传输是用对称加密效率" class="table-of-contents__link toc-highlight">为什么数据传输是用对称加密？效率</a></li><li><a href="#但是非对称加密的方式也并非万无一失在此举个例子" class="table-of-contents__link toc-highlight">但是，非对称加密的方式也并非万无一失，在此举个例子：</a></li><li><a href="#所以引入了数字证书认证中心" class="table-of-contents__link toc-highlight">所以引入了，数字证书认证中心</a></li></ul></li><li><a href="#https是什么" class="table-of-contents__link toc-highlight">HTTPS是什么？</a><ul><li><a href="#ssl的基本概念" class="table-of-contents__link toc-highlight">SSL的基本概念</a></li><li><a href="#http与https的区别" class="table-of-contents__link toc-highlight">Http与Https的区别</a></li></ul></li><li><a href="#数字证书无法篡改的原因" class="table-of-contents__link toc-highlight">数字证书无法篡改的原因？</a><ul><li><a href="#总结https-在内容传输的加密上使用的是对称加密非对称加密只作用在证书验证阶段" class="table-of-contents__link toc-highlight">总结：HTTPS 在内容传输的加密上使用的是对称加密，非对称加密只作用在证书验证阶段</a></li></ul></li><li><a href="#https握手-中间人攻击" class="table-of-contents__link toc-highlight">https握手-中间人攻击</a><ul><li><a href="#https的详细握手过程" class="table-of-contents__link toc-highlight">https的详细握手过程</a></li><li><a href="#wireshark抓网络数据包来解释https的整个详细的握手过程" class="table-of-contents__link toc-highlight">wireshark抓网络数据包来解释https的整个详细的握手过程</a></li><li><a href="#ack消息属于tcp协议里面的确认报文" class="table-of-contents__link toc-highlight">ack消息属于tcp协议里面的确认报文</a></li><li><a href="#步骤2客户端发送client_hello" class="table-of-contents__link toc-highlight">步骤2.客户端发送client_hello</a></li><li><a href="#步骤3服务端发送server_hello" class="table-of-contents__link toc-highlight">步骤3：服务端发送server_hello</a></li><li><a href="#服务端发送证书" class="table-of-contents__link toc-highlight">服务端发送证书</a></li><li><a href="#服务端发送server-key-exchange" class="table-of-contents__link toc-highlight">服务端发送Server Key Exchange</a></li><li><a href="#服务端发送server-hello-done" class="table-of-contents__link toc-highlight">服务端发送Server Hello Done</a></li><li><a href="#客户端发送" class="table-of-contents__link toc-highlight">客户端发送</a></li><li><a href="#0-8服务端发送new-session-ticket" class="table-of-contents__link toc-highlight">0-8.服务端发送New Session Ticket</a></li><li><a href="#0-9服务端发送change_cipher_spec" class="table-of-contents__link toc-highlight">0-9.服务端发送change_cipher_spec</a></li><li><a href="#0-10服务端发送encrypted_handshake_message" class="table-of-contents__link toc-highlight">0-10.服务端发送encrypted_handshake_message</a></li><li><a href="#0-11完成密钥协商开始发送数据" class="table-of-contents__link toc-highlight">0-11.完成密钥协商，开始发送数据</a></li><li><a href="#0-12完成数据发送4次tcp挥手" class="table-of-contents__link toc-highlight">0-12.完成数据发送，4次tcp挥手</a></li><li><a href="#0-13总结" class="table-of-contents__link toc-highlight">0-13.总结</a></li></ul></li><li><a href="#用了-https-会被抓包吗" class="table-of-contents__link toc-highlight">用了 HTTPS 会被抓包吗？</a><ul><li><a href="#既然-https-不能防抓包那-https-有什么意义" class="table-of-contents__link toc-highlight">既然 HTTPS 不能防抓包，那 HTTPS 有什么意义？</a></li></ul></li><li><a href="#1为什么需要-ca-认证机构颁发证书" class="table-of-contents__link toc-highlight">1.为什么需要 CA 认证机构颁发证书？</a><ul><li><a href="#1-1证书包含什么信息" class="table-of-contents__link toc-highlight">1-1.证书包含什么信息？</a></li><li><a href="#1-2浏览器如何验证证书的合法性" class="table-of-contents__link toc-highlight">1-2.浏览器如何验证证书的合法性？</a></li><li><a href="#1-3既然证书是公开的如果要发起中间人攻击我在官网上下载一份证书作为我的服务器证书那客户端肯定会认同这个证书是合法的如何避免这种证书冒用的情况" class="table-of-contents__link toc-highlight">1-3.既然证书是公开的，如果要发起中间人攻击，我在官网上下载一份证书作为我的服务器证书，那客户端肯定会认同这个证书是合法的，如何避免这种证书冒用的情况？</a></li><li><a href="#1-2本地随机数被窃取怎么办" class="table-of-contents__link toc-highlight">1-2.本地随机数被窃取怎么办？</a></li></ul></li></ul></div></div></div></div></main></div></div></div>
<script src="/assets/js/runtime~main.654f7f82.js"></script>
<script src="/assets/js/main.0a662770.js"></script>
</body>
</html>