"use strict";(self.webpackChunkprogramming_technology=self.webpackChunkprogramming_technology||[]).push([[8557],{3905:(r,e,n)=>{n.d(e,{Zo:()=>p,kt:()=>f});var t=n(67294);function o(r,e,n){return e in r?Object.defineProperty(r,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):r[e]=n,r}function a(r,e){var n=Object.keys(r);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(r);e&&(t=t.filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.push.apply(n,t)}return n}function i(r){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?a(Object(n),!0).forEach((function(e){o(r,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(e){Object.defineProperty(r,e,Object.getOwnPropertyDescriptor(n,e))}))}return r}function c(r,e){if(null==r)return{};var n,t,o=function(r,e){if(null==r)return{};var n,t,o={},a=Object.keys(r);for(t=0;t<a.length;t++)n=a[t],e.indexOf(n)>=0||(o[n]=r[n]);return o}(r,e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(r);for(t=0;t<a.length;t++)n=a[t],e.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(r,n)&&(o[n]=r[n])}return o}var s=t.createContext({}),l=function(r){var e=t.useContext(s),n=e;return r&&(n="function"==typeof r?r(e):i(i({},e),r)),n},p=function(r){var e=l(r.components);return t.createElement(s.Provider,{value:e},r.children)},u="mdxType",d={inlineCode:"code",wrapper:function(r){var e=r.children;return t.createElement(t.Fragment,{},e)}},m=t.forwardRef((function(r,e){var n=r.components,o=r.mdxType,a=r.originalType,s=r.parentName,p=c(r,["components","mdxType","originalType","parentName"]),u=l(n),m=o,f=u["".concat(s,".").concat(m)]||u[m]||d[m]||a;return n?t.createElement(f,i(i({ref:e},p),{},{components:n})):t.createElement(f,i({ref:e},p))}));function f(r,e){var n=arguments,o=e&&e.mdxType;if("string"==typeof r||o){var a=n.length,i=new Array(a);i[0]=m;var c={};for(var s in e)hasOwnProperty.call(e,s)&&(c[s]=e[s]);c.originalType=r,c[u]="string"==typeof r?r:o,i[1]=c;for(var l=2;l<a;l++)i[l]=n[l];return t.createElement.apply(null,i)}return t.createElement.apply(null,n)}m.displayName="MDXCreateElement"},16879:(r,e,n)=>{n.r(e),n.d(e,{assets:()=>s,contentTitle:()=>i,default:()=>d,frontMatter:()=>a,metadata:()=>c,toc:()=>l});var t=n(87462),o=(n(67294),n(3905));const a={},i=void 0,c={unversionedId:"JavaScript/js\u9519\u8bef\u5904\u7406",id:"JavaScript/js\u9519\u8bef\u5904\u7406",title:"js\u9519\u8bef\u5904\u7406",description:"window.onerror",source:"@site/programming-tech/JavaScript/98-js\u9519\u8bef\u5904\u7406.md",sourceDirName:"JavaScript",slug:"/JavaScript/js\u9519\u8bef\u5904\u7406",permalink:"/JavaScript/js\u9519\u8bef\u5904\u7406",draft:!1,editUrl:"https://github.com/huiruo/programming-tech-website/edit/main/programming-tech/JavaScript/98-js\u9519\u8bef\u5904\u7406.md",tags:[],version:"current",sidebarPosition:98,frontMatter:{},sidebar:"docs",previous:{title:"window.history",permalink:"/JavaScript/window.history"},next:{title:"URLSearchParams-URLSearchParams",permalink:"/JavaScript/URLSearchParams-URLSearchParams"}},s={},l=[{value:"window.onerror",id:"windowonerror",level:2},{value:"react\u51fd\u6570\u7ec4\u4ef6\u5b9e\u73b0\u7684\u9519\u8bef\u8fb9\u754c",id:"react\u51fd\u6570\u7ec4\u4ef6\u5b9e\u73b0\u7684\u9519\u8bef\u8fb9\u754c",level:2},{value:"react17\u5728\u7c7b\u7ec4\u4ef6\u4e2d",id:"react17\u5728\u7c7b\u7ec4\u4ef6\u4e2d",level:3}],p={toc:l},u="wrapper";function d(r){let{components:e,...n}=r;return(0,o.kt)(u,(0,t.Z)({},p,n,{components:e,mdxType:"MDXLayout"}),(0,o.kt)("h2",{id:"windowonerror"},"window.onerror"),(0,o.kt)("p",null,"\u8be5\u65b9\u6cd5\u53ef\u4ee5\u6355\u83b7\u6240\u6709\u672a\u88ab\u6355\u83b7\u7684 JavaScript \u5f02\u5e38\uff0c\u5e76\u5c06\u5176\u4f5c\u4e3a\u53c2\u6570\u4f20\u9012\u7ed9\u5904\u7406\u7a0b\u5e8f\u51fd\u6570\u3002"),(0,o.kt)("p",null,"\u8981\u5728\u9879\u76ee\u4e2d\u4f7f\u7528 window.onerror \u65b9\u6cd5\uff0c\u60a8\u9700\u8981\u5728\u5168\u5c40\u8303\u56f4\u5185\u5b9a\u4e49\u8be5\u65b9\u6cd5\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-html"},"<!DOCTYPE html>\n<html>\n<head>\n  <meta charset=\"UTF-8\">\n  <title>My Website</title>\n  <script>\n    window.onerror = function(message, url, line, column, error) {\n      console.log('\u53d1\u751f\u4e86\u5f02\u5e38\uff1a' + message);\n      console.log('\u5728\u6587\u4ef6 ' + url + ' \u7684\u7b2c ' + line + ' \u884c\uff0c\u7b2c ' + column + ' \u5217');\n      console.log('\u9519\u8bef\u5bf9\u8c61\uff1a', error);\n    };\n  <\/script>\n</head>\n<body>\n  \x3c!-- \u9875\u9762\u5185\u5bb9 --\x3e\n  <script src=\"main.js\"><\/script>\n</body>\n</html>\n")),(0,o.kt)("h2",{id:"react\u51fd\u6570\u7ec4\u4ef6\u5b9e\u73b0\u7684\u9519\u8bef\u8fb9\u754c"},"react\u51fd\u6570\u7ec4\u4ef6\u5b9e\u73b0\u7684\u9519\u8bef\u8fb9\u754c"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"import React, { useState, useEffect } from 'react';\n\nfunction ErrorBoundary({ children }) {\n  const [hasError, setHasError] = useState(false);\n\n  useEffect(() => {\n    const handleErrors = (error, info) => {\n      // \u5728\u8fd9\u91cc\u5904\u7406\u5f02\u5e38\n      console.log('\u53d1\u751f\u4e86\u5f02\u5e38\uff1a' + error);\n      console.log('\u5806\u6808\u4fe1\u606f\uff1a' + info.componentStack);\n      setHasError(true);\n    };\n    window.addEventListener('error', handleErrors);\n    return () => window.removeEventListener('error', handleErrors);\n  }, []);\n\n  if (hasError) {\n    // \u5728\u8fd9\u91cc\u5448\u73b0\u5907\u7528 UI\n    return <h1>\u53d1\u751f\u4e86\u9519\u8bef</h1>;\n  }\n  return children;\n}\n\nexport default ErrorBoundary;\n")),(0,o.kt)("p",null,"\u4f7f\u7528\uff1a"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"import React from 'react';\nimport ErrorBoundary from './ErrorBoundary';\n\nfunction MyComponent() {\n  // \u5728\u8fd9\u91cc\u5b9a\u4e49\u7ec4\u4ef6\n}\n\nexport default function App() {\n  return (\n    <ErrorBoundary>\n      <MyComponent />\n    </ErrorBoundary>\n  );\n}\n")),(0,o.kt)("h3",{id:"react17\u5728\u7c7b\u7ec4\u4ef6\u4e2d"},"react17\u5728\u7c7b\u7ec4\u4ef6\u4e2d"),(0,o.kt)("p",null,"\u4f7f\u7528 static getDerivedStateFromError() \u548c componentDidCatch() \u65b9\u6cd5\u6765\u4ee3\u66ff componentDidCatch() \u65b9\u6cd5\u6765\u5904\u7406\u9519\u8bef:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"class ErrorBoundary extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = { hasError: false, error: null, errorInfo: null };\n  }\n\n  static getDerivedStateFromError(error) {\n    return { hasError: true, error: error };\n  }\n\n  componentDidCatch(error, errorInfo) {\n    console.error(error, errorInfo);\n    this.setState({ errorInfo: errorInfo });\n  }\n\n  render() {\n    if (this.state.hasError) {\n      return (\n        <div>\n          <h1>Oops! Something went wrong.</h1>\n          <p>{this.state.error && this.state.error.toString()}</p>\n          <p>{this.state.errorInfo.componentStack}</p>\n        </div>\n      );\n    }\n\n    return this.props.children;\n  }\n}\n\nclass App extends React.Component {\n  render() {\n    return (\n      <div>\n        <ErrorBoundary>\n          <App />\n        </ErrorBoundary>\n      </div>\n    );\n  }\n}\n")))}d.isMDXComponent=!0}}]);