"use strict";(self.webpackChunkprogramming_technology=self.webpackChunkprogramming_technology||[]).push([[2575],{3905:(e,n,r)=>{r.d(n,{Zo:()=>p,kt:()=>k});var t=r(67294);function o(e,n,r){return n in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}function a(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);n&&(t=t.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),r.push.apply(r,t)}return r}function l(e){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?a(Object(r),!0).forEach((function(n){o(e,n,r[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))}))}return e}function s(e,n){if(null==e)return{};var r,t,o=function(e,n){if(null==e)return{};var r,t,o={},a=Object.keys(e);for(t=0;t<a.length;t++)r=a[t],n.indexOf(r)>=0||(o[r]=e[r]);return o}(e,n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(t=0;t<a.length;t++)r=a[t],n.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}var i=t.createContext({}),c=function(e){var n=t.useContext(i),r=n;return e&&(r="function"==typeof e?e(n):l(l({},n),e)),r},p=function(e){var n=c(e.components);return t.createElement(i.Provider,{value:n},e.children)},d="mdxType",u={inlineCode:"code",wrapper:function(e){var n=e.children;return t.createElement(t.Fragment,{},n)}},m=t.forwardRef((function(e,n){var r=e.components,o=e.mdxType,a=e.originalType,i=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),d=c(r),m=o,k=d["".concat(i,".").concat(m)]||d[m]||u[m]||a;return r?t.createElement(k,l(l({ref:n},p),{},{components:r})):t.createElement(k,l({ref:n},p))}));function k(e,n){var r=arguments,o=n&&n.mdxType;if("string"==typeof e||o){var a=r.length,l=new Array(a);l[0]=m;var s={};for(var i in n)hasOwnProperty.call(n,i)&&(s[i]=n[i]);s.originalType=e,s[d]="string"==typeof e?e:o,l[1]=s;for(var c=2;c<a;c++)l[c]=r[c];return t.createElement.apply(null,l)}return t.createElement.apply(null,r)}m.displayName="MDXCreateElement"},15801:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>i,contentTitle:()=>l,default:()=>u,frontMatter:()=>a,metadata:()=>s,toc:()=>c});var t=r(87462),o=(r(67294),r(3905));const a={title:"jsx-ast-render\u9636\u6bb5",sidebar_position:1},l="\u524d\u8a00",s={unversionedId:"React/jsx-ast-render\u9636\u6bb5",id:"React/jsx-ast-render\u9636\u6bb5",title:"jsx-ast-render\u9636\u6bb5",description:"react \u6a21\u677f\u5f15\u64ce",source:"@site/programming-tech/React/01-jsx-ast-render\u9636\u6bb5.md",sourceDirName:"React",slug:"/React/jsx-ast-render\u9636\u6bb5",permalink:"/React/jsx-ast-render\u9636\u6bb5",draft:!1,editUrl:"https://github.com/huiruo/programming-tech-website/programming-tech/React/01-jsx-ast-render\u9636\u6bb5.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{title:"jsx-ast-render\u9636\u6bb5",sidebar_position:1},sidebar:"docs",previous:{title:"react-vue\u5f02\u540c-vue",permalink:"/react-vue\u5f02\u540c-vue"},next:{title:"mockData-babel\u8fd4\u56de",permalink:"/React/mockData-babel\u8fd4\u56de"}},i={},c=[{value:"react \u6a21\u677f\u5f15\u64ce",id:"react-\u6a21\u677f\u5f15\u64ce",level:2},{value:"code:",id:"code",level:2},{value:"workInProgress \u6784\u5efa",id:"workinprogress-\u6784\u5efa",level:2},{value:"workInProgress \u6784\u5efa2\uff1abeginWork \u7b2c\u4e00\u6b21\u4f1a\u8c03\u7528updateHostRoot\u8fdb\u884c\u521d\u59cb\u5316:updateHostRoot",id:"workinprogress-\u6784\u5efa2beginwork-\u7b2c\u4e00\u6b21\u4f1a\u8c03\u7528updatehostroot\u8fdb\u884c\u521d\u59cb\u5316updatehostroot",level:3},{value:"\u91cd\u70b9\u6784\u5efa\u5b50\u8282\u70b9\uff1a",id:"\u91cd\u70b9\u6784\u5efa\u5b50\u8282\u70b9",level:3},{value:"beginWork\u7b2c\u4e8c\u6b21\u4e4bcase IndeterminateComponent",id:"beginwork\u7b2c\u4e8c\u6b21\u4e4bcase-indeterminatecomponent",level:2},{value:"\u91cd\u70b9\uff1acode\u51fd\u6570\u521d\u59cb\u5316\u5728renderWithHooks\u8fd9\u91cc\u6267\u884c",id:"\u91cd\u70b9code\u51fd\u6570\u521d\u59cb\u5316\u5728renderwithhooks\u8fd9\u91cc\u6267\u884c",level:3},{value:"ChildReconciler",id:"childreconciler",level:3},{value:"\u7b2c\u4e09\u6b21 beginWork",id:"\u7b2c\u4e09\u6b21-beginwork",level:2},{value:"React.createElement \u65e7api",id:"reactcreateelement-\u65e7api",level:3},{value:"\u5f00\u59cb",id:"\u5f00\u59cb",level:2},{value:"\u63a5\u4e0a\u9762updateContainer",id:"\u63a5\u4e0a\u9762updatecontainer",level:2},{value:"commit\u9636\u6bb5",id:"commit\u9636\u6bb5",level:2},{value:"\u5f00\u59cb1",id:"\u5f00\u59cb1",level:2},{value:"\u5f00\u59cb2 updateContainer(",id:"\u5f00\u59cb2-updatecontainer",level:2},{value:"performConcurrentWorkOnRoot \u8fd9\u4e2a\u51fd\u6570\u5728render\u7ed3\u675f\u4f1a\u5f00\u542fcommit\u9636\u6bb5",id:"performconcurrentworkonroot-\u8fd9\u4e2a\u51fd\u6570\u5728render\u7ed3\u675f\u4f1a\u5f00\u542fcommit\u9636\u6bb5",level:3},{value:"\u904d\u5386\u6d41\u7a0b",id:"\u904d\u5386\u6d41\u7a0b",level:2},{value:"workInProgress \u5185\u5b58\u4e2d\u6784\u5efa\u7684\u6811\u548c\u53cc\u7f13\u5b58",id:"workinprogress-\u5185\u5b58\u4e2d\u6784\u5efa\u7684\u6811\u548c\u53cc\u7f13\u5b58",level:2},{value:"\u53cc\u7f13\u5b58\uff0c\u4ee5current tree\u4e3a\u4e3b\uff0cworkInProgress tree\u4e3a\u8f85\u3002",id:"\u53cc\u7f13\u5b58\u4ee5current-tree\u4e3a\u4e3bworkinprogress-tree\u4e3a\u8f85",level:3},{value:"\u57fa\u78402\uff1aDiff",id:"\u57fa\u78402diff",level:2},{value:"\u6d41\u7a0b1.  jsx\u8bed\u6cd5\u7cd6\u7684html\u7ed3\u6784\u662f\u901a\u8fc7babel\u5c06\u7ed3\u6784\u89e3\u6790\u8f6c\u6362\u4e3a ast \u8bed\u6cd5\u6811\u7ed3\u6784",id:"\u6d41\u7a0b1--jsx\u8bed\u6cd5\u7cd6\u7684html\u7ed3\u6784\u662f\u901a\u8fc7babel\u5c06\u7ed3\u6784\u89e3\u6790\u8f6c\u6362\u4e3a-ast-\u8bed\u6cd5\u6811\u7ed3\u6784",level:2},{value:"\u8f6c\u5316\u6d4b\u8bd5:",id:"\u8f6c\u5316\u6d4b\u8bd5",level:2},{value:"\u7b80\u5355\u5b9e\u4f8b1:babel\u5c06jsx\u4ee3\u7801\u8f6c\u6362\u4e3aReact.createElement()\u8c03\u7528",id:"\u7b80\u5355\u5b9e\u4f8b1babel\u5c06jsx\u4ee3\u7801\u8f6c\u6362\u4e3areactcreateelement\u8c03\u7528",level:3},{value:"\u7b80\u5355\u5b9e\u4f8b2:\u4e0d\u4f7f\u7528babel",id:"\u7b80\u5355\u5b9e\u4f8b2\u4e0d\u4f7f\u7528babel",level:3},{value:"\u7b80\u5355\u5b9e\u4f8b3\uff1a\u4f7f\u7528babel",id:"\u7b80\u5355\u5b9e\u4f8b3\u4f7f\u7528babel",level:3},{value:"\u6d41\u7a0b2\uff1a\u5165\u53e3\uff1a\u6b64\u65f6\u8fd8\u4e0d\u662ffiber\u6811,\u6ca1\u6709\u5f00\u542frender\u9636\u6bb5",id:"\u6d41\u7a0b2\u5165\u53e3\u6b64\u65f6\u8fd8\u4e0d\u662ffiber\u6811\u6ca1\u6709\u5f00\u542frender\u9636\u6bb5",level:2},{value:"17\u7248\u672c\u7684\u5165\u53e3,\u548c18\u4e0d\u4e00\u6837",id:"17\u7248\u672c\u7684\u5165\u53e3\u548c18\u4e0d\u4e00\u6837",level:2},{value:"legacyRenderSubtreeIntoContainer()",id:"legacyrendersubtreeintocontainer",level:3},{value:"17\u7248\u672c\uff1acreateFiberRoot \u521b\u5efafiberRoot\u5bf9\u8c61",id:"17\u7248\u672ccreatefiberroot-\u521b\u5efafiberroot\u5bf9\u8c61",level:2},{value:"\u57fa\u7840\uff1a\u4e24\u5927\u9636\u6bb5\uff1arender\u548ccommit",id:"\u57fa\u7840\u4e24\u5927\u9636\u6bb5render\u548ccommit",level:2},{value:"\u9996\u6b21\u6e32\u67d3\uff0c workInProgress fiber tree\u4e2d\u9664\u4e86\u6839\u8282\u70b9\u4e4b\u5916\uff0c\u6240\u6709\u8282\u70b9\u7684alternate\u90fd\u4e3a\u7a7a\u3002",id:"\u9996\u6b21\u6e32\u67d3-workinprogress-fiber-tree\u4e2d\u9664\u4e86\u6839\u8282\u70b9\u4e4b\u5916\u6240\u6709\u8282\u70b9\u7684alternate\u90fd\u4e3a\u7a7a",level:3},{value:"update\u65f6",id:"update\u65f6",level:3},{value:"render\u9636\u6bb5\uff1a",id:"render\u9636\u6bb5",level:2},{value:"render\u4e4b\u4efb\u52a1\u8c03\u5ea6",id:"render\u4e4b\u4efb\u52a1\u8c03\u5ea6",level:2},{value:"\u4efb\u52a1\u8c03\u5ea6\u4f8b\u5b50",id:"\u4efb\u52a1\u8c03\u5ea6\u4f8b\u5b50",level:3},{value:"commit\u9636\u6bb5:\u53ef\u4ee5\u5206\u4e3a3\u4e2a\u9636\u6bb5\uff1a",id:"commit\u9636\u6bb5\u53ef\u4ee5\u5206\u4e3a3\u4e2a\u9636\u6bb5",level:2},{value:"\u4e24\u4e2a\u9636\u6bb5\u533a\u522b\uff1a",id:"\u4e24\u4e2a\u9636\u6bb5\u533a\u522b",level:2},{value:"2-1.render\u9636\u6bb5\u5f00\u59cb: \u7b2c\u4e00\u6b21\u6e32\u67d3\u4e2d\u8c03\u7528performConcurrentWorkOnRoot()",id:"2-1render\u9636\u6bb5\u5f00\u59cb-\u7b2c\u4e00\u6b21\u6e32\u67d3\u4e2d\u8c03\u7528performconcurrentworkonroot",level:2},{value:"2-2.\u6e32\u67d3:workLoopSync()--&gt;performUnitOfWork();workLoopConcurrent()\u548cworkLoopSync()\u533a\u522b",id:"2-2\u6e32\u67d3workloopsync--performunitofworkworkloopconcurrent\u548cworkloopsync\u533a\u522b",level:2},{value:"\u7b2c\u4e00\u6b65:\u63a5\u4e0a\u9762:performUnitOfWork()--&gt;beginWork()",id:"\u7b2c\u4e00\u6b65\u63a5\u4e0a\u9762performunitofwork--beginwork",level:2},{value:"\u7b2c\u4e8c\u6b65:\u63a2\u7a76beginWork():\u4f20\u5165\u5f53\u524d Fiber \u8282\u70b9\uff0c\u521b\u5efa\u5b50 Fiber \u8282\u70b9",id:"\u7b2c\u4e8c\u6b65\u63a2\u7a76beginwork\u4f20\u5165\u5f53\u524d-fiber-\u8282\u70b9\u521b\u5efa\u5b50-fiber-\u8282\u70b9",level:2},{value:"RootFiber\u7ed3\u6784\u904d\u5386\u4f8b\u5b50",id:"rootfiber\u7ed3\u6784\u904d\u5386\u4f8b\u5b50",level:3},{value:"\u90a3\u6211\u4eec\u7ee7\u7eed\u770b\u770bbeginWork\u4e2d\u662f\u5982\u4f55\u5224\u65ad\u4e0b\u4e00\u4e2a\u5de5\u4f5c\u5355\u5143\u7684\u3002",id:"\u90a3\u6211\u4eec\u7ee7\u7eed\u770b\u770bbeginwork\u4e2d\u662f\u5982\u4f55\u5224\u65ad\u4e0b\u4e00\u4e2a\u5de5\u4f5c\u5355\u5143\u7684",level:2},{value:"beginWork()\u7b80\u7565",id:"beginwork\u7b80\u7565",level:2},{value:"1-2.update \u65f6",id:"1-2update-\u65f6",level:3},{value:"beginWork()\u5b8c\u6574:",id:"beginwork\u5b8c\u6574",level:3},{value:"updateHostComponent\u4e3a\u4f8b\u8fdb\u884c\u5206\u6790",id:"updatehostcomponent\u4e3a\u4f8b\u8fdb\u884c\u5206\u6790",level:2},{value:"2-5-1 \u5e38\u89c1\u7684\u4e0d\u9700\u8981\u66f4\u65b0\u7684\u60c5\u51b5",id:"2-5-1-\u5e38\u89c1\u7684\u4e0d\u9700\u8981\u66f4\u65b0\u7684\u60c5\u51b5",level:3},{value:"bailoutOnAlreadyFinishedWork",id:"bailoutonalreadyfinishedwork",level:3},{value:"2-7 effectTag \u7528\u4e8e\u4fdd\u5b58\u8981\u6267\u884cDOM\u64cd\u4f5c\u7684\u5177\u4f53\u7c7b\u578b",id:"2-7-effecttag-\u7528\u4e8e\u4fdd\u5b58\u8981\u6267\u884cdom\u64cd\u4f5c\u7684\u5177\u4f53\u7c7b\u578b",level:3},{value:"\u7b2c\u4e09\u6b65. Reconciliation,\u8fd9\u4e2a\u4ee3\u7801\u5f88\u957f 1k",id:"\u7b2c\u4e09\u6b65-reconciliation\u8fd9\u4e2a\u4ee3\u7801\u5f88\u957f-1k",level:2},{value:"reconcileChildren\u7b80\u7565\u51fd\u6570",id:"reconcilechildren\u7b80\u7565\u51fd\u6570",level:3},{value:"reconcileChildren\u7b80\u7565\u51fd\u6570",id:"reconcilechildren\u7b80\u7565\u51fd\u6570-1",level:3},{value:"\u8981\u6267\u884c DOM \u64cd\u4f5c\u7684\u5177\u4f53\u7c7b\u578b\u5c31\u4fdd\u5b58\u5728fiber.effectTag\u4e2d",id:"\u8981\u6267\u884c-dom-\u64cd\u4f5c\u7684\u5177\u4f53\u7c7b\u578b\u5c31\u4fdd\u5b58\u5728fibereffecttag\u4e2d",level:3},{value:"render\u9636\u6bb52:completeWork",id:"render\u9636\u6bb52completework",level:2},{value:"effectList",id:"effectlist",level:3},{value:"completeUnitOfWork",id:"completeunitofwork",level:3},{value:"\u6b63\u5f0f\u8fdb\u5165completeWork",id:"\u6b63\u5f0f\u8fdb\u5165completework",level:3},{value:"\u8c03\u7528createElement\u4e3a\u5f53\u524dfiber\u521b\u5efadom\u8282\u70b9",id:"\u8c03\u7528createelement\u4e3a\u5f53\u524dfiber\u521b\u5efadom\u8282\u70b9",level:3},{value:"appendAllChildren\u8d1f\u8d23\u5c06\u5b50\u5b59DOM\u8282\u70b9\u63d2\u5165\u521a\u751f\u6210\u7684DOM\u8282\u70b9\u4e2d",id:"appendallchildren\u8d1f\u8d23\u5c06\u5b50\u5b59dom\u8282\u70b9\u63d2\u5165\u521a\u751f\u6210\u7684dom\u8282\u70b9\u4e2d",level:3},{value:"\u89e3\u6790\uff1a\u5728&quot;\u5f52&quot;\u9636\u6bb5\u4f1a\u8c03\u7528completeWork\u5904\u7406 Fiber \u8282\u70b9",id:"\u89e3\u6790\u5728\u5f52\u9636\u6bb5\u4f1a\u8c03\u7528completework\u5904\u7406-fiber-\u8282\u70b9",level:2},{value:"render\u9636\u6bb5\u4e4bupdate\u65f6: fiber \u53cc\u7f13\u5b58 \u548c diff\uff1bbeginWork\u4e0ecompleteWork\u7684\u4e0d\u540c",id:"render\u9636\u6bb5\u4e4bupdate\u65f6-fiber-\u53cc\u7f13\u5b58-\u548c-diffbeginwork\u4e0ecompletework\u7684\u4e0d\u540c",level:2},{value:"render\u9636\u6bb5\u4e4bupdate\u65f6\u4e24\u4e2a\u51fd\u6570\u5bf9\u6bd4",id:"render\u9636\u6bb5\u4e4bupdate\u65f6\u4e24\u4e2a\u51fd\u6570\u5bf9\u6bd4",level:3},{value:"update\u6d41\u7a0b\u4e4bbeginWork current\u4e0d\u4e3anull\u7684\u903b\u8f91\uff1a",id:"update\u6d41\u7a0b\u4e4bbeginwork-current\u4e0d\u4e3anull\u7684\u903b\u8f91",level:3},{value:"update\u6d41\u7a0b\u4e4bbeginWork\u7b2c\u4e8c\u9636\u6bb5",id:"update\u6d41\u7a0b\u4e4bbeginwork\u7b2c\u4e8c\u9636\u6bb5",level:3},{value:"update\u6d41\u7a0b\u4e4bcompleteWork--&gt;updateHostComponent",id:"update\u6d41\u7a0b\u4e4bcompletework--updatehostcomponent",level:3},{value:"update\u6d41\u7a0b\u4e4bcompleteWork:\u8fd9\u4e2atag\u6807\u8bc6\u6709\u4ec0\u4e48\u7528\u5462",id:"update\u6d41\u7a0b\u4e4bcompletework\u8fd9\u4e2atag\u6807\u8bc6\u6709\u4ec0\u4e48\u7528\u5462",level:3},{value:"\u6269\u5c55\uff1auseState \u66f4\u65b0",id:"\u6269\u5c55usestate-\u66f4\u65b0",level:2},{value:"effectList",id:"effectlist-1",level:2},{value:"\u6d41\u7a0b\u7ed3\u5c3e:render \u9636\u6bb5\u5168\u90e8\u5de5\u4f5c\u5b8c\u6210",id:"\u6d41\u7a0b\u7ed3\u5c3erender-\u9636\u6bb5\u5168\u90e8\u5de5\u4f5c\u5b8c\u6210",level:2},{value:"\u8fd9\u91cc\u4ee5\u4e00\u4e2a\u7b80\u5355\u7684jsx\u7ed3\u6784\u4e3a\u4f8b\uff1a",id:"\u8fd9\u91cc\u4ee5\u4e00\u4e2a\u7b80\u5355\u7684jsx\u7ed3\u6784\u4e3a\u4f8b",level:3}],p={toc:c},d="wrapper";function u(e){let{components:n,...a}=e;return(0,o.kt)(d,(0,t.Z)({},p,a,{components:n,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"\u524d\u8a00"},"\u524d\u8a00"),(0,o.kt)("h2",{id:"react-\u6a21\u677f\u5f15\u64ce"},"react \u6a21\u677f\u5f15\u64ce"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-mermaid"},"flowchart LR\n\nA1(jsx\u7684Fn\u7ec4\u4ef6)--\x3eA2(ast tree)--\u8f6c\u5316--\x3eA3(\u751f\u6210code\u51fd\u6570)--\u5f00\u59cb\u6267\u884ccode--\x3eA4(fiber tree)--\x3eA5(DOM)\n")),(0,o.kt)("p",null,"react\u521d\u59cb\u5316\u7684\u65f6\u5019\u4f7f\u7528babel \u5904\u7406jsx\u6a21\u677f\u7ec4\u4ef6\uff0c\u5f97\u5230ast\u6811\u7684\u7ed3\u6784\u6811,\u5e76\u8f6c\u5316\u4e3acode\u51fd\u6570"),(0,o.kt)("p",null,"jsx \u8f6c\u6362\u4e3a\u4e86\u6d4f\u89c8\u5668\u80fd\u591f\u8bc6\u522b\u7684\u539f\u751fjs\u8bed\u6cd5\uff0c\u4e3a react \u540e\u7eed\u5bf9\u72b6\u6001\u6539\u53d8\u3001\u4e8b\u4ef6\u54cd\u5e94\u4ee5\u53ca\u9875\u9762\u66f4\u65b0\u7b49\u5960\u5b9a\u4e86\u57fa\u7840\u3002"),(0,o.kt)("p",null,"\u5148\u770bbabel \u7684\u6267\u884c\u51fd\u6570"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"function transform(code, options) {\n  console.log('=Babel-transform-\u53c2\u6570:', { code })\n  const babel_transform = Babel.transform(code, processOptions(options));\n  console.log('=Babel-\u8fd4\u56de:', babel_transform)\n  return babel_transform\n}\n")),(0,o.kt)("p",null,"01-mockData-babel\u8fd4\u56de.json"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'{\n"metadata":"",\n"options":"",\n"ignored":"",\n"code":"",\n"ast":"",\n"map":""\n}\n')),(0,o.kt)("h2",{id:"code"},"code:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"'use strict';\n\nvar _slicedToArray = function () { function sliceIterator(arr, i) { var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i[\"return\"]) _i[\"return\"](); } finally { if (_d) throw _e; } } return _arr; } return function (arr, i) { if (Array.isArray(arr)) { return arr; } else if (Symbol.iterator in Object(arr)) { return sliceIterator(arr, i); } else { throw new TypeError(\"Invalid attempt to destructure non-iterable instance\"); } }; }();\n\nconsole.log('=Babel:', Babel);\nfunction Test() {\n  console.log('test-render');\n\n  var _React$useState = React.useState('\u6539\u53d8\u6211'),\n    _React$useState2 = _slicedToArray(_React$useState, 2),\n    data = _React$useState2[0],\n    setData = _React$useState2[1];\n\n  var _React$useState3 = React.useState(false),\n    _React$useState4 = _slicedToArray(_React$useState3, 2),\n    showDiv = _React$useState4[0],\n    setShowDiv = _React$useState4[1];\n\n  var onClickText = function onClickText() {\n    console.log('=useState=onClick');\n    setData('\u52aa\u529b\u54e6');\n    setShowDiv(!showDiv);\n  };\n\n  var onClickText2 = function onClickText2() {\n    console.log('=useState=onClick:', data);\n  };\n\n  React.useEffect(function () {\n    console.log('=\u526f\u4f5c\u7528-useEffect--\x3e\u8fd0\u884c');\n  }, []);\n\n  React.useLayoutEffect(function () {\n    console.log('=\u526f\u4f5c\u7528-useLayoutEffect--\x3e\u8fd0\u884c');\n  }, []);\n\n  return React.createElement(\n    'div',\n    { id: 'div1', className: 'c1' },\n    React.createElement(\n      'button',\n      { onClick: onClickText, className: 'btn' },\n      'Hello world,Click me'\n    ),\n    React.createElement(\n      'span',\n      null,\n      data\n    ),\n    showDiv && React.createElement(\n      'div',\n      null,\n      '\\u88AB\\u4F60\\u53D1\\u73B0\\u4E86'\n    ),\n    React.createElement(\n      'div',\n      { id: 'div2', className: 'c2' },\n      React.createElement(\n        'p',\n        null,\n        '\\u6D4B\\u8BD5\\u5B50\\u8282\\u70B9'\n      )\n    )\n  );\n}\n\nvar root = ReactDOM.createRoot(document.getElementById('root'));\nconsole.log(\"=app=root:\", root);\nroot.render(React.createElement(Test, null));\n// 17 \u5199\u6cd5\n// ReactDOM.render(<Test />, document.getElementById('root'))\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"function createElement(type, config, children) {\n  // console.log('=development\u8c03\u7528createElement\u6784\u5efaAst\u6811:', { type, config, children })\n  console.log('%c=development\u8c03\u7528createElement-1:type', 'color:blueviolet', type, { config, children })\n  var propName; // Reserved names are extracted\n\n  var props = {};\n  var key = null;\n  var ref = null;\n  var self = null;\n  var source = null;\n\n  if (config != null) {\n    if (hasValidRef(config)) {\n      ref = config.ref;\n\n      {\n        warnIfStringRefCannotBeAutoConverted(config);\n      }\n    }\n\n    if (hasValidKey(config)) {\n      {\n        checkKeyStringCoercion(config.key);\n      }\n\n      key = '' + config.key;\n    }\n\n    self = config.__self === undefined ? null : config.__self;\n    source = config.__source === undefined ? null : config.__source; // Remaining properties are added to a new props object\n\n    for (propName in config) {\n      if (hasOwnProperty.call(config, propName) && !RESERVED_PROPS.hasOwnProperty(propName)) {\n        props[propName] = config[propName];\n      }\n    }\n  } // Children can be more than one argument, and those are transferred onto\n  // the newly allocated props object.\n\n\n  var childrenLength = arguments.length - 2;\n\n  if (childrenLength === 1) {\n    props.children = children;\n  } else if (childrenLength > 1) {\n    var childArray = Array(childrenLength);\n\n    for (var i = 0; i < childrenLength; i++) {\n      childArray[i] = arguments[i + 2];\n    }\n\n    {\n      if (Object.freeze) {\n        Object.freeze(childArray);\n      }\n    }\n\n    props.children = childArray;\n  } // Resolve default props\n\n\n  if (type && type.defaultProps) {\n    var defaultProps = type.defaultProps;\n\n    for (propName in defaultProps) {\n      if (props[propName] === undefined) {\n        props[propName] = defaultProps[propName];\n      }\n    }\n  }\n\n  {\n    if (key || ref) {\n      var displayName = typeof type === 'function' ? type.displayName || type.name || 'Unknown' : type;\n\n      if (key) {\n        defineKeyPropWarningGetter(props, displayName);\n      }\n\n      if (ref) {\n        defineRefPropWarningGetter(props, displayName);\n      }\n    }\n  }\n  const reactElementRes = ReactElement(type, key, ref, self, source, ReactCurrentOwner.current, props);\n  console.log('=development\u8c03\u7528createElement-2:\u8fd4\u56de:', reactElementRes)\n  return reactElementRes\n}\n")),(0,o.kt)("h2",{id:"workinprogress-\u6784\u5efa"},"workInProgress \u6784\u5efa"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"  function createWorkInProgress(current, pendingProps) {\n    var workInProgress = current.alternate;\n    // \u533a\u5206\u662f\u5728mount\u65f6\u8fd8\u662f\u5728update\u65f6\n    if (workInProgress === null) {\n      // We use a double buffering pooling technique because we know that we'll\n      // only ever need at most two versions of a tree. We pool the \"other\" unused\n      // node that we're free to reuse. This is lazily created to avoid allocating\n      // extra objects for things that are never updated. It also allow us to\n      // reclaim the extra memory if needed.\n      console.log('==createWorkInProgress--\x3e,\u6ca1\u6709\u5c31\u521b\u5efa\u4e00\u4e2a')\n      workInProgress = createFiber(current.tag, pendingProps, current.key, current.mode);\n      console.log('==createWorkInProgress--\x3e,\u6ca1\u6709\u5c31\u521b\u5efa\u4e00\u4e2a\u8fd4\u56de\u503c', workInProgress)\n      debugger\n      workInProgress.elementType = current.elementType;\n      workInProgress.type = current.type;\n      workInProgress.stateNode = current.stateNode;\n\n      {\n        // DEV-only fields\n        workInProgress._debugSource = current._debugSource;\n        workInProgress._debugOwner = current._debugOwner;\n        workInProgress._debugHookTypes = current._debugHookTypes;\n      }\n      console.log('==createWorkInProgress--\x3e,workInProgress.alternate\u6307\u5b9a\u4e3acurrent')\n      workInProgress.alternate = current;\n      current.alternate = workInProgress;\n    } else {\n      // \u590d\u7528\u5c5e\u6027\n      workInProgress.pendingProps = pendingProps; // Needed because Blocks store data on type.\n\n      workInProgress.type = current.type; // We already have an alternate.\n      // Reset the effect tag.\n\n      workInProgress.flags = NoFlags; // The effects are no longer valid.\n\n      workInProgress.subtreeFlags = NoFlags;\n      workInProgress.deletions = null;\n\n      {\n        // We intentionally reset, rather than copy, actualDuration & actualStartTime.\n        // This prevents time from endlessly accumulating in new commits.\n        // This has the downside of resetting values for different priority renders,\n        // But works for yielding (the common case) and should support resuming.\n        workInProgress.actualDuration = 0;\n        workInProgress.actualStartTime = -1;\n      }\n    } // Reset all effects except static ones.\n    // Static effects are not specific to a render.\n\n\n    workInProgress.flags = current.flags & StaticMask;\n    // \u590d\u7528\u5c5e\u6027\n    workInProgress.childLanes = current.childLanes;\n    workInProgress.lanes = current.lanes;\n    workInProgress.child = current.child;\n    workInProgress.memoizedProps = current.memoizedProps;\n    workInProgress.memoizedState = current.memoizedState;\n    workInProgress.updateQueue = current.updateQueue; // Clone the dependencies object. This is mutated during the render phase, so\n    // it cannot be shared with the current fiber.\n\n    var currentDependencies = current.dependencies;\n    workInProgress.dependencies = currentDependencies === null ? null : {\n      lanes: currentDependencies.lanes,\n      firstContext: currentDependencies.firstContext\n    }; // These will be overridden during the parent's reconciliation\n\n    workInProgress.sibling = current.sibling;\n    workInProgress.index = current.index;\n    workInProgress.ref = current.ref;\n\n    {\n      workInProgress.selfBaseDuration = current.selfBaseDuration;\n      workInProgress.treeBaseDuration = current.treeBaseDuration;\n    }\n\n    {\n      workInProgress._debugNeedsRemount = current._debugNeedsRemount;\n\n      switch (workInProgress.tag) {\n        case IndeterminateComponent:\n        case FunctionComponent:\n        case SimpleMemoComponent:\n          workInProgress.type = resolveFunctionForHotReloading(current.type);\n          break;\n\n        case ClassComponent:\n          workInProgress.type = resolveClassForHotReloading(current.type);\n          break;\n\n        case ForwardRef:\n          workInProgress.type = resolveForwardRefForHotReloading(current.type);\n          break;\n      }\n    }\n\n    return workInProgress;\n  }\n")),(0,o.kt)("p",null,"\u8d4b\u503c\uff1a\u8c03\u7528 prepareFreshStack"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"  function renderRootSync(root, lanes) {\n\n    var prevExecutionContext = executionContext;\n    executionContext |= RenderContext;\n    var prevDispatcher = pushDispatcher(); // If the root or lanes have changed, throw out the existing stack\n    // and prepare a fresh one. Otherwise we'll continue where we left off.\n\n    if (workInProgressRoot !== root || workInProgressRootRenderLanes !== lanes) {\n      {\n        if (isDevToolsPresent) {\n          var memoizedUpdaters = root.memoizedUpdaters;\n\n          if (memoizedUpdaters.size > 0) {\n            restorePendingUpdaters(root, workInProgressRootRenderLanes);\n            memoizedUpdaters.clear();\n          } // At this point, move Fibers that scheduled the upcoming work from the Map to the Set.\n          // If we bailout on this work, we'll move them back (like above).\n          // It's important to move them now in case the work spawns more work at the same priority with different updaters.\n          // That way we can keep the current update and future updates separate.\n\n\n          movePendingFibersToMemoized(root, lanes);\n        }\n\n      }\n\n      workInProgressTransitions = getTransitionsForLanes();\n\n      console.log('workInProgress', workInProgress, root)\n      debugger\n      console.log('render\u8c03\u7528 prepareFreshStack\u524d',workInProgress)\n      prepareFreshStack(root, lanes);\n      console.log('workInProgress', workInProgress, root)\n      console.log('render\u8c03\u7528 prepareFreshStack\u540e',workInProgress)\n    }\n")),(0,o.kt)("h3",{id:"workinprogress-\u6784\u5efa2beginwork-\u7b2c\u4e00\u6b21\u4f1a\u8c03\u7528updatehostroot\u8fdb\u884c\u521d\u59cb\u5316updatehostroot"},"workInProgress \u6784\u5efa2\uff1abeginWork \u7b2c\u4e00\u6b21\u4f1a\u8c03\u7528updateHostRoot\u8fdb\u884c\u521d\u59cb\u5316:updateHostRoot"),(0,o.kt)("p",null,"\u7b2c\u4e8c\u6b21\u624d\u8d70 mountIndeterminateComponent \u6267\u884ccode()\u51fd\u6570,\u6b64\u65f6\u7684workInProgress.type \u624d\u6709\u503c"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"  function beginWork(current, workInProgress, renderLanes) {\n    console.log('workInProgress', workInProgress, root)\n    debugger\n    workInProgress.lanes = NoLanes;\n    console.log('%c=beginWork()===start1-\u521d\u59cb\u5316', 'color:magenta', { getFiberName: getFiberName(workInProgress), current, renderLanes, workInProgress })\n    switch (workInProgress.tag) {\n      case IndeterminateComponent:\n        {\n          console.log('%c=beginWork()==end 2 mountIndeterminateComponent', 'color:magenta', workInProgress)\n          console.log(`%c=\u63a2\u7a76\u521d\u59cb\u548chook=\u8c03\u7528mountIndeterminateComponent`, 'color:blueviolet', workInProgress.type)\n          return mountIndeterminateComponent(current, workInProgress, workInProgress.type, renderLanes);\n      }\n      case HostRoot:\n        console.log('%c=beginWork()=end 6\u7b2c\u4e00\u6b21\u4f1a\u8d70\u8fd9\u91cc\u521d\u59cb\u5316workInProgress', 'color:magenta')\n        console.log('%c=beginWork()=end 6 updateHostRoot', 'color:magenta')\n        return updateHostRoot(current, workInProgress, renderLanes);\n    }\n  }\n")),(0,o.kt)("h3",{id:"\u91cd\u70b9\u6784\u5efa\u5b50\u8282\u70b9"},"\u91cd\u70b9\u6784\u5efa\u5b50\u8282\u70b9\uff1a"),(0,o.kt)("p",null,"reconcileChildren(current, workInProgress, nextChildren, renderLanes)--\x3ereconcileChildren"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"function updateHostRoot(current, workInProgress, renderLanes) {\n  pushHostRootContext(workInProgress);\n\n  if (current === null) {\n    throw new Error('Should have a current fiber. This is a bug in React.');\n  }\n\n  var nextProps = workInProgress.pendingProps;\n  var prevState = workInProgress.memoizedState;\n  var prevChildren = prevState.element;\n  cloneUpdateQueue(current, workInProgress);\n  processUpdateQueue(workInProgress, nextProps, null, renderLanes);\n  var nextState = workInProgress.memoizedState;\n  var root = workInProgress.stateNode;\n  // being called \"element\".\n\n\n  var nextChildren = nextState.element;\n\n  if (prevState.isDehydrated) {\n  } else {\n      // Root is not dehydrated. Either this is a client-only root, or it\n      // already hydrated.\n      resetHydrationState();\n\n      if (nextChildren === prevChildren) {\n        return bailoutOnAlreadyFinishedWork(current, workInProgress, renderLanes);\n      }\n\n      console.log('=reconcileChildren 9')\n      debugger\n      reconcileChildren(current, workInProgress, nextChildren, renderLanes);\n      console.log('%c=updateHostRoot:\u6784\u5efa\u4e4b\u540eworkInProgress.child', 'color:black', { child })\n  }\n  console.log('%c=updateHostRoot:\u6700\u540e\u8fd4\u56deworkInProgress.child', 'color:black', workInProgress.child)\n\n  return workInProgress.child;\n}\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"function reconcileChildren(current, workInProgress, nextChildren, renderLanes) {\n  if (current === null) {\n    // If this is a fresh new component that hasn't been rendered yet, we\n    // won't update its child set by applying minimal side-effects. Instead,\n    // we will add them all to the child before it gets rendered. That means\n    // we can optimize this reconciliation pass by not tracking side-effects.\n    console.log('%c=reconcileChildren mount', 'blueviolet');\n    workInProgress.child = mountChildFibers(workInProgress, null, nextChildren, renderLanes);\n    console.log('%c=reconcileChildren mount \u8fd4\u56de\u503cworkInProgress.child', 'blueviolet', workInProgress.child);\n  } else {\n    // If the current child is the same as the work in progress, it means that\n    // we haven't yet started any work on these children. Therefore, we use\n    // the clone algorithm to create a copy of all the current children.\n    // If we had any progressed work already, that is invalid at this point so\n    // let's throw it out.\n    console.log('%c=reconcileChildren update', 'yellow');\n    workInProgress.child = reconcileChildFibers(workInProgress, current.child, nextChildren, renderLanes);\n  }\n}\n")),(0,o.kt)("p",null,"\u5f88\u957f\u7684\u51fd\u6570: reconcileChildren->reconcileChildFibers"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"  function ChildReconciler(shouldTrackSideEffects) {\n    // \u7701\u7565\n    function reconcileChildFibers(returnFiber, currentFirstChild, newChild, lanes) {\n      // This function is not recursive.\n      // If the top level item is an array, we treat it as a set of children,\n      // not as a fragment. Nested arrays on the other hand will be treated as\n      // fragment nodes. Recursion happens at the normal flow.\n      // Handle top level unkeyed fragments as if they were arrays.\n      // This leads to an ambiguity between <>{[...]}</> and <>...</>.\n      // We treat the ambiguous cases above the same.\n      var isUnkeyedTopLevelFragment = typeof newChild === 'object' && newChild !== null && newChild.type === REACT_FRAGMENT_TYPE && newChild.key === null;\n\n      console.log('%c=reconcileChildFibers A', 'blueviolet');\n\n      if (isUnkeyedTopLevelFragment) {\n        newChild = newChild.props.children;\n      } // Handle object types\n\n\n      if (typeof newChild === 'object' && newChild !== null) {\n        switch (newChild.$$typeof) {\n          case REACT_ELEMENT_TYPE:\n            return placeSingleChild(reconcileSingleElement(returnFiber, currentFirstChild, newChild, lanes));\n\n          case REACT_PORTAL_TYPE:\n            return placeSingleChild(reconcileSinglePortal(returnFiber, currentFirstChild, newChild, lanes));\n\n          case REACT_LAZY_TYPE:\n            var payload = newChild._payload;\n            var init = newChild._init; // TODO: This function is supposed to be non-recursive.\n\n            return reconcileChildFibers(returnFiber, currentFirstChild, init(payload), lanes);\n        }\n\n        if (isArray(newChild)) {\n          return reconcileChildrenArray(returnFiber, currentFirstChild, newChild, lanes);\n        }\n\n        if (getIteratorFn(newChild)) {\n          return reconcileChildrenIterator(returnFiber, currentFirstChild, newChild, lanes);\n        }\n\n        throwOnInvalidObjectType(returnFiber, newChild);\n      }\n\n      if (typeof newChild === 'string' && newChild !== '' || typeof newChild === 'number') {\n        return placeSingleChild(reconcileSingleTextNode(returnFiber, currentFirstChild, '' + newChild, lanes));\n      }\n\n      {\n        if (typeof newChild === 'function') {\n          warnOnFunctionType(returnFiber);\n        }\n      } // Remaining cases are all treated as empty.\n\n\n      return deleteRemainingChildren(returnFiber, currentFirstChild);\n    }\n\n    return reconcileChildFibers;\n  }\n")),(0,o.kt)("h2",{id:"beginwork\u7b2c\u4e8c\u6b21\u4e4bcase-indeterminatecomponent"},"beginWork\u7b2c\u4e8c\u6b21\u4e4bcase IndeterminateComponent"),(0,o.kt)("p",null,"\u7b2c\u4e8c\u6b21beginWork\u8fdb\u5165case IndeterminateComponent \u6267\u884c mountIndeterminateComponent(),\u53ef\u89c1\u6df1\u5ea6\u904d\u5386\u4ece\u7236\u7ea7\u7ec4\u4ef6\u5f00\u59cb"),(0,o.kt)("p",null,"\u9996\u5148\u8981\u6ce8\u610f\u7684\u662f\uff0c\u867d\u7136 App \u662f\u4e00\u4e2a FunctionComponent\uff0c\u4f46\u662f\u5728 first paint \u7684\u65f6\u5019\uff0cReact \u5224\u65ad\u5176\u4e3a IndeterminateComponent"),(0,o.kt)("p",null,"\u5bf9\u4e8e FunctionComponent\uff0c\u5728\u7b2c\u4e00\u6b21\u8bc6\u522b\u7684\u65f6\u5019\u4f1a\u88ab\u8ba4\u4e3a\u662f IndeterminateComponent"),(0,o.kt)("p",null,"\u4e00\u4e2a\u51fd\u6570\uff0c\u53ea\u8981\u8fd4\u56de\u7684\u662f\u4e00\u4e2a\u5bf9\u8c61\u4e14\u5bf9\u8c61\u4e2d\u6709 render \u65b9\u6cd5\uff0c\u5c31\u8ba4\u4e3a\u662f ClassComponent\uff0c\u5426\u5219\u5c31\u662f FunctionComponent"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"    switch (workInProgress.tag) {\n      case IndeterminateComponent:\n        {\n          console.log('%c=beginWork()==end 2 mountIndeterminateComponent', 'color:magenta')\n          console.log(`%c=\u63a2\u7a76\u521d\u59cb\u548chook=\u8c03\u7528mountIndeterminateComponent`, 'color:blueviolet')\n          return mountIndeterminateComponent(current, workInProgress, workInProgress.type, renderLanes);\n        }\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"function beginWork(current, workInProgress, renderLanes) {\n    workInProgress.lanes = NoLanes;\n    console.log('%c=beginWork()===start1-\u521d\u59cb\u5316', 'color:magenta', { getFiberName: getFiberName(workInProgress), current, renderLanes, workInProgress })\n    switch (workInProgress.tag) {\n      case IndeterminateComponent:\n        {\n          console.log('%c=beginWork()==end 2 mountIndeterminateComponent', 'color:magenta')\n          console.log(`%c=\u63a2\u7a76\u521d\u59cb\u548chook=\u8c03\u7528mountIndeterminateComponent`, 'color:blueviolet')\n          return mountIndeterminateComponent(current, workInProgress, workInProgress.type, renderLanes);\n        }\n\n      case LazyComponent:\n        {\n          var elementType = workInProgress.elementType;\n          console.log('%c=beginWork()=end 3 mountLazyComponent', 'color:magenta')\n          return mountLazyComponent(current, workInProgress, elementType, renderLanes);\n        }\n\n      case FunctionComponent:\n        {\n          var Component = workInProgress.type;\n          var unresolvedProps = workInProgress.pendingProps;\n          var resolvedProps = workInProgress.elementType === Component ? unresolvedProps : resolveDefaultProps(Component, unresolvedProps);\n          console.log('%c=beginWork()=end 4\u53ea\u6709\u66f4\u65b0\u624d\u4f1a\u8c03\u7528updateFunctionComponent', 'color:magenta')\n          return updateFunctionComponent(current, workInProgress, Component, resolvedProps, renderLanes);\n        }\n\n      case ClassComponent:\n        {\n          var _Component = workInProgress.type;\n          var _unresolvedProps = workInProgress.pendingProps;\n\n          var _resolvedProps = workInProgress.elementType === _Component ? _unresolvedProps : resolveDefaultProps(_Component, _unresolvedProps);\n          console.log('%c=beginWork()=end 5 updateClassComponent', 'color:magenta')\n          return updateClassComponent(current, workInProgress, _Component, _resolvedProps, renderLanes);\n        }\n\n      case HostRoot:\n        console.log('%c=beginWork()=end 6 updateHostRoot', 'color:magenta')\n        return updateHostRoot(current, workInProgress, renderLanes);\n\n      case HostComponent:\n        console.log(`%c=beginWork()=end 7 updateHostComponent$1,\u5373\u539f\u751f DOM \u7ec4\u4ef6\u5bf9\u5e94\u7684 Fiber\u8282\u70b9:`, 'color:magenta', { type: workInProgress.type })\n        return updateHostComponent$1(current, workInProgress, renderLanes);\n\n      case HostText:\n        console.log('%c=beginWork()=end 8 updateHostText$1', 'color:magenta')\n        return updateHostText$1(current, workInProgress);\n\n      case SuspenseComponent:\n        console.log('%c=beginWork()=end 9 updateSuspenseComponent', 'color:magenta')\n        return updateSuspenseComponent(current, workInProgress, renderLanes);\n\n      case HostPortal:\n        console.log('%c=beginWork()=end 10 updatePortalComponent', 'color:magenta')\n        return updatePortalComponent(current, workInProgress, renderLanes);\n\n      case ForwardRef:\n        {\n          var type = workInProgress.type;\n          var _unresolvedProps2 = workInProgress.pendingProps;\n\n          var _resolvedProps2 = workInProgress.elementType === type ? _unresolvedProps2 : resolveDefaultProps(type, _unresolvedProps2);\n\n          console.log('%c=beginWork()=end 11 updateForwardRef', 'color:magenta')\n          return updateForwardRef(current, workInProgress, type, _resolvedProps2, renderLanes);\n        }\n\n      case Fragment:\n        console.log('%c=beginWork()=end 12 updateFragment', 'color:magenta')\n        return updateFragment(current, workInProgress, renderLanes);\n\n      case Mode:\n        console.log('%c=beginWork()=end 13 updateMode', 'color:magenta')\n        return updateMode(current, workInProgress, renderLanes);\n\n      case Profiler:\n        console.log('%c=beginWork()=end 14 updateProfiler', 'color:magenta')\n        return updateProfiler(current, workInProgress, renderLanes);\n\n      case ContextProvider:\n        console.log('%c=beginWork()=end 15 updateContextProvider', 'color:magenta')\n        return updateContextProvider(current, workInProgress, renderLanes);\n\n      case ContextConsumer:\n        console.log('%c=beginWork()=end 16 updateContextConsumer', 'color:magenta')\n        return updateContextConsumer(current, workInProgress, renderLanes);\n\n      case MemoComponent:\n        {\n          var _type2 = workInProgress.type;\n          var _unresolvedProps3 = workInProgress.pendingProps; // Resolve outer props first, then resolve inner props.\n\n          var _resolvedProps3 = resolveDefaultProps(_type2, _unresolvedProps3);\n\n          {\n            if (workInProgress.type !== workInProgress.elementType) {\n              var outerPropTypes = _type2.propTypes;\n\n              if (outerPropTypes) {\n                checkPropTypes(outerPropTypes, _resolvedProps3, // Resolved for outer only\n                  'prop', getComponentNameFromType(_type2));\n              }\n            }\n          }\n\n          _resolvedProps3 = resolveDefaultProps(_type2.type, _resolvedProps3);\n          console.log('%c=beginWork()=end 17 updateMemoComponent', 'color:magenta')\n          return updateMemoComponent(current, workInProgress, _type2, _resolvedProps3, renderLanes);\n        }\n\n      case SimpleMemoComponent:\n        {\n          console.log('%c=beginWork()=end 18 updateSimpleMemoComponent', 'color:magenta')\n          return updateSimpleMemoComponent(current, workInProgress, workInProgress.type, workInProgress.pendingProps, renderLanes);\n        }\n\n      case IncompleteClassComponent:\n        {\n          var _Component2 = workInProgress.type;\n          var _unresolvedProps4 = workInProgress.pendingProps;\n\n          var _resolvedProps4 = workInProgress.elementType === _Component2 ? _unresolvedProps4 : resolveDefaultProps(_Component2, _unresolvedProps4);\n          console.log('%c=beginWork()=end 19 mountIncompleteClassComponent', 'color:magenta')\n          return mountIncompleteClassComponent(current, workInProgress, _Component2, _resolvedProps4, renderLanes);\n        }\n\n      case SuspenseListComponent:\n        {\n          console.log('%c=beginWork()=end 20 updateSuspenseListComponent', 'color:magenta')\n          return updateSuspenseListComponent(current, workInProgress, renderLanes);\n        }\n\n      case ScopeComponent:\n        {\n\n          break;\n        }\n\n      case OffscreenComponent:\n        {\n          console.log('%c=beginWork()=end 21 updateOffscreenComponent', 'color:magenta')\n          return updateOffscreenComponent(current, workInProgress, renderLanes);\n        }\n    }\n    throw new Error(\"Unknown unit of work tag (\" + workInProgress.tag + \"). This error is likely caused by a bug in \" + 'React. Please file an issue.');\n  }\n}\n")),(0,o.kt)("h3",{id:"\u91cd\u70b9code\u51fd\u6570\u521d\u59cb\u5316\u5728renderwithhooks\u8fd9\u91cc\u6267\u884c"},"\u91cd\u70b9\uff1acode\u51fd\u6570\u521d\u59cb\u5316\u5728renderWithHooks\u8fd9\u91cc\u6267\u884c"),(0,o.kt)("p",null,"mountIndeterminateComponent "),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"\u8c03\u7528  renderWithHooks \u751f\u6210 value"),(0,o.kt)("li",{parentName:"ul"},"\u6267\u884c reconcileChildren(null, workInProgress, value, renderLanes) \u53c2\u6570value")),(0,o.kt)("p",null,"\u5173\u952e\u7684\u51fd\u6570 renderWithHooks\uff1b\u800c\u5728 renderWithHooks \u4e2d\uff0c\u6211\u4eec\u4f1a\u6839\u636e\u7ec4\u4ef6\u5904\u4e8e\u4e0d\u540c\u7684\u72b6\u6001\uff0c\u7ed9 ReactCurrentDispatcher.current \u6302\u8f7d\u4e0d\u540c\u7684 dispatcher \u3002\u800c\u5728first paint \u65f6\uff0c\u6302\u8f7d\u7684\u662fHooksDispatcherOnMountInDEV"),(0,o.kt)("p",null,"HooksDispatcherOnMountInDEV \u91cc\u5c31\u662f\u7ec4\u4ef6 first paint \u7684\u65f6\u5019\u6240\u7528\u5230\u7684\u5404\u79cd hooks"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"function mountIndeterminateComponent(_current, workInProgress, Component, renderLanes) {\n    // \u7701\u7565\n    setIsRendering(true);\n    ReactCurrentOwner$1.current = workInProgress;\n    console.log(`%c=\u63a2\u7a76\u521d\u59cb\u548chook=mountIndeterminateComponent\u8c03\u7528renderWithHooks 1`, 'color:blueviolet', { workInProgress, Component, props, context, renderLanes })\n    value = renderWithHooks(null, workInProgress, Component, props, context, renderLanes);\n    console.log(`%c=\u63a2\u7a76\u521d\u59cb\u548chook=mountIndeterminateComponent\u8c03\u7528renderWithHooks \u8fd4\u56de\u503c`, 'color:blueviolet', { value })\n    // \u7701\u7565\n\n   if (getIsHydrating() && hasId) {\n        pushMaterializedTreeId(workInProgress);\n      }\n      console.log('%c=reconcileChildren 12:\u91cd\u70b9\uff0cmountIndeterminateComponent\u8c03\u7528reconcileChildren', 'color:red')\n      reconcileChildren(null, workInProgress, value, renderLanes);\n\n      {\n        validateFunctionComponentInDev(workInProgress, Component);\n      }\n\n      return workInProgress.child;\n    }\n  }\n}\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"function renderWithHooks(current, workInProgress, Component, props, secondArg, nextRenderLanes) {\n    // \u7701\u7565\uff1a\n    console.log(`%c=\u63a2\u7a76\u521d\u59cb\u548chook=renderWithHooks\u91cd\u70b9\uff0c\u8c03\u7528\u51fd\u6570\u7ec4\u4ef6\uff0c\u91cc\u9762\u6267\u884c\u5404\u79cd React Hook==start\u5e76\u8fd4\u56de ReactElement`, 'color:blueviolet', Component)\n    var children = Component(props, secondArg); // Check if there was a render phase update\n    console.log(`%c=\u63a2\u7a76\u521d\u59cb\u548chook=renderWithHooks\u91cd\u70b9,\u8fd4\u56de ReactElement==end`, 'color:blueviolet', { children })\n    // \u7701\u7565\uff1a\n    return children;\n}\n")),(0,o.kt)("p",null,"\u521d\u59cb\u5316--\x3emountChildFibers"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"function reconcileChildren(current, workInProgress, nextChildren, renderLanes) {\n  if (current === null) {\n    // If this is a fresh new component that hasn't been rendered yet, we\n    // won't update its child set by applying minimal side-effects. Instead,\n    // we will add them all to the child before it gets rendered. That means\n    // we can optimize this reconciliation pass by not tracking side-effects.\n    console.log('%c=reconcileChildren mount', 'blueviolet');\n    workInProgress.child = mountChildFibers(workInProgress, null, nextChildren, renderLanes);\n    console.log('%c=reconcileChildren mount \u8fd4\u56de\u503cworkInProgress.child', 'blueviolet',workInProgress.child);\n  } else {\n    // If the current child is the same as the work in progress, it means that\n    // we haven't yet started any work on these children. Therefore, we use\n    // the clone algorithm to create a copy of all the current children.\n    // If we had any progressed work already, that is invalid at this point so\n    // let's throw it out.\n    console.log('%c=reconcileChildren update', 'yellow');\n    workInProgress.child = reconcileChildFibers(workInProgress, current.child, nextChildren, renderLanes);\n  }\n}\n")),(0,o.kt)("h3",{id:"childreconciler"},"ChildReconciler"),(0,o.kt)("p",null,"\u4ece\u8be5\u51fd\u6570\u540d\u5c31\u80fd\u770b\u51fa\u8fd9\u662fReconciler\u6a21\u5757\u7684\u6838\u5fc3\u90e8\u5206\u3002\u90a3\u4e48\u4ed6\u7a76\u7adf\u505a\u4e86\u4ec0\u4e48\u5462\uff1f"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"\u5bf9\u4e8e mount \u7684\u7ec4\u4ef6\uff0c\u4ed6\u4f1a\u521b\u5efa\u65b0\u7684\u5b50 Fiber \u8282\u70b9\uff1b"),(0,o.kt)("li",{parentName:"ul"},"\u5bf9\u4e8e update \u7684\u7ec4\u4ef6\uff0c\u4ed6\u4f1a\u5c06\u5f53\u524d\u7ec4\u4ef6\u4e0e\u8be5\u7ec4\u4ef6\u5728\u4e0a\u6b21\u66f4\u65b0\u65f6\u5bf9\u5e94\u7684 Fiber \u8282\u70b9\u6bd4\u8f83\uff08\u4e5f\u5c31\u662f\u4fd7\u79f0\u7684Diff \u7b97\u6cd5\uff09\uff0c\u5c06\u6bd4\u8f83\u7684\u7ed3\u679c\u751f\u6210\u65b0 Fiber \u8282\u70b9\u3002")),(0,o.kt)("p",null,"\u4e0d\u8bba\u8d70\u54ea\u4e2a\u903b\u8f91\uff0c\u6700\u7ec8\u4ed6\u4f1a\u751f\u6210\u65b0\u7684\u5b50 Fiber \u8282\u70b9\u5e76\u8d4b\u503c\u7ed9workInProgress.child\uff0c\u4f5c\u4e3a\u672c\u6b21 beginWork \u8fd4\u56de\u503c\uff0c\u5e76\u4f5c\u4e3a\u4e0b\u6b21performUnitOfWork\u6267\u884c\u65f6workInProgress\u7684\u4f20\u53c2\u3002"),(0,o.kt)("p",null,"mountChildFibers\u4e0ereconcileChildFibers\u8fd9\u4e24\u4e2a\u65b9\u6cd5\u7684\u903b\u8f91\u57fa\u672c\u4e00\u81f4\u3002\u552f\u4e00\u7684\u533a\u522b\u662f\uff1areconcileChildFibers \u4f1a\u4e3a\u751f\u6210\u7684 Fiber \u8282\u70b9\u5e26\u4e0aeffectTag\u5c5e\u6027\uff0c\u800c mountChildFibers \u4e0d\u4f1a\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"var mountChildFibers = ChildReconciler(false);\n\n// \u8fd9\u4e2a\u4ee3\u7801\u5f88\u957f 1k\nfunction ChildReconciler(shouldTrackSideEffects) {\n\n}\n")),(0,o.kt)("p",null,"root.render(React.createElement(Test, null));\n\u8c03\u7528\u7684\u53c2\u6570\u662f\uff1aReact.createElement(Test, null)\u5904\u7406\u4e4b\u540e\u7684\uff1a"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"var ReactElement = function (type, key, ref, self, source, owner, props) {\n    var element = {\n      // This tag allows us to uniquely identify this as a React Element\n      $$typeof: REACT_ELEMENT_TYPE,\n      // Built-in properties that belong on the element\n      type: type,\n      key: key,\n      ref: ref,\n      props: props,\n      // Record the component responsible for creating this element.\n      _owner: owner\n    };\n\n    return element;\n}\n")),(0,o.kt)("h2",{id:"\u7b2c\u4e09\u6b21-beginwork"},"\u7b2c\u4e09\u6b21 beginWork"),(0,o.kt)("p",null,"\u6b64\u65f6\u6784\u5efa code() \u751f\u6210\u7684\u8282\u70b9"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"      case HostComponent:\n        console.log(`%c=beginWork()=end 7 updateHostComponent$1,\u5373\u539f\u751f DOM \u7ec4\u4ef6\u5bf9\u5e94\u7684 Fiber\u8282\u70b9:`, 'color:magenta', { type: workInProgress.type })\n        return updateHostComponent$1(current, workInProgress, renderLanes);\n")),(0,o.kt)("p",null,"\u6b64\u65f6 workInProgress"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"actualDuration:0\nactualStartTime:-1\nalternate:null\nchild:null\nchildLanes:0\ndeletions: null\ndependencies: null\nelementType:\"div\"\nflags: 0\nindex : 0\nkey : null\nlanes : 0\nmemoizedProps:null\nmemoizedState:null\nmode:1\npendingProps:{id: 'div1', className: 'c1', children: Array(4)}\nref:null\nreturn:FiberNode {tag: 0, key: null, stateNode: null, elementType: \u0192, type: \u0192, \u2026}\nselfBaseDuration:0,\nsibling:null\nstateNode:null\nsubtreeFlags:0\ntag:5\ntreeBaseDuration:0\ntype:\"div\"\nupdateQueue:null\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"function updateHostComponent$1(current, workInProgress, renderLanes) {\n  pushHostContext(workInProgress);\n\n  if (current === null) {\n    tryToClaimNextHydratableInstance(workInProgress);\n  }\n\n  var type = workInProgress.type;\n  var nextProps = workInProgress.pendingProps;\n  var prevProps = current !== null ? current.memoizedProps : null;\n  var nextChildren = nextProps.children;\n  var isDirectTextChild = shouldSetTextContent(type, nextProps);\n\n  if (isDirectTextChild) {\n    // We special case a direct text child of a host node. This is a common\n    // case. We won't handle it as a reified child. We will instead handle\n    // this in the host environment that also has access to this prop. That\n    // avoids allocating another HostText fiber and traversing it.\n    nextChildren = null;\n  } else if (prevProps !== null && shouldSetTextContent(type, prevProps)) {\n    // If we're switching from a direct text child to a normal child, or to\n    // empty, we need to schedule the text content to be reset.\n    workInProgress.flags |= ContentReset;\n  }\n\n  markRef$1(current, workInProgress);\n  console.log('=reconcileChildren 11')\n  reconcileChildren(current, workInProgress, nextChildren, renderLanes);\n  return workInProgress.child;\n}\n")),(0,o.kt)("h3",{id:"reactcreateelement-\u65e7api"},"React.createElement \u65e7api"),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://cloud.tencent.com/developer/article/2135083"},"https://cloud.tencent.com/developer/article/2135083"),"\nreact17 \u4e4b\u540e\u6211\u4eec\u53ef\u4ee5\u4e0d\u518d\u4f9d\u8d56 React.createElement \u8fd9\u4e2a api \u4e86\uff0c\u4f46\u662f\u5b9e\u9645\u573a\u666f\u4e2d\u4ee5\u53ca\u5f88\u591a\u5f00\u6e90\u5305\u4e2d\u53ef\u80fd\u4f1a\u6709\u5f88\u591a\u901a\u8fc7 React.createElement \u624b\u52a8\u521b\u5efa\u5143\u7d20\u7684\u573a\u666f:"),(0,o.kt)("p",null,"React.createElement \u5176\u63a5\u6536\u4e09\u4e2a\u6216\u4ee5\u4e0a\u53c2\u6570\uff1a"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"type\uff1a\u8981\u521b\u5efa\u7684 React \u5143\u7d20\u7c7b\u578b\uff0c\u53ef\u4ee5\u662f\u6807\u7b7e\u540d\u79f0\u5b57\u7b26\u4e32\uff0c\u5982 'div' \u6216\u8005 'span' \u7b49\uff1b\u4e5f\u53ef\u4ee5\u662f React\u7ec4\u4ef6 \u7c7b\u578b(class\u7ec4\u4ef6\u6216\u8005\u51fd\u6570\u7ec4\u4ef6)\uff1b\u6216\u8005\u662f React fragment \u7c7b\u578b\u3002"),(0,o.kt)("li",{parentName:"ul"},"config\uff1a\u5199\u5728\u6807\u7b7e\u4e0a\u7684\u5c5e\u6027\u7684\u96c6\u5408\uff0cjs \u5bf9\u8c61\u683c\u5f0f\uff0c\u82e5\u6807\u7b7e\u4e0a\u672a\u6dfb\u52a0\u4efb\u4f55\u5c5e\u6027\u5219\u4e3a null\u3002"),(0,o.kt)("li",{parentName:"ul"},"children\uff1a\u4ece\u7b2c\u4e09\u4e2a\u53c2\u6570\u5f00\u59cb\u540e\u7684\u53c2\u6570\u4e3a\u5f53\u524d\u521b\u5efa\u7684React\u5143\u7d20\u7684\u5b50\u8282\u70b9\uff0c\u6bcf\u4e2a\u53c2\u6570\u7684\u7c7b\u578b\uff0c\u82e5\u662f\u5f53\u524d\u5143\u7d20\u8282\u70b9\u7684 textContent \u5219\u4e3a\u5b57\u7b26\u4e32\u7c7b\u578b\uff1b\u5426\u5219\u4e3a\u65b0\u7684 React.createElement \u521b\u5efa\u7684\u5143\u7d20\u3002")),(0,o.kt)("h2",{id:"\u5f00\u59cb"},"\u5f00\u59cb"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-mermaid"},'flowchart TD\nA1("ReactDOM.createRoot(document.getElementById(\'root\'))")--1FiberRoot\u521b\u5efa--\x3eA2("return new ReactDOMRoot(root)")--\x3e1FiberRoot--\x3eA6("root=createContainer(container")--\x3eA7("return createFiberRoot(containerInfo")--1FiberRoot\u521d\u59cb\u5316\u76f8\u5173\u53ea\u8c03\u7528\u4e00\u6b21--\x3eA8("root=new FiberRootNode(containerInfo")\n\nA7--2root.current=uninitializedFiber--\x3eA11("uninitializedFiber=createHostRootFiber(tag,isStrictMode)")--\x3eA12("return createFiber(HostRoot")\n\nA1--2\u5f00\u542frender--\x3eA3("root.render(<\u7ec4\u4ef6>)")--\x3eA4("ReactDOMRoot.prototype.render")\nA4--\u5f00\u59cb\u6e32\u67d3,\u6ce8\u610f\u975e\u6279\u91cf--\x3eA5("updateContainer(children, root")\n')),(0,o.kt)("h2",{id:"\u63a5\u4e0a\u9762updatecontainer"},"\u63a5\u4e0a\u9762updateContainer"),(0,o.kt)("p",null,"fiber \u534f\u8c03\u8fc7\u7a0b,\u6784\u5efafiber\u6811\u7684\u9636\u6bb5\u53ef\u4e2d\u65ad"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-mermaid"},'flowchart TD\nA1("updateContainer(children, root")--\x3eA2("root=scheduleUpdateOnFiber(current$1,lane")--\x3e A3("ensureRootIsScheduled(root,eventTime)")\n\nA3--"ensureRootIsScheduled(root,currentTime)\u51fd\u6570\u4e2d"--\x3eifB{{"\u66f4\u65b0\u65b9\u5f0f?newCallbackPriority ===SyncLane"}}\n\nD1("scheduleLegacySyncCallback(performSyncWorkOnRoot.bind(null,root))")\nD2("newCallbackNode=scheduleCallback$1(schedulerPriorityLevel, performConcurrentWorkOnRoot.bind(null,root))")\n\nifB--true\u5f02\u6b65\u66f4\u65b0legacy\u6a21\u5f0f--\x3eD1\nifB--\u521d\u6b21\u6e32\u67d3\u9ed8\u8ba4false,\u540c\u6b65\u66f4\u65b0concurrent\u6a21\u5f0f--\x3eD2\n\nD2--\x3eD3("scheduleCallback$1")--\x3eD4("performConcurrentWorkOnRoot(root, didTimeout){<br> exitStatus = renderRootSync(root,lanes)}")\n\nD4--1--\x3eD5("renderRootSync(root,lanes)")\n\nD4--"2.exitStatus!==RootInProgress"--\x3eC1("finishConcurrentRender(root,exitStatus)render\u9636\u6bb5\u7ed3\u675f,commit\u9636\u6bb5\u524d")\n\nD5(workLoopSync)--\x3eA0Aif\nA0Aif{{workInProgress!=null?}}--\u4e0d\u4e3anull--\x3eE1\nA0Aif--\u4e3anull--\x3eendW(\u7ed3\u675f\u5f53\u524d\u5faa\u73af)\n\nsubgraph render1[\u6784\u5efafiber\u6811/\u534f\u8c03\u9636\u6bb5:render\u662f\u4e00\u4e2a\u6df1\u5ea6\u4f18\u5148\u904d\u5386\u7684\u8fc7\u7a0b\u6838\u5fc3\u51fd\u6570beginWork\u548ccompleteUnitOfWork]\n\n  E1(performUnitOfWork:\u6df1\u5ea6\u904d\u5386)\n\n  E1--1.\u904d\u5386\u5230\u7684\u8282\u70b9\u6267\u884cbeginWork\u521b\u5efa\u5b50fiber\u8282\u70b9--\x3eE2(beginWork$1\u5904\u7406\u5b8c\u8fd4\u56denext)\n\n  E1--2.\u82e5\u5f53\u524d\u8282\u70b9\u4e0d\u5b58\u5728\u5b50\u8282\u70b9:next=null--\x3eE6B(completeUnitOfWork)\n  \n  E2--current=null\u521d\u59cb\u5316:tag\u8fdb\u5165\u4e0d\u540ccase--\x3eE6A(case:HostComponent\u4e3a\u4f8b)--\x3eE6A1(updateHostComponent$1)--\x3eE6A2(reconcileChildren)--current!=null--\x3eE6A3(reconcileChildFibers)\n\n    %% subgraph beginWork2[beginWork\u7b2c\u4e8c\u9636\u6bb5]\n    E6A2--current==null--\x3ez1("mountChildFibers:beginWork\u7b2c\u4e8c\u9636\u6bb5")--\x3ez2(ChildReconciler)--case--\x3ez3(placeSingleChild)\n    %% end\n\n  E2-.current!=null\u66f4\u65b0\u6d41\u7a0b.->E51(attemptEarlyBailoutIfNoScheduledUpdate)--\x3eE52(bailoutOnAlreadyFinishedWork)--\x3eE53(cloneChildFibers)\n\n  E6B--\x3eE6B1[\u4e3a\u4f20\u5165\u7684\u8282\u70b9\u6267\u884ccompleteWork:\u6267\u884c\u4e0d\u540ctag]--case:HostComponent\u5e76\u4e14current!=null--\x3eE6B2(update\u6d41\u7a0b:updateHostComponent)--\x3eE6A1A(prepareUpdate:\u5bf9\u6bd4props)--\x3eE6A1B(diffProperties)--\x3eE6A1C(markUpdate:\u8d4b\u503c\u66f4\u65b0\u7684flags\u4e5f\u53ebupdate)\n\n  E6B1--case:HostComponent-current=null--\x3eE6B3(\u4e3afiber\u521b\u5efadom:createInstance)\n  E6B3--case:HostComponent-current=null--\x3eE6B4(add child dom:appendAllChildren)\n  E6B3--\x3eE6B3A(createElement)--\x3eE6B3B(document.createElement)\n\n  E53--\x3ecreateWorkInProgress\n  E53-.tag\u7c7b\u578b\u8fdb\u5165\u4e0d\u540ccase.->E6A\n\n    %% subgraph render2[\u6784\u5efaFiberNode]\n    E6A3-.\u6839\u636e\u5b50\u8282\u70b9\u7c7b\u578b\u521b\u5efafiber\u8282\u70b9.->o1(reconcileSingleElement) --\x3eo2(createFiberFromElement) --\x3e o3(createFiberFromTypeAndProps) --fiber.type\u4e5f\u662f\u5728\u8fd9\u91cc\u8d4b\u503c--\x3e o4(createFiber)--\x3e o5(return new FiberNode)\n    %% end\nend\n')),(0,o.kt)("h2",{id:"commit\u9636\u6bb5"},"commit\u9636\u6bb5"),(0,o.kt)("p",null,"commit\u9636\u6bb5\u4e4bbeforeMutation\u548cmutation\u9636\u6bb5"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-mermaid"},'flowchart TD\nA1(finishConcurrentRender)--\x3eA2("commitRoot")--\x3eA3("commitRootImpl(root,")\n\nA3--\x3e2A\nA3(commitRootImpl)--\x3e3A\n\nsubgraph befor[beforeMutation\u9636\u6bb5]\n  2A(commitBeforeMutationEffects)--18\u6216\u9ad8\u7248\u672c--\x3e2B(commitBeforeMutationEffects_begin)--\x3e2C(commitBeforeMutationEffects_complete)--\x3e2D(commitBeforeMutationEffectsOnFiber)\nend\n\nsubgraph Mutation[mutation\u9636\u6bb5]\n  3A(commitMutationEffects)--\x3e3B(commitMutationEffectsOnFiber)--case\u91cc\u9762\u90fd\u4f1a\u6267\u884c--\x3e3C(recursivelyTraverseMutationEffects)\n\n  3C--\x3e3B\n  3B--\x3e3D1(commitReconciliationEffects)--\x3e3E(commitPlacement)\n  3B--case:SimpleMemoComponent--\x3e3D2(commitHookEffectListUnmount)\n  3B--case:HostComponent--\x3e3D3(commitUpdate)\n  3E--HostComponent--\x3e3E1(insertOrAppendPlacementNode)--\x3e3E1a(insertBefore)\n  3E--HostPortal--\x3e3E2(insertOrAppendPlacementNodeIntoContainer)\n\n  3E1--\x3e3E1b(appendChild)\nend\n')),(0,o.kt)("p",null,"commit\u9636\u6bb5\u4e4blayout\u6700\u540e\u9636\u6bb5"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-mermaid"},"flowchart TD\nC1(commitRootImpl)\nC1--\x3e4A\nC1--layout\u6700\u540e\u9636\u6bb5--\x3e5A\nsubgraph layout[layout\u9636\u6bb5]\n  4A(commitLayoutEffect)--\x3e4B(commitLayoutEffects_begin)--\x3e4C(commitLayoutMountEffects_complete)--\x3e4D(commitLayoutEffectOnFiber)\n\n  4D--case=ClassComponent--\x3e4E1(componentDidMount)--\x3e4E2(commitUpdateQueue)\n  4D--case=SimpleMemoComponent--\x3e4E3(commitHookEffectListMount)\n\n  5A(flushPassiveEffects)--\x3e5B(flushPassiveEffectsImpl)\n  5B--\u6267\u884cuseEffect\u7684\u9500\u6bc1\u51fd\u6570--\x3e5C1(commitPassiveUnmountEffects)\n  5B--\u6267\u884cuseEffect\u7684create\u51fd\u6570--\x3e5C2(commitPassiveMountEffects)\nend\n")),(0,o.kt)("h2",{id:"\u5f00\u59cb1"},"\u5f00\u59cb1"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"const root = ReactDOM.createRoot(document.getElementById('root'))\nconsole.log(\"=app=root:\", root)\nroot.render(<Test />);\n\nfunction createRoot(container, options) {\n        // \u7701\u7565\n    console.log('%c=\u4e00\u5207\u5f00\u59cb1:createRoot(', 'color:red', { createRoot: container, options })\n    var root = createContainer(container, ConcurrentRoot, null, isStrictMode, concurrentUpdatesByDefaultOverride, identifierPrefix, onRecoverableError);\n    markContainerAsRoot(root.current, container);\n    var rootContainerElement = container.nodeType === COMMENT_NODE ? container.parentNode : container;\n    listenToAllSupportedEvents(rootContainerElement);\n    return new ReactDOMRoot(root);\n}\n\nfunction createContainer(containerInfo, tag, hydrationCallbacks, isStrictMode, concurrentUpdatesByDefaultOverride, identifierPrefix, onRecoverableError, transitionCallbacks) {\n    var hydrate = false;\n    var initialChildren = null;\n    console.log('\u521d\u59cb/\u66f4\u65b0--\x3eFiberRoot:a--\x3ecreateContainer')\n    return createFiberRoot(containerInfo, tag, hydrate, initialChildren, hydrationCallbacks, isStrictMode, concurrentUpdatesByDefaultOverride, identifierPrefix, onRecoverableError);\n}\n")),(0,o.kt)("p",null,"FiberRootNode\u662f\u521d\u59cb\u5316\u76f8\u5173\u53ea\u8c03\u7528\u4e00\u6b21"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"function createFiberRoot(containerInfo, tag, hydrate, initialChildren, hydrationCallbacks, isStrictMode, concurrentUpdatesByDefaultOverride, // TODO: We have several of these arguments that are conceptually part of the\n    // host config, but because they are passed in at runtime, we have to thread\n    // them through the root constructor. Perhaps we should put them all into a\n    // single type, like a DynamicHostConfig that is defined by the renderer.\n    identifierPrefix, onRecoverableError, transitionCallbacks) {\n    var root = new FiberRootNode(containerInfo, tag, hydrate, identifierPrefix, onRecoverableError);\n\n    return root;\n}\n\nfunction FiberRootNode(containerInfo, tag, hydrate, identifierPrefix, onRecoverableError) {\n    console.log('==FiberRootNode\u662f\u521d\u59cb\u5316\u76f8\u5173\u53ea\u8c03\u7528\u4e00\u6b21===')\n    this.tag = tag;\n    this.containerInfo = containerInfo;\n    this.pendingChildren = null;\n    this.current = null;\n    this.pingCache = null;\n    this.finishedWork = null;\n    this.timeoutHandle = noTimeout;\n    this.context = null;\n    this.pendingContext = null;\n    this.callbackNode = null;\n    this.callbackPriority = NoLane;\n    this.eventTimes = createLaneMap(NoLanes);\n    this.expirationTimes = createLaneMap(NoTimestamp);\n    this.pendingLanes = NoLanes;\n    this.suspendedLanes = NoLanes;\n    this.pingedLanes = NoLanes;\n    this.expiredLanes = NoLanes;\n    this.mutableReadLanes = NoLanes;\n    this.finishedLanes = NoLanes;\n    this.entangledLanes = NoLanes;\n    this.entanglements = createLaneMap(NoLanes);\n    this.identifierPrefix = identifierPrefix;\n    this.onRecoverableError = onRecoverableError;\n\n    {\n        this.mutableSourceEagerHydrationData = null;\n    }\n\n    {\n        this.effectDuration = 0;\n        this.passiveEffectDuration = 0;\n    }\n\n    {\n        this.memoizedUpdaters = new Set();\n        var pendingUpdatersLaneMap = this.pendingUpdatersLaneMap = [];\n\n        for (var _i = 0; _i < TotalLanes; _i++) {\n            pendingUpdatersLaneMap.push(new Set());\n        }\n    }\n\n    {\n        switch (tag) {\n            case ConcurrentRoot:\n                this._debugRootType = hydrate ? 'hydrateRoot()' : 'createRoot()';\n                break;\n\n            case LegacyRoot:\n                this._debugRootType = hydrate ? 'hydrate()' : 'render()';\n                break;\n        }\n    }\n}\n")),(0,o.kt)("p",null,"\u53ef\u89c1children \u5c31\u662f\u6839\u8282\u70b9"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"ReactDOMHydrationRoot.prototype.render = ReactDOMRoot.prototype.render = function (children) {\n    console.log('%c=\u4e00\u5207\u5f00\u59cb3:', 'color:red', 'ReactDOMRoot.prototype.render\u8c03\u7528updateContainer()\u5f00\u542frender\u9636\u6bb5==', { children });\n    var root = this._internalRoot;\n    // \u7701\u7565\u51fd\u6570\n    updateContainer(children, root, null, null);\n};\n")),(0,o.kt)("h2",{id:"\u5f00\u59cb2-updatecontainer"},"\u5f00\u59cb2 updateContainer("),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"function updateContainer(element, container, parentComponent, callback) {\n    {\n        onScheduleRoot(container, element);\n    }\n\n    var current$1 = container.current;\n    var eventTime = requestEventTime();\n    var lane = requestUpdateLane(current$1);\n\n    {\n        markRenderScheduled(lane);\n    }\n\n    var context = getContextForSubtree(parentComponent);\n\n    if (container.context === null) {\n        container.context = context;\n    } else {\n        container.pendingContext = context;\n    }\n\n    // \u7701\u7565\n    var update = createUpdate(eventTime, lane); // Caution: React DevTools currently depends on this property\n    // being called \"element\".\n\n    update.payload = {\n        element: element\n    };\n    callback = callback === undefined ? null : callback;\n\n\n    // \u7701\u7565\n    console.log('==render\u9636\u6bb5\u51c6\u5907\uff1aupdateContainer\u8c03\u7528enqueueUpdate()\u548cscheduleUpdateOnFiber()==')\n    enqueueUpdate(current$1, update);\n    var root = scheduleUpdateOnFiber(current$1, lane, eventTime);\n\n    if (root !== null) {\n        entangleTransitions(root, current$1, lane);\n    }\n\n    return lane;\n}\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"function scheduleUpdateOnFiber(fiber, lane, eventTime) {\n    var root = markUpdateLaneFromFiberToRoot(fiber, lane);\n    console.log('==render\u9636\u6bb5\u51c6\u5907:scheduleUpdateOnFiber()\u8c03\u7528ensureRootIsScheduled()==')\n    ensureRootIsScheduled(root, eventTime);\n    return root;\n}\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"function ensureRootIsScheduled(root, currentTime) {\n    // \u7701\u7565\n    if (newCallbackPriority === SyncLane) {\n        // Special case: Sync React callbacks are scheduled on a special\n        // internal queue\n        if (root.tag === LegacyRoot) {\n            if (ReactCurrentActQueue$1.isBatchingLegacy !== null) {\n                ReactCurrentActQueue$1.didScheduleLegacyUpdate = true;\n            }\n\n            console.log('%c=render\u9636\u6bb5\u51c6\u5907:ensureRootIsScheduled\u8c03\u7528performSyncWorkOnRoot\uff1a\u5f02\u6b65\u66f4\u65b0legacy\u6a21\u5f0f1==', 'color:red')\n            scheduleLegacySyncCallback(performSyncWorkOnRoot.bind(null, root));\n        } else {\n\n            console.log('%c=render\u9636\u6bb5\u51c6\u5907:ensureRootIsScheduled\u8c03\u7528performSyncWorkOnRoot\uff1a\u5f02\u6b65\u66f4\u65b0legacy\u6a21\u5f0f2==', 'color:red')\n            scheduleSyncCallback(performSyncWorkOnRoot.bind(null, root));\n        }\n\n        // \u7701\u7565\n    } else {\n        // \u7701\u7565\n        // console.log('\u66f4\u65b0\u6d41\u7a0b--\x3e0-c2: performConcurrentWorkOnRoot')\n        console.log('%c=render\u9636\u6bb5\u51c6\u5907:', 'color:red', 'ensureRootIsScheduled()\u8c03\u7528performConcurrentWorkOnRoot--\u540c\u6b65\u66f4\u65b0:concurrent\u6a21\u5f0f==')\n        newCallbackNode = scheduleCallback$1(schedulerPriorityLevel, performConcurrentWorkOnRoot.bind(null, root));\n    }\n\n    root.callbackPriority = newCallbackPriority;\n    root.callbackNode = newCallbackNode;\n}\n")),(0,o.kt)("h3",{id:"performconcurrentworkonroot-\u8fd9\u4e2a\u51fd\u6570\u5728render\u7ed3\u675f\u4f1a\u5f00\u542fcommit\u9636\u6bb5"},"performConcurrentWorkOnRoot \u8fd9\u4e2a\u51fd\u6570\u5728render\u7ed3\u675f\u4f1a\u5f00\u542fcommit\u9636\u6bb5"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"function performConcurrentWorkOnRoot(root, didTimeout) {\n    // \u7701\u7565\n    console.log('%c==render\u9636\u6bb5\u51c6\u5907:\u91cd\u70b9\u51fd\u6570performConcurrentWorkOnRoot,\u8fd9\u4e2a\u51fd\u6570\u5728render\u7ed3\u675f\u4f1a\u5f00\u542fcommit\u9636\u6bb5', 'color:red', 'color:cyan');\n\n    console.log('==render\u9636\u6bb5\u51c6\u5907:performConcurrentWorkOnRoot\u8c03\u7528renderRootSync():\u540c\u6b65\u66f4\u65b0concurrent\u6a21\u5f0f:', { shouldTimeSlice });\n    var exitStatus = shouldTimeSlice ? renderRootConcurrent(root, lanes) : renderRootSync(root, lanes);\n\n    if (exitStatus !== RootInProgress) {\n        // \u7701\u7565\n\n        if (exitStatus === RootDidNotComplete) {\n            markRootSuspended$1(root, lanes);\n        } else {\n            // \u7701\u7565\n\n            root.finishedWork = finishedWork;\n            root.finishedLanes = lanes;\n            console.log(`%c=commit\u9636\u6bb5=\u524d=render\u9636\u6bb5\u7ed3\u675f=performConcurrentWorkOnRoot\u8c03\u7528finishConcurrentRender--\x3ecommitRoot`, 'color:cyan')\n            finishConcurrentRender(root, exitStatus, lanes);\n        }\n    }\n\n    // \u7701\u7565\n\n    return null;\n}\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"function renderRootSync(root, lanes) {\n    var prevExecutionContext = executionContext;\n    executionContext |= RenderContext;\n    var prevDispatcher = pushDispatcher(); // If the root or lanes have changed, throw out the existing stack\n    // \u7701\u7565\n\n    do {\n        try {\n            console.log('%c=render\u9636\u6bb5\u51c6\u5907:', 'color:red', 'renderRootSync()\u8c03\u7528workLoopSync()-root:', { root });\n            workLoopSync();\n            break;\n        } catch (thrownValue) {\n            handleError(root, thrownValue);\n        }\n    } while (true);\n\n    // \u7701\u7565\n    workInProgressRoot = null;\n    workInProgressRootRenderLanes = NoLanes;\n    return workInProgressRootExitStatus;\n}\n")),(0,o.kt)("p",null,"\u56fe\u4f8b"),(0,o.kt)("p",null,(0,o.kt)("img",{src:r(84182).Z,width:"1808",height:"665"}),"\n",(0,o.kt)("img",{src:r(19767).Z,width:"1738",height:"580"}),"\n",(0,o.kt)("img",{src:r(47707).Z,width:"1920",height:"376"})),(0,o.kt)("h1",{id:"\u57fa\u7840"},"\u57fa\u7840"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"react\u628a\u6bcf\u4e2afiber\u5f53\u6210\u751f\u6210fiber\u6700\u5c0f\u5355\u5143,\u53ea\u8981\u8fed\u4ee3\u6240\u6709fiber\u5219\u5230\u9876\u7ea7Fiber\u65f6\u6574\u9897FiberTree\u4fbf\u751f\u6210\u4e86\u3002")),(0,o.kt)("h2",{id:"\u904d\u5386\u6d41\u7a0b"},"\u904d\u5386\u6d41\u7a0b"),(0,o.kt)("p",null,"Tree \u6784\u5efa\u7684\u904d\u5386\u987a\u5e8f\uff0c\u5b83\u4f1a\u4ee5\u65e7\u7684fiber tree\u4e3a\u84dd\u672c\uff0c\u628a\u6bcf\u4e2afiber\u4f5c\u4e3a\u4e00\u4e2a\u5de5\u4f5c\u5355\u5143\uff0c\u81ea\u9876\u5411\u4e0b\u9010\u8282\u70b9\u6784\u9020workInProgress tree\uff08\u6784\u5efa\u4e2d\u7684\u65b0fiber tree\uff09:"),(0,o.kt)("p",null,"\u6df1\u5ea6\u4f18\u5148\u904d\u5386"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"\u4ece\u9876\u70b9\u5f00\u59cb\u904d\u5386"),(0,o.kt)("li",{parentName:"ol"},"\u5982\u679c\u6709\u5b50\u8282\u70b9\uff0c\u5148\u904d\u5386\u5b50\u8282\u70b9\uff1b"),(0,o.kt)("li",{parentName:"ol"},"\u5982\u679c\u6ca1\u6709\u5b50\u8282\u70b9\uff0c\u5219\u770b\u6709\u6ca1\u6709\u5144\u5f1f\u8282\u70b9\uff0c\u6709\u5219\u904d\u5386\u5144\u5f1f\u8282\u70b9\uff0c\u5e76\u628aeffect\u5411\u4e0a\u5f52\u5e76"),(0,o.kt)("li",{parentName:"ol"},"\u5982\u679c\u6ca1\u6709\u5144\u5f1f\u8282\u70b9\uff0c\u5219\u770b\u6709\u6ca1\u6709\u7236\u5144\u5f1f\u8282\u70b9\uff0c\u6709\u5219\u904d\u5386\u7236\u5144\u5f1f\u8282\u70b9"),(0,o.kt)("li",{parentName:"ol"},"\u5982\u679c\u6ca1\u6709\u90fd\u6ca1\u6709\u4e86\uff0c\u90a3\u4e48\u904d\u5386\u7ed3\u675f")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-mermaid"},"flowchart TD\n\n  A0(workLoopSync)--\u5f02\u6b65--\x3eA0Aif\n  A0A(workLoopConcurrent)--\u540c\u6b65--\x3eA0Aif{{workInProgress!==null}}\n  A0Aif--\x3eA1\n  A0Aif--\u4e3anull--\x3eendW(\u7ed3\u675f\u5f53\u524d\u5faa\u73af)\n\n  A1(performUnitOfWork)--\x3eA2(beginWork\u5904\u7406\u5b8c\u8fd4\u56denext)--\x3eA2if{{next=null?}}\n\n  A3A(\u5c06\u4e0b\u4e00\u5de5\u4f5c\u5355\u5143\u4e3a\u5f53\u524d\u5de5\u4f5c\u5355\u5143:workInProgress=next)\n  A3A--\x3eA0Aif\n  A2if--next\u4e3anull--\x3eA3B(completeUnitOfWork)\n  A2if--next\u4e0d\u4e3anull--\x3eA3A\n\n  A3Bif{{\u8282\u70b9\u662f\u5426\u7a7a:completedWork!=null?}}\n  A3B--\x3eA3Bif--\u4e3anull--\x3eA0Aif\n  A3Bif--\u975enull--\x3eA3Bif2{{\u662f\u5426\u5b58\u5728\u5144\u5f1f\u8282\u70b9:siblingFiber!=null?}}\n\n  A3Bif2--\u5144\u5f1f\u8282\u70b9null--\x3eA3C1(\u56de\u6eaf\u5230\u7236\u8282\u70b9:completedWork=returnFiber)--\x3eA3Bif\n  A3Bif2--\u5144\u5f1f\u8282\u70b9!null--\x3eA3C2(\u5c06\u5144\u5f1f\u8282\u70b9\u4f5c\u4e3a\u4e0b\u4e00\u5de5\u4f5c\u5355\u5143)--\x3eA0Aif\n")),(0,o.kt)("h2",{id:"workinprogress-\u5185\u5b58\u4e2d\u6784\u5efa\u7684\u6811\u548c\u53cc\u7f13\u5b58"},"workInProgress \u5185\u5b58\u4e2d\u6784\u5efa\u7684\u6811\u548c\u53cc\u7f13\u5b58"),(0,o.kt)("p",null,"\u771f\u5b9edom\u5bf9\u5e94\u5728\u5185\u5b58\u4e2d\u7684Fiber\u8282\u70b9\u5f62\u6210Fiber\u6811:current Fiber"),(0,o.kt)("p",null,"workInProgress Fiber\u548ccurrent Fiber\u8fd9\u4e24\u9897\u6811\u7684\u8282\u70b9\u901a\u8fc7alternate\u76f8\u8fde."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"performUnitOfWork \u4f5c\u7528\u521b\u5efa\u4e0b\u4e00\u4e2a Fiber \u8282\u70b9\uff0c\u5e76\u8d4b\u503c\u7ed9 workInProgress\uff0c\u540c\u65f6\u628a workInProgress \u4e0e\u5df2\u521b\u5efa\u7684 Fiber \u8282\u70b9\u8fde\u63a5\u8d77\u6765\u6784\u6210 Fiber \u6811\u3002\n\nworkInProgress fiber tree\uff1a\u5185\u5b58\u4e2d\u6784\u5efa\u7684\u6811\u3002\n\u66f4\u65b0\u8fc7\u7a0b\u4e2d\u6784\u5efa\u7684 new fiber tree\n\ncurrent fiber tree\uff1a\u6b63\u5728\u89c6\u56fe\u5c42\u6e32\u67d3\u7684\u6811\u3002\nold fiber tree\uff0c\u5bf9\u5e94\u5f53\u524d\u5c4f\u5e55\u663e\u793a\u7684\u5185\u5bb9\uff0c\u901a\u8fc7\u6839\u8282\u70b9 fiberRootNode \u7684 currrent \u6307\u9488\u53ef\u4ee5\u8bbf\u95ee\u3002\n")),(0,o.kt)("h3",{id:"\u53cc\u7f13\u5b58\u4ee5current-tree\u4e3a\u4e3bworkinprogress-tree\u4e3a\u8f85"},"\u53cc\u7f13\u5b58\uff0c\u4ee5current tree\u4e3a\u4e3b\uff0cworkInProgress tree\u4e3a\u8f85\u3002"),(0,o.kt)("p",null,"\u53cc\u7f13\u51b2\u673a\u5236\u662fReact\u7ba1\u7406\u66f4\u65b0\u5de5\u4f5c\u7684\u4e00\u79cd\u624b\u6bb5\uff0c\u4e5f\u662f\u63d0\u5347\u7528\u6237\u4f53\u9a8c\u7684\u91cd\u8981\u673a\u5236\u3002"),(0,o.kt)("p",null,"\u5f53React\u5f00\u59cb\u66f4\u65b0\u5de5\u4f5c\u4e4b\u540e\uff0c\u4f1a\u6709\u4e24\u4e2afiber\u6811\uff0c\u4e00\u4e2acurrent\u6811\uff0c\u662f\u5f53\u524d\u663e\u793a\u5728\u9875\u9762\u4e0a\u5185\u5bb9\u5bf9\u5e94\u7684fiber\u6811\u3002\u53e6\u4e00\u4e2a\u662fworkInProgress\u6811\uff0c\u5b83\u662f\u4f9d\u636ecurrent\u6811\u6df1\u5ea6\u4f18\u5148\u904d\u5386\u6784\u5efa\u51fa\u6765\u7684\u65b0\u7684fiber\u6811\uff0c\u6240\u6709\u7684\u66f4\u65b0\u6700\u7ec8\u90fd\u4f1a\u4f53\u73b0\u5728workInProgress\u6811\u4e0a\u3002\u5f53\u66f4\u65b0\u672a\u5b8c\u6210\u7684\u65f6\u5019\uff0c\u9875\u9762\u4e0a\u59cb\u7ec8\u5c55\u793acurrent\u6811\u5bf9\u5e94\u7684\u5185\u5bb9\uff0c\u5f53\u66f4\u65b0\u7ed3\u675f\u65f6\uff08commit\u9636\u6bb5\u7684\u6700\u540e\uff09\uff0c\u9875\u9762\u5185\u5bb9\u5bf9\u5e94\u7684fiber\u6811\u4f1a\u7531current\u6811\u5207\u6362\u5230workInProgress\u6811\uff0c\u6b64\u65f6workInProgress\u6811\u5373\u6210\u4e3a\u65b0\u7684current\u6811\u3002"),(0,o.kt)("p",null,"\u6700\u7ec8commit\u9636\u6bb5\u5b8c\u6210\u65f6\uff0c\u4e24\u68f5\u6811\u4f1a\u8fdb\u884c\u5207\u6362\u3002\n\u5728\u672a\u66f4\u65b0\u5b8c\u6210\u65f6\u4f9d\u65e7\u5c55\u793a\u65e7\u5185\u5bb9\uff0c\u4fdd\u6301\u4ea4\u4e92\uff0c\u5f53\u66f4\u65b0\u5b8c\u6210\u7acb\u5373\u5207\u6362\u5230\u65b0\u5185\u5bb9\uff0c\u8fd9\u6837\u53ef\u4ee5\u505a\u5230\u65b0\u5185\u5bb9\u548c\u65e7\u5185\u5bb9\u65e0\u7f1d\u5207\u6362\u3002"),(0,o.kt)("p",null,"\u6e32\u67d3\u6d41\u7a0b\u4e2d\uff0c\u5148\u590d\u7528current\u6811\uff08rootFiber\uff09\u7684alternate \u4f5c\u4e3a workInProgress\u3002\n\u6784\u5efaworkInProgress Fiber\u53d1\u751f\u5728createWorkInProgress\u4e2d\uff0c\u5b83\u80fd\u521b\u5efa\u6216\u8005\u590d\u7528Fiber"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"  function createWorkInProgress(current, pendingProps) {\n    var workInProgress = current.alternate;\n    // \u533a\u5206\u662f\u5728mount\u65f6\u8fd8\u662f\u5728update\u65f6\n    if (workInProgress === null) {\n      // We use a double buffering pooling technique because we know that we'll\n      // only ever need at most two versions of a tree. We pool the \"other\" unused\n      // node that we're free to reuse. This is lazily created to avoid allocating\n      // extra objects for things that are never updated. It also allow us to\n      // reclaim the extra memory if needed.\n      console.log('==createWorkInProgress--\x3e,\u6ca1\u6709\u5c31\u521b\u5efa\u4e00\u4e2a')\n      workInProgress = createFiber(current.tag, pendingProps, current.key, current.mode);\n      workInProgress.elementType = current.elementType;\n      workInProgress.type = current.type;\n      workInProgress.stateNode = current.stateNode;\n\n      {\n        // DEV-only fields\n        workInProgress._debugSource = current._debugSource;\n        workInProgress._debugOwner = current._debugOwner;\n        workInProgress._debugHookTypes = current._debugHookTypes;\n      }\n      console.log('==createWorkInProgress--\x3e,workInProgress.alternate\u6307\u5b9a\u4e3acurrent')\n      workInProgress.alternate = current;\n      current.alternate = workInProgress;\n    } else {\n      // \u590d\u7528\u5c5e\u6027\n      workInProgress.pendingProps = pendingProps; // Needed because Blocks store data on type.\n\n      workInProgress.type = current.type; // We already have an alternate.\n      // Reset the effect tag.\n\n      workInProgress.flags = NoFlags; // The effects are no longer valid.\n\n      workInProgress.subtreeFlags = NoFlags;\n      workInProgress.deletions = null;\n\n      {\n        // We intentionally reset, rather than copy, actualDuration & actualStartTime.\n        // This prevents time from endlessly accumulating in new commits.\n        // This has the downside of resetting values for different priority renders,\n        // But works for yielding (the common case) and should support resuming.\n        workInProgress.actualDuration = 0;\n        workInProgress.actualStartTime = -1;\n      }\n    } // Reset all effects except static ones.\n    // Static effects are not specific to a render.\n\n\n    workInProgress.flags = current.flags & StaticMask;\n    // \u590d\u7528\u5c5e\u6027\n    workInProgress.childLanes = current.childLanes;\n    workInProgress.lanes = current.lanes;\n    workInProgress.child = current.child;\n    workInProgress.memoizedProps = current.memoizedProps;\n    workInProgress.memoizedState = current.memoizedState;\n    workInProgress.updateQueue = current.updateQueue; // Clone the dependencies object. This is mutated during the render phase, so\n    // it cannot be shared with the current fiber.\n\n    var currentDependencies = current.dependencies;\n    workInProgress.dependencies = currentDependencies === null ? null : {\n      lanes: currentDependencies.lanes,\n      firstContext: currentDependencies.firstContext\n    }; // These will be overridden during the parent's reconciliation\n\n    workInProgress.sibling = current.sibling;\n    workInProgress.index = current.index;\n    workInProgress.ref = current.ref;\n\n    {\n      workInProgress.selfBaseDuration = current.selfBaseDuration;\n      workInProgress.treeBaseDuration = current.treeBaseDuration;\n    }\n\n    {\n      workInProgress._debugNeedsRemount = current._debugNeedsRemount;\n\n      switch (workInProgress.tag) {\n        case IndeterminateComponent:\n        case FunctionComponent:\n        case SimpleMemoComponent:\n          workInProgress.type = resolveFunctionForHotReloading(current.type);\n          break;\n\n        case ClassComponent:\n          workInProgress.type = resolveClassForHotReloading(current.type);\n          break;\n\n        case ForwardRef:\n          workInProgress.type = resolveForwardRefForHotReloading(current.type);\n          break;\n      }\n    }\n\n    return workInProgress;\n  } // Used to reuse a Fiber for a second pass.\n")),(0,o.kt)("h2",{id:"\u57fa\u78402diff"},"\u57fa\u78402\uff1aDiff"),(0,o.kt)("p",null,"diff\u672c\u8d28\u4e0a\u662f\u4e00\u4e9b\u8ba1\u7b97\uff08\u904d\u5386\u3001\u6bd4\u8f83\uff09\uff0c\u662f\u53ef\u62c6\u5206\u7684\uff08\u7b97\u4e00\u534a\u5f85\u4f1a\u513f\u63a5\u7740\u7b97\uff09 "),(0,o.kt)("p",null,"diff\u7684\u8fc7\u7a0b\uff0c\u4e5f\u5c31\u662feffect\u7684\u6536\u96c6\u8fc7\u7a0b\uff0c\u6b64\u8fc7\u7a0b\u4f1a\u627e\u51fa\u6240\u6709\u8282\u70b9\u7684\u53d8\u66f4\uff0c\u5982\u8282\u70b9\u65b0\u589e\u3001\u5220\u9664\u3001\u5c5e\u6027\u53d8\u66f4\u7b49\uff0c\u8fd9\u4e9b\u53d8\u66f4 react \u7edf\u79f0\u4e3a\u526f\u4f5c\u7528\uff08effect\uff09\uff0c\u968f\u7740\u6240\u6709\u7684\u8282\u70b9\uff08\u5de5\u4f5c\u5355\u5143\uff09\u5728\u5e27\u7a7a\u95f2\u65f6\u95f4\u9010\u4e2a\u6267\u884c\u5b8c\u6bd5\uff0c\u6700\u540e\u4ea7\u51fa\u7684\u7ed3\u679c\u662feffect list\uff0c\u4ece\u4e2d\u53ef\u4ee5\u77e5\u9053\u54ea\u4e9b\u8282\u70b9\u66f4\u65b0\u3001\u54ea\u4e9b\u8282\u70b9\u589e\u52a0\u3001\u54ea\u4e9b\u8282\u70b9\u5220\u9664\u4e86\u3002"),(0,o.kt)("p",null,"diff \u6bd4\u8f83\uff0c\u5c31\u662f\u5728\u6784\u5efa workInProgress fiber tree \u7684\u8fc7\u7a0b\u4e2d\uff0c\u5224\u65ad current fiber tree \u4e2d\u7684 fiber node \u662f\u5426\u53ef\u4ee5\u88ab workInProgress fiber tree \u590d\u7528\u3002"),(0,o.kt)("p",null,"\u80fd\u88ab\u590d\u7528\uff0c\u610f\u5473\u5728\u672c\u6b21\u66f4\u65b0\u4e2d\uff0c\u9700\u8981\u505a: \u7ec4\u4ef6\u7684 update \u4ee5\u53ca dom \u8282\u70b9\u7684 move\u3001update \u7b49\u64cd\u4f5c\uff1b"),(0,o.kt)("p",null,"\u4e0d\u53ef\u590d\u7528\uff0c\u5219\u610f\u5473\u7740\u9700\u8981\u505a: \u7ec4\u4ef6\u7684 mount\u3001unmount \u4ee5\u53ca dom \u8282\u70b9\u7684 insert\u3001delete \u7b49\u64cd\u4f5c\u3002"),(0,o.kt)("p",null,"\u5f53\u66f4\u65b0\u5b8c\u6210\u4ee5\u540e\uff0cfiberRootNode \u7684 current \u6307\u9488\u4f1a\u6307\u5411 workInProgress fiber tree\uff0c\u4f5c\u4e3a\u4e0b\u4e00\u6b21\u66f4\u65b0\u7684 current fiber tree"),(0,o.kt)("p",null,"\u6700\u540e\uff0c\u6df1\u5ea6\u8c03\u548c\u5b50\u8282\u70b9\uff0c\u6e32\u67d3\u89c6\u56fe\n\u904d\u5386fiber\u6811\uff0c\u4ee5workInProgress \u4f5c\u4e3a\u6700\u65b0\u7684\u6e32\u67d3\u6811\uff0c\u5373current Fiber \u6811\u3002"),(0,o.kt)("h1",{id:"\u4e00-\u6784\u5efaast"},"\u4e00. \u6784\u5efaAST"),(0,o.kt)("h2",{id:"\u6d41\u7a0b1--jsx\u8bed\u6cd5\u7cd6\u7684html\u7ed3\u6784\u662f\u901a\u8fc7babel\u5c06\u7ed3\u6784\u89e3\u6790\u8f6c\u6362\u4e3a-ast-\u8bed\u6cd5\u6811\u7ed3\u6784"},"\u6d41\u7a0b1.  jsx\u8bed\u6cd5\u7cd6\u7684html\u7ed3\u6784\u662f\u901a\u8fc7babel\u5c06\u7ed3\u6784\u89e3\u6790\u8f6c\u6362\u4e3a ast \u8bed\u6cd5\u6811\u7ed3\u6784"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"react 18\u4e2d\uff1a\u4f7f\u7528 babel\u5c06jsx\u4ee3\u7801\u8f6c\u6362\u4e3aroot.render()\u8c03\u7528,\u6b64\u65f6\u5c31\u5f97\u5230\u8f6c\u5316\u540e\u7684Ast\u6811\u7ed3\u6784")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"react17\u4e2d \u4f7f\u7528 babel\u5c06jsx\u4ee3\u7801\u8f6c\u6362\u4e3aReact.createElement()\u8c03\u7528,\u6b64\u65f6\u5c31\u5f97\u5230\u8f6c\u5316\u540e\u7684Ast\u6811\u7ed3\u6784"))),(0,o.kt)("h2",{id:"\u8f6c\u5316\u6d4b\u8bd5"},"\u8f6c\u5316\u6d4b\u8bd5:"),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://www.babeljs.cn/repl"},"https://www.babeljs.cn/repl")),(0,o.kt)("h3",{id:"\u7b80\u5355\u5b9e\u4f8b1babel\u5c06jsx\u4ee3\u7801\u8f6c\u6362\u4e3areactcreateelement\u8c03\u7528"},"\u7b80\u5355\u5b9e\u4f8b1:babel\u5c06jsx\u4ee3\u7801\u8f6c\u6362\u4e3aReact.createElement()\u8c03\u7528"),(0,o.kt)("p",null,"\u6d4b\u8bd5\uff1a",(0,o.kt)("a",{parentName:"p",href:"https://www.babeljs.cn/repl"},"https://www.babeljs.cn/repl")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx"},'// jsx\nconst element = <h1 style = {{"color": "red"}}>123\n    <div>test</div>\n</h1>\n\n// babel \u7f16\u8bd1\u8fc7\u540e\u751f\u6210\u7684\u4ee3\u7801\nconst element = /*#__PURE__*/React.createElement("h1", {\n  style: {\n    "color": "red"\n  }\n}, "123", /*#__PURE__*/React.createElement("div", null, "test"));\n')),(0,o.kt)("h3",{id:"\u7b80\u5355\u5b9e\u4f8b2\u4e0d\u4f7f\u7528babel"},"\u7b80\u5355\u5b9e\u4f8b2:\u4e0d\u4f7f\u7528babel"),(0,o.kt)("p",null,"\u6e32\u67d3\u4ee3\u7801\uff1aexample-code\\\u4f8b-1-jsx-ast-r17.html"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-html"},"<script>\nconst container = document.getElementById('root');\nconst element = React.createElement(\n    'div',\n    { className: 'red' },\n    'Click Me'\n)\nconsole.log('createElement \u8f6c\u5316\u540east\u6811\u7684\u7ed3\u6784:', element)\nReactDOM.render(element, container)\n/*\n{\n    $$typeof: Symbol(react.element)\n    key: null\n    props:\n    children: \"Click Me\"\n    className: \"red\"\n    [[Prototype]]: Object\n    ref: null\n    type: \"div\"\n    _owner: null\n    _store: {validated: false}\\\n}\n*/\n<\/script>\n")),(0,o.kt)("h3",{id:"\u7b80\u5355\u5b9e\u4f8b3\u4f7f\u7528babel"},"\u7b80\u5355\u5b9e\u4f8b3\uff1a\u4f7f\u7528babel"),(0,o.kt)("p",null,"\u6e32\u67d3\u4ee3\u7801\uff1aexample-code\\\u4f8b4-\u5728html-\u4f7f\u7528babel\u8f6c\u4e49jsx.html"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-html"},'<script type="text/babel">\n  function Test() {\n    return (\n      <div className="red">Click Me</div>\n    )\n  }\n\n  ReactDOM.render(<Test />, document.getElementById(\'root\'))\n<\/script>\n')),(0,o.kt)("h2",{id:"\u6d41\u7a0b2\u5165\u53e3\u6b64\u65f6\u8fd8\u4e0d\u662ffiber\u6811\u6ca1\u6709\u5f00\u542frender\u9636\u6bb5"},"\u6d41\u7a0b2\uff1a\u5165\u53e3\uff1a\u6b64\u65f6\u8fd8\u4e0d\u662ffiber\u6811,\u6ca1\u6709\u5f00\u542frender\u9636\u6bb5"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"<script type=\"text/babel\">\n  const root = ReactDOM.createRoot(document.getElementById('root'))\n  root.render(<Test />);\n<\/script>\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"function createRoot(container, options) {\n  return new ReactDOMRoot(root);\n}\n\nReactDOMHydrationRoot.prototype.render = ReactDOMRoot.prototype.render = function (children) {\n    console.log('%c ==\u4e00\u5207\u5f00\u59cb3:', 'color:red', 'ReactDOMRoot.prototype.render\u8c03\u7528updateContainer()\u5f00\u542frender\u9636\u6bb5==', children);\n    var root = this._internalRoot;\n}\n")),(0,o.kt)("h2",{id:"17\u7248\u672c\u7684\u5165\u53e3\u548c18\u4e0d\u4e00\u6837"},"17\u7248\u672c\u7684\u5165\u53e3,\u548c18\u4e0d\u4e00\u6837"),(0,o.kt)("p",null,"\u8fd9\u4e2a\u662f 17\u6216\u5219\u572818\u4e2d\u8c03\u7528ReactDOM.render(ast,domRoot)\u7684\u6d41\u7a0b\uff0c\u5982\u679c\u572818\u4e2d\u8c03\u7528ReactDOM.createRoot(domRoot).render(Ast) \u662f\u4e0d\u7528\u8d70\u4e0b\u9762\u7684\u6d41\u7a0b\u7684,18\u76f4\u63a5\u6d41\u7a0b\u56fe\u7684\u6d41\u7a0b\u6784\u5efafiber\u548c\u66f4\u65b0"),(0,o.kt)("h3",{id:"legacyrendersubtreeintocontainer"},"legacyRenderSubtreeIntoContainer()"),(0,o.kt)("p",null,"\u6839\u636e container \u662f\u5426\u5b58\u5728 root \u533a\u5206\u521d\u59cb\u5316/\u66f4\u65b0\uff0c\u521b\u5efa\u6216\u83b7\u53d6 fiberRoot;"),(0,o.kt)("p",null,"Babel \u4f1a\u628a JSX \u8f6c\u8bd1\u6210\u4e00\u4e2a\u540d\u4e3a React.createElement() \u51fd\u6570\u8c03\u7528,\n\u56e0\u6b64legacyRenderSubtreeIntoContainer \u4e2d\u6253\u5370\u7684children\u5b9e\u9645\u4e0a\u662f\u901a\u8fc7React.createElement()\u5904\u7406\u8fc7\u7684"),(0,o.kt)("p",null,"17\u4e2d\u7684React.createElement\u505a\u7684\u4e8b\u60c5\u5c31\u662f\u751f\u6210react\u7684ast\u6811\n\u5c06\u53c2\u6570\u8bfb\u53d6\u8f6c\u6362\u4e3aast\u6811\u7684\u4e00\u4e9b\u6240\u9700\u53c2\u6570\u5b57\u6bb5,\u6700\u7ec8\u8fd4\u56deast\u6811\u7684\u7ed3\u6784"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"function createElement(type, config, children) {\n    //\u6839\u636e\u4e0a\u9762\u7684\u793a\u4f8b\u4ee3\u7801\uff0ctype=div,config= {className:'red'},children='Click Me'\n  var propName; // Reserved names are extracted\n  var props = {};// \u6211\u4eec\u5e38\u7528\u7684props \u76ee\u524d\u7ec4\u4ef6\n  var key = null;//\u8be5\u7ec4\u4ef6\u7684\u552f\u4e00key\n  var ref = null;// \u6211\u4eec\u7684ref\n  var self = null;\n  var source = null;\n\n  // ...\n  ...\n  // ...\n\n    // \u5f53\u53d1\u73b0arguments\u7684\u53c2\u6570\u5927\u4e8e1\u7684\u65f6\u5019\u3002\u8bf4\u660e\u662f\u6709\u591a\u4e2a\u5144\u5f1f\u5b50\u5143\u7d20\u7684\uff0c\u5982\u679c\u7b49\u4e8e1\u7684\u8bdd\u8bf4\u660e\u53ea\u6709\u4e00\u4e2a\u5143\u7d20\n  var childrenLength = arguments.length - 2;\n\n  if (childrenLength === 1) {\n      // \u76f4\u63a5\u5c06props\u7684children\u8bbe\u4e3a\u5f53\u524dchildren\n    props.children = children;\n  } else if (childrenLength > 1) {\n    var childArray = Array(childrenLength);\n\n    for (var i = 0; i < childrenLength; i++) {\n      childArray[i] = arguments[i + 2];\n    }\n\n    {\n      if (Object.freeze) {\n        Object.freeze(childArray);\n      }\n    }\n    // \u6709\u591a\u4e2a\u5144\u5f1f\u5143\u7d20\u7684\u8bdd\uff0c\u5c06\u5144\u5f1f\u8282\u70b9\u653e\u7f6e\u5728\u4e00\u4e2a\u6570\u7ec4\u91cc\u9762\uff0c\u8d4b\u503c\u7ed9props\u7684children\n    props.children = childArray;\n  } // Resolve default props\n\n  // ...\n  ...\n  // ...\n\n    // ReactElement \u8fd4\u56de\u56de\u6765\u7684\u662f\u6211\u4eec\u6700\u7ec8\u7684ast\u6811\u7684\u7ed3\u6784\n  return ReactElement(type, key, ref, self, source, ReactCurrentOwner.current, props);\n}\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"// \u4ece container \u53d6\u51fa _reactRootContainer \u4f5c\u4e3a react \u7684\u4e00\u4e2a\u6839:\nvar maybeRoot = container._reactRootContainer;\n")),(0,o.kt)("p",null,"\u68c0\u67e5 root \u662f\u5426\u5b58\u5728\uff0c\u5982\u679c\u5b58\u5728\u5c31\u662f Update\uff0c\u5982\u679c\u4e0d\u5b58\u5728\u5c31\u662f\u521d\u59cb\u5316\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"A.\u82e5root\u4e0d\u5b58\u5728\uff1a\n\u8c03\u7528 legacyCreateRootFromDOMContainer(contaiber,forceHydrate) \u521d\u59cb\u5316 root\u3002\n\u5c06 root \u8d4b\u503c\u7ed9 container._reactRootContainer,\u53d6\u51fa root \u4e2d\u7684_internalRoot \u4f5c\u4e3a fiberRoot\u3002\n\nB.\u82e5 root \u5b58\u5728, \u4ece root \u4e2d\u53d6\u51fa fiberRoot:\n  root = maybeRoot;\n\u8c03\u7528 updateContainer(children,fiberRoot,parentComponent,callBack)\n\u6ce8\u610f\uff1a\u8fd9\u91cc callBack \u4f1a\u901a\u8fc7 getPublicRootInstance() \u9012\u5f52\u627e\u5230 fiberRoot \u4e0a\u7b2c\u4e00\u4e2a\u975e HTMlElement \u7ed3\u70b9,\u5e76\u5c06 callback \u7ed1\u5b9a\u5728\u5b83\u4e0a\u8fb9\u3002\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"function render(element, container, callback) {\n    return legacyRenderSubtreeIntoContainer(null, element, container, false, callback); \n}\n\n/*\n\u53ef\u4ee5\u89c1\u5230\u521d\u59cb\u5316\u9636\u6bb5:legacyCreateRootFromDOMContainer \u4e0d\u6279\u91cf\u8c03\u7528 updateContainer\n\nupdate\u9636\u6bb5\uff1a\u76f4\u63a5\u8c03\u7528 updateContainer\n*/\nfunction legacyRenderSubtreeIntoContainer(parentComponent, children, container, forceHydrate, callback) {\n  if (!maybeRoot) {\n    console.log('\u5f00\u59cb\u8c03\u7528--\x3e0-a0:\u521d\u59cb\u5316\u6e32\u67d3')\n    // Initial mount\n    root = legacyCreateRootFromDOMContainer(container, children, parentComponent, callback, forceHydrate);\n  } else {\n    root = maybeRoot;\n\n    if (typeof callback === 'function') {\n      var originalCallback = callback;\n\n      callback = function () {\n        var instance = getPublicRootInstance(root);\n        originalCallback.call(instance);\n      };\n    } // Update\n\n    console.log('\u66f4\u65b0\u6d41\u7a0b--\x3e1-a1:\u5373\u66f4\u65b0')\n    updateContainer(children, root, parentComponent, callback);\n  }\n\n  return getPublicRootInstance(root);\n}\n\n// \u7b2c\u4e00\u6b21\u6e32\u67d3\nlegacyCreateRootFromDOMContainer(){\n      \n  console.log('--\x3e0-a,\u521d\u59cb\u5316\u6e32\u67d3\u4e0d\u6267\u884c\u6279\u91cf\u66f4\u65b0,\u800c\u662f\u6267\u884cflushSync',)\n  flushSync(function () {\n    updateContainer(initialChildren, _root, parentComponent, callback);\n  });\n}\n")),(0,o.kt)("h2",{id:"17\u7248\u672ccreatefiberroot-\u521b\u5efafiberroot\u5bf9\u8c61"},"17\u7248\u672c\uff1acreateFiberRoot \u521b\u5efafiberRoot\u5bf9\u8c61"),(0,o.kt)("p",null,"\u6700\u7ec8\u521b\u5efa\u4e86 fiberRoot \u548c rootFiber\uff1a"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-mermaid"},"flowchart LR\nA1(createContainer)--\x3eA2(createFiberRoot)--\x3eE12(createHostRootFiber)\nA2--\x3eFiberRootNode\n")),(0,o.kt)("h1",{id:"\u4e8c-\u5f00\u542frender"},"\u4e8c. \u5f00\u542frender"),(0,o.kt)("h2",{id:"\u57fa\u7840\u4e24\u5927\u9636\u6bb5render\u548ccommit"},"\u57fa\u7840\uff1a\u4e24\u5927\u9636\u6bb5\uff1arender\u548ccommit"),(0,o.kt)("h3",{id:"\u9996\u6b21\u6e32\u67d3-workinprogress-fiber-tree\u4e2d\u9664\u4e86\u6839\u8282\u70b9\u4e4b\u5916\u6240\u6709\u8282\u70b9\u7684alternate\u90fd\u4e3a\u7a7a"},"\u9996\u6b21\u6e32\u67d3\uff0c workInProgress fiber tree\u4e2d\u9664\u4e86\u6839\u8282\u70b9\u4e4b\u5916\uff0c\u6240\u6709\u8282\u70b9\u7684alternate\u90fd\u4e3a\u7a7a\u3002"),(0,o.kt)("p",null,"\u6240\u4ee5\u5728mount\u65f6\uff0c\u9664\u4e86\u6839\u8282\u70b9fiberRootNode\u4e4b\u5916\uff0c\u5176\u4f59\u8282\u70b9\u8c03\u7528beginWork\u65f6\u53c2\u6570current\u7b49\u4e8enull\u3002"),(0,o.kt)("p",null,"render\u9636\u6bb5\u662f\u5728\u5185\u5b58\u4e2d\u6784\u5efa\u4e00\u68f5\u65b0\u7684fiber\u6811\uff08\u79f0\u4e3aworkInProgress\u6811\uff09,\u6784\u5efa\u8fc7\u7a0b\u662f\u4f9d\u7167\u73b0\u6709fiber\u6811\uff08current\u6811\uff09\u4eceroot\u5f00\u59cb\u6df1\u5ea6\u4f18\u5148\u904d\u5386\u518d\u56de\u6eaf\u5230root\u7684\u8fc7\u7a0b\uff0c",(0,o.kt)("inlineCode",{parentName:"p"},"\u8fd9\u4e2a\u8fc7\u7a0b\u4e2d\u6bcf\u4e2afiber\u8282\u70b9\u90fd\u4f1a\u7ecf\u5386\u4e24\u4e2a\u9636\u6bb5\uff1abeginWork\u548ccompleteWork\u3002")),(0,o.kt)("h3",{id:"update\u65f6"},"update\u65f6"),(0,o.kt)("p",null,"workInProgress fiber tree\u6240\u6709\u8282\u70b9\u90fd\u5b58\u5728\u4e0a\u4e00\u6b21\u66f4\u65b0\u65f6\u7684fiber\u8282\u70b9\uff0c\u6240\u4ee5current !== null\u3002"),(0,o.kt)("p",null,"\u5f53current\u548cworkInProgress\u6ee1\u8db3\u4e00\u5b9a\u6761\u4ef6\u65f6,\u53ef\u4ee5\u590d\u7528current\u8282\u70b9\u7684\u5b50\u8282\u70b9\u7684\u4f5c\u4e3aworkInProgress\u7684\u5b50\u8282\u70b9\uff0c\n\u53cd\u4e4b\u5219\u9700\u8981\u8fdb\u5165\u5bf9\u6bd4\uff08diff\uff09\u7684\u6d41\u7a0b\uff0c\u6839\u636e\u6bd4\u5bf9\u7684\u7ed3\u679c\u521b\u5efaworkInProgress\u7684\u5b50\u8282\u70b9\u3002"),(0,o.kt)("p",null,"beginWork\u5728\u521b\u5efafiber\u8282\u70b9\u7684\u8fc7\u7a0b\u4e2d\u4e2d\u4f1a\u4f9d\u8d56\u4e00\u4e2adidReceiveUpdate\u53d8\u91cf\u6765\u6807\u8bc6\u5f53\u524d\u7684current\u662f\u5426\u6709\u66f4\u65b0\u3002\n\u5728\u6ee1\u8db3\u4e0b\u9762\u7684\u51e0\u79cd\u60c5\u51b5\u65f6\uff0cdidReceiveUpdate === false\uff1a"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"\u672a\u4f7f\u7528forceUpdate\uff0c\u4e14oldProps === newProps && workInProgress.type === current.type && \uff01hasLegacyContextChanged() \uff0c\u5373props\u3001fiber.type\u548ccontext\u90fd\u672a\u53d1\u751f\u53d8\u5316")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"\u672a\u4f7f\u7528forceUpdate\uff0c\u4e14!includesSomeLane(renderLanes, updateLanes)\uff0c\u5373\u5f53\u524dfiber\u8282\u70b9\u4f18\u5148\u7ea7\u4f4e\u4e8e\u5f53\u524d\u66f4\u65b0\u7684\u4f18\u5148\u7ea7"))),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"const updateLanes = workInProgress.lanes;\nif (current !== null) {\n  //update\u65f6\n  const oldProps = current.memoizedProps;\n  const newProps = workInProgress.pendingProps;\n  if (\n    oldProps !== newProps ||\n    hasLegacyContextChanged() ||\n    (__DEV__ ? workInProgress.type !== current.type : false)\n  ) {\n    didReceiveUpdate = true;\n  } else if (!includesSomeLane(renderLanes, updateLanes)) {\n    // \u672c\u6b21\u7684\u6e32\u67d3\u4f18\u5148\u7ea7renderLanes\u4e0d\u5305\u542bfiber.lanes, \u8868\u660e\u5f53\u524dfiber\u8282\u70b9\u4f18\u5148\u7ea7\u4f4e\u4e8e\u672c\u6b21\u7684\u6e32\u67d3\u4f18\u5148\u7ea7\uff0c\u4e0d\u9700\u6e32\u67d3\n    didReceiveUpdate = false;\n    //...\n    // \u867d\u7136\u5f53\u524d\u8282\u70b9\u4e0d\u9700\u8981\u66f4\u65b0\uff0c\u4f46\u9700\u8981\u4f7f\u7528bailoutOnAlreadyFinishedWork\u5faa\u73af\u68c0\u6d4b\u5b50\u8282\u70b9\u662f\u5426\u9700\u8981\u66f4\u65b0\n    return bailoutOnAlreadyFinishedWork(current, workInProgress, renderLanes);\n  } else {\n    if ((current.effectTag & ForceUpdateForLegacySuspense) !== NoEffect) {\n      // forceUpdate\u4ea7\u751f\u7684\u66f4\u65b0\uff0c\u9700\u8981\u5f3a\u5236\u6e32\u67d3\n      didReceiveUpdate = true;\n    } else {\n      didReceiveUpdate = false;\n    }\n  }\n} else {\n  //mount\u65f6\n  //...\n}\n")),(0,o.kt)("h2",{id:"render\u9636\u6bb5"},"render\u9636\u6bb5\uff1a"),(0,o.kt)("p",null,"render\u9636\u6bb5\u7684\u6267\u884c\u5176\u5b9e\u662f\u4e00\u4e2a\u6df1\u5ea6\u4f18\u5148\u904d\u5386\u7684\u8fc7\u7a0b\uff0c\u5b83\u6709\u4e24\u4e2a\u6838\u5fc3\u51fd\u6570\uff0cbeginWork\u548ccompleteUnitOfWork,"),(0,o.kt)("p",null,"\u5728\u904d\u5386\u7684\u8fc7\u7a0b\u4e2d\uff0c\u4f1a\u5bf9\u6bcf\u4e2a\u904d\u5386\u5230\u7684\u8282\u70b9\u6267\u884cbeginWork\u521b\u5efa\u5b50fiber\u8282\u70b9\u3002\u82e5\u5f53\u524d\u8282\u70b9\u4e0d\u5b58\u5728\u5b50\u8282\u70b9\uff08next === null\uff09\uff0c\u5219\u5bf9\u5176\u6267\u884c"),(0,o.kt)("p",null,"completeUnitOfWork\u3002completeUnitOfWork\u65b9\u6cd5\u5185\u90e8\u4f1a\u5224\u65ad\u5f53\u524d\u8282\u70b9\u6709\u65e0\u5144\u5f1f\u8282\u70b9\uff0c\u6709\u5219\u8fdb\u5165\u5144\u5f1f\u8282\u70b9\u7684beginWork\u6d41\u7a0b\uff0c\u5426\u5219\u8fdb\n\u5165\u7236\u8282\u70b9\u7684completeUnitOfWork\u6d41\u7a0b"),(0,o.kt)("p",null,"\u5f53beginWork\u8fd4\u56de\u503c\u4e3a\u7a7a\u65f6\uff0c\u4ee3\u8868\u5728\u904d\u5386\u7236->\u5b50\u94fe\u8868\u7684\u8fc7\u7a0b\u4e2d\u53d1\u73b0\u5f53\u524d\u94fe\u8868\u5df2\u7ecf\u65e0\u4e0b\u4e00\u4e2a\u8282\u70b9\u4e86\uff08\u4e5f\u5c31\u662f\u5df2\u904d\u5386\u5b8c\u5f53\u524d\u7236->\u5b50\u94fe\u8868\uff09\uff0c"),(0,o.kt)("p",null,"\u6b64\u65f6\u4f1a\u8fdb\u5165\u5230completeUnitOfWork\u51fd\u6570\u3002"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"1.beginWork\u9636\u6bb5:\u5c06ast\u6811\u8f6c\u6362\u4e3afiber \u6811\u3002\u8fd9\u4e9bFiber\u8282\u70b9\u4f1a\u88ab\u6807\u8bb0\u6210\u5e26\u6709\u2018Placement\u2019\u7684\u526f\u4f5c\u7528\uff0c\u8bf4\u660e\u5b83\u4eec\u662f\u65b0\u589e\u7684\u8282\u70b9\uff0c\u9700\u8981\u88ab\u63d2\u5165\u5230\u771f\u5b9e\u8282\u70b9\u4e2d\u4e86")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"- \u6267\u884c\u90e8\u5206\u751f\u547d\u5468\u671f\u548crender\uff0c\u5f97\u5230\u6700\u65b0\u7684 children\n- \u5411\u4e0b\u904d\u5386\u8c03\u548c children \uff0c\u590d\u7528 oldFiber\n- \u6253\u4e0d\u540c\u7684\u526f\u4f5c\u7528\u6807\u7b7eeffectTag\uff0c\u6bd4\u5982\u7c7b\u7ec4\u4ef6\u7684\u751f\u547d\u5468\u671f\uff0c\u6216\u8005\u5143\u7d20\u7684\u589e\u52a0\uff0c\u5220\u9664\uff0c\u66f4\u65b0\u3002\n")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"2.completeWork\u9636\u6bb5:\u751f\u6210\u5b9e\u4f8b")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"completeUnitOfWork \u7684\u6d41\u7a0b\u662f\u81ea\u4e0b\u5411\u4e0a\u7684\n\n1.\u5c06effectTag \u7684 Fiber \u8282\u70b9\u4fdd\u5b58\u5230 effectList \u7684\u5355\u5411\u94fe\u8868\u4e2d\u3002 \u5728 commit \u9636\u6bb5\uff0c\u5c06\u4e0d\u518d\u9700\u8981\u904d\u5386\u6bcf\u4e00\u4e2a fiber \uff0c\u53ea\u9700\u8981\u6267\u884c\u66f4\u65b0 effectList \u5c31\u53ef\u4ee5\u4e86\u3002\n2.\u5904\u7406\u7ec4\u4ef6\u7684context\uff0c\u521d\u59cb\u5316\u5143\u7d20\u6807\u7b7e\uff0c\u751f\u6210\u771f\u5b9eDOM\uff0c\u5904\u7406props\uff0c\u7b49\n")),(0,o.kt)("p",null,"\u6b63\u5728\u6784\u5efaFiber\u6811\u53ebworkInProgress Fiber\uff0c\u8fd9\u4e24\u9897\u6811\u7684\u8282\u70b9\u901a\u8fc7alternate\u76f8\u8fde."),(0,o.kt)("p",null,"\u771f\u5b9edom\u5bf9\u5e94\u5728\u5185\u5b58\u4e2d\u7684Fiber\u8282\u70b9\u5f62\u6210Fiber\u6811\uff0c\u8fd9\u9897Fiber\u6811\u5728react\u4e2d\u53ebcurrent Fiber"),(0,o.kt)("p",null,"\u7ec4\u4ef6\u7684\u72b6\u6001\u8ba1\u7b97\u3001diff\u7684\u64cd\u4f5c:\u901a\u8fc7 Diff \u7b97\u6cd5\u627e\u51fa\u6240\u6709\u8282\u70b9\u53d8\u66f4\uff0c\u4f8b\u5982\u8282\u70b9\u65b0\u589e\u3001\u5220\u9664\u3001\u5c5e\u6027\u53d8\u66f4\u7b49\u7b49, \u83b7\u5f97\u9700\u8981\u66f4\u65b0\u7684\u8282\u70b9\u4fe1\u606f\uff0c\u4ee5\u53carender\u51fd\u6570\u7684\u6267\u884c\uff0c\u53d1\u751f\u5728beginWork\u9636\u6bb5"),(0,o.kt)("p",null,"effect\u94fe\u8868\u7684\u6536\u96c6\u3001\u88ab\u8df3\u8fc7\u7684\u4f18\u5148\u7ea7\u7684\u6536\u96c6\uff0c\u53d1\u751f\u5728completeWork\u9636\u6bb5\u3002"),(0,o.kt)("p",null,"render/reconciliation \u534f\u8c03\u9636\u6bb5(\u53ef\u4e2d\u65ad/\u5f02\u6b65)\uff1a"),(0,o.kt)("p",null,"render \u9636\u6bb5\uff1a\u7eaf\u51c0\u4e14\u6ca1\u6709\u526f\u4f5c\u7528\uff0c\u53ef\u80fd\u4f1a\u88ab React \u6682\u505c\u3001\u7ec8\u6b62\u6216\u91cd\u65b0\u542f\u52a8\u3002"),(0,o.kt)("p",null,"\u5728 render \u9636\u6bb5\uff0cReact \u4e3b\u8981\u662f\u5728\u5185\u5b58\u4e2d\u505a\u8ba1\u7b97\uff0c\u660e\u786e DOM \u6811\u7684\u66f4\u65b0\u70b9\uff1b\u800c commit \u9636\u6bb5\uff0c\u5219\u8d1f\u8d23\u628a render \u9636\u6bb5\u751f\u6210\u7684\u66f4\u65b0\u771f\u6b63\u5730\u6267\u884c\u6389\u3002"),(0,o.kt)("p",null,"\u5728 render \u9636\u6bb5\uff0c\u4e00\u4e2a\u5e9e\u5927\u7684\u66f4\u65b0\u4efb\u52a1\u88ab\u5206\u89e3\u4e3a\u4e86\u4e00\u4e2a\u4e2a\u7684\u5de5\u4f5c\u5355\u5143\uff0c\u8fd9\u4e9b\u5de5\u4f5c\u5355\u5143\u6709\u7740\u4e0d\u540c\u7684\u4f18\u5148\u7ea7\uff0cReact \u53ef\u4ee5\u6839\u636e\u4f18\u5148\u7ea7\u7684\u9ad8\u4f4e\u53bb\u5b9e\u73b0\u5de5\u4f5c\u5355\u5143\u7684\u6253\u65ad\u548c\u6062\u590d\u3002"),(0,o.kt)("h2",{id:"render\u4e4b\u4efb\u52a1\u8c03\u5ea6"},"render\u4e4b\u4efb\u52a1\u8c03\u5ea6"),(0,o.kt)("p",null,"\u540c\u6b65\u4e0d\u53ef\u4e2d\u65ad\u66f4\u65b0\uff0c\u610f\u5473\u7740\u5728\u66f4\u65b0\u8fc7\u7a0b\u4e2d\uff0c\u5373\u4f7f\u4ea7\u751f\u4e86\u66f4\u9ad8\u4f18\u5148\u7ea7\u7684\u66f4\u65b0\uff0c\u539f\u6765\u7684\u66f4\u65b0\u4e5f\u4f1a\u7ee7\u7eed\u5904\u7406\uff0c\u7b49\u5904\u7406\u5b8c\u6bd5\u6e32\u67d3\u5230\u5c4f\u5e55\u4e0a\u4ee5\u540e\u624d\u4f1a\u5f00\u59cb\u5904\u7406\u66f4\u9ad8\u4f18\u5148\u7ea7\u7684\u66f4\u65b0\u3002"),(0,o.kt)("p",null,"\u5f02\u6b65\u53ef\u4e2d\u65ad\u66f4\u65b0\uff0c\u5728\u6784\u5efa workInProgress \u7684\u8fc7\u7a0b\u4e2d\uff0c\u5982\u679c\u6709\u66f4\u9ad8\u4f18\u5148\u7ea7\u7684\u66f4\u65b0\u4ea7\u751f\uff0c React \u4f1a\u505c\u6b62 workInProgress fiber tree \u7684\u6784\u5efa\uff0c\u7136\u540e\u5f00\u59cb\u5904\u7406\u66f4\u9ad8\u4f18\u5148\u7ea7\u7684\u66f4\u65b0\uff0c\u91cd\u65b0\u6784\u5efa workInProgress fiber tree\u3002"),(0,o.kt)("p",null,"\u7b49\u66f4\u9ad8\u4f18\u5148\u7ea7\u7684\u66f4\u65b0\u5904\u7406\u5b8c\u6bd5\u4e4b\u540e\uff0c\u624d\u4f1a\u5904\u7406\u539f\u6765\u88ab\u4e2d\u65ad\u7684\u66f4\u65b0\u3002"),(0,o.kt)("p",null,"React fiber\u7684\u6784\u5efa\u7684\u8fc7\u7a0b\u4ee5\u6bcf\u4e2afiber\u4f5c\u4e3a\u4e00\u4e2a\u5de5\u4f5c\u5355\u5143\uff0c\u8fdb\u884c\u5de5\u4f5c\u5faa\u73af\uff0c\u5de5\u4f5c\u5faa\u73af\u4e2d\u6bcf\u6b21\u5904\u7406\u4e00\u4e2a\u4efb\u52a1\uff08\u5de5\u4f5c\u5355\u5143\uff09\uff0c\u5904\u7406\u5b8c\u6bd5\u6709\u4e00\u6b21\u5598\u606f\u7684\u673a\u4f1a\uff1a"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"while (nextUnitOfWork !== null && !shouldYieldToRenderer()) {\n  nextUnitOfWork = performUnitOfWork(nextUnitOfWork);\n}\n")),(0,o.kt)("p",null,"shouldYieldToRenderer\u5c31\u662f\u770b\u65f6\u95f4\u7528\u5b8c\u4e86\u6ca1\uff0c\u6ca1\u7528\u5b8c\u7684\u8bdd\u7ee7\u7eed\u5904\u7406\u4e0b\u4e00\u4e2a\u4efb\u52a1\uff0c\u7528\u5b8c\u4e86\u5c31\u7ed3\u675f\uff0c\u628a\u65f6\u95f4\u63a7\u5236\u6743\u8fd8\u7ed9\u4e3b\u7ebf\u7a0b\uff0c\u7b49\u4e0b\u4e00\u6b21requestIdleCallback\u56de\u8c03\u518d\u63a5\u7740\u505a\u3002\u4f46\u5982\u679c\u5f53\u524d\u6e32\u67d3\u6267\u884c\u5f88\u957f\u4e00\u6bb5\u65f6\u95f4\u540e\u8fd8\u672a\u7ed3\u675f\uff0c\u90a3\u4e48\u5c31\u4e0d\u518d\u4f1a\u5598\u606f\uff0c\u800c\u662f\u4e00\u6b21\u6027\u628a\u5269\u4f59\u5de5\u4f5c\u5168\u90e8\u505a\u5b8c\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"if (!isYieldy) {\n  // Flush work without yielding\n  while (nextUnitOfWork !== null) {\n    nextUnitOfWork = performUnitOfWork(nextUnitOfWork);\n  }\n}\n")),(0,o.kt)("p",null,"React Fiber\u7684\u5de5\u4f5c\u8c03\u5ea6\u4e0e\u6d4f\u89c8\u5668\u7684\u6838\u5fc3\u4ea4\u4e92\u6d41\u7a0b\u5982\u4e0b\uff1a\n",(0,o.kt)("img",{src:r(92321).Z,width:"812",height:"396"})),(0,o.kt)("h3",{id:"\u4efb\u52a1\u8c03\u5ea6\u4f8b\u5b50"},"\u4efb\u52a1\u8c03\u5ea6\u4f8b\u5b50"),(0,o.kt)("p",null,"\u6211\u4eec\u70b9\u51fb Child \u7684 button \u6309\u94ae\uff0c\u540c\u65f6\u7ed9 Child \u548c Parent \u7684 number \u52a0 1\u3002\u5176\u4e2d Child \u7684\u52a0 1 \u64cd\u4f5c\u5148\u5f00\u59cb\uff0c\u5e76\u4e14 Parent \u7684\u52a0 1 \u64cd\u4f5c\u4f18\u5148\u7ea7\u66f4\u9ad8\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},'function Parent() {\n    const [number, setNumber] = useState(1);\n    const buttonRef = useRef(null);\n    const add = () => { setNumber(number + 1) }\n    const click = () => { buttonRef.current.click() }\n    return (\n        <div>\n            <button ref={buttonRef} onClick={add}>\u4fee\u6539 Parent</button>\n            <span>{number}</span>\n            <Child callback={click} />\n        </div>\n    )\n }\n\nconst Child = (props) => {\n    const [number, setNumber] = useState(1);\n    const click = () => {\n        setTimeout(() => {\n            // setTimeout \u5185\u90e8\u4ea7\u751f\u7684\u66f4\u65b0\uff0c\u4f18\u5148\u7ea7\u4e3a\u666e\u901a\u4f18\u5148\u7ea7\n            setNumber(number + 1);\n        }, 10)\n        setTimeout(() => {\n            // click \u89e6\u53d1\u7684\u66f4\u65b0\uff0c\u4f18\u5148\u7ea7\u4e3a\u7528\u6237 block \u4f18\u5148\u7ea7\uff0c\u8981\u66f4\u9ad8\u4e00\u4e9b\n            props.callback && props.callback();\n        }, 10);\n     }\n\n    return (\n        <div>\n            <button onClick={click}>\u4fee\u6539 Child + Parent</button>\n            <div  className="box">\n                {Array(50000).fill(number).map(item => (<span>{item}</span>))}\n            </div>\n        </div>\n                \n    )\n}\n')),(0,o.kt)("h2",{id:"commit\u9636\u6bb5\u53ef\u4ee5\u5206\u4e3a3\u4e2a\u9636\u6bb5"},"commit\u9636\u6bb5:\u53ef\u4ee5\u5206\u4e3a3\u4e2a\u9636\u6bb5\uff1a"),(0,o.kt)("p",null,"\u5728render\u9636\u6bb5\u7ed3\u675f\u540e\uff0c\u4f1a\u8fdb\u5165commit\u9636\u6bb5\uff0c\u8be5\u9636\u6bb5\u4e0d\u53ef\u4e2d\u65ad,commit\u9636\u6bb5\u7684\u8c03\u5ea6\u4f18\u5148\u7ea7\u91c7\u7528\u7684\u662f\u6700\u9ad8\u4f18\u5148\u7ea7\uff0c\u4ee5\u4fdd\u8bc1commit\u9636\u6bb5\u540c\u6b65\u6267\u884c\u4e0d\u53ef\u88ab\u6253\u65ad\u3002"),(0,o.kt)("p",null,"\u4e3b\u8981\u662f\u53bb\u4f9d\u636eworkInProgress\u6811\u4e2d\u6709\u53d8\u5316\u7684\u90a3\u4e9b\u8282\u70b9\uff08render\u9636\u6bb5\u7684completeWork\u8fc7\u7a0b\u6536\u96c6\u5230\u7684effect\u94fe\u8868\uff09,\u53bb\u5b8c\u6210DOM\u64cd\u4f5c\uff0c\u5c06\u66f4\u65b0\u5e94\u7528\u5230\u9875\u9762\u4e0a\uff0c\u9664\u6b64\u4e4b\u5916\uff0c\u8fd8\u4f1a\u5f02\u6b65\u8c03\u5ea6useEffect\u4ee5\u53ca\u540c\u6b65\u6267\u884cuseLayoutEffect\u3002"),(0,o.kt)("p",null,"\u76f8\u5e94\u7684\u8282\u70b9\u8fdb\u884c\u63d0\u4ea4\uff0c\u6e32\u67d3\u5230\u9875\u9762\u4e0a,\u5728commit\u9636\u6bb5\u5c31\u4f1a\u64cd\u4f5c\u771f\u5b9e\u8282\u70b9\uff0c\u5c06\u5b83\u4eec\u63d2\u5165\u5230dom\u6811\u4e2d:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"1.Before mutation \u9636\u6bb5\uff08\u6267\u884c DOM \u64cd\u4f5c\u524d\uff09\uff1b"),(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},"\u5bf9\u4e8e\u7c7b\u7ec4\u4ef6\uff0c\u6267\u884c getSnapshotBeforeUpdate \u751f\u547d\u5468\u671f"),(0,o.kt)("li",{parentName:"ul"},"\u5bf9\u4e8e\u51fd\u6570\u7ec4\u4ef6\uff0c\u5f02\u6b65\u8c03\u7528 useEffect"))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"2.mutation \u9636\u6bb5\uff08\u6267\u884c DOM \u64cd\u4f5c\uff09\uff1b"),(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},"\u8fdb\u884c\u771f\u5b9e\u7684 DOM \u64cd\u4f5c"))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"3.layout \u9636\u6bb5\uff08\u6267\u884c DOM \u64cd\u4f5c\u540e\uff09"),(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},"\u5bf9\u4e8e\u7c7b\u7ec4\u4ef6\uff0c\u4f1a\u6267\u884csetState\u7684callback"),(0,o.kt)("li",{parentName:"ul"},"\u5bf9\u4e8e\u51fd\u6570\u7ec4\u4ef6\uff0c\u4f1a\u6267\u884cuseLayoutEffect")))),(0,o.kt)("h2",{id:"\u4e24\u4e2a\u9636\u6bb5\u533a\u522b"},"\u4e24\u4e2a\u9636\u6bb5\u533a\u522b\uff1a"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("inlineCode",{parentName:"p"},"render \u9636\u6bb5\u7684\u5de5\u4f5c\u53ef\u4ee5\u5206\u4e3a\u9012\u9636\u6bb5\u548c\u5f52\u9636\u6bb5\u4f5c\u7528\uff1a")),(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},"\u5176\u4e2d\u9012\u9636\u6bb5\u4f1a\u6267\u884c beginWork()"),(0,o.kt)("li",{parentName:"ul"},"\u5f52\u9636\u6bb5\u4f1a\u6267\u884c completeWork()"))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"render/reconciliation\u9636\u6bb5\u7684\u5de5\u4f5c\uff08diff\uff09\u53ef\u4ee5\u62c6\u5206\uff0ccommit\u9636\u6bb5\u7684\u5de5\u4f5c\uff08patch\uff09\u4e0d\u53ef\u62c6\u5206"))),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"commit\u9636\u6bb5\u7684\u5de5\u4f5c\uff08patch\uff09\u628a\u672c\u6b21\u66f4\u65b0\u4e2d\u7684\u6240\u6709DOM change\u5e94\u7528\u5230DOM\u6811\uff0c\u662f\u4e00\u8fde\u4e32\u7684DOM\u64cd\u4f5c\u3002\n\nDOM\u64cd\u4f5c\u867d\u7136\u770b\u8d77\u6765\u4e5f\u53ef\u4ee5\u62c6\u5206\uff08\u6309\u7167change list\u4e00\u6bb5\u4e00\u6bb5\u505a\uff09\uff0c\u4f46\u8fd9\u6837\u505a\u4e00\u65b9\u9762\u53ef\u80fd\u9020\u6210DOM\u5b9e\u9645\u72b6\u6001\u4e0e\u7ef4\u62a4\u7684\u5185\u90e8\u72b6\u6001\u4e0d\u4e00\u81f4\uff0c\u53e6\u5916\u8fd8\u4f1a\u5f71\u54cd\u4f53\u9a8c\u3002\u800c\u4e14\uff0c\u4e00\u822c\u573a\u666f\u4e0b\uff0cDOM\u66f4\u65b0\u7684\u8017\u65f6\u6bd4\u8d77diff\u53ca\u751f\u547d\u5468\u671f\u51fd\u6570\u8017\u65f6\u4e0d\u7b97\u4ec0\u4e48\uff0c\u62c6\u5206\u7684\u610f\u4e49\u4e0d\u5f88\u5927\n")),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"\u63d0\u793a:\u63a5\u4e0b\u6765\u7684\u6d41\u7a0b\u5f00log\u4f1a\u6bd4\u8f83\u6e05\u6670")),(0,o.kt)("br",null),(0,o.kt)("h2",{id:"2-1render\u9636\u6bb5\u5f00\u59cb-\u7b2c\u4e00\u6b21\u6e32\u67d3\u4e2d\u8c03\u7528performconcurrentworkonroot"},"2-1.render\u9636\u6bb5\u5f00\u59cb: \u7b2c\u4e00\u6b21\u6e32\u67d3\u4e2d\u8c03\u7528performConcurrentWorkOnRoot()"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"\u8c03\u7528 ReactDOMRoot.prototype.render() \u5f00\u59cbrender\u9636\u6bb5")),(0,o.kt)("p",null,"18\u4e2d\u521d\u59cb\u5316\u8c03\u7528",(0,o.kt)("inlineCode",{parentName:"p"},"performSyncWorkOnRoot()"),"\u6216",(0,o.kt)("inlineCode",{parentName:"p"},"performConcurrentWorkOnRoot()"),"\u7684\u8c03\u7528,\u8fd9\u53d6\u51b3\u4e8e\u672c\u6b21\u66f4\u65b0\u662f\u540c\u6b65\u66f4\u65b0\u8fd8\u662f\u5f02\u6b65\u66f4\u65b0."),(0,o.kt)("p",null,"\u603b\u7ed3:\nrender \u9636\u6bb5\u5f00\u59cb\u4e8e performSyncWorkOnRoot \u6216 performConcurrentWorkOnRoot \u65b9\u6cd5\u7684\u8c03\u7528\u3002\u524d\u9762\u6709\u63d0\u5230\uff1a\u8fd9\u53d6\u51b3\u4e8e\u672c\u6b21\u66f4\u65b0\u662f\u540c\u6b65\u66f4\u65b0\u8fd8\u662f\u5f02\u6b65\u66f4\u65b0\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"// performConcurrentWorkOnRoot \u8c03\u7528 renderRootSync --\x3eworkLoopSync\nfunction performConcurrentWorkOnRoot(root, didTimeout) {\n  var exitStatus = shouldTimeSlice ? renderRootConcurrent(root, lanes) : renderRootSync(root, lanes);\n  return null;\n}\n\n// \u7b2c\u4e00\u6b21\u6e32\u67d3\u8d70\u8fd9\u4e2a renderRootSync --\x3e renderRootSync --\x3eworkLoopSync\nfunction renderRootSync(root, lanes) {\n  do {\n    try {\n      console.log('renderRootSync---\x3e', root);\n      workLoopSync();\n      break;\n    } catch (thrownValue) {\n      handleError(root, thrownValue);\n    }\n  } while (true);\n}\n\nfunction renderRootConcurrent(root, lanes) {\ndo {\n  try {\n    workLoopConcurrent();\n    break;\n  } catch (thrownValue) {\n    handleError(root, thrownValue);\n  }\n} while (true);\n}\n")),(0,o.kt)("h2",{id:"2-2\u6e32\u67d3workloopsync--performunitofworkworkloopconcurrent\u548cworkloopsync\u533a\u522b"},"2-2.\u6e32\u67d3:workLoopSync()--\x3eperformUnitOfWork();workLoopConcurrent()\u548cworkLoopSync()\u533a\u522b"),(0,o.kt)("p",null,"\u5b83\u4eec\u552f\u4e00\u7684\u533a\u522b\u662f\u662f\u5426\u8c03\u7528shouldYield\u3002\u5982\u679c\u5f53\u524d\u6d4f\u89c8\u5668\u5e27\u6ca1\u6709\u5269\u4f59\u65f6\u95f4\uff0cshouldYield\u4f1a\u4e2d\u6b62\u5faa\u73af\uff0c\u76f4\u5230\u6d4f\u89c8\u5668\u6709\u7a7a\u95f2\u65f6\u95f4\u540e\u518d\u7ee7\u7eed\u904d\u5386\u3002"),(0,o.kt)("p",null,"workInProgress \u4ee3\u8868\u5f53\u524d\u5df2\u521b\u5efa\u7684 workInProgress fiber\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"function workLoopConcurrent() {\n  // Perform work until Scheduler asks us to yield\n  while (workInProgress !== null && !shouldYield()) {\n    performUnitOfWork(workInProgress);\n  }\n}\n\n// \u7b2c\u4e00\u6b21\u6e32\u67d3\u8d70\u8fd9\u4e2a\nfunction workLoopSync() {\n  // Already timed out, so perform work without checking if we need to yield.\n  while (workInProgress !== null) {\n    performUnitOfWork(workInProgress);\n  }\n}\n")),(0,o.kt)("br",null),(0,o.kt)("h1",{id:"\u4e09-render\u9636\u6bb51beginwork"},"\u4e09. render\u9636\u6bb51:beginWork"),(0,o.kt)("h2",{id:"\u7b2c\u4e00\u6b65\u63a5\u4e0a\u9762performunitofwork--beginwork"},"\u7b2c\u4e00\u6b65:\u63a5\u4e0a\u9762:performUnitOfWork()--\x3ebeginWork()"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"performUnitOfWork()"),"\u5c06\u89e6\u53d1\u5bf9 beginWork \u7684\u8c03\u7528\uff0c\u8fdb\u800c\u5b9e\u73b0\u5bf9\u65b0 Fiber \u8282\u70b9\u7684\u521b\u5efa\u3002\n\u82e5 beginWork \u6240\u521b\u5efa\u7684 Fiber \u8282\u70b9\u4e0d\u4e3a\u7a7a\uff0c\u5219 performUniOfWork \u4f1a\u7528\u8fd9\u4e2a\u65b0\u7684 Fiber \u8282\u70b9\u6765\u66f4\u65b0 workInProgress \u7684\u503c\uff0c\u4e3a\u4e0b\u4e00\u6b21\u5faa\u73af\u505a\u51c6\u5907\u3002"),(0,o.kt)("p",null,"\u901a\u8fc7\u5faa\u73af\u8c03\u7528",(0,o.kt)("inlineCode",{parentName:"p"},"performUnitOfWork()"),"\u6765\u89e6\u53d1 beginWork\uff0c\u65b0\u7684 Fiber \u8282\u70b9\u5c31\u4f1a\u88ab\u4e0d\u65ad\u5730\u521b\u5efa\u3002\u5f53 workInProgress \u7ec8\u4e8e\u4e3a\u7a7a\u65f6\uff0c\u8bf4\u660e\u6ca1\u6709\u65b0\u7684\u8282\u70b9\u53ef\u4ee5\u521b\u5efa\u4e86\uff0c\u4e5f\u5c31\u610f\u5473\u7740\u5df2\u7ecf\u5b8c\u6210\u5bf9\u6574\u68f5 Fiber \u6811\u7684\u6784\u5efa\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"performUnitOfWork \u4f5c\u7528\u521b\u5efa\u4e0b\u4e00\u4e2a Fiber \u8282\u70b9\uff0c\u5e76\u8d4b\u503c\u7ed9workInProgress\uff0c\u540c\u65f6\u628a workInProgress \u4e0e\u5df2\u521b\u5efa\u7684 Fiber \u8282\u70b9\u8fde\u63a5\u8d77\u6765\u6784\u6210 Fiber \u6811\u3002\n")),(0,o.kt)("p",null,"react\u628a\u6bcf\u4e2afiber\u5f53\u6210\u751f\u6210fiber\u6700\u5c0f\u5355\u5143,\u53ea\u8981\u8fed\u4ee3\u6240\u6709fiber\u5219\u5230\u9876\u7ea7Fiber\u65f6\u6574\u9897FiberTree\u4fbf\u751f\u6210\u4e86\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"// performConcurrentWorkOnRoot\u4f1a\u8c03\u7528\u8be5\u65b9\u6cd5\nfunction workLoopConcurrent() {\n  while (workInProgress !== null && !shouldYield()) {\n    performUnitOfWork(workInProgress)\n  }\n}\n\n// performSyncWorkOnRoot \u4f1a\u8c03\u7528\u8be5\u65b9\u6cd5,react 18 \u521d\u59cb\u5316\u8c03\u7528\u8fd9\u4e2a\nfunction workLoopSync() {\n  while (workInProgress !== null) {\n    performUnitOfWork(workInProgress)\n  }\n}\n/*\n\u5b83\u4eec\u552f\u4e00\u7684\u533a\u522b\u662f\u662f\u5426\u8c03\u7528shouldYield\u3002\u5982\u679c\u5f53\u524d\u6d4f\u89c8\u5668\u5e27\u6ca1\u6709\u5269\u4f59\u65f6\u95f4\uff0cshouldYield\u4f1a\u4e2d\u6b62\u5faa\u73af\uff0c\u76f4\u5230\u6d4f\u89c8\u5668\u6709\u7a7a\u95f2\u65f6\u95f4\u540e\u518d\u7ee7\u7eed\u904d\u5386\u3002\n\nworkInProgress\u4ee3\u8868\u5f53\u524d\u5df2\u521b\u5efa\u7684 workInProgress fiber\u3002\n* */\n\nfunction performUnitOfWork(unitOfWork) {\n  workInProgressNums = workInProgressNums + 1\n  // The current, flushed, state of this fiber is the alternate. Ideally\n  // nothing should rely on this, but relying on it here means that we don't\n  // need an additional field on the work in progress.\n  var current = unitOfWork.alternate;\n  setCurrentFiber(unitOfWork);\n  var next;\n\n  if ((unitOfWork.mode & ProfileMode) !== NoMode) {\n    startProfilerTimer(unitOfWork);\n    //\u5bf9\u5f53\u524d\u8282\u70b9\u8fdb\u884c\u534f\u8c03\uff0c\u5982\u679c\u5b58\u5728\u5b50\u8282\u70b9\uff0c\u5219\u8fd4\u56de\u5b50\u8282\u70b9\u7684\u5f15\u7528\n    next = beginWork$1(current, unitOfWork, subtreeRenderLanes);\n    stopProfilerTimerIfRunningAndRecordDelta(unitOfWork, true);\n  } else {\n    next = beginWork$1(current, unitOfWork, subtreeRenderLanes);\n  }\n\n  resetCurrentFiber();\n  unitOfWork.memoizedProps = unitOfWork.pendingProps;\n\n  //\u5982\u679c\u65e0\u5b50\u8282\u70b9\uff0c\u5219\u4ee3\u8868\u5f53\u524d\u7684child\u94fe\u8868\u5df2\u7ecf\u904d\u5386\u5b8c\n  if (next === null) {\n    // If this doesn't spawn new work, complete the current work.\n    //\u6b64\u51fd\u6570\u5185\u90e8\u4f1a\u5e2e\u6211\u4eec\u627e\u5230\u4e0b\u4e00\u4e2a\u53ef\u6267\u884c\u7684\u8282\u70b9\n    completeUnitOfWork(unitOfWork);\n  } else {\n    workInProgress = next;\n  }\n\n  ReactCurrentOwner$2.current = null;\n}\n")),(0,o.kt)("h2",{id:"\u7b2c\u4e8c\u6b65\u63a2\u7a76beginwork\u4f20\u5165\u5f53\u524d-fiber-\u8282\u70b9\u521b\u5efa\u5b50-fiber-\u8282\u70b9"},"\u7b2c\u4e8c\u6b65:\u63a2\u7a76beginWork():\u4f20\u5165\u5f53\u524d Fiber \u8282\u70b9\uff0c\u521b\u5efa\u5b50 Fiber \u8282\u70b9"),(0,o.kt)("p",null,"beginWork\u7684\u4e3b\u8981\u529f\u80fd\u5c31\u662f\u5904\u7406\u5f53\u524d\u904d\u5386\u5230\u7684fiber\uff0c\u7ecf\u8fc7\u4e00\u756a\u5904\u7406\u4e4b\u540e\u8fd4\u56de\u5b83\u7684\u5b50fiber\uff0c\u4e00\u4e2a\u4e00\u4e2a\u5730\u5f80\u5916\u5410\u51fafiber\u8282\u70b9\uff0c\u90a3\u4e48workInProgress\u6811\u4e5f\u5c31\u4f1a\u88ab\u4e00\u70b9\u4e00\u70b9\u5730\u6784\u5efa\u51fa\u6765"),(0,o.kt)("p",null,"\u9996\u5148\u4ece rootFiber \u5f00\u59cb\u5411\u4e0b\u6df1\u5ea6\u4f18\u5148\u904d\u5386\u3002\u4e3a\u904d\u5386\u5230\u7684\u6bcf\u4e2a Fiber \u8282\u70b9\u8c03\u7528beginWork\u65b9\u6cd5\u3002"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"current\uff1a\u5f53\u524d\u7ec4\u4ef6\u5bf9\u5e94\u7684 Fiber \u8282\u70b9\u5728\u4e0a\u4e00\u6b21\u66f4\u65b0\u65f6\u7684 Fiber \u8282\u70b9\uff0c\u5373 workInProgress.alternate\uff1b"),(0,o.kt)("li",{parentName:"ul"},"workInProgress\uff1a\u5f53\u524d\u7ec4\u4ef6\u5bf9\u5e94\u7684 Fiber \u8282\u70b9\uff1b"),(0,o.kt)("li",{parentName:"ul"},"renderLanes\uff1a\u4f18\u5148\u7ea7\u76f8\u5173\uff0c\u5728\u8bb2\u89e3Scheduler\u65f6\u518d\u8bb2\u89e3\u3002")),(0,o.kt)("p",null,"\u66f4\u65b0\u7684\u65f6\u5019\u5b83\u4f1a\u4ee5\u65e7\u7684fiber tree\u4e3a\u84dd\u672c\uff0c\u628a\u6bcf\u4e2afiber\u4f5c\u4e3a\u4e00\u4e2a\u5de5\u4f5c\u5355\u5143\uff0c\u81ea\u9876\u5411\u4e0b\u9010\u8282\u70b9\u6784\u9020workInProgress tree\uff08\u6784\u5efa\u4e2d\u7684\u65b0fiber tree\uff09, \u6df1\u5ea6\u4f18\u5148\u904d\u5386:"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"\u4ece\u9876\u70b9\u5f00\u59cb\u904d\u5386"),(0,o.kt)("li",{parentName:"ol"},"\u5982\u679c\u6709\u5b50\u8282\u70b9\uff0c\u5148\u904d\u5386\u5b50\u8282\u70b9\uff1b"),(0,o.kt)("li",{parentName:"ol"},"\u5982\u679c\u6ca1\u6709\u5b50\u8282\u70b9\uff0c\u5219\u770b\u6709\u6ca1\u6709\u5144\u5f1f\u8282\u70b9\uff0c\u6709\u5219\u904d\u5386\u5144\u5f1f\u8282\u70b9\uff0c\u5e76\u628aeffect\u5411\u4e0a\u5f52\u5e76"),(0,o.kt)("li",{parentName:"ol"},"\u5982\u679c\u6ca1\u6709\u5144\u5f1f\u8282\u70b9\uff0c\u5219\u770b\u6709\u6ca1\u6709\u7236\u5144\u5f1f\u8282\u70b9\uff0c\u6709\u5219\u904d\u5386\u7236\u5144\u5f1f\u8282\u70b9"),(0,o.kt)("li",{parentName:"ol"},"\u5982\u679c\u6ca1\u6709\u90fd\u6ca1\u6709\u4e86\uff0c\u90a3\u4e48\u904d\u5386\u7ed3\u675f")),(0,o.kt)("h3",{id:"rootfiber\u7ed3\u6784\u904d\u5386\u4f8b\u5b50"},"RootFiber\u7ed3\u6784\u904d\u5386\u4f8b\u5b50"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-mermaid"},"%% flowchart LR\nflowchart RL\nA1--child--\x3eB1--child--\x3eC1--sibling--\x3eC2\nB1--sibling--\x3eB2\nB2--return--\x3eA1\nB2--child--\x3eC3\nC3--return--\x3eB2\nC3--sibling--\x3eC4\nC4--return--\x3eB2\nB1--return--\x3eA1\nC1--return--\x3eB1\nC2--return--\x3eB1\n")),(0,o.kt)("p",null,"\u904d\u5386\u8fc7\u7a0b:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-mermaid"},"flowchart LR\n%% flowchart TD\nstart--\x3eA1--1--\x3eB1--2--\x3eC1--3--\x3eC2\n\nC2--4--\x3eB1\nB1--5--\x3eB2\nB2--9--\x3eA1\nB2--6--\x3eC3\nC3--7--\x3eC4\nC4--8--\x3eB2\n")),(0,o.kt)("h2",{id:"\u90a3\u6211\u4eec\u7ee7\u7eed\u770b\u770bbeginwork\u4e2d\u662f\u5982\u4f55\u5224\u65ad\u4e0b\u4e00\u4e2a\u5de5\u4f5c\u5355\u5143\u7684"},"\u90a3\u6211\u4eec\u7ee7\u7eed\u770b\u770bbeginWork\u4e2d\u662f\u5982\u4f55\u5224\u65ad\u4e0b\u4e00\u4e2a\u5de5\u4f5c\u5355\u5143\u7684\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"function performUnitOfWork(unitOfWork) {\n\n  workInProgressNums = workInProgressNums + 1\n  // The current, flushed, state of this fiber is the alternate. Ideally\n  // nothing should rely on this, but relying on it here means that we don't\n  // need an additional field on the work in progress.\n  var current = unitOfWork.alternate;\n  setCurrentFiber(unitOfWork);\n  var next;\n\n  if ((unitOfWork.mode & ProfileMode) !== NoMode) {\n    startProfilerTimer(unitOfWork);\n    //\u5bf9\u5f53\u524d\u8282\u70b9\u8fdb\u884c\u534f\u8c03\uff0c\u5982\u679c\u5b58\u5728\u5b50\u8282\u70b9\uff0c\u5219\u8fd4\u56de\u5b50\u8282\u70b9\u7684\u5f15\u7528\n    next = beginWork$1(current, unitOfWork, subtreeRenderLanes);\n    stopProfilerTimerIfRunningAndRecordDelta(unitOfWork, true);\n  } else {\n    next = beginWork$1(current, unitOfWork, subtreeRenderLanes);\n  }\n\n  resetCurrentFiber();\n  unitOfWork.memoizedProps = unitOfWork.pendingProps;\n\n  //\u5982\u679c\u65e0\u5b50\u8282\u70b9\uff0c\u5219\u4ee3\u8868\u5f53\u524d\u7684child\u94fe\u8868\u5df2\u7ecf\u904d\u5386\u5b8c\n  if (next === null) {\n    // If this doesn't spawn new work, complete the current work.\n    //\u6b64\u51fd\u6570\u5185\u90e8\u4f1a\u5e2e\u6211\u4eec\u627e\u5230\u4e0b\u4e00\u4e2a\u53ef\u6267\u884c\u7684\u8282\u70b9\n    console.log(`%c=\u65e0\u5b50\u8282\u70b9\uff0c\u5219\u4ee3\u8868\u5f53\u524d\u7684child\u94fe\u8868\u5df2\u7ecf\u904d\u5386\u5b8c,\u5f00\u542f\u5b50\u7ec4\u4ef6\u94fecompleteUnitOfWork`, 'color:black', { type: unitOfWork.type });\n    completeUnitOfWork(unitOfWork);\n  } else {\n    workInProgress = next;\n  }\n\n  ReactCurrentOwner$2.current = null;\n}\n\nfunction getFiberName(unitOfWork) {\n  if (unitOfWork === null) return null\n\n  if (typeof unitOfWork.type === 'function') {\n    var re = /function\\s*(\\w*)/i;\n    var matches = re.exec(unitOfWork.type);\n    // console.log('%c=getFiberName:', 'color:green', matches[1])\n    return 'function ' + matches[1]\n  } else {\n    // console.log('%c=getFiberName:', 'color:green', unitOfWork.type)\n    return unitOfWork.type\n  }\n}\n\nfunction completeUnitOfWork(unitOfWork) {\n  // Attempt to complete the current unit of work, then move to the next\n  // sibling. If there are no more siblings, return to the parent fiber.\n  var completedWork = unitOfWork;\n\n  do {\n    // The current, flushed, state of this fiber is the alternate. Ideally\n    // nothing should rely on this, but relying on it here means that we don't\n    // need an additional field on the work in progress.\n    var current = completedWork.alternate;\n    var returnFiber = completedWork.return; // Check if the work completed or if something threw.\n\n    if ((completedWork.flags & Incomplete) === NoFlags) {\n      setCurrentFiber(completedWork);\n      var next = void 0;\n\n      if ((completedWork.mode & ProfileMode) === NoMode) {\n        // console.log(`%c=\u5f00\u59cbcompleteWork-1-${completedWork.type}`, 'color:black')\n        console.log(`%c=\u5f00\u59cbcompleteWork-1-`, 'color:black', { getFiberName: getFiberName(completedWork) })\n        next = completeWork(current, completedWork, subtreeRenderLanes);\n      } else {\n        console.log(`%c=\u5f00\u59cbcompleteWork-2`, 'color:black')\n        startProfilerTimer(completedWork);\n        next = completeWork(current, completedWork, subtreeRenderLanes); // Update render duration assuming we didn't error.\n\n        stopProfilerTimerIfRunningAndRecordDelta(completedWork, false);\n      }\n\n      resetCurrentFiber();\n\n      if (next !== null) {\n        // Completing this fiber spawned new work. Work on that next.\n        workInProgress = next;\n        return;\n      }\n    } else {\n      // This fiber did not complete because something threw. Pop values off\n      // the stack without entering the complete phase. If this is a boundary,\n      // capture values if possible.\n      var _next = unwindWork(current, completedWork); // Because this fiber did not complete, don't reset its lanes.\n\n      if (_next !== null) {\n        // If completing this work spawned new work, do that next. We'll come\n        // back here again.\n        // Since we're restarting, remove anything that is not a host effect\n        // from the effect tag.\n        _next.flags &= HostEffectMask;\n        workInProgress = _next;\n        return;\n      }\n\n      if ((completedWork.mode & ProfileMode) !== NoMode) {\n        // Record the render duration for the fiber that errored.\n        stopProfilerTimerIfRunningAndRecordDelta(completedWork, false); // Include the time spent working on failed children before continuing.\n\n        var actualDuration = completedWork.actualDuration;\n        var child = completedWork.child;\n\n        while (child !== null) {\n          actualDuration += child.actualDuration;\n          child = child.sibling;\n        }\n\n        completedWork.actualDuration = actualDuration;\n      }\n\n      if (returnFiber !== null) {\n        // Mark the parent fiber as incomplete and clear its subtree flags.\n        returnFiber.flags |= Incomplete;\n        returnFiber.subtreeFlags = NoFlags;\n        returnFiber.deletions = null;\n      } else {\n        // We've unwound all the way to the root.\n        workInProgressRootExitStatus = RootDidNotComplete;\n        workInProgress = null;\n        return;\n      }\n    }\n\n    //\u67e5\u770b\u5f53\u524d\u8282\u70b9\u662f\u5426\u5b58\u5728\u5144\u5f1f\u8282\u70b9\n    var siblingFiber = completedWork.sibling;\n\n    if (siblingFiber !== null) {\n      // If there is more work to do in this returnFiber, do that next.\n      // \u82e5\u5b58\u5728\uff0c\u4fbf\u628asiblingFiber\u8282\u70b9\u4f5c\u4e3a\u4e0b\u4e00\u4e2a\u5de5\u4f5c\u5355\u5143\uff0c\n      // \u7ee7\u7eed\u6267\u884cperformUnitOfWork\uff0c\u6267\u884c\u5f53\u524d\u8282\u70b9\u5e76\u5c1d\u8bd5\u904d\u5386\u5f53\u524d\u8282\u70b9\u6240\u5728\u7684child\u94fe\u8868\n      console.log(`%c=completeUnitOfWork--getFiberName:${getFiberName(completedWork)}\u5b58\u5728\u5144\u5f1f\u8282\u70b9,\u628asiblingFiber:${getFiberName(siblingFiber)}\u8282\u70b9\u4f5c\u4e3a\u4e0b\u4e00\u4e2a\u5de5\u4f5c\u5355\u5143`, 'color:grey')\n      console.log(`%c=siblingFiber:`, 'color:grey', siblingFiber)\n      workInProgress = siblingFiber;\n      return;\n    } // Otherwise, return to the parent\n\n    console.log(`%c=completeUnitOfWork-getFiberName:${getFiberName(completedWork)}\u4e0d\u5b58\u5728\u5144\u5f1f\u8282\u70b9,\u5219\u56de\u6eaf\u5230\u7236\u8282\u70b9:returnFiber:${getFiberName(returnFiber)},\u5c1d\u8bd5\u67e5\u627e\u7236\u8282\u70b9\u7684\u5144\u5f1f\u8282\u70b9`, 'color:grey')\n    console.log(`%c=returnFiber:`, 'color:grey', { returnFiber })\n    // \u5982\u679c\u4e0d\u5b58\u5728\u5144\u5f1f\u8282\u70b9\uff0c\u5219\u56de\u6eaf\u5230\u7236\u8282\u70b9\uff0c\u5c1d\u8bd5\u67e5\u627e\u7236\u8282\u70b9\u7684\u5144\u5f1f\u8282\u70b9\n    completedWork = returnFiber; // Update the next thing we're working on in case something throws.\n    workInProgress = completedWork;\n  } while (completedWork !== null); // We've reached the root.\n\n\n  if (workInProgressRootExitStatus === RootInProgress) {\n    workInProgressRootExitStatus = RootCompleted;\n  }\n}\n")),(0,o.kt)("h2",{id:"beginwork\u7b80\u7565"},"beginWork()\u7b80\u7565"),(0,o.kt)("p",null,"\u8be5\u65b9\u6cd5\u4f1a\u6839\u636e\u4f20\u5165\u7684 Fiber \u8282\u70b9\u521b\u5efa\u5b50 Fiber \u8282\u70b9\uff0c\u5e76\u5c06\u8fd9\u4e24\u4e2a Fiber \u8282\u70b9\u8fde\u63a5\u8d77\u6765\u3002"),(0,o.kt)("p",null,'\u5f53\u904d\u5386\u5230\u5b50\u8282\u70b9\uff08\u5373\u6ca1\u6709\u5b50\u7ec4\u4ef6\u7684\u7ec4\u4ef6\uff09\u65f6\u5c31\u4f1a\u8fdb\u5165"\u5f52"\u9636\u6bb5\u3002'),(0,o.kt)("p",null,"\u5176\u4e2d\u4f20\u53c2\uff1a"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"current\uff1a\u5f53\u524d\u7ec4\u4ef6\u5bf9\u5e94\u7684 Fiber \u8282\u70b9\u5728\u4e0a\u4e00\u6b21\u66f4\u65b0\u65f6\u7684 Fiber \u8282\u70b9\uff0c\u5373 workInProgress.alternate\uff1b"),(0,o.kt)("li",{parentName:"ul"},"workInProgress\uff1a\u5f53\u524d\u7ec4\u4ef6\u5bf9\u5e94\u7684 Fiber \u8282\u70b9\uff1b"),(0,o.kt)("li",{parentName:"ul"},"renderLanes\uff1a\u4f18\u5148\u7ea7\u76f8\u5173\uff0c\u5728\u8bb2\u89e3Scheduler\u65f6\u518d\u8bb2\u89e3\u3002")),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"\u901a\u8fc7 current === null \u6765\u533a\u5206\u7ec4\u4ef6\u662f\u5904\u4e8e mount \u8fd8\u662f update")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"\u7ec4\u4ef6 mount \u65f6\uff0c\u7531\u4e8e\u662f\u9996\u6b21\u6e32\u67d3\uff0c\u662f\u4e0d\u5b58\u5728\u5f53\u524d\u7ec4\u4ef6\u5bf9\u5e94\u7684 Fiber\u8282\u70b9\u5728\u4e0a\u4e00\u6b21\u66f4\u65b0\u65f6\u7684 Fiber \u8282\u70b9\uff0c\u5373 mount \u65f6current === null\u3002"),(0,o.kt)("li",{parentName:"ul"},"\u7ec4\u4ef6 update \u65f6\uff0c\u7531\u4e8e\u4e4b\u524d\u5df2\u7ecf mount \u8fc7\uff0c\u6240\u4ee5 current !== null\u3002")),(0,o.kt)("p",null,"\u57fa\u4e8e\u6b64\u539f\u56e0\uff0cbeginWork \u7684\u5de5\u4f5c\u53ef\u4ee5\u5206\u4e3a\u4e24\u90e8\u5206\uff1a"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"mount \u65f6\uff1a\u9664 fiberRootNode \u4ee5\u5916\uff0ccurrent === null\u3002\u4f1a\u6839\u636efiber.tag\u4e0d\u540c\uff0c\u521b\u5efa\u4e0d\u540c\u7c7b\u578b\u7684\u5b50 Fiber \u8282\u70b9\u3002"),(0,o.kt)("li",{parentName:"ul"},"update \u65f6\uff1a\u5982\u679c current \u5b58\u5728\uff0c\u5728\u6ee1\u8db3\u4e00\u5b9a\u6761\u4ef6\u65f6\u53ef\u4ee5\u590d\u7528 current \u8282\u70b9\uff0c\u8fd9\u6837\u5c31\u80fd\u514b\u9686 current.child \u4f5c\u4e3a workInProgress.child\uff0c\u800c\u4e0d\u9700\u8981\u65b0\u5efa workInProgress.child\u3002")),(0,o.kt)("p",null,"\u6211\u4eec\u53ef\u4ee5\u770b\u5230\uff0c\u6839\u636efiber.tag\u4e0d\u540c\uff0c\u8fdb\u5165\u4e0d\u540c\u7c7b\u578b Fiber \u7684\u521b\u5efa\u903b\u8f91;"),(0,o.kt)("p",null,"\u7b80\u7565\u51fd\u6570"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"function beginWork(current, workInProgress, renderLanes) {\n  // mount current !== null \u4e3anull,\u4e0d\u8d70\u4ee5\u4e0b\u903b\u8f91\n  if (current !== null) {\n    console.log('%c=beginWork()===start1-\u66f4\u65b0', 'color:magenta', { getFiberName: getFiberName(workInProgress), current, renderLanes, workInProgress })\n    // \u901a\u8fc7\u4e00\u7cfb\u5217\u5224\u65ad\u903b\u8f91\u5224\u65ad\u5f53\u524d\u8282\u70b9\u662f\u5426\u53ef\u590d\u7528\uff0c\u7528didReceiveUpdate\u6765\u6807\u8bb0\uff0c\n  }{\n  console.log('%c=beginWork()===start1-\u521d\u59cb\u5316', 'color:magenta', { getFiberName: getFiberName(workInProgress), current, renderLanes, workInProgress })\n  workInProgress.lanes = NoLanes;\n\n  switch (workInProgress.tag) {\n    case IndeterminateComponent: \n      // ...\u7701\u7565\n    case LazyComponent: \n      // ...\u7701\u7565\n    case FunctionComponent: \n      // ...\u7701\u7565\n    case ClassComponent: \n      // ...\u7701\u7565\n    case HostRoot:\n      // ...\u7701\u7565\n    case HostComponent:\n      console.log(`%c=beginWork()=end 7 updateHostComponent$1,\u5373\u539f\u751f DOM \u7ec4\u4ef6\u5bf9\u5e94\u7684 Fiber\u8282\u70b9:`, 'color:magenta', { type: workInProgress.type })\n      return updateHostComponent$1(current, workInProgress, renderLanes);\n    case HostText:\n  }\n  }\n}\n")),(0,o.kt)("h3",{id:"1-2update-\u65f6"},"1-2.update \u65f6"),(0,o.kt)("p",null,"\u6211\u4eec\u53ef\u4ee5\u770b\u5230,didReceiveUpdate === false\uff08\u5373\u53ef\u4ee5\u76f4\u63a5\u590d\u7528\u524d\u4e00\u6b21\u66f4\u65b0\u7684\u5b50 Fiber\uff0c\u4e0d\u9700\u8981\u65b0\u5efa\u5b50 Fiber\uff09\uff0c\u9700\u6ee1\u8db3\u5982\u4e0b\u60c5\u51b5\uff1a"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"oldProps === newProps && workInProgress.type === current.type\uff0c\u5373 props \u4e0e fiber.type \u4e0d\u53d8\uff1b")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"!includesSomeLane(renderLanes, updateLanes)\uff0c\u5373\u5f53\u524d Fiber \u8282\u70b9\u4f18\u5148\u7ea7\u4e0d\u591f\uff0c\u4f1a\u5728\u8bb2\u89e3 Scheduler \u65f6\u4ecb\u7ecd\u3002")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"attemptEarlyBailoutIfNoScheduledUpdate--\x3ebailoutOnAlreadyFinishedWork=> cloneChildFibers \u987e\u540d\u601d\u4e49\uff0c\u4f1a\u76f4\u63a5\u514b\u9686\u4e00\u4e2afiber\u8282\u70b9\u5e76\u8fd4\u56de\u3002"))),(0,o.kt)("h3",{id:"beginwork\u5b8c\u6574"},"beginWork()\u5b8c\u6574:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"function beginWork(current, workInProgress, renderLanes) {\n  {\n    if (workInProgress._debugNeedsRemount && current !== null) {\n      console.log('%c=beginWork()===end->\u7ed3\u675f', 'color:magenta')\n      // This will restart the begin phase with a new fiber.\n      console.log('%c=beginWork()\u8c03\u7528 createFiberFromTypeAndProps(workInProgress.type, workInProgress,...)', 'color:yellow');\n      return remountFiber(current, workInProgress, createFiberFromTypeAndProps(workInProgress.type, workInProgress.key, workInProgress.pendingProps, workInProgress._debugOwner || null, workInProgress.mode, workInProgress.lanes));\n    }\n  }\n\n  // update\u65f6\uff1a\u5982\u679ccurrent\u5b58\u5728\u53ef\u80fd\u5b58\u5728\u4f18\u5316\u8def\u5f84\uff0c\u53ef\u4ee5\u590d\u7528current\uff08\u5373\u4e0a\u4e00\u6b21\u66f4\u65b0\u7684Fiber\u8282\u70b9\uff09\n  if (current !== null) {\n    console.log('%c=beginWork()===start1-\u66f4\u65b0', 'color:magenta', { getFiberName: getFiberName(workInProgress), current, renderLanes, workInProgress })\n\n    // \u901a\u8fc7\u4e00\u7cfb\u5217\u5224\u65ad\u903b\u8f91\u5224\u65ad\u5f53\u524d\u8282\u70b9\u662f\u5426\u53ef\u590d\u7528\uff0c\u7528didReceiveUpdate\u6765\u6807\u8bb0\uff0c\n    // \u82e5\u53ef\u590d\u7528\u5219\u8d70attemptEarlyBailoutIfNoScheduledUpdate\u3002\n    var oldProps = current.memoizedProps;\n    var newProps = workInProgress.pendingProps;\n\n    if (oldProps !== newProps || hasContextChanged() || ( // Force a re-render if the implementation changed due to hot reload:\n      workInProgress.type !== current.type)) {\n      // If props or context changed, mark the fiber as having performed work.\n      // This may be unset if the props are determined to be equal later (memo).\n      didReceiveUpdate = true;\n    } else {\n      // Neither props nor legacy context changes. Check if there's a pending\n      // update or context change.\n      var hasScheduledUpdateOrContext = checkScheduledUpdateOrContext(current, renderLanes);\n\n      if (!hasScheduledUpdateOrContext && // If this is the second pass of an error or suspense boundary, there\n        // may not be work scheduled on `current`, so we check for this flag.\n        (workInProgress.flags & DidCapture) === NoFlags) {\n        // No pending updates or context. Bail out now.\n        didReceiveUpdate = false;\n        console.log('%c=beginWork()end 1', 'color:magenta')\n        // bailoutOnAlreadyFinishedWork=> cloneChildFibers \u987e\u540d\u601d\u4e49\uff0c\u4f1a\u76f4\u63a5\u514b\u9686\u4e00\u4e2afiber\u8282\u70b9\u5e76\u8fd4\u56de\u3002\n        return attemptEarlyBailoutIfNoScheduledUpdate(current, workInProgress, renderLanes);\n      }\n\n      if ((current.flags & ForceUpdateForLegacySuspense) !== NoFlags) {\n        // This is a special case that only exists for legacy mode.\n        // See https://github.com/facebook/react/pull/19216.\n        didReceiveUpdate = true;\n      } else {\n        // An update was scheduled on this fiber, but there are no new props\n        // nor legacy context. Set this to false. If an update queue or context\n        // consumer produces a changed value, it will set this to true. Otherwise,\n        // the component will assume the children have not changed and bail out.\n        didReceiveUpdate = false;\n      }\n    }\n  } else {\n    didReceiveUpdate = false;\n\n    if (getIsHydrating() && isForkedChild(workInProgress)) {\n      // Check if this child belongs to a list of muliple children in\n      // its parent.\n      //\n      // In a true multi-threaded implementation, we would render children on\n      // parallel threads. This would represent the beginning of a new render\n      // thread for this subtree.\n      //\n      // We only use this for id generation during hydration, which is why the\n      // logic is located in this special branch.\n      var slotIndex = workInProgress.index;\n      var numberOfForks = getForksAtLevel();\n      pushTreeId(workInProgress, numberOfForks, slotIndex);\n    }\n  } // Before entering the begin phase, clear pending update priority.\n  // TODO: This assumes that we're about to evaluate the component and process\n  // the update queue. However, there's an exception: SimpleMemoComponent\n  // sometimes bails out later in the begin phase. This indicates that we should\n  // move this assignment out of the common path and into each branch.\n\n\n  workInProgress.lanes = NoLanes;\n  console.log('%c=beginWork()===start1-\u521d\u59cb\u5316', 'color:magenta', { getFiberName: getFiberName(workInProgress), current, renderLanes, workInProgress })\n  switch (workInProgress.tag) {\n    case IndeterminateComponent:\n      {\n        console.log('%c=beginWork()==end 2 mountIndeterminateComponent', 'color:magenta')\n        return mountIndeterminateComponent(current, workInProgress, workInProgress.type, renderLanes);\n      }\n\n    case LazyComponent:\n      {\n        var elementType = workInProgress.elementType;\n        console.log('%c=beginWork()=end 3 mountLazyComponent', 'color:magenta')\n        return mountLazyComponent(current, workInProgress, elementType, renderLanes);\n      }\n\n    case FunctionComponent:\n      {\n        var Component = workInProgress.type;\n        var unresolvedProps = workInProgress.pendingProps;\n        var resolvedProps = workInProgress.elementType === Component ? unresolvedProps : resolveDefaultProps(Component, unresolvedProps);\n        console.log('%c=beginWork()=end 4 updateFunctionComponent', 'color:magenta')\n        return updateFunctionComponent(current, workInProgress, Component, resolvedProps, renderLanes);\n      }\n\n    case ClassComponent:\n      {\n        var _Component = workInProgress.type;\n        var _unresolvedProps = workInProgress.pendingProps;\n\n        var _resolvedProps = workInProgress.elementType === _Component ? _unresolvedProps : resolveDefaultProps(_Component, _unresolvedProps);\n        console.log('%c=beginWork()=end 5 updateClassComponent', 'color:magenta')\n        return updateClassComponent(current, workInProgress, _Component, _resolvedProps, renderLanes);\n      }\n\n    case HostRoot:\n      console.log('%c=beginWork()=end 6 updateHostRoot', 'color:magenta')\n      return updateHostRoot(current, workInProgress, renderLanes);\n\n    case HostComponent:\n      console.log(`%c=beginWork()=end 7 updateHostComponent$1,\u5373\u539f\u751f DOM \u7ec4\u4ef6\u5bf9\u5e94\u7684 Fiber\u8282\u70b9:`, 'color:magenta', { type: workInProgress.type })\n      return updateHostComponent$1(current, workInProgress, renderLanes);\n\n    case HostText:\n      console.log('%c=beginWork()=end 8 updateHostText$1', 'color:magenta')\n      return updateHostText$1(current, workInProgress);\n\n    case SuspenseComponent:\n      console.log('%c=beginWork()=end 9 updateSuspenseComponent', 'color:magenta')\n      return updateSuspenseComponent(current, workInProgress, renderLanes);\n\n    case HostPortal:\n      console.log('%c=beginWork()=end 10 updatePortalComponent', 'color:magenta')\n      return updatePortalComponent(current, workInProgress, renderLanes);\n\n    case ForwardRef:\n      {\n        var type = workInProgress.type;\n        var _unresolvedProps2 = workInProgress.pendingProps;\n\n        var _resolvedProps2 = workInProgress.elementType === type ? _unresolvedProps2 : resolveDefaultProps(type, _unresolvedProps2);\n\n        console.log('%c=beginWork()=end 11 updateForwardRef', 'color:magenta')\n        return updateForwardRef(current, workInProgress, type, _resolvedProps2, renderLanes);\n      }\n\n    case Fragment:\n      console.log('%c=beginWork()=end 12 updateFragment', 'color:magenta')\n      return updateFragment(current, workInProgress, renderLanes);\n\n    case Mode:\n      console.log('%c=beginWork()=end 13 updateMode', 'color:magenta')\n      return updateMode(current, workInProgress, renderLanes);\n\n    case Profiler:\n      console.log('%c=beginWork()=end 14 updateProfiler', 'color:magenta')\n      return updateProfiler(current, workInProgress, renderLanes);\n\n    case ContextProvider:\n      console.log('%c=beginWork()=end 15 updateContextProvider', 'color:magenta')\n      return updateContextProvider(current, workInProgress, renderLanes);\n\n    case ContextConsumer:\n      console.log('%c=beginWork()=end 16 updateContextConsumer', 'color:magenta')\n      return updateContextConsumer(current, workInProgress, renderLanes);\n\n    case MemoComponent:\n      {\n        var _type2 = workInProgress.type;\n        var _unresolvedProps3 = workInProgress.pendingProps; // Resolve outer props first, then resolve inner props.\n\n        var _resolvedProps3 = resolveDefaultProps(_type2, _unresolvedProps3);\n\n        {\n          if (workInProgress.type !== workInProgress.elementType) {\n            var outerPropTypes = _type2.propTypes;\n\n            if (outerPropTypes) {\n              checkPropTypes(outerPropTypes, _resolvedProps3, // Resolved for outer only\n                'prop', getComponentNameFromType(_type2));\n            }\n          }\n        }\n\n        _resolvedProps3 = resolveDefaultProps(_type2.type, _resolvedProps3);\n        console.log('%c=beginWork()=end 17 updateMemoComponent', 'color:magenta')\n        return updateMemoComponent(current, workInProgress, _type2, _resolvedProps3, renderLanes);\n      }\n\n    case SimpleMemoComponent:\n      {\n        console.log('%c=beginWork()=end 18 updateSimpleMemoComponent', 'color:magenta')\n        return updateSimpleMemoComponent(current, workInProgress, workInProgress.type, workInProgress.pendingProps, renderLanes);\n      }\n\n    case IncompleteClassComponent:\n      {\n        var _Component2 = workInProgress.type;\n        var _unresolvedProps4 = workInProgress.pendingProps;\n\n        var _resolvedProps4 = workInProgress.elementType === _Component2 ? _unresolvedProps4 : resolveDefaultProps(_Component2, _unresolvedProps4);\n        console.log('%c=beginWork()=end 19 mountIncompleteClassComponent', 'color:magenta')\n        return mountIncompleteClassComponent(current, workInProgress, _Component2, _resolvedProps4, renderLanes);\n      }\n\n    case SuspenseListComponent:\n      {\n        console.log('%c=beginWork()=end 20 updateSuspenseListComponent', 'color:magenta')\n        return updateSuspenseListComponent(current, workInProgress, renderLanes);\n      }\n\n    case ScopeComponent:\n      {\n\n        break;\n      }\n\n    case OffscreenComponent:\n      {\n        console.log('%c=beginWork()=end 21 updateOffscreenComponent', 'color:magenta')\n        return updateOffscreenComponent(current, workInProgress, renderLanes);\n      }\n  }\n  throw new Error(\"Unknown unit of work tag (\" + workInProgress.tag + \"). This error is likely caused by a bug in \" + 'React. Please file an issue.');\n}\n")),(0,o.kt)("h2",{id:"updatehostcomponent\u4e3a\u4f8b\u8fdb\u884c\u5206\u6790"},"updateHostComponent\u4e3a\u4f8b\u8fdb\u884c\u5206\u6790"),(0,o.kt)("p",null,"HostComponent\u4ee3\u8868\u539f\u751f\u7684 DOM \u5143\u7d20\u8282\u70b9(\u5982div,span,p\u7b49\u8282\u70b9)\uff0c\u8fd9\u4e9b\u8282\u70b9\u7684\u66f4\u65b0\u4f1a\u8fdb\u5165updateHostComponent\u3002"),(0,o.kt)("p",null,"\u5728\u5404\u4e2aupdateXXX\u51fd\u6570\u4e2d\uff0c\u4f1a\u5224\u65ad\u5f53\u524d\u8282\u70b9\u662f\u5426\u9700\u8981\u66f4\u65b0\uff0c\u5982\u679c\u4e0d\u9700\u8981\u66f4\u65b0\u5219\u4f1a\u8fdb\u5165bailoutOnAlreadyFinishedWork\uff0c"),(0,o.kt)("p",null,"\u5e76\u4f7f\u7528bailoutOnAlreadyFinishedWork\u7684\u7ed3\u679c\u4f5c\u4e3abeginWork\u7684\u8fd4\u56de\u503c\uff0c\u63d0\u524dbeginWork\uff0c\u800c\u4e0d\u9700\u8981\u8fdb\u5165diff\u9636\u6bb5\u3002"),(0,o.kt)("h3",{id:"2-5-1-\u5e38\u89c1\u7684\u4e0d\u9700\u8981\u66f4\u65b0\u7684\u60c5\u51b5"},"2-5-1 \u5e38\u89c1\u7684\u4e0d\u9700\u8981\u66f4\u65b0\u7684\u60c5\u51b5"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"updateClassComponent\u65f6\u82e5!shouldUpdate && !didCaptureError"),(0,o.kt)("li",{parentName:"ol"},"updateFunctionComponent\u65f6\u82e5current !== null && !didReceiveUpdate"),(0,o.kt)("li",{parentName:"ol"},"updateMemoComponent\u65f6\u82e5compare(prevProps, nextProps) && current.ref === workInProgress.ref"),(0,o.kt)("li",{parentName:"ol"},"updateHostRoot\u65f6\u82e5nextChildren === prevChildren")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"function updateHostComponent(\n  current: Fiber | null,\n  workInProgress: Fiber,\n  renderLanes: Lanes,\n) {\n  //...\n\n  //1. \u72b6\u6001\u8ba1\u7b97, \u7531\u4e8eHostComponent\u662f\u65e0\u72b6\u6001\u7ec4\u4ef6, \u6240\u4ee5\u53ea\u9700\u8981\u6536\u96c6 nextProps\u5373\u53ef, \u5b83\u6ca1\u6709 memoizedState\n  const type = workInProgress.type;\n  const nextProps = workInProgress.pendingProps;\n  const prevProps = current !== null ? current.memoizedProps : null;\n  // 2. \u83b7\u53d6\u4e0b\u7ea7`ReactElement`\u5bf9\u8c61\n  let nextChildren = nextProps.children;\n  const isDirectTextChild = shouldSetTextContent(type, nextProps);\n\n  if (isDirectTextChild) {\n    // \u5982\u679c\u5b50\u8282\u70b9\u53ea\u6709\u4e00\u4e2a\u6587\u672c\u8282\u70b9, \u4e0d\u7528\u518d\u521b\u5efa\u4e00\u4e2aHostText\u7c7b\u578b\u7684fiber\n    nextChildren = null;\n  } else if (prevProps !== null && shouldSetTextContent(type, prevProps)) {\n  // \u7279\u6b8a\u64cd\u4f5c\u9700\u8981\u8bbe\u7f6efiber.effectTag \n    workInProgress.effectTag |= ContentReset;\n  }\n  // \u7279\u6b8a\u64cd\u4f5c\u9700\u8981\u8bbe\u7f6efiber.effectTag \n  markRef(current, workInProgress);\n  // 3. \u6839\u636e`ReactElement`\u5bf9\u8c61, \u8c03\u7528`reconcilerChildren`\u751f\u6210`fiber`\u5b50\u8282\u70b9\uff0c\u5e76\u5c06\u7b2c\u4e00\u4e2a\u5b50fiber\u8282\u70b9\u8d4b\u503c\u7ed9workInProgress.child\u3002\n  reconcileChildren(current, workInProgress, nextChildren, renderLanes);\n  return workInProgress.child;\n}\n")),(0,o.kt)("h3",{id:"bailoutonalreadyfinishedwork"},"bailoutOnAlreadyFinishedWork"),(0,o.kt)("p",null,"bailoutOnAlreadyFinishedWork\u5185\u90e8\u5148\u4f1a\u5224\u65ad!includesSomeLane(renderLanes, workInProgress.childLanes)\u662f\u5426\u6210\u7acb\u3002"),(0,o.kt)("p",null,"\u82e5!includesSomeLane(renderLanes, workInProgress.childLanes)\u6210\u7acb\u5219\u6240\u6709\u7684\u5b50\u8282\u70b9\u90fd\u4e0d\u9700\u8981\u66f4\u65b0,\n\u6216\u66f4\u65b0\u7684\u4f18\u5148\u7ea7\u90fd\u4f4e\u4e8e\u5f53\u524d\u66f4\u65b0\u7684\u6e32\u67d3\u4f18\u5148\u7ea7\u3002"),(0,o.kt)("p",null,"\u6b64\u65f6\u4ee5\u6b64\u8282\u70b9\u4e3a\u5934\u8282\u70b9\u7684\u6574\u9897\u5b50\u6811\u90fd\u53ef\u4ee5\u76f4\u63a5\u590d\u7528\u3002\u6b64\u65f6\u4f1a\u8df3\u8fc7\u6574\u9897\u5b50\u6811\uff0c\u5e76\u4f7f\u7528null\u4f5c\u4e3abeginWork\u7684\u8fd4\u56de\u503c\uff08\u8fdb\u5165\u56de\u6eaf\u7684\u903b\u8f91\uff09\uff1b"),(0,o.kt)("p",null,"\u82e5\u4e0d\u6210\u7acb\uff0c\u5219\u8868\u793a\u867d\u7136\u5f53\u524d\u8282\u70b9\u4e0d\u9700\u8981\u66f4\u65b0\uff0c\u4f46\u5f53\u524d\u8282\u70b9\u5b58\u5728\u67d0\u4e9bfiber\u5b50\u8282\u70b9\u9700\u8981\u5728\u6b64\u6b21\u6e32\u67d3\u4e2d\u8fdb\u884c\u66f4\u65b0\uff0c\u5219\u590d\u7528current fiber\n\u751f\u6210workInProgress\u7684\u6b21\u7ea7\u8282\u70b9\uff1b"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"function bailoutOnAlreadyFinishedWork(\n  current: Fiber | null,\n  workInProgress: Fiber,\n  renderLanes: Lanes,\n): Fiber | null {\n  //...\n\n  if (!includesSomeLane(renderLanes, workInProgress.childLanes)) {\n    // renderLanes \u4e0d\u5305\u542b workInProgress.childLanes\n    // \u6240\u6709\u7684\u5b50\u8282\u70b9\u90fd\u4e0d\u9700\u8981\u5728\u672c\u6b21\u66f4\u65b0\u8fdb\u884c\u66f4\u65b0\u64cd\u4f5c\uff0c\u76f4\u63a5\u8df3\u8fc7\uff0c\u8fdb\u884c\u56de\u6eaf\n    return null;\n  } \n\n  //...\n\n  // \u867d\u7136\u6b64\u8282\u70b9\u4e0d\u9700\u8981\u66f4\u65b0\uff0c\u6b64\u8282\u70b9\u7684\u67d0\u4e9b\u5b50\u8282\u70b9\u9700\u8981\u66f4\u65b0\uff0c\u9700\u8981\u7ee7\u7eed\u8fdb\u884c\u534f\u8c03\n  cloneChildFibers(current, workInProgress);\n  return workInProgress.child;\n}\n")),(0,o.kt)("h3",{id:"2-7-effecttag-\u7528\u4e8e\u4fdd\u5b58\u8981\u6267\u884cdom\u64cd\u4f5c\u7684\u5177\u4f53\u7c7b\u578b"},"2-7 effectTag \u7528\u4e8e\u4fdd\u5b58\u8981\u6267\u884cDOM\u64cd\u4f5c\u7684\u5177\u4f53\u7c7b\u578b"),(0,o.kt)("p",null,"\u4e0a\u9762\u6211\u4eec\u4ecb\u7ecd\u5230\u5728updateXXX\u7684\u4e3b\u8981\u903b\u8f91\u4e2d\uff0c\u5728\u83b7\u53d6\u4e0b\u7ea7ReactElement\u4ee5\u53ca\u6839\u636eReactElement\u5bf9\u8c61, \u8c03\u7528reconcileChildren\u751f\u6210fiber\u5b50\u8282\u70b9\u65f6\uff0c\n\u90fd\u4f1a\u6839\u636e\u5b9e\u9645\u60c5\u51b5\uff0c\u8fdb\u884ceffectTag\u7684\u8bbe\u7f6e\u3002\u90a3\u4e48effectTag\u7684\u4f5c\u7528\u5230\u5e95\u662f\u4ec0\u4e48\u5462\uff1f"),(0,o.kt)("p",null,"reconciler \u7684\u76ee\u7684\u4e4b\u4e00\u5c31\u662f\u8d1f\u8d23\u627e\u51fa\u53d8\u5316\u7684\u7ec4\u4ef6\uff0c\u968f\u540e\u901a\u77e5Renderer\u9700\u8981\u6267\u884c\u7684DOM\u64cd\u4f5c\uff0ceffectTag\u6b63\u662f\u7528\u4e8e\u4fdd\u5b58\u8981\u6267\u884cDOM\u64cd\u4f5c\u7684\u5177\u4f53\u7c7b\u578b\u3002"),(0,o.kt)("p",null,"effectTag\u901a\u8fc7\u4e8c\u8fdb\u5236\u8868\u793a\uff1a"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"//...\n// \u610f\u5473\u7740\u8be5Fiber\u8282\u70b9\u5bf9\u5e94\u7684DOM\u8282\u70b9\u9700\u8981\u63d2\u5165\u5230\u9875\u9762\u4e2d\u3002\nexport const Placement = /*                    */ 0b000000000000010;\n//\u610f\u5473\u7740\u8be5Fiber\u8282\u70b9\u9700\u8981\u66f4\u65b0\u3002\nexport const Update = /*                       */ 0b000000000000100;\nexport const PlacementAndUpdate = /*           */ 0b000000000000110;\n//\u610f\u5473\u7740\u8be5Fiber\u8282\u70b9\u5bf9\u5e94\u7684DOM\u8282\u70b9\u9700\u8981\u4ece\u9875\u9762\u4e2d\u5220\u9664\u3002\nexport const Deletion = /*                     */ 0b000000000001000;\n//...\n")),(0,o.kt)("p",null,"\u901a\u8fc7\u8fd9\u79cd\u65b9\u5f0f\u4fdd\u5b58effectTag\u53ef\u4ee5\u65b9\u4fbf\u7684\u4f7f\u7528\u4f4d\u64cd\u4f5c\u4e3afiber\u8d4b\u503c\u591a\u4e2aeffect\u4ee5\u53ca\u5224\u65ad\u5f53\u524dfiber\u662f\u5426\u5b58\u5728\u67d0\u79cdeffect\u3002"),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"React \u7684\u4f18\u5148\u7ea7 lane \u6a21\u578b\u4e2d\u540c\u6837\u4f7f\u7528\u4e86\u4e8c\u8fdb\u5236\u7684\u65b9\u5f0f\u6765\u8868\u793a\u4f18\u5148\u7ea7\u3002")),(0,o.kt)("h2",{id:"\u7b2c\u4e09\u6b65-reconciliation\u8fd9\u4e2a\u4ee3\u7801\u5f88\u957f-1k"},"\u7b2c\u4e09\u6b65. Reconciliation,\u8fd9\u4e2a\u4ee3\u7801\u5f88\u957f 1k"),(0,o.kt)("p",null,"\u4e86\u89e3\u4e86\u904d\u5386\u6d41\u7a0b\u4e0e\u4efb\u52a1\u8c03\u5ea6\u65b9\u6cd5\u4e4b\u540e\uff0c\u63a5\u4e0b\u6765\u5c31\u662f\u5c31\u662f\u6211\u4eec\u719f\u77e5\u7684Reconcilation\u9636\u6bb5\u4e86\uff08\u4e3a\u4e86\u65b9\u4fbf\u7406\u89e3\uff0c\u8fd9\u91cc\u4e0d\u533a\u5206Diff\u548cReconcilation, \u4e24\u8005\u662f\u540c\u4e00\u4e2a\u4e1c\u897f\uff09\u3002\u601d\u8def\u548c Fiber \u91cd\u6784\u4e4b\u524d\u5dee\u522b\u4e0d\u5927\uff0c\u53ea\u4e0d\u8fc7\u8fd9\u91cc\u4e0d\u4f1a\u518d\u9012\u5f52\u53bb\u6bd4\u5bf9\u3001\u800c\u4e14\u4e0d\u4f1a\u9a6c\u4e0a\u63d0\u4ea4\u53d8\u66f4\u3002"),(0,o.kt)("p",null,"\u5bf9\u4e8e\u6211\u4eec\u5e38\u89c1\u7684\u7ec4\u4ef6\u7c7b\u578b\uff0c\u5982\uff08FunctionComponent/ClassComponent/HostComponent\uff09\uff0c\u6700\u7ec8\u4f1a\u8fdb\u5165 reconcileChildren \u65b9\u6cd5\n\u4ece\u8be5\u51fd\u6570\u540d\u5c31\u80fd\u770b\u51fa\u8fd9\u662fReconciler\u6a21\u5757\u7684\u6838\u5fc3\u90e8\u5206\u3002\u90a3\u4e48\u4ed6\u7a76\u7adf\u505a\u4e86\u4ec0\u4e48\u5462\uff1f"),(0,o.kt)("p",null,"\u548c beginWork \u4e00\u6837\uff0c\u4ed6\u4e5f\u662f\u901a\u8fc7 current === null ? \u533a\u5206 mount \u4e0e update\u3002"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"\u5bf9\u4e8e mount \u7684\u7ec4\u4ef6\uff0c\u4ed6\u4f1a\u521b\u5efa\u65b0\u7684\u5b50 Fiber \u8282\u70b9\uff1b"),(0,o.kt)("li",{parentName:"ul"},"\u5bf9\u4e8e update \u7684\u7ec4\u4ef6\uff0c\u4ed6\u4f1a\u5c06\u5f53\u524d\u7ec4\u4ef6\u4e0e\u8be5\u7ec4\u4ef6\u5728\u4e0a\u6b21\u66f4\u65b0\u65f6\u5bf9\u5e94\u7684 Fiber \u8282\u70b9\u6bd4\u8f83\uff08\u4e5f\u5c31\u662f\u4fd7\u79f0\u7684Diff \u7b97\u6cd5\uff09\uff0c\u5c06\u6bd4\u8f83\u7684\u7ed3\u679c\u751f\u6210\u65b0 Fiber \u8282\u70b9\u3002")),(0,o.kt)("p",null,"updateXXX\u51fd\u6570\u4e2d\uff0c\u4f1a\u6839\u636e\u83b7\u53d6\u5230\u7684\u4e0b\u7ea7ReactElement\u5bf9\u8c61, \u8c03\u7528reconcileChildren\n\u751f\u6210\u5f53\u524dworkInProgress fiber\u8282\u70b9\u7684\u4e0b\u7ea7fiber\u5b50\u8282\u70b9\u3002"),(0,o.kt)("p",null,"\u53cc\u7f13\u5b58\u673a\u5236:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"\u5728\u534f\u8c03\u9636\u6bb5\uff0cReact\u5229\u7528diff\u7b97\u6cd5\uff0c\u5c06\u4ea7\u751fupdate\u7684ReactElement\u4e0ecurrent fiber tree\u4e2d\u5bf9\u5e94\u7684\u8282\u70b9\u8fdb\u884c\u6bd4\u8f83\uff0c\n\n\u5e76\u6700\u7ec8\u5728\u5185\u5b58\u4e2d\u751f\u6210workInProgress fiber tree\u3002\u968f\u540eRenderer\u4f1a\u4f9d\u636eworkInProgress fiber tree\u5c06update\u6e32\u67d3\u5230\u9875\u9762\u4e0a\u3002\n\n\u540c\u65f6\u6839\u8282\u70b9\u7684current\u5c5e\u6027\u4f1a\u6307\u5411workInProgress fiber tree\uff0c\u6b64\u65f6workInProgress fiber tree\u5c31\u53d8\u4e3acurrent fiber tree\u3002\n")),(0,o.kt)("h3",{id:"reconcilechildren\u7b80\u7565\u51fd\u6570"},"reconcileChildren\u7b80\u7565\u51fd\u6570"),(0,o.kt)("p",null,"\u4e0d\u8bba\u8d70\u54ea\u4e2a\u903b\u8f91\uff0c\u6700\u7ec8\u4ed6\u4f1a\u751f\u6210\u65b0\u7684\u5b50 Fiber \u8282\u70b9\u5e76\u8d4b\u503c\u7ed9workInProgress.child\uff0c\u4f5c\u4e3a\u672c\u6b21 beginWork \u8fd4\u56de\u503c\uff0c\u5e76\u4f5c\u4e3a\u4e0b\u6b21performUnitOfWork\u6267\u884c\u65f6workInProgress\u7684\u4f20\u53c2\u3002"),(0,o.kt)("p",null,"mountChildFibers\u4e0ereconcileChildFibers\u8fd9\u4e24\u4e2a\u65b9\u6cd5\u7684\u903b\u8f91\u57fa\u672c\u4e00\u81f4\u3002\u552f\u4e00\u7684\u533a\u522b\u662f\uff1areconcileChildFibers \u4f1a\u4e3a\u751f\u6210\u7684 Fiber \u8282\u70b9\u5e26\u4e0aeffectTag\u5c5e\u6027\uff0c\u800c mountChildFibers \u4e0d\u4f1a\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"export function reconcileChildren(\n  current: Fiber | null,\n  workInProgress: Fiber,\n  nextChildren: any,\n  renderLanes: Lanes\n) {\n  if (current === null) {\n    // \u5bf9\u4e8e mount \u7684\u7ec4\u4ef6\n    workInProgress.child = mountChildFibers(\n      workInProgress,\n      null,\n      nextChildren,\n      renderLanes,\n    );\n  } else {\n    // \u5bf9\u4e8e update \u7684\u7ec4\u4ef6\n    workInProgress.child = reconcileChildFibers(\n      workInProgress,\n      current.child,\n      nextChildren,\n      renderLanes,\n    );\n  }\n}\n")),(0,o.kt)("p",null,"\u5177\u4f53\u8fc7\u7a0b\u5982\u4e0b\uff08\u4ee5\u7ec4\u4ef6\u8282\u70b9\u4e3a\u4f8b\uff09\uff1a"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"\u5982\u679c\u5f53\u524d\u8282\u70b9\u4e0d\u9700\u8981\u66f4\u65b0\uff0c\u76f4\u63a5\u628a\u5b50\u8282\u70b9clone\u8fc7\u6765\uff0c\u8df3\u52305\uff1b\u8981\u66f4\u65b0\u7684\u8bdd\u6253\u4e2atag"),(0,o.kt)("li",{parentName:"ol"},"\u66f4\u65b0\u5f53\u524d\u8282\u70b9\u72b6\u6001\uff08props, state, context\u7b49\uff09"),(0,o.kt)("li",{parentName:"ol"},"\u8c03\u7528shouldComponentUpdate()\uff0cfalse\u7684\u8bdd\uff0c\u8df3\u52305"),(0,o.kt)("li",{parentName:"ol"},"\u8c03\u7528render()\u83b7\u5f97\u65b0\u7684\u5b50\u8282\u70b9\uff0c\u5e76\u4e3a\u5b50\u8282\u70b9\u521b\u5efafiber\uff08\u521b\u5efa\u8fc7\u7a0b\u4f1a\u5c3d\u91cf\u590d\u7528\u73b0\u6709fiber\uff0c\u5b50\u8282\u70b9\u589e\u5220\u4e5f\u53d1\u751f\u5728\u8fd9\u91cc\uff09"),(0,o.kt)("li",{parentName:"ol"},"\u5982\u679c\u6ca1\u6709\u4ea7\u751fchild fiber\uff0c\u8be5\u5de5\u4f5c\u5355\u5143\u7ed3\u675f\uff0c\u628aeffect list\u5f52\u5e76\u5230return\uff0c\u5e76\u628a\u5f53\u524d\u8282\u70b9\u7684sibling\u4f5c\u4e3a\u4e0b\u4e00\u4e2a\u5de5\u4f5c\u5355\u5143\uff1b\u5426\u5219\u628achild\u4f5c\u4e3a\u4e0b\u4e00\u4e2a\u5de5\u4f5c\u5355\u5143"),(0,o.kt)("li",{parentName:"ol"},"\u5982\u679c\u6ca1\u6709\u5269\u4f59\u53ef\u7528\u65f6\u95f4\u4e86\uff0c\u7b49\u5230\u4e0b\u4e00\u6b21\u4e3b\u7ebf\u7a0b\u7a7a\u95f2\u65f6\u624d\u5f00\u59cb\u4e0b\u4e00\u4e2a\u5de5\u4f5c\u5355\u5143\uff1b\u5426\u5219\uff0c\u7acb\u5373\u5f00\u59cb\u505a"),(0,o.kt)("li",{parentName:"ol"},"\u5982\u679c\u6ca1\u6709\u4e0b\u4e00\u4e2a\u5de5\u4f5c\u5355\u5143\u4e86\uff08\u56de\u5230\u4e86workInProgress tree\u7684\u6839\u8282\u70b9\uff09\uff0c\u7b2c1\u9636\u6bb5\u7ed3\u675f\uff0c\u8fdb\u5165pendingCommit\u72b6\u6001")),(0,o.kt)("p",null,"\u5b9e\u9645\u4e0a\u662f1-6\u7684\u5de5\u4f5c\u5faa\u73af\uff0c7\u662f\u51fa\u53e3\uff0c\u5de5\u4f5c\u5faa\u73af\u6bcf\u6b21\u53ea\u505a\u4e00\u4ef6\u4e8b\uff0c\u505a\u5b8c\u770b\u8981\u4e0d\u8981\u5598\u53e3\u6c14\u3002\u5de5\u4f5c\u5faa\u73af\u7ed3\u675f\u65f6\uff0cworkInProgress tree\u7684\u6839\u8282\u70b9\u8eab\u4e0a\u7684effect list\u5c31\u662f\u6536\u96c6\u5230\u7684\u6240\u6709side effect\uff08\u56e0\u4e3a\u6bcf\u505a\u5b8c\u4e00\u4e2a\u90fd\u5411\u4e0a\u5f52\u5e76\uff09"),(0,o.kt)("p",null,"\u63a5\u4ee5\u4e0a\u4ee3\u7801\uff1a\n\u5bf9\u4e8e\u6211\u4eec\u5e38\u89c1\u7684\u7ec4\u4ef6\u7c7b\u578b\uff0c\u5982\uff08FunctionComponent/ClassComponent/HostComponent\uff09\uff0c\u6700\u7ec8\u4f1a\u8fdb\u5165 reconcileChildren \u65b9\u6cd5\u3002"),(0,o.kt)("p",null,"\u4ece\u8be5\u51fd\u6570\u540d\u5c31\u80fd\u770b\u51fa\u8fd9\u662fReconciler\u6a21\u5757\u7684\u6838\u5fc3\u90e8\u5206\u3002\u90a3\u4e48\u4ed6\u7a76\u7adf\u505a\u4e86\u4ec0\u4e48\u5462\uff1f"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"\u5bf9\u4e8e mount \u7684\u7ec4\u4ef6\uff0c\u4ed6\u4f1a\u521b\u5efa\u65b0\u7684\u5b50 Fiber \u8282\u70b9\uff1b"),(0,o.kt)("li",{parentName:"ul"},"\u5bf9\u4e8e update \u7684\u7ec4\u4ef6\uff0c\u4ed6\u4f1a\u5c06\u5f53\u524d\u7ec4\u4ef6\u4e0e\u8be5\u7ec4\u4ef6\u5728\u4e0a\u6b21\u66f4\u65b0\u65f6\u5bf9\u5e94\u7684 Fiber \u8282\u70b9\u6bd4\u8f83\uff08\u4e5f\u5c31\u662f\u4fd7\u79f0\u7684Diff \u7b97\u6cd5\uff09\uff0c\u5c06\u6bd4\u8f83\u7684\u7ed3\u679c\u751f\u6210\u65b0 Fiber \u8282\u70b9\u3002")),(0,o.kt)("p",null,"\u4e0d\u8bba\u8d70\u54ea\u4e2a\u903b\u8f91\uff0c\u6700\u7ec8\u4ed6\u4f1a\u751f\u6210\u65b0\u7684\u5b50 Fiber \u8282\u70b9\u5e76\u8d4b\u503c\u7ed9workInProgress.child\uff0c\u4f5c\u4e3a\u672c\u6b21 beginWork \u8fd4\u56de\u503c\uff0c\u5e76\u4f5c\u4e3a\u4e0b\u6b21performUnitOfWork\u6267\u884c\u65f6workInProgress\u7684\u4f20\u53c2\u3002"),(0,o.kt)("p",null,"mountChildFibers\u4e0ereconcileChildFibers\u8fd9\u4e24\u4e2a\u65b9\u6cd5\u7684\u903b\u8f91\u57fa\u672c\u4e00\u81f4\u3002\u552f\u4e00\u7684\u533a\u522b\u662f\uff1areconcileChildFibers \u4f1a\u4e3a\u751f\u6210\u7684 Fiber \u8282\u70b9\u5e26\u4e0aeffectTag\u5c5e\u6027\uff0c\u800c mountChildFibers \u4e0d\u4f1a\u3002"),(0,o.kt)("h3",{id:"reconcilechildren\u7b80\u7565\u51fd\u6570-1"},"reconcileChildren\u7b80\u7565\u51fd\u6570"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"var reconcileChildFibers = ChildReconciler(true);\nvar mountChildFibers = ChildReconciler(false);\nfunction reconcileChildren(current, workInProgress, nextChildren, renderLanes) {\n  if (current === null) {\n    console.log('%c reconcileChildren mount', 'yellow');\n    workInProgress.child = mountChildFibers(workInProgress, null, nextChildren, renderLanes);\n  } else {\n    console.log('%c reconcileChildren update', 'yellow');\n    workInProgress.child = reconcileChildFibers(workInProgress, current.child, nextChildren, renderLanes);\n  }\n}\n\n// \u8fd9\u4e2a\u4ee3\u7801\u5f88\u957f 1k\nfunction ChildReconciler(shouldTrackSideEffects) {\n\n}\n")),(0,o.kt)("p",null,"\u6d41\u7a0b\u5f00\u6253\u5370\u6bd4\u8f83\u76f4\u89c2\uff0c\u753b\u56fe\u592a\u590d\u6742\uff1a"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-mermaid"},"flowchart TD\nreconcileChildren--\u521d\u59cb\u5316--\x3eA1(mountChildFibers\u6216\u5219\u53ebChildReconciler)\n")),(0,o.kt)("h3",{id:"\u8981\u6267\u884c-dom-\u64cd\u4f5c\u7684\u5177\u4f53\u7c7b\u578b\u5c31\u4fdd\u5b58\u5728fibereffecttag\u4e2d"},"\u8981\u6267\u884c DOM \u64cd\u4f5c\u7684\u5177\u4f53\u7c7b\u578b\u5c31\u4fdd\u5b58\u5728fiber.effectTag\u4e2d"),(0,o.kt)("p",null,"render \u9636\u6bb5\u7684\u5de5\u4f5c\u662f\u5728\u5185\u5b58\u4e2d\u8fdb\u884c\uff0c\u5f53\u5de5\u4f5c\u7ed3\u675f\u540e\u4f1a\u901a\u77e5Renderer\u9700\u8981\u6267\u884c\u7684 DOM \u64cd\u4f5c\u3002"),(0,o.kt)("p",null,"\u901a\u8fc7\u4e8c\u8fdb\u5236\u8868\u793a effectTag\uff0c\u53ef\u4ee5\u65b9\u4fbf\u7684\u4f7f\u7528\u4f4d\u64cd\u4f5c\u4e3a fiber.effectTag \u8d4b\u503c\u591a\u4e2a effect\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"// DOM \u9700\u8981\u63d2\u5165\u5230\u9875\u9762\u4e2d\nexport const Placement = /*                */ 0b00000000000010;\n// DOM \u9700\u8981\u66f4\u65b0\nexport const Update = /*                   */ 0b00000000000100;\n// DOM \u9700\u8981\u63d2\u5165\u5230\u9875\u9762\u4e2d\u5e76\u66f4\u65b0\nexport const PlacementAndUpdate = /*       */ 0b00000000000110;\n// DOM \u9700\u8981\u5220\u9664\nexport const Deletion = /*                 */ 0b00000000001000;\n")),(0,o.kt)("p",null,"\u90a3\u4e48\uff0c\u5982\u679c\u8981\u901a\u77e5 Renderer \u5c06 Fiber \u8282\u70b9\u5bf9\u5e94\u7684 DOM \u8282\u70b9\u63d2\u5165\u9875\u9762\u4e2d\uff0c\u9700\u8981\u6ee1\u8db3\u4e24\u4e2a\u6761\u4ef6\uff1a"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"fiber.stateNode \u5b58\u5728\uff0c\u5373 Fiber \u8282\u70b9\u4e2d\u4fdd\u5b58\u4e86\u5bf9\u5e94\u7684 DOM \u8282\u70b9\uff1b"),(0,o.kt)("li",{parentName:"ul"},"(fiber.effectTag & Placement) !== 0\uff0c\u5373 Fiber \u8282\u70b9\u5b58\u5728 Placement effectTag\u3002")),(0,o.kt)("p",null,"\u6211\u4eec\u77e5\u9053\uff0cmount \u65f6\uff0cfiber.stateNode === null\uff0c\u4e14\u5728 reconcileChildren \u4e2d\u8c03\u7528\u7684 mountChildFibers \u4e0d\u4f1a\u4e3a Fiber \u8282\u70b9\u8d4b\u503c effectTag\u3002\u90a3\u4e48\u9996\u5c4f\u6e32\u67d3\u5982\u4f55\u5b8c\u6210\u5462\uff1f"),(0,o.kt)("p",null,"\u9488\u5bf9\u7b2c\u4e00\u4e2a\u95ee\u9898\uff0cfiber.stateNode \u4f1a\u5728 completeWork \u4e2d\u521b\u5efa\uff0c\u6211\u4eec\u4f1a\u5728\u4e0b\u4e00\u8282\u4ecb\u7ecd\u3002"),(0,o.kt)("p",null,"\u5047\u8bbe mountChildFibers \u4e5f\u4f1a\u8d4b\u503c effectTag\uff0c\u90a3\u4e48\u53ef\u4ee5\u9884\u89c1 mount \u65f6\u6574\u68f5 Fiber \u6811\u6240\u6709\u8282\u70b9\u90fd\u4f1a\u6709Placement effectTag\u3002\u90a3\u4e48commit \u9636\u6bb5\u5728\u6267\u884c DOM \u64cd\u4f5c\u65f6\u6bcf\u4e2a\u8282\u70b9\u90fd\u4f1a\u6267\u884c\u4e00\u6b21\u63d2\u5165\u64cd\u4f5c\uff0c\u8fd9\u6837\u5927\u91cf\u7684 DOM \u64cd\u4f5c\u662f\u6781\u4f4e\u6548\u7684\u3002"),(0,o.kt)("p",null,"\u603b\u7ed3:\u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0c\u5728mount \u65f6\u53ea\u6709 rootFiber \u4f1a\u8d4b\u503c Placement effectTag\uff0c\u5728 commit \u9636\u6bb5\u53ea\u6267\u884c\u4e00\u6b21\u63d2\u5165\u64cd\u4f5c\u3002"),(0,o.kt)("h1",{id:"\u56db-render\u9636\u6bb52completework"},"\u56db. render\u9636\u6bb52:completeWork"),(0,o.kt)("p",null,"completeWork\u9636\u6bb5\u5904\u5728beginWork\u4e4b\u540e\uff0ccommit\u4e4b\u524d\uff0c\u8d77\u5230\u7684\u662f\u4e00\u4e2a\u627f\u4e0a\u542f\u4e0b\u7684\u4f5c\u7528\u3002\u5b83\u63a5\u6536\u5230\u7684\u662f\u7ecf\u8fc7diff\u540e\u7684fiber\u8282\u70b9\uff0c\u7136\u540e\u4ed6\u81ea\u5df1\u8981\u5c06DOM\u8282\u70b9\u548ceffectList\u90fd\u51c6\u5907\u597d\u3002\u56e0\u4e3acommit\u9636\u6bb5\u662f\u4e0d\u80fd\u88ab\u6253\u65ad\u7684\uff0c\u6240\u4ee5\u5145\u5206\u51c6\u5907\u6709\u5229\u4e8ecommit\u9636\u6bb5\u505a\u66f4\u5c11\u7684\u5de5\u4f5c\u3002"),(0,o.kt)("p",null,"\u6bcf\u4e2afiber\u8282\u70b9\u5728\u66f4\u65b0/\u521b\u5efa\u65f6\u90fd\u4f1a\u7ecf\u5386\u4e24\u4e2a\u9636\u6bb5\uff1abeginWork\u548ccompleteWork\u3002"),(0,o.kt)("p",null,"workLoopSync \u5faa\u73af\u8c03\u7528 performUnitOfWork "),(0,o.kt)("h2",{id:"render\u9636\u6bb52completework"},"render\u9636\u6bb52:completeWork"),(0,o.kt)("p",null,"complete\u9636\u6bb5workInProgress\u8282\u70b9\u90fd\u662f\u7ecf\u8fc7diff\u7b97\u6cd5\u8c03\u548c\u8fc7\u7684\uff0c\u4e5f\u5c31\u610f\u5473\u7740\u5bf9\u4e8e\u67d0\u4e2a\u8282\u70b9\u6765\u8bf4\u5b83fiber\u7684\u5f62\u6001\u5df2\u7ecf\u57fa\u672c\u786e\u5b9a\u4e86\uff0c\u4f46\u9664\u6b64\u4e4b\u5916\u8fd8\u6709\u4e24\u70b9\uff1a"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"\u76ee\u524d\u53ea\u6709fiber\u5f62\u6001\u53d8\u4e86\uff0c\u5bf9\u4e8e\u539f\u751fDOM\u7ec4\u4ef6\uff08HostComponent\uff09\u548c\u6587\u672c\u8282\u70b9\uff08HostText\uff09\u7684fiber\u6765\u8bf4\uff0c\u5bf9\u5e94\u7684DOM\u8282\u70b9\uff08fiber.stateNode\uff09\u5e76\u672a\u53d8\u5316\u3002"),(0,o.kt)("li",{parentName:"ul"},"\u7ecf\u8fc7Diff\u751f\u6210\u7684\u65b0\u7684workInProgress\u8282\u70b9\u6301\u6709\u4e86flag(\u5373effectTag)")),(0,o.kt)("p",null,"workInProgress\u8282\u70b9\u7684completeWork\u9636\u6bb5\u4e3b\u8981\u505a\u7684:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"\u771f\u5b9eDOM\u8282\u70b9\u7684\u521b\u5efa\u4ee5\u53ca\u6302\u8f7d")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"\u6784\u5efa\u8fc7\u7a0b\u4e2d\uff0c\u4f1a\u81ea\u4e0b\u800c\u4e0a\u5c06\u5b50\u8282\u70b9\u7684\u7b2c\u4e00\u5c42\u7b2c\u4e00\u5c42\u63d2\u5165\u5230\u5f53\u524d\u8282\u70b9\u3002\n\u66f4\u65b0\u8fc7\u7a0b\u4e2d\uff0c\u4f1a\u8ba1\u7b97DOM\u8282\u70b9\u7684\u5c5e\u6027\uff0c\u4e00\u65e6\u5c5e\u6027\u9700\u8981\u66f4\u65b0\uff0c\u4f1a\u4e3aDOM\u8282\u70b9\u5bf9\u5e94\u7684workInProgress\u8282\u70b9\u6807\u8bb0Update\u7684effectTag\n")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"effectList\u7684\u6536\u96c6")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"\u6267\u884cbeginWork\u540e\u4f1a\u521b\u5efa\u5b50 Fiber \u8282\u70b9\uff0c\u8282\u70b9\u4e0a\u53ef\u80fd\u5b58\u5728effectTag\u3002\n")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"DOM\u5c5e\u6027\u7684\u5904\u7406,\u6b21\u8981\u7406\u89e3"),(0,o.kt)("li",{parentName:"ul"},"\u9519\u8bef\u5904\u7406,\u6b21\u8981\u7406\u89e3")),(0,o.kt)("p",null,"\u4e00\u65e6workInProgress\u6811\u7684\u6240\u6709\u8282\u70b9\u90fd\u5b8c\u6210complete\uff0c\u5219\u8bf4\u660eworkInProgress\u6811\u5df2\u7ecf\u6784\u5efa\u5b8c\u6210\uff0c\u6240\u6709\u7684\u66f4\u65b0\u5de5\u4f5c\u5df2\u7ecf\u505a\u5b8c\uff0c\u63a5\u4e0b\u6765\u8fd9\u68f5\u6811\u4f1a\u8fdb\u5165commit\u9636\u6bb5"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"\u5982\u679c\u6ca1\u6709\u5b50Fiber\u8282\u70b9\u5219\u8fd4\u56denull, \u53ea\u6709\u5f53next\u4e3anull\u7684\u65f6\u5019\u624d\u4f1a\u8fdb\u5165completeWork;")),(0,o.kt)("p",null,"\u5f53\u524dFiber\u8282\u70b9\u6ca1\u6709\u5b50\u8282\u70b9\u65f6\u5c31\u8fdb\u5165\u4e86completeWork, \u53ef\u4ee5\u7406\u89e3\u4e3a\u9012\u5f52\u9636\u6bb5\u7684\u5f52\u9636\u6bb5\u3002 "),(0,o.kt)("p",null,"workLoopSync \u5faa\u73af\u8c03\u7528 performUnitOfWork "),(0,o.kt)("p",null,"performUnitOfWork--\x3ecompleteUnitOfWork--\x3ecompleteWork "),(0,o.kt)("p",null,"completeWork\u662f\u4e00\u4e2ado while\u5faa\u73af, \u7ec8\u6b62\u6761\u4ef6\u6709completeWork !== null\u6216\u8005\u5faa\u73af\u5185return\u524d\u7684\u51e0\u4e2a\u7ec8\u6b62\u6761\u4ef6"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"function performUnitOfWork(unitOfWork) {\n  workInProgressNums = workInProgressNums + 1\n  // The current, flushed, state of this fiber is the alternate. Ideally\n  // nothing should rely on this, but relying on it here means that we don't\n  // need an additional field on the work in progress.\n  var current = unitOfWork.alternate;\n  setCurrentFiber(unitOfWork);\n  var next;\n\n  if ((unitOfWork.mode & ProfileMode) !== NoMode) {\n    startProfilerTimer(unitOfWork);\n    //\u5bf9\u5f53\u524d\u8282\u70b9\u8fdb\u884c\u534f\u8c03\uff0c\u5982\u679c\u5b58\u5728\u5b50\u8282\u70b9\uff0c\u5219\u8fd4\u56de\u5b50\u8282\u70b9\u7684\u5f15\u7528\n    next = beginWork$1(current, unitOfWork, subtreeRenderLanes);\n    stopProfilerTimerIfRunningAndRecordDelta(unitOfWork, true);\n  } else {\n    next = beginWork$1(current, unitOfWork, subtreeRenderLanes);\n  }\n\n  resetCurrentFiber();\n  unitOfWork.memoizedProps = unitOfWork.pendingProps;\n\n  //\u5982\u679c\u65e0\u5b50\u8282\u70b9\uff0c\u5219\u4ee3\u8868\u5f53\u524d\u7684child\u94fe\u8868\u5df2\u7ecf\u904d\u5386\u5b8c\n  if (next === null) {\n    // If this doesn't spawn new work, complete the current work.\n    //\u6b64\u51fd\u6570\u5185\u90e8\u4f1a\u5e2e\u6211\u4eec\u627e\u5230\u4e0b\u4e00\u4e2a\u53ef\u6267\u884c\u7684\u8282\u70b9\n    console.log(`%c \u65e0\u5b50\u8282\u70b9\uff0c\u5219\u4ee3\u8868\u5f53\u524d\u7684child\u94fe\u8868\u5df2\u7ecf\u904d\u5386\u5b8c,\u5f00\u542f\u5b50\u7ec4\u4ef6\u94fecompleteUnitOfWork:${unitOfWork.type}`, 'color:black');\n    completeUnitOfWork(unitOfWork);\n  } else {\n    workInProgress = next;\n  }\n\n  ReactCurrentOwner$2.current = null;\n}\n")),(0,o.kt)("h3",{id:"effectlist"},"effectList"),(0,o.kt)("p",null,"\u6211\u4eec\u5728\u4ecb\u7ecdcompleteUnitOfWork\u51fd\u6570\u7684\u65f6\u5019\u63d0\u5230\uff0c\u4ed6\u7684\u5176\u4e2d\u4e00\u4e2a\u4f5c\u7528\u662f\u7528\u4e8e\u8fdb\u884c\u7236\u8282\u70b9\u7684effectList\u7684\u6536\u96c6\uff1a"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"\u628a\u5f53\u524d fiber \u8282\u70b9\u7684 effectList \u5408\u5e76\u5230\u7236\u8282\u70b9\u7684effectList\u4e2d\u3002"),(0,o.kt)("li",{parentName:"ul"},"\u82e5\u5f53\u524d fiber \u8282\u70b9\u5b58\u5728\u5b58\u5728\u526f\u4f5c\u7528(\u589e,\u5220,\u6539)\uff0c \u5219\u5c06\u5176\u52a0\u5165\u5230\u7236\u8282\u70b9\u7684effectList\u4e2d\u3002")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"  // \u5c06\u6b64\u8282\u70b9\u7684effectList\u5408\u5e76\u5230\u5230\u7236\u8282\u70b9\u7684effectList\u4e2d\n  if (returnFiber.firstEffect === null) {\n    returnFiber.firstEffect = completedWork.firstEffect;\n  }\n    \n  if (completedWork.lastEffect !== null) {\n    if (returnFiber.lastEffect !== null) {\n      returnFiber.lastEffect.nextEffect = completedWork.firstEffect;\n    }\n    returnFiber.lastEffect = completedWork.lastEffect;\n  }\n  // \u82e5\u5f53\u524d fiber \u8282\u70b9\u5b58\u5728\u5b58\u5728\u526f\u4f5c\u7528(\u589e,\u5220,\u6539)\uff0c \u5219\u5c06\u5176\u52a0\u5165\u5230\u7236\u8282\u70b9\u7684`effectList`\u4e2d\u3002\n  const flags = completedWork.flags;\n  if (flags > PerformedWork) {\n    if (returnFiber.lastEffect !== null) {\n      returnFiber.lastEffect.nextEffect = completedWork;\n    } else {\n      returnFiber.firstEffect = completedWork;\n    }\n    returnFiber.lastEffect = completedWork;\n  }\n")),(0,o.kt)("p",null,"effectList\u5b58\u5728\u7684\u76ee\u7684\u662f\u4e3a\u4e86\u63d0\u5347commit\u9636\u6bb5\u7684\u5de5\u4f5c\u6548\u7387\u3002\n\u5728commit\u9636\u6bb5\uff0c\u6211\u4eec\u9700\u8981\u627e\u51fa\u6240\u6709\u5b58\u5728effectTag\u7684fiber\u8282\u70b9\u5e76\u4f9d\u6b21\u6267\u884ceffectTag\u5bf9\u5e94\u64cd\u4f5c\u3002\u4e3a\u4e86\u907f\u514d\u5728commit\u9636\u6bb5\u518d\u53bb\u505a\u904d\u5386\u64cd\u4f5c\u53bb\u5bfb\u627eeffectTag\n\u4e0d\u4e3a\u7a7a\u7684fiber\u8282\u70b9\uff0cReact\u5728completeUnitOfWork\u51fd\u6570\u8c03\u7528\u7684\u8fc7\u7a0b\u4e2d\u63d0\u524d\u628a\u6240\u6709\u5b58\u5728effectTag\u7684\u8282\u70b9\u6536\u96c6\u5230effectList\u4e2d\uff0c\u5728commit\u9636\u6bb5\uff0c\u53ea\u9700\u8981\u904d\u5386effectList\uff0c\u5e76\u6267\u884c\u5404\u4e2a\u8282\u70b9\u7684effectTag\u7684\u5bf9\u5e94\u64cd\u4f5c\u5c31\u597d\u3002"),(0,o.kt)("h3",{id:"completeunitofwork"},"completeUnitOfWork"),(0,o.kt)("p",null,"completeUnitOfWork\u4e3b\u8981\u6d41\u7a0b"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"\u8c03\u7528completeWork\u3002"),(0,o.kt)("li",{parentName:"ol"},"\u7528\u4e8e\u8fdb\u884c\u7236\u8282\u70b9\u7684effectList\u7684\u6536\u96c6\uff1a",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},"\u628a\u5f53\u524d fiber \u8282\u70b9\u7684 effectList \u5408\u5e76\u5230\u7236\u8282\u70b9\u7684effectList\u4e2d\u3002"),(0,o.kt)("li",{parentName:"ul"},"\u82e5\u5f53\u524d fiber \u8282\u70b9\u5b58\u5728\u5b58\u5728\u526f\u4f5c\u7528(\u589e,\u5220,\u6539)\uff0c \u5219\u5c06\u5176\u52a0\u5165\u5230\u7236\u8282\u70b9\u7684effectList\u4e2d\u3002"))),(0,o.kt)("li",{parentName:"ol"},"\u6cbf\u7740\u6b64\u8282\u70b9\u6240\u5728\u7684\u5144 -> \u5f1f\u94fe\u8868\u67e5\u770b\u5176\u662f\u5426\u62e5\u6709\u5144\u5f1ffiber\u8282\u70b9\uff08\u5373fiber.sibling !== null\uff09\uff0c\u5982\u679c\u5b58\u5728\uff0c\u5219\u8fdb\u5165\u5176\u5144\u5f1ffiber\u7236 -> \u5b50\u94fe\u8868\n\u7684\u904d\u5386\uff08\u5373\u8fdb\u5165\u5176\u5144\u5f1f\u8282\u70b9\u7684beginWork\u9636\u6bb5\uff09\u3002\u5982\u679c\u4e0d\u5b58\u5728\u5144\u5f1ffiber\uff0c\u4f1a\u901a\u8fc7\u5b50 -> \u7236\u94fe\u8868\u56de\u6eaf\u5230\u7236\u8282\u70b9\u4e0a\uff0c\u76f4\u5230\u56de\u6eaf\u5230\u6839\u8282\u70b9\uff0c\u4e5f\u5373\u5b8c\u6210\u672c\u6b21\u534f\u8c03")),(0,o.kt)("p",null,"completeUnitOfWork \u4ece\u6e90\u7801\u4e2d\u53ef\u4ee5\u770b\u5230\u662f\u4e00\u4e2ado while\u5faa\u73af, \u7ec8\u6b62\u6761\u4ef6\u6709completeWork !== null\u6216\u8005\u5faa\u73af\u5185return\u524d\u7684\u51e0\u4e2a\u7ec8\u6b62\u6761\u4ef6, \u6211\u4eec\u53ef\u4ee5\u770b\u5230\u6709\u4e00\u4e2a\u662fsiblingFiber\u4e0d\u4e3anull\u7684\u60c5\u51b5. \u5373\u5f53\u524d\u7684\u8282\u70b9\u5b58\u5728\u5144\u5f1f\u8282\u70b9\u65f6\u5e76\u4e14\u5df2\u7ecf\u6ca1\u6709\u5b50\u8282\u70b9, \u5f53\u524d\u8282\u70b9\u4f1a\u7ed3\u675fcompleteWork, \u8df3\u51fa\u8c03\u7528\u6808, \u6267\u884c\u4e0b\u4e00\u6b21\u5faa\u73af, \u8fdb\u5165\u5144\u5f1f\u8282\u70b9\u7684beginWork.\u5f53\u5144\u5f1f\u8282\u70b9\u4e3anull\u7684\u65f6\u5019, \u90a3\u4e48completeWork\u4f1a\u88ab\u8d4b\u503c\u4e3areturnFiber, \u8fd9\u4e2a\u65f6\u5019\u6ce8\u610f\u5e76\u6ca1\u6709\u7528return\u8df3\u51fa\u8c03\u7528\u6808, \u56e0\u4e3a\u7236\u7ea7\u8282\u70b9\u7684beginWork\u5df2\u7ecf\u88ab\u6267\u884c, \u56e0\u6b64\u4f1a\u8fdb\u5165\u7236\u7ea7\u8282\u70b9\u7684completeWork, \u7531\u6b64\u5411\u4e0a, \u5f53completeWork\u4e3anull\u65f6\u610f\u5473\u7740\u5f52\u5230\u6839\u8282\u70b9"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"function completeUnitOfWork(unitOfWork) {\n  var completedWork = unitOfWork;\n\n  do {\n    var current = completedWork.alternate;\n    var returnFiber = completedWork.return; // Check if the work completed or if something threw.\n\n    if ((completedWork.flags & Incomplete) === NoFlags) {\n      setCurrentFiber(completedWork);\n      var next = void 0;\n\n      if ((completedWork.mode & ProfileMode) === NoMode) {\n        console.log(`%c ==\u5f00\u59cbcompleteWork-1`, 'color:black')\n        next = completeWork(current, completedWork, subtreeRenderLanes);\n      } else {\n        console.log(`%c ==\u5f00\u59cbcompleteWork-2`, 'color:black')\n        startProfilerTimer(completedWork);\n        next = completeWork(current, completedWork, subtreeRenderLanes); // Update render duration assuming we didn't error.\n\n        stopProfilerTimerIfRunningAndRecordDelta(completedWork, false);\n      }\n\n      resetCurrentFiber();\n\n      if (next !== null) {\n        // Completing this fiber spawned new work. Work on that next.\n        workInProgress = next;\n        return;\n      }\n    }else{\n      // ...\n    }\n\n    // \u67e5\u770b\u5f53\u524d\u8282\u70b9\u662f\u5426\u5b58\u5728\u5144\u5f1f\u8282\u70b9\n    var siblingFiber = completedWork.sibling;\n    if (siblingFiber !== null) {\n      // If there is more work to do in this returnFiber, do that next.\n      // \u82e5\u5b58\u5728\uff0c\u4fbf\u628asiblingFiber\u8282\u70b9\u4f5c\u4e3a\u4e0b\u4e00\u4e2a\u5de5\u4f5c\u5355\u5143\uff0c\n      // \u7ee7\u7eed\u6267\u884cperformUnitOfWork\uff0c\u6267\u884c\u5f53\u524d\u8282\u70b9\u5e76\u5c1d\u8bd5\u904d\u5386\u5f53\u524d\u8282\u70b9\u6240\u5728\u7684child\u94fe\u8868\n      workInProgress = siblingFiber;\n      return;\n    }\n\n    // \u5982\u679c\u4e0d\u5b58\u5728\u5144\u5f1f\u8282\u70b9\uff0c\u5219\u56de\u6eaf\u5230\u7236\u8282\u70b9\uff0c\u5c1d\u8bd5\u67e5\u627e\u7236\u8282\u70b9\u7684\u5144\u5f1f\u8282\u70b9\n    completedWork = returnFiber; // Update the next thing we're working on in case something throws.\n    workInProgress = completedWork;\n  } while (completedWork !== null); // We've reached the root.\n}\n")),(0,o.kt)("h3",{id:"\u6b63\u5f0f\u8fdb\u5165completework"},"\u6b63\u5f0f\u8fdb\u5165completeWork"),(0,o.kt)("p",null,"completeWork\u7684\u4f5c\u7528\u5305\u62ec\uff1a"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"\u4e3a\u65b0\u589e\u7684 fiber \u8282\u70b9\u751f\u6210\u5bf9\u5e94\u7684DOM\u8282\u70b9\u3002"),(0,o.kt)("li",{parentName:"ol"},"\u66f4\u65b0DOM\u8282\u70b9\u7684\u5c5e\u6027\u3002"),(0,o.kt)("li",{parentName:"ol"},"\u8fdb\u884c\u4e8b\u4ef6\u7ed1\u5b9a\u3002"),(0,o.kt)("li",{parentName:"ol"},"\u6536\u96c6effectTag\u3002")),(0,o.kt)("p",null,"\u7c7b\u4f3c beginWork\uff0ccompleteWork \u4e5f\u662f\u9488\u5bf9\u4e0d\u540c fiber.tag \u8c03\u7528\u4e0d\u540c\u7684\u5904\u7406\u903b\u8f91\u3002"),(0,o.kt)("p",null,"\u91cd\u70b9\u5173\u6ce8\u9875\u9762\u6e32\u67d3\u6240\u5fc5\u987b\u7684 HostComponent\uff08\u5373\u539f\u751f DOM \u7ec4\u4ef6\u5bf9\u5e94\u7684 Fiber \u8282\u70b9\uff09,"),(0,o.kt)("p",null,"\u540c\u65f6\u9488\u5bf9 HostComponent \uff0c\u5224\u65adupdate\u65f6\u6211\u4eec\u8fd8\u9700\u8981\u8003\u8651 workInProgress.stateNode != null ?\uff08\u5373\u8be5 Fiber \u8282\u70b9\u662f\u5426\u5b58\u5728\u5bf9\u5e94\u7684 DOM \u8282\u70b9\uff09\u3002"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"case HostComponent\u4e3a\u4f8b\u5b50:")),(0,o.kt)("p",null,"\u8fd8\u8bb0\u5f97\u6211\u4eec\u8bb2\u5230\uff1amount \u65f6\u53ea\u4f1a\u5728 rootFiber \u5b58\u5728 Placement effectTag\u3002\u90a3\u4e48commit \u9636\u6bb5\u662f\u5982\u4f55\u901a\u8fc7\u4e00\u6b21\u63d2\u5165 DOM \u64cd\u4f5c\uff08\u5bf9\u5e94\u4e00\u4e2aPlacement effectTag\uff09\u5c06\u6574\u68f5 DOM \u6811\u63d2\u5165\u9875\u9762\u7684\u5462\uff1f"),(0,o.kt)("p",null,"\u539f\u56e0\u5c31\u5728\u4e8e completeWork \u4e2d\u7684appendAllChildren \u65b9\u6cd5\u3002"),(0,o.kt)("p",null,"\u7531\u4e8e completeWork \u5c5e\u4e8e\u201c\u5f52\u201d\u9636\u6bb5\u8c03\u7528\u7684\u51fd\u6570\uff0c\u6bcf\u6b21\u8c03\u7528 appendAllChildren \u65f6\u90fd\u4f1a\u5c06\u5df2\u751f\u6210\u7684\u5b50\u5b59 DOM \u8282\u70b9\u63d2\u5165\u5f53\u524d\u751f\u6210\u7684 DOM \u8282\u70b9\u4e0b\u3002\u90a3\u4e48\u5f53\u201c\u5f52\u201d\u5230 rootFiber \u65f6\uff0c\u6211\u4eec\u5df2\u7ecf\u6709\u4e00\u4e2a\u6784\u5efa\u597d\u7684\u79bb\u5c4f DOM \u6811\u3002"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"hostComponent\u4e3a\u4f8b\u5b50:")),(0,o.kt)("p",null,"\u6839\u636ecurrent\u72b6\u6001\u8fdb\u5165\u4e0d\u540c\u903b\u8f91\uff0c\u6211\u4eec\u5206\u6790\u9996\u5c4f\u6e32\u67d3\u65f6\u7684\u903b\u8f91\uff0c\u4e3b\u8981\u6709\u4ee5\u4e0b\u51e0\u6b65:"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"createInstance \u4e3a\u5f53\u524dfiber\u521b\u5efadom\u5b9e\u4f8b")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"createInstance =>\ncreateElement => \ndocument.createElement\n")),(0,o.kt)("ol",{start:2},(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"appendAllChildren \u904d\u5386\u6240\u6709\u540c\u7ea7\u5b50\u4ee3\u8282\u70b9\uff0c\u6267\u884c\u7236\u8282\u70b9\u7684appenChild\u65b9\u6cd5\uff0c\u5373\u6b64\u65b9\u6cd5\u4f1a\u5c06\u6240\u6709\u5b50dom\u8282\u70b9\u4e0e\u5f53\u524d\u521b\u5efa\u7684dom\u5b9e\u4f8b\u8fde\u63a5")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"\u8d4b\u503cstateNode\u5c5e\u6027")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"finalizeInitialChildren \u5904\u7406props"))),(0,o.kt)("p",null,"\u81f3\u6b64\uff0c\u9996\u5c4f\u6e32\u67d3\u65f6render\u9636\u6bb5\u7684\u5927\u4f53\u6d41\u7a0b\u5c31\u68b3\u7406\u5b8c\u4e86"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"function completeWork(current, workInProgress, renderLanes) {\n  const newProps = workInProgress.pendingProps;\n\n  switch (workInProgress.tag) {\n    case IndeterminateComponent:\n    case LazyComponent:\n    case SimpleMemoComponent:\n    case FunctionComponent:\n    case ForwardRef:\n    case Fragment:\n    case Mode:\n    case Profiler:\n    case ContextConsumer:\n    case MemoComponent:\n      return null;\n    case ClassComponent: {\n      // ...\u7701\u7565\n      return null;\n    }\n    case HostRoot: {\n      // ...\u7701\u7565\n      updateHostContainer(workInProgress);\n      return null;\n    }\n    case HostComponent:\n        {\n          popHostContext(workInProgress);\n          var rootContainerInstance = getRootHostContainer();\n          var type = workInProgress.type;\n\n          if (current !== null && workInProgress.stateNode != null) {\n            console.log(`%c=completeWork->\u66f4\u65b0\u6d41\u7a0bHostComponent\u8c03\u7528updateHostComponent`, 'color:chartreuse')\n            updateHostComponent(current, workInProgress, type, newProps, rootContainerInstance);\n\n            if (current.ref !== workInProgress.ref) {\n              markRef(workInProgress);\n            }\n          } else {\n            if (!newProps) {\n              if (workInProgress.stateNode === null) {\n                throw new Error('We must have new props for new mounts. This error is likely ' + 'caused by a bug in React. Please file an issue.');\n              } // This can happen when we abort work.\n\n\n              bubbleProperties(workInProgress);\n              return null;\n            }\n\n            var currentHostContext = getHostContext(); // TODO: Move createInstance to beginWork and keep it on a context\n            // \"stack\" as the parent. Then append children as we go in beginWork\n            // or completeWork depending on whether we want to add them top->down or\n            // bottom->up. Top->down is faster in IE11.\n\n            var _wasHydrated = popHydrationState(workInProgress);\n\n            if (_wasHydrated) {\n              // TODO: Move this and createInstance step into the beginPhase\n              // to consolidate.\n              if (prepareToHydrateHostInstance(workInProgress, rootContainerInstance, currentHostContext)) {\n                // If changes to the hydrated node need to be applied at the\n                // commit-phase we mark this as such.\n                markUpdate(workInProgress);\n              }\n            } else {\n              // \u4e3a\u5f53\u524dfiber\u521b\u5efadom\u5b9e\u4f8b\n              console.log('%c=beginWork->HostComponent\u521d\u59cb\u5316\u6d41\u7a0b\u8c03\u7528createInstance\u4e3a\u5f53\u524dfiber\u521b\u5efadom\u5b9e\u4f8b==>start', 'color:chartreuse')\n              var instance = createInstance(type, newProps, rootContainerInstance, currentHostContext, workInProgress);\n              // \u5c06\u5b50\u5b59dom\u8282\u70b9\u8ffd\u52a0\u5230\u5f53\u524d\u521b\u5efa\u7684dom\u8282\u70b9\u4e0a\n              console.log('%c=beginWork->HostComponent\u521d\u59cb\u5316\u6d41\u7a0b-\u5c06\u5b50\u5b59dom\u8282\u70b9\u8ffd\u52a0\u5230\u5f53\u524d\u521b\u5efa\u7684dom\u8282\u70b9\u4e0a', 'color:green', { instance })\n              appendAllChildren(instance, workInProgress, false, false);\n              // \u5c06\u5f53\u524d\u521b\u5efa\u7684\u6302\u8f7d\u5230stateNode\u5c5e\u6027\u4e0a\n              workInProgress.stateNode = instance; // Certain renderers require commit-time effects for initial mount.\n              console.log('%c=beginWork->HostComponent\u521d\u59cb\u5316\u6d41\u7a0b\u5c06\u5f53\u524d\u521b\u5efa\u7684\u6302\u8f7d\u5230workInProgress.stateNode:', 'color:green', { workInProgress_stateNode: workInProgress.stateNode });\n              // (eg DOM renderer supports auto-focus for certain elements).\n              // Make sure such renderers get scheduled for later work.\n              // \u5904\u7406props\uff08\u7ed1\u5b9a\u56de\u8c03\uff0c\u8bbe\u7f6edom\u5c5e\u6027...\uff09\n              if (finalizeInitialChildren(instance, type, newProps, rootContainerInstance)) {\n                markUpdate(workInProgress);\n              }\n            }\n            // ref\u5c5e\u6027\u76f8\u5173\u903b\u8f91\n            if (workInProgress.ref !== null) {\n              // If there is a ref on a host node we need to schedule a callback\n              markRef(workInProgress);\n            }\n          }\n\n          bubbleProperties(workInProgress);\n          return null;\n        }\n}\n")),(0,o.kt)("h3",{id:"\u8c03\u7528createelement\u4e3a\u5f53\u524dfiber\u521b\u5efadom\u8282\u70b9"},"\u8c03\u7528createElement\u4e3a\u5f53\u524dfiber\u521b\u5efadom\u8282\u70b9"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"function createElement(type, props, rootContainerElement, parentNamespace) {\n  var isCustomComponentTag; // We create tags in the namespace of their parent container, except HTML\n  // tags get no namespace.\n\n  var ownerDocument = getOwnerDocumentFromRootContainer(rootContainerElement);\n  var domElement;\n  var namespaceURI = parentNamespace;\n\n  if (namespaceURI === HTML_NAMESPACE) {\n    namespaceURI = getIntrinsicNamespace(type);\n  }\n\n  if (namespaceURI === HTML_NAMESPACE) {\n    {\n      isCustomComponentTag = isCustomComponent(type, props); // Should this check be gated by parent namespace? Not sure we want to\n      // allow <SVG> or <mATH>.\n\n      if (!isCustomComponentTag && type !== type.toLowerCase()) {\n        error('<%s /> is using incorrect casing. ' + 'Use PascalCase for React components, ' + 'or lowercase for HTML elements.', type);\n      }\n    }\n\n    if (type === 'script') {\n      // Create the script via .innerHTML so its \"parser-inserted\" flag is\n      // set to true and it does not execute\n      var div = ownerDocument.createElement('div');\n\n      div.innerHTML = '<script><' + '/script>'; // eslint-disable-line\n      // This is guaranteed to yield a script element.\n\n      var firstChild = div.firstChild;\n      domElement = div.removeChild(firstChild);\n    } else if (typeof props.is === 'string') {\n      // $FlowIssue `createElement` should be updated for Web Components\n      domElement = ownerDocument.createElement(type, {\n        is: props.is\n      });\n    } else {\n      // Separate else branch instead of using `props.is || undefined` above because of a Firefox bug.\n      // See discussion in https://github.com/facebook/react/pull/6896\n      // and discussion in https://bugzilla.mozilla.org/show_bug.cgi?id=1276240\n      domElement = ownerDocument.createElement(type); // Normally attributes are assigned in `setInitialDOMProperties`, however the `multiple` and `size`\n      // attributes on `select`s needs to be added before `option`s are inserted.\n      // This prevents:\n      // - a bug where the `select` does not scroll to the correct option because singular\n      //  `select` elements automatically pick the first item #13222\n      // - a bug where the `select` set the first item as selected despite the `size` attribute #14239\n      // See https://github.com/facebook/react/issues/13222\n      // and https://github.com/facebook/react/issues/14239\n\n      if (type === 'select') {\n        var node = domElement;\n\n        if (props.multiple) {\n          node.multiple = true;\n        } else if (props.size) {\n          // Setting a size greater than 1 causes a select to behave like `multiple=true`, where\n          // it is possible that no option is selected.\n          //\n          // This is only necessary when a select in \"single selection mode\".\n          node.size = props.size;\n        }\n      }\n    }\n  } else {\n    domElement = ownerDocument.createElementNS(namespaceURI, type);\n  }\n\n  {\n    if (namespaceURI === HTML_NAMESPACE) {\n      if (!isCustomComponentTag && Object.prototype.toString.call(domElement) === '[object HTMLUnknownElement]' && !hasOwnProperty.call(warnedUnknownTags, type)) {\n        warnedUnknownTags[type] = true;\n\n        error('The tag <%s> is unrecognized in this browser. ' + 'If you meant to render a React component, start its name with ' + 'an uppercase letter.', type);\n      }\n    }\n  }\n\n  console.log(`%c=createElement`, 'color:green', { type, props, domElement })\n  return domElement;\n}\n")),(0,o.kt)("h3",{id:"appendallchildren\u8d1f\u8d23\u5c06\u5b50\u5b59dom\u8282\u70b9\u63d2\u5165\u521a\u751f\u6210\u7684dom\u8282\u70b9\u4e2d"},"appendAllChildren\u8d1f\u8d23\u5c06\u5b50\u5b59DOM\u8282\u70b9\u63d2\u5165\u521a\u751f\u6210\u7684DOM\u8282\u70b9\u4e2d"),(0,o.kt)("p",null,"beginWork\u65f6\u4ecb\u7ecd\u8fc7\uff0c\u5728mount\u65f6\uff0c\u4e3a\u4e86\u907f\u514d\u6bcf\u4e2afiber\u8282\u70b9\u90fd\u9700\u8981\u8fdb\u884c\u63d2\u5165\u64cd\u4f5c\uff0c\u5728mount\u65f6\uff0c\u53ea\u6709\u6839\u8282\u70b9\u4f1a\u6536\u96c6effectTag\uff0c\n\u5176\u4f59\u8282\u70b9\u4e0d\u4f1a\u8fdb\u884ceffectTag\u7684\u6536\u96c6\u3002\u7531\u4e8e\u6bcf\u6b21\u6267\u884cappendAllChildren\u540e\uff0c\u6211\u4eec\u90fd\u80fd\u5f97\u5230\u4e00\u68f5\u4ee5\u5f53\u524dworkInProgress\u4e3a\n\u6839\u8282\u70b9\u7684DOM\u6811\u3002\u56e0\u6b64\u5728commit\u9636\u6bb5\u6211\u4eec\u53ea\u9700\u8981\u5bf9mount\u7684\u6839\u8282\u70b9\u8fdb\u884c\u4e00\u6b21\u63d2\u5165\u64cd\u4f5c\u5c31\u53ef\u4ee5\u4e86\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"  appendAllChildren = function(\n    parent: Instance,\n    workInProgress: Fiber,\n    needsVisibilityToggle: boolean,\n    isHidden: boolean,\n  ) {\n    // \u83b7\u53d6workInProgress\u7684\u5b50fiber\u8282\u70b9\n    let node = workInProgress.child;\n\n    // \u5f53\u5b58\u5728\u5b50\u8282\u70b9\u65f6\uff0c\u53bb\u5f80\u4e0b\u904d\u5386\n    while (node !== null) {\n      if (node.tag === HostComponent || node.tag === HostText) {\n        // \u5f53node\u8282\u70b9\u4e3aHostComponent\u540eHostText\u65f6\uff0c\u76f4\u63a5\u63d2\u5165\u5230\u5b50DOM\u8282\u70b9\u5217\u8868\u7684\u5c3e\u90e8\n        appendInitialChild(parent, node.stateNode);\n      } else if (enableFundamentalAPI && node.tag === FundamentalComponent) {\n        appendInitialChild(parent, node.stateNode.instance);\n      } else if (node.tag === HostPortal) {\n        // \u5f53node\u8282\u70b9\u4e3aHostPortal\u7c7b\u578b\u7684\u8282\u70b9\uff0c\u4ec0\u4e48\u90fd\u4e0d\u505a\n      } else if (node.child !== null) {\n        // \u4e0a\u9762\u5206\u652f\u90fd\u6ca1\u6709\u547d\u4e2d\uff0c\u8bf4\u660enode\u8282\u70b9\u4e0d\u5b58\u5728\u5bf9\u5e94DOM\uff0c\u5411\u4e0b\u67e5\u627e\u62e5\u6709stateNode\u5c5e\u6027\u7684\u5b50\u8282\u70b9\n        node.child.return = node;\n        node = node.child;\n        continue;\n      }\n      if (node === workInProgress) {\n        // \u56de\u6eaf\u5230workInProgress\u65f6\uff0c\u4ee5\u6dfb\u52a0\u5b8c\u6240\u6709\u5b50\u8282\u70b9\n        return;\n      }\n\n      // \u5f53node\u8282\u70b9\u4e0d\u5b58\u5728\u5144\u5f1f\u8282\u70b9\u65f6\uff0c\u5411\u4e0a\u56de\u6eaf\n      while (node.sibling === null) {\n        // \u56de\u6eaf\u5230workInProgress\u65f6\uff0c\u4ee5\u6dfb\u52a0\u5b8c\u6240\u6709\u5b50\u8282\u70b9\n        if (node.return === null || node.return === workInProgress) {\n          return;\n        }\n        node = node.return;\n      }\n      \n      // \u6b64\u65f6workInProgress\u7684\u7b2c\u4e00\u4e2a\u5b50DOM\u8282\u70b9\u5df2\u7ecf\u63d2\u5165\u5230\u8fdb\u5165workInProgress\u5bf9\u5e94\u7684DOM\u8282\u70b9\u4e86\uff0c\u5f00\u59cb\u8fdb\u5165node\u8282\u70b9\u7684\u5144\u5f1f\u8282\u70b9\u7684\u63d2\u5165\u64cd\u4f5c\n      node.sibling.return = node.return;\n      node = node.sibling;\n    }\n  };\n")),(0,o.kt)("h2",{id:"\u89e3\u6790\u5728\u5f52\u9636\u6bb5\u4f1a\u8c03\u7528completework\u5904\u7406-fiber-\u8282\u70b9"},'\u89e3\u6790\uff1a\u5728"\u5f52"\u9636\u6bb5\u4f1a\u8c03\u7528completeWork\u5904\u7406 Fiber \u8282\u70b9'),(0,o.kt)("p",null,"completeWork \u5c06\u6839\u636e workInProgress \u8282\u70b9\u7684 tag \u5c5e\u6027\u7684\u4e0d\u540c\uff0c\u8fdb\u5165\u4e0d\u540c\u7684 DOM \u8282\u70b9\u7684\u521b\u5efa\u3001\u5904\u7406\u903b\u8f91\u3002"),(0,o.kt)("p",null,"completeWork \u5185\u90e8\u6709 3 \u4e2a\u5173\u952e\u52a8\u4f5c\uff1a"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"\u521b\u5efa DOM \u8282\u70b9\uff08CreateInstance\uff09"),(0,o.kt)("li",{parentName:"ul"},"\u5c06 DOM \u8282\u70b9\u63d2\u5165\u5230 DOM \u6811\u4e2d\uff08AppendAllChildren\uff09"),(0,o.kt)("li",{parentName:"ul"},"\u4e3a DOM \u8282\u70b9\u8bbe\u7f6e\u5c5e\u6027\uff08FinalizeInitialChildren\uff09")),(0,o.kt)("p",null,'\u5f53\u67d0\u4e2a Fiber \u8282\u70b9\u6267\u884c\u5b8ccompleteWork\uff0c\u5982\u679c\u5176\u5b58\u5728\u5144\u5f1f Fiber \u8282\u70b9\uff08\u5373fiber.sibling !== null\uff09\uff0c\u4f1a\u8fdb\u5165\u5176\u5144\u5f1f Fiber \u7684"\u9012"\u9636\u6bb5\u3002'),(0,o.kt)("p",null,'\u5982\u679c\u4e0d\u5b58\u5728\u5144\u5f1f Fiber\uff0c\u4f1a\u8fdb\u5165\u7236\u7ea7 Fiber \u7684"\u5f52"\u9636\u6bb5\u3002'),(0,o.kt)("p",null,'"\u9012"\u548c"\u5f52"\u9636\u6bb5\u4f1a\u4ea4\u9519\u6267\u884c\u76f4\u5230"\u5f52"\u5230 rootFiber\u3002\u81f3\u6b64\uff0c\u534f\u8c03\u9636\u6bb5\u7684\u5de5\u4f5c\u5c31\u7ed3\u675f\u4e86\u3002'),(0,o.kt)("h1",{id:"\u66f4\u65b0\u9636\u6bb5"},"\u66f4\u65b0\u9636\u6bb5"),(0,o.kt)("p",null,"\u4f1a\u6839\u636e\u65b0\u7684\u72b6\u6001\u5f62\u6210\u7684jsx\uff08ClassComponent\u7684render\u6216\u8005FuncComponent\u7684\u8fd4\u56de\u503c\uff09\u548ccurrent Fiber\u5bf9\u6bd4\u5f62\uff08diff\u7b97\u6cd5\uff09\u6784\u5efa",(0,o.kt)("strong",{parentName:"p"},"workInProgress\u7684Fiber\u6811")),(0,o.kt)("p",null,"\u7136\u540e\u5c06fiberRoot\u7684current\u6307\u5411workInProgress\u6811\uff0c\u6b64\u65f6workInProgress\u5c31\u53d8\u6210\u4e86current Fiber\u3002"),(0,o.kt)("p",null,"\u5728update\u7684\u65f6\u5019\uff0crender\u9636\u6bb5\u4f1a\u6839\u636e\u6700\u65b0\u7684jsx\u548c\u8001\u7684Fiber\u8fdb\u884c\u5bf9\u6bd4\uff0c\u751f\u6210\u65b0\u7684Fiber\u3002\n\u8fd9\u4e9bFiber\u4f1a\u5e26\u6709\u5404\u79cd\u526f\u4f5c\u7528\uff0c\u6bd4\u5982\u2018Deletion\u2019\u3001\u2018Update\u2019\u3001\u2018Placement\u2019\u7b49\uff0c\u8fd9\u4e00\u4e2a\u5bf9\u6bd4\u7684\u8fc7\u7a0b\u5c31\u662fdiff\u7b97\u6cd5 \uff0c\u5728commit\u9636\u6bb5\u4f1a\u64cd\u4f5c\u771f\u5b9e\u8282\u70b9\uff0c\u6267\u884c\u76f8\u5e94\u7684\u526f\u4f5c\u7528\u3002"),(0,o.kt)("p",null,"diff \u2f50\u8f83\u7684\u662f\u4ec0\u4e48\uff1f \u2f50\u8f83\u7684\u662f current fiber \u548c vdom\uff0c\u2f50\u8f83\u4e4b\u540e\u2f63\u6210 workInprogress Fiber"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"render\u9636\u6bb5\u4f1a\u6839\u636e\u6700\u65b0\u7684jsx\u751f\u6210\u7684\u865a\u62dfdom\u548ccurrent Fiber\u6811\u8fdb\u884c\u5bf9\u6bd4\uff0c\u6bd4\u8f83\u4e4b\u540e\u751f\u6210workinProgress Fiber(workinProgress Fiber\u6811\u7684alternate\u6307\u5411Current Fiber\u6811\u7684\u5bf9\u5e94\u8282\u70b9\uff0c\u8fd9\u4e9bFiber\u4f1a\u5e26\u6709\u5404\u79cd\u526f\u4f5c\u7528\uff0c\u6bd4\u5982\u2018Deletion\u2019\u3001\u2018Update\u2019\u3001'Placement\u2019\u7b49)\u8fd9\u4e00\u5bf9\u6bd4\u8fc7\u7a0b\u5c31\u662fdiff\u7b97\u6cd5\n")),(0,o.kt)("p",null,"\u5f53workinProgress Fiber\u6811\u6784\u5efa\u5b8c\u6210\uff0cworkInprogress \u5219\u6210\u4e3a\u4e86curent Fiber\u6e32\u67d3\u5230\u9875\u9762\u4e0a"),(0,o.kt)("h2",{id:"render\u9636\u6bb5\u4e4bupdate\u65f6-fiber-\u53cc\u7f13\u5b58-\u548c-diffbeginwork\u4e0ecompletework\u7684\u4e0d\u540c"},"render\u9636\u6bb5\u4e4bupdate\u65f6: fiber \u53cc\u7f13\u5b58 \u548c diff\uff1bbeginWork\u4e0ecompleteWork\u7684\u4e0d\u540c"),(0,o.kt)("p",null,"\u5728update diff \u6bd4\u8f83\u65f6\uff1a \u5c31\u662f\u5728\u6784\u5efa workInProgress fiber tree \u7684\u8fc7\u7a0b\u4e2d\uff0c\u4f1a\u6839\u636e\u65b0\u7684\u72b6\u6001\u5f62\u6210\u7684jsx\uff08ClassComponent\u7684render\u6216\u8005FuncComponent\u7684\u8fd4\u56de\u503c\uff09\u548ccurrent Fiber\u5bf9\u6bd4\u5f62\uff08diff\u7b97\u6cd5\uff09\u6784\u5efa",(0,o.kt)("strong",{parentName:"p"},"workInProgress\u7684Fiber\u6811"),"\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"\u5224\u65ad current fiber tree \u4e2d\u7684 fiber node \u662f\u5426\u53ef\u4ee5\u88ab workInProgress fiber tree \u590d\u7528\u3002\n\n\u80fd\u88ab\u590d\u7528\uff0c\u610f\u5473\u5728\u672c\u6b21\u66f4\u65b0\u4e2d\uff0c\u9700\u8981\u505a:\n\u7ec4\u4ef6\u7684 update \u4ee5\u53ca dom \u8282\u70b9\u7684 move\u3001update \u7b49\u64cd\u4f5c\uff1b\n\n\u4e0d\u53ef\u590d\u7528\uff0c\u5219\u610f\u5473\u7740\u9700\u8981\u505a:\n\u7ec4\u4ef6\u7684 mount\u3001unmount \u4ee5\u53ca dom \u8282\u70b9\u7684 insert\u3001delete \u7b49\u64cd\u4f5c\u3002\n")),(0,o.kt)("p",null,"\u5f53\u66f4\u65b0\u5b8c\u6210\u4ee5\u540e\uff0cfiberRootNode \u7684 current \u6307\u9488\u4f1a\u6307\u5411 workInProgress fiber tree\uff0c\u4f5c\u4e3a\u4e0b\u4e00\u6b21\u66f4\u65b0\u7684 current fiber tree"),(0,o.kt)("p",null,"\u5f53 update \u65f6\uff0cFiber \u8282\u70b9\u5df2\u7ecf\u5b58\u5728\u5bf9\u5e94 DOM \u8282\u70b9\uff0c\u6240\u4ee5\u4e0d\u9700\u8981\u751f\u6210 DOM \u8282\u70b9\u3002\u9700\u8981\u505a\u7684\u4e3b\u8981\u662f\u5904\u7406 props\uff0c\u6bd4\u5982\uff1a"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"onClick\u3001onChange \u7b49\u56de\u8c03\u51fd\u6570\u7684\u6ce8\u518c\uff1b"),(0,o.kt)("li",{parentName:"ul"},"\u5904\u7406style prop\uff1b"),(0,o.kt)("li",{parentName:"ul"},"\u5904\u7406DANGEROUSLY_SET_INNER_HTML prop\uff1b"),(0,o.kt)("li",{parentName:"ul"},"\u5904\u7406children prop\u3002")),(0,o.kt)("p",null,"\u6211\u4eec\u53bb\u6389\u4e00\u4e9b\u5f53\u524d\u4e0d\u9700\u8981\u5173\u6ce8\u7684\u529f\u80fd\uff08\u6bd4\u5982 ref\uff09\u3002\u53ef\u4ee5\u770b\u5230\u6700\u4e3b\u8981\u7684\u903b\u8f91\u662f\u8c03\u7528 updateHostComponent \u65b9\u6cd5\u3002\u4f60\u53ef\u4ee5\u4ece\u8fd9\u91cc\u770b\u5230updateHostComponent \u65b9\u6cd5\u5b9a\u4e49\u3002"),(0,o.kt)("p",null,"\u5728 updateHostComponent \u5185\u90e8\uff0c\u88ab\u5904\u7406\u5b8c\u7684 props \u4f1a\u88ab\u8d4b\u503c\u7ed9 workInProgress.updateQueue\uff0c\u5e76\u6700\u7ec8\u4f1a\u5728 commit \u9636\u6bb5\u88ab\u6e32\u67d3\u5728\u9875\u9762\u4e0a\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"workInProgress.updateQueue = (updatePayload: any);\n")),(0,o.kt)("p",null,"\u5176\u4e2dupdatePayload\u4e3a\u6570\u7ec4\u5f62\u5f0f\uff0c\u4ed6\u7684\u5947\u6570\u7d22\u5f15\u7684\u503c\u4e3a\u53d8\u5316\u7684 prop key\uff0c\u5076\u6570\u7d22\u5f15\u7684\u503c\u4e3a\u53d8\u5316\u7684 prop value\u3002"),(0,o.kt)("h3",{id:"render\u9636\u6bb5\u4e4bupdate\u65f6\u4e24\u4e2a\u51fd\u6570\u5bf9\u6bd4"},"render\u9636\u6bb5\u4e4bupdate\u65f6\u4e24\u4e2a\u51fd\u6570\u5bf9\u6bd4"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"function beginWork(current, workInProgress, renderLanes) {\n  // mount current !== null \u4e3anull,\u4e0d\u8d70\u4ee5\u4e0b\u903b\u8f91\n  if (current !== null) {\n    console.log('%c=beginWork()===start1-\u66f4\u65b0', 'color:magenta', { getFiberName: getFiberName(workInProgress), current, renderLanes, workInProgress })\n    // \u901a\u8fc7\u4e00\u7cfb\u5217\u5224\u65ad\u903b\u8f91\u5224\u65ad\u5f53\u524d\u8282\u70b9\u662f\u5426\u53ef\u590d\u7528\uff0c\u7528didReceiveUpdate\u6765\u6807\u8bb0\uff0c\n  }{\n  console.log('%c=beginWork()===start1-\u521d\u59cb\u5316', 'color:magenta', { getFiberName: getFiberName(workInProgress), current, renderLanes, workInProgress })\n  workInProgress.lanes = NoLanes;\n\n  switch (workInProgress.tag) {\n    case IndeterminateComponent: \n      // ...\u7701\u7565\n    case LazyComponent: \n      // ...\u7701\u7565\n    case FunctionComponent: \n      // ...\u7701\u7565\n    case ClassComponent: \n      // ...\u7701\u7565\n    case HostRoot:\n      // ...\u7701\u7565\n    case HostComponent:\n      console.log(`%c=beginWork()=end 7 updateHostComponent$1,\u5373\u539f\u751f DOM \u7ec4\u4ef6\u5bf9\u5e94\u7684 Fiber\u8282\u70b9:`, 'color:magenta', { type: workInProgress.type })\n      return updateHostComponent$1(current, workInProgress, renderLanes);\n    case HostText:\n  }\n  }\n}\n\nfunction completeWork(current, workInProgress, renderLanes) {\n  const newProps = workInProgress.pendingProps;\n\n  switch (workInProgress.tag) {\n    case IndeterminateComponent:\n    case LazyComponent:\n    case SimpleMemoComponent:\n    case FunctionComponent:\n    case ForwardRef:\n    case Fragment:\n    case Mode:\n    case Profiler:\n    case ContextConsumer:\n    case MemoComponent:\n      return null;\n    case ClassComponent: {\n      // ...\u7701\u7565\n      return null;\n    }\n    case HostRoot: {\n      // ...\u7701\u7565\n      updateHostContainer(workInProgress);\n      return null;\n    }\n    case HostComponent:\n        {\n          popHostContext(workInProgress);\n          var rootContainerInstance = getRootHostContainer();\n          var type = workInProgress.type;\n\n          if (current !== null && workInProgress.stateNode != null) {\n            console.log(`%c=completeWork->\u66f4\u65b0\u6d41\u7a0bHostComponent\u8c03\u7528updateHostComponent`, 'color:chartreuse')\n            updateHostComponent(current, workInProgress, type, newProps, rootContainerInstance);\n\n            if (current.ref !== workInProgress.ref) {\n              markRef(workInProgress);\n            }\n          } else {\n            if (!newProps) {\n              if (workInProgress.stateNode === null) {\n                throw new Error('We must have new props for new mounts. This error is likely ' + 'caused by a bug in React. Please file an issue.');\n              } // This can happen when we abort work.\n\n\n              bubbleProperties(workInProgress);\n              return null;\n            }\n\n            var currentHostContext = getHostContext(); // TODO: Move createInstance to beginWork and keep it on a context\n            // \"stack\" as the parent. Then append children as we go in beginWork\n            // or completeWork depending on whether we want to add them top->down or\n            // bottom->up. Top->down is faster in IE11.\n\n            var _wasHydrated = popHydrationState(workInProgress);\n\n            if (_wasHydrated) {\n              // TODO: Move this and createInstance step into the beginPhase\n              // to consolidate.\n              if (prepareToHydrateHostInstance(workInProgress, rootContainerInstance, currentHostContext)) {\n                // If changes to the hydrated node need to be applied at the\n                // commit-phase we mark this as such.\n                markUpdate(workInProgress);\n              }\n            } else {\n              // \u4e3a\u5f53\u524dfiber\u521b\u5efadom\u5b9e\u4f8b\n              console.log('%c=beginWork->HostComponent\u521d\u59cb\u5316\u6d41\u7a0b\u8c03\u7528createInstance\u4e3a\u5f53\u524dfiber\u521b\u5efadom\u5b9e\u4f8b==>start', 'color:chartreuse')\n              var instance = createInstance(type, newProps, rootContainerInstance, currentHostContext, workInProgress);\n              // \u5c06\u5b50\u5b59dom\u8282\u70b9\u8ffd\u52a0\u5230\u5f53\u524d\u521b\u5efa\u7684dom\u8282\u70b9\u4e0a\n              console.log('%c=beginWork->HostComponent\u521d\u59cb\u5316\u6d41\u7a0b-\u5c06\u5b50\u5b59dom\u8282\u70b9\u8ffd\u52a0\u5230\u5f53\u524d\u521b\u5efa\u7684dom\u8282\u70b9\u4e0a', 'color:green', { instance })\n              appendAllChildren(instance, workInProgress, false, false);\n              // \u5c06\u5f53\u524d\u521b\u5efa\u7684\u6302\u8f7d\u5230stateNode\u5c5e\u6027\u4e0a\n              workInProgress.stateNode = instance; // Certain renderers require commit-time effects for initial mount.\n              console.log('%c=beginWork->HostComponent\u521d\u59cb\u5316\u6d41\u7a0b\u5c06\u5f53\u524d\u521b\u5efa\u7684\u6302\u8f7d\u5230workInProgress.stateNode:', 'color:green', { workInProgress_stateNode: workInProgress.stateNode });\n              // (eg DOM renderer supports auto-focus for certain elements).\n              // Make sure such renderers get scheduled for later work.\n              // \u5904\u7406props\uff08\u7ed1\u5b9a\u56de\u8c03\uff0c\u8bbe\u7f6edom\u5c5e\u6027...\uff09\n              if (finalizeInitialChildren(instance, type, newProps, rootContainerInstance)) {\n                markUpdate(workInProgress);\n              }\n            }\n            // ref\u5c5e\u6027\u76f8\u5173\u903b\u8f91\n            if (workInProgress.ref !== null) {\n              // If there is a ref on a host node we need to schedule a callback\n              markRef(workInProgress);\n            }\n          }\n\n          bubbleProperties(workInProgress);\n          return null;\n        }\n}\n")),(0,o.kt)("p",null,"update\u6d41\u7a0b\u6211\u4eec\u53ea\u9700\u6293\u4f4f\u4e0emount\u7684\u4e0d\u540c\uff1acurrent\u4e0d\u4e3anull\uff0c\u7531\u4e8e\u4e8c\u8005\u7684\u4e0d\u540c\u4e3b\u8981\u4f53\u73b0\u5728render\u9636\u6bb5\uff0c\u56e0\u4e3a\u6211\u4eec\u5206\u522b\u5206\u6790beginWork\u4e0ecompleteWork\u7684\u4e0d\u540c\u3002"),(0,o.kt)("h3",{id:"update\u6d41\u7a0b\u4e4bbeginwork-current\u4e0d\u4e3anull\u7684\u903b\u8f91"},"update\u6d41\u7a0b\u4e4bbeginWork current\u4e0d\u4e3anull\u7684\u903b\u8f91\uff1a"),(0,o.kt)("p",null,"\u901a\u8fc7\u4e00\u7cfb\u5217\u5224\u65ad\u903b\u8f91\u5224\u65ad\u5f53\u524d\u8282\u70b9\u662f\u5426\u53ef\u590d\u7528\uff0c\u7528didReceiveUpdate\u6765\u6807\u8bb0\uff0c\n\u82e5\u53ef\u590d\u7528\u5219\u8d70attemptEarlyBailoutIfNoScheduledUpdate\u3002\u8c03\u7528\u6808\u5982\u4e0b:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"\u987e\u540d\u601d\u4e49\uff0c\u4f1a\u76f4\u63a5\u514b\u9686\u4e00\u4e2afiber\u8282\u70b9\u5e76\u8fd4\u56de\u3002\nattemptEarlyBailoutIfNoScheduledUpdate =>bailoutOnAlreadyFinishedWork=>cloneChildFibers\n")),(0,o.kt)("h3",{id:"update\u6d41\u7a0b\u4e4bbeginwork\u7b2c\u4e8c\u9636\u6bb5"},"update\u6d41\u7a0b\u4e4bbeginWork\u7b2c\u4e8c\u9636\u6bb5"),(0,o.kt)("p",null,"beginWork\u7b2c\u4e8c\u9636\u6bb5\u7684\u903b\u8f91\u662fmount\u4e0eupdate\u5171\u7528\u7684\uff0c\u5f53\u8282\u70b9\u65e0\u6cd5\u590d\u7528\u65f6\u4f1a\u8c03\u7528 reconcileChildren \u751f\u6210\u5b50\u8282\u70b9\uff0c\n\u5176\u5185\u90e8\u4f1a\u6839\u636ecurrent\u662f\u5426\u5b58\u5728\u8fdb\u5165 mountChildFibers\uff08current\u4e3anull\uff09\u6216 reconcileChildFibers\uff08current\u4e0d\u4e3anull\uff09\uff0c"),(0,o.kt)("p",null,"\u6211\u4eec\u5df2\u7ecf\u77e5\u9053\u8fd9\u4e24\u8005\u7684\u903b\u8f91\u57fa\u672c\u662f\u76f8\u540c\u7684\uff0c\u53ea\u662f reconcileChildFibers \u4f1a\u4e3a\u5f53\u524dfiber\u6253\u4e0a flags\uff0c\u5b83\u4ee3\u8868\u5f53\u524ddom\u9700\u8981\u6267\u884c\u7684\u64cd\u4f5c\uff08\u63d2\u5165\uff0c\u66f4\u65b0\uff0c\u5220\u9664\u7b49\uff09\uff0c"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"function placeSingleChild(newFiber: Fiber): Fiber {\n   // shouldTrackSideEffects\u4ee3\u8868\u9700\u8981\u8ffd\u8e2a\u526f\u4f5c\u7528\uff0cupdate\u65f6\u4f1a\u5c06\u5176\u6807\u8bb0\u4e3atrue\n   // \u5f53\u524dfiber\u4e0d\u5b58\u5728dom\u5b9e\u4f8b\u65f6\uff0c\u624d\u53ef\u6807\u8bb0Placement\n    if (shouldTrackSideEffects && newFiber.alternate === null) {\n      newFiber.flags |= Placement;\n    }\n    return newFiber;\n  }\n")),(0,o.kt)("p",null,"\u53e6\u5916\uff0c\u7531\u4e8emount\u65f6current\u4e0d\u5b58\u5728\uff0c\u56e0\u6b64reconcileChildFibers\u4e0d\u4f1a\u6709\u5bf9\u6bd4\u66f4\u65b0\u7684\u903b\u8f91\uff0c\u76f4\u63a5\u521b\u5efa\u8282\u70b9\uff0c\u800cupdate\u65f6\u5219\u4f1a\u5c06current\u4e0e\u5f53\u524d\u7684ReactElement\n\u505a\u5bf9\u6bd4\u751f\u6210WIP\uff0c\u4e5f\u5c31\u662fdiff\u7b97\u6cd5\uff0c\u5177\u4f53\u5b9e\u73b0\u7ec6\u8282\u8fd9\u91cc\u4e0d\u5c55\u5f00"),(0,o.kt)("h3",{id:"update\u6d41\u7a0b\u4e4bcompletework--updatehostcomponent"},"update\u6d41\u7a0b\u4e4bcompleteWork--\x3eupdateHostComponent"),(0,o.kt)("p",null,"updateHostComponent \u7528\u4e8e\u66f4\u65b0DOM\u8282\u70b9\u7684\u5c5e\u6027\u5e76\u5728\u5f53\u524d\u8282\u70b9\u5b58\u5728\u66f4\u65b0\u5c5e\u6027\uff0c\u6536\u96c6Update effectTag\u3002"),(0,o.kt)("p",null,"\u6839\u636e\u9700\u4ee3\u7801\uff1a\n\u8981\u53d8\u5316\u7684prop\u4f1a\u88ab\u5b58\u50a8\u5230updatePayload \u4e2d\uff0cupdatePayload \u4e3a\u4e00\u4e2a\u5076\u6570\u7d22\u5f15\u7684\u503c\u4e3a\u53d8\u5316\u7684prop key\uff0c\u5947\u6570\u7d22\u5f15\u7684\u503c\u4e3a\u53d8\u5316\u7684prop value\u7684\u6570\u7ec4\u3002\n\u5e76\u6700\u7ec8\u6302\u8f7d\u5230\u6302\u8f7d\u5230workInProgress.updateQueue\u4e0a\uff0c\u4f9b\u540e\u7eedcommit\u9636\u6bb5\u4f7f\u7528\u3002"),(0,o.kt)("p",null,"\u6211\u4eec\u5df2\u7ecf\u77e5\u9053\uff0cmount\u65f6completeWork\u4f1a\u76f4\u63a5\u521b\u5efadom\u5b9e\u4f8b\uff0c\u800cupdate\u4f1a\u8c03\u7528updateHostComponent\uff0c\u6211\u4eec\u6765\u5206\u6790\u5176\u5b9e\u73b0\u903b\u8f91:"),(0,o.kt)("p",null,"\u5728\u65b0\u65e7props\u4e0d\u540c\u65f6\u8c03\u7528prepareUpdate\uff0c\u4ed6\u4f1a\u5bf9\u6bd4\u65b0\u65e7props\u5e76\u751f\u6210updatePayload\uff0c\u5176\u8c03\u7528\u6808\u5982\u4e0b:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"prepareUpdate--\x3ediffProperties\n")),(0,o.kt)("p",null,"diffProperties\u5185\u90e8\u4e3b\u903b\u8f91\u662f\u5bf9props\u8fdb\u884c\u4e24\u8f6e\u5faa\u73af\uff0c\u5206\u522b\u5904\u7406\u5c5e\u6027\u5220\u9664\u4e0e\u5c5e\u6027\u65b0\u589e\u7684\u60c5\u51b5\uff0c\u6700\u7ec8\u8fd4\u56deupdatePayload\uff0c\u8fd9\u662f\u4e00\u4e2a\u6570\u7ec4\uff0c\n\u7b2ci\u9879\u548c\u7b2ci+1\u9879\u5206\u522b\u662f\u66f4\u65b0\u540e\u7684\u7684key\u548cvalue\u3002\u4ed6\u4f1a\u5728mutation\u9636\u6bb5\u88ab\u7528\u4e8e\u66f4\u65b0\u8282\u70b9\u5c5e\u6027\u3002\nupdateHostComponent\u7684\u6700\u540e\u8c03\u7528\u8fdb\u884cmarkUpdate\uff0c\u8d4b\u503c\u66f4\u65b0\u7684flags\uff08Update\uff09\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"updateHostComponent = function (current, workInProgress, type, newProps, rootContainerInstance) {\n  // If we have an alternate, that means this is an update and we need to\n  // schedule a side-effect to do the updates.\n  var oldProps = current.memoizedProps;\n  console.log(`%c=updateHostComponent\u66f4\u65b0\u6d41\u7a0b`, 'color:chartreuse')\n\n  if (oldProps === newProps) {\n    // In mutation mode, this is sufficient for a bailout because\n    // we won't touch this node even if children changed.\n    return;\n  } // If we get updated because one of our children updated, we don't\n  // have newProps so we'll have to reuse them.\n  // TODO: Split the update API as separate for the props vs. children.\n  // Even better would be if children weren't special cased at all tho.\n\n\n  var instance = workInProgress.stateNode;\n  var currentHostContext = getHostContext(); // TODO: Experiencing an error where oldProps is null. Suggests a host\n  // component is hitting the resume path. Figure out why. Possibly\n  // related to `hidden`.\n\n  // \u5bf9\u6bd4props\u751f\u6210updatePayload\n  var updatePayload = prepareUpdate(instance, type, oldProps, newProps, rootContainerInstance, currentHostContext); // TODO: Type this specific to this type of component.\n\n  workInProgress.updateQueue = updatePayload; // If the update payload indicates that there is a change or if there\n  // is a new ref we mark this as an update. All the work is done in commitWork.\n\n  if (updatePayload) {\n    markUpdate(workInProgress);\n  }\n};\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"function diffProperties(\n  domElement: Element,\n  tag: string,\n  lastRawProps: Object,\n  nextRawProps: Object,\n  rootContainerElement: Element | Document,\n): null | Array<mixed> {\n  let updatePayload: null | Array<any> = null;\n  let lastProps: Object;\n  let nextProps: Object;\n  //\u5904\u7406\u65b0\u65e7props \u9488\u5bf9\u8868\u5355\u6807\u7b7e\u505a\u7279\u6b8a\u5904\u7406\n  switch (tag) {\n    case 'input':\n      lastProps = ReactDOMInputGetHostProps(domElement, lastRawProps);\n      nextProps = ReactDOMInputGetHostProps(domElement, nextRawProps);\n      updatePayload = [];\n      break;\n    case 'select':\n      lastProps = ReactDOMSelectGetHostProps(domElement, lastRawProps);\n      nextProps = ReactDOMSelectGetHostProps(domElement, nextRawProps);\n      updatePayload = [];\n      break;\n    case 'textarea':\n      lastProps = ReactDOMTextareaGetHostProps(domElement, lastRawProps);\n      nextProps = ReactDOMTextareaGetHostProps(domElement, nextRawProps);\n      updatePayload = [];\n      break;\n    default:\n      lastProps = lastRawProps;\n      nextProps = nextRawProps;\n      if (\n        typeof lastProps.onClick !== 'function' &&\n        typeof nextProps.onClick === 'function'\n      ) {\n        // TODO: This cast may not be sound for SVG, MathML or custom elements.\n        trapClickOnNonInteractiveElement(((domElement: any): HTMLElement));\n      }\n      break;\n  }\n\n  assertValidProps(tag, nextProps);\n\n  let propKey;\n  let styleName;\n  let styleUpdates = null;\n  for (propKey in lastProps) {\n    if (\n      nextProps.hasOwnProperty(propKey) ||\n      !lastProps.hasOwnProperty(propKey) ||\n      lastProps[propKey] == null\n    ) {\n      continue;\n    }\n    // \u65b0\u65e0\u65e7\u6709\u65f6\u8fdb\u5165\u4e00\u4e0b\u903b\u8f91\uff0c\u5373\u5c5e\u6027\u88ab\u5220\u9664\n    if (propKey === STYLE) {\n      const lastStyle = lastProps[propKey];\n      // \u5c06\u5bf9\u5e94style\u5c5e\u6027\u7f6e\u7a7a\n      for (styleName in lastStyle) {\n        if (lastStyle.hasOwnProperty(styleName)) {\n          if (!styleUpdates) {\n            styleUpdates = {};\n          }\n          styleUpdates[styleName] = '';\n        }\n      }\n    } else {\n      // \u5c06\u5bf9\u5e94key\u53cavalue\uff08null\uff09\u63a8\u5165\u66f4\u65b0\u961f\u5217\uff0c\n      (updatePayload = updatePayload || []).push(propKey, null);\n    }\n  }\n  for (propKey in nextProps) {\n    const nextProp = nextProps[propKey];\n    const lastProp = lastProps != null ? lastProps[propKey] : undefined;\n    if (\n      !nextProps.hasOwnProperty(propKey) ||\n      nextProp === lastProp ||\n      (nextProp == null && lastProp == null)\n    ) {\n      continue;\n    }\n    // \u65b0\u6709\u65e7\u65e0\u6216\u65b0\u65e7\u90fd\u6709\u5207\u4e0d\u76f8\u7b49\u65f6\u8fdb\u5165\u4ee5\u4e0b\u903b\u8f91\n\n    // style\u5c5e\u6027\u7279\u6b8a\u5904\u7406 \u603b\u7ed3\u5982\u4e0b\n    // \u65b0\u6709\u65e7\u65e0 \u63a8\u5165style\u961f\u5217\n    // \u65b0\u65e7\u90fd\u6709 \u7528\u65b0\u7684\n    // \u65b0\u65e0\u65e7\u6709 \u5c06\u5bf9\u5e94\u5c5e\u6027\u7f6e\u7a7a\n    if (propKey === STYLE) {\n      if (lastProp) {\n        for (styleName in lastProp) {\n          if (\n            lastProp.hasOwnProperty(styleName) &&\n            (!nextProp || !nextProp.hasOwnProperty(styleName))\n          ) {\n            if (!styleUpdates) {\n              styleUpdates = {};\n            }\n            styleUpdates[styleName] = '';\n          }\n        }\n        for (styleName in nextProp) {\n          if (\n            nextProp.hasOwnProperty(styleName) &&\n            lastProp[styleName] !== nextProp[styleName]\n          ) {\n            if (!styleUpdates) {\n              styleUpdates = {};\n            }\n            styleUpdates[styleName] = nextProp[styleName];\n          }\n        }\n      } else {\n        if (!styleUpdates) {\n          if (!updatePayload) {\n            updatePayload = [];\n          }\n          updatePayload.push(propKey, styleUpdates);\n        }\n        styleUpdates = nextProp;\n      }\n    } else {\n      // \u5c06\u5bf9\u5e94key\u53cavalue\u63a8\u5165\u66f4\u65b0\u961f\u5217\n      (updatePayload = updatePayload || []).push(propKey, nextProp);\n    }\n  }\n  if (styleUpdates) {\n    (updatePayload = updatePayload || []).push(STYLE, styleUpdates);\n  }\n  return updatePayload;\n}\n")),(0,o.kt)("h3",{id:"update\u6d41\u7a0b\u4e4bcompletework\u8fd9\u4e2atag\u6807\u8bc6\u6709\u4ec0\u4e48\u7528\u5462"},"update\u6d41\u7a0b\u4e4bcompleteWork:\u8fd9\u4e2atag\u6807\u8bc6\u6709\u4ec0\u4e48\u7528\u5462"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"render\u9636\u6bb5\u7ec4\u4ef6\u66f4\u65b0\u4f1a\u6839\u636echeckHasForceUpdateAfterProcessing\uff0c\u548ccheckShouldComponentUpdate\u6765\u5224\u65ad\uff0c\n\n\u5982\u679cUpdate\u7684tag\u662fForceUpdate\uff0c\u5219 checkHasForceUpdateAfterProcessing \u4e3atrue\uff0c\u5f53\u7ec4\u4ef6\u662fPureComponent\u65f6;  checkShouldComponentUpdate \u4f1a\u6d45\u6bd4\u8f83state\u548cprops\uff0c\u6240\u4ee5\u5f53\u4f7f\u7528this.forceUpdate\u4e00\u5b9a\u4f1a\u66f4\u65b0.\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"function resumeMountClassInstance(workInProgress, ctor, newProps, renderLanes) {\n  var instance = workInProgress.stateNode;\n  var oldProps = workInProgress.memoizedProps;\n  instance.props = oldProps;\n  var oldContext = instance.context;\n  var contextType = ctor.contextType;\n  var nextContext = emptyContextObject;\n    ...\n  var shouldUpdate = checkHasForceUpdateAfterProcessing() || checkShouldComponentUpdate(workInProgress, ctor, oldProps, newProps, oldState, newState, nextContext);\n  if (shouldUpdate) {\n    // In order to support react-lifecycles-compat polyfilled components,\n    // Unsafe lifecycles should not be invoked for components using the new APIs.\n    if (!hasNewLifecycles && (typeof instance.UNSAFE_componentWillMount === 'function' || typeof instance.componentWillMount === 'function')) {\n      if (typeof instance.componentWillMount === 'function') {\n        instance.componentWillMount();\n      }\n\n      if (typeof instance.UNSAFE_componentWillMount === 'function') {\n        instance.UNSAFE_componentWillMount();\n      }\n    }\n\n    if (typeof instance.componentDidMount === 'function') {\n      workInProgress.flags |= Update;\n    }\n  } else {\n    // If an update was already in progress, we should schedule an Update\n    // effect even though we're bailing out, so that cWU/cDU are called.\n    if (typeof instance.componentDidMount === 'function') {\n      workInProgress.flags |= Update;\n    } // If shouldComponentUpdate returned false, we should still update the\n    // memoized state to indicate that this work can be reused.\n\n\n    workInProgress.memoizedProps = newProps;\n    workInProgress.memoizedState = newState;\n  } // Update the existing instance's state, props, and context pointers even\n}\n")),(0,o.kt)("h2",{id:"\u6269\u5c55usestate-\u66f4\u65b0"},"\u6269\u5c55\uff1auseState \u66f4\u65b0"),(0,o.kt)("p",null,"\u5728react\u4e2d\u89e6\u53d1\u72b6\u6001\u66f4\u65b0\u7684\u51e0\u79cd\u65b9\u5f0f\uff1a"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"ReactDOM.render")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"this.forceUpdate")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"useState")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"useReducer"))),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"react \u5408\u6210\u4e8b\u4ef6\u4e2d\u6539\u53d8\u72b6\u6001\u662f\u5f02\u6b65\u7684\uff0c\u51fa\u4e8e\u51cf\u5c11 render \u6b21\u6570\uff0creact \u4f1a\u6536\u96c6\u6240\u6709\u72b6\u6001\u53d8\u66f4\uff0c\u7136\u540e\u6bd4\u5bf9\u4f18\u5316\uff0c\u6700\u540e\u505a\u4e00\u6b21\u53d8\u66f4\n")),(0,o.kt)("h2",{id:"effectlist-1"},"effectList"),(0,o.kt)("p",null,"\u81f3\u6b64render \u9636\u6bb5\u7684\u7edd\u5927\u90e8\u5206\u5de5\u4f5c\u5c31\u5b8c\u6210\u4e86"),(0,o.kt)("p",null,"\u8fd8\u6709\u4e00\u4e2a\u95ee\u9898\uff1a\u4f5c\u4e3a DOM \u64cd\u4f5c\u7684\u4f9d\u636e\uff0ccommit \u9636\u6bb5\u9700\u8981\u627e\u5230\u6240\u6709\u6709 effectTag \u7684 Fiber \u8282\u70b9\u5e76\u4f9d\u6b21\u6267\u884c effectTag \u5bf9\u5e94\u64cd\u4f5c\u3002\u96be\u9053\u9700\u8981\u5728commit \u9636\u6bb5\u518d\u904d\u5386\u4e00\u6b21 Fiber \u6811\u5bfb\u627e effectTag !== null\u7684Fiber \u8282\u70b9\u4e48\uff1f"),(0,o.kt)("p",null,"\u8fd9\u663e\u7136\u662f\u5f88\u4f4e\u6548\u7684\u3002"),(0,o.kt)("p",null,"\u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0c\u5728 completeWork \u7684\u4e0a\u5c42\u51fd\u6570 completeUnitOfWork \u4e2d\uff0c\u6bcf\u4e2a\u6267\u884c\u5b8c completeWork \u4e14\u5b58\u5728 effectTag \u7684 Fiber \u8282\u70b9\u4f1a\u88ab\u4fdd\u5b58\u5728\u4e00\u6761\u88ab\u79f0\u4e3aeffectList\u7684\u5355\u5411\u94fe\u8868\u4e2d\u3002"),(0,o.kt)("p",null,"effectList \u4e2d\u7b2c\u4e00\u4e2a Fiber \u8282\u70b9\u4fdd\u5b58\u5728 fiber.firstEffect \uff0c\u6700\u540e\u4e00\u4e2a\u5143\u7d20\u4fdd\u5b58\u5728 fiber.lastEffect\u3002"),(0,o.kt)("p",null,"\u7c7b\u4f3c appendAllChildren\uff0c\u5728\u201c\u5f52\u201d\u9636\u6bb5\uff0c\u6240\u6709\u6709 effectTag \u7684 Fiber \u8282\u70b9\u90fd\u4f1a\u88ab\u8ffd\u52a0\u5728 effectList \u4e2d\uff0c\u6700\u7ec8\u5f62\u6210\u4e00\u6761\u4ee5rootFiber.firstEffect \u4e3a\u8d77\u70b9\u7684\u5355\u5411\u94fe\u8868\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"                       nextEffect         nextEffect\nrootFiber.firstEffect -----------\x3e fiber -----------\x3e fiber\n")),(0,o.kt)("p",null,"\u8fd9\u6837\uff0c\u5728commit \u9636\u6bb5\u53ea\u9700\u8981\u904d\u5386 effectList \u5c31\u80fd\u6267\u884c\u6240\u6709 effect \u4e86\u3002"),(0,o.kt)("p",null,"\u4f60\u53ef\u4ee5\u5728\u8fd9\u91cc\u770b\u5230\u8fd9\u6bb5\u4ee3\u7801\u903b\u8f91\u3002"),(0,o.kt)("p",null,"\u501f\u7528 React \u56e2\u961f\u6210\u5458Dan Abramov\u7684\u8bdd\uff1aeffectList \u76f8\u8f83\u4e8e Fiber \u6811\uff0c\u5c31\u50cf\u5723\u8bde\u6811\u4e0a\u6302\u7684\u90a3\u4e00\u4e32\u5f69\u706f\u3002"),(0,o.kt)("h2",{id:"\u6d41\u7a0b\u7ed3\u5c3erender-\u9636\u6bb5\u5168\u90e8\u5de5\u4f5c\u5b8c\u6210"},"\u6d41\u7a0b\u7ed3\u5c3e:render \u9636\u6bb5\u5168\u90e8\u5de5\u4f5c\u5b8c\u6210"),(0,o.kt)("p",null,"\u81f3\u6b64\uff0crender \u9636\u6bb5\u5168\u90e8\u5de5\u4f5c\u5b8c\u6210\u3002\u5728 performSyncWorkOnRoot \u51fd\u6570\u4e2d fiberRootNode \u88ab\u4f20\u9012\u7ed9 commitRoot \u65b9\u6cd5\uff0c\u5f00\u542fcommit \u9636\u6bb5\u5de5\u4f5c\u6d41\u7a0b\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"commitRoot(root);\n")),(0,o.kt)("h3",{id:"\u8fd9\u91cc\u4ee5\u4e00\u4e2a\u7b80\u5355\u7684jsx\u7ed3\u6784\u4e3a\u4f8b"},"\u8fd9\u91cc\u4ee5\u4e00\u4e2a\u7b80\u5355\u7684jsx\u7ed3\u6784\u4e3a\u4f8b\uff1a"),(0,o.kt)("p",null,"beginWork\u4e0ecompleteWork\u8fd9\u4e8c\u8005\u662f\u5982\u4f55\u76f8\u4e92\u914d\u5408\u5171\u540c\u5b8c\u6210fiber\u6811\u7684\u6784\u5efa\u7684\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"return (\n    <>\n      <div>\n        <span>age: 18</span>\n        <p>\n          <span>name: zs</span>\n        </p>\n      </div>\n    </>\n);\n")),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"\u6267\u884cdiv\u7684beginWork\uff0c\u521b\u5efa\u7b2c\u4e00\u4e2aspan1\u5bf9\u5e94\u7684fiber\u8282\u70b9\u4e0ep\u5bf9\u5e94\u7684fiber\u8282\u70b9\uff0c\u540c\u65f6\u4f1a\u5c06span.sibling\u6307\u5411p\uff0c\u4f7f\u5f97span\u6267\u884c\u5b8ccompleteWork\u53ef\u4ee5\u8fdb\u5165p\u7684beginWork\u9636\u6bb5"),(0,o.kt)("li",{parentName:"ol"},"\u6267\u884cspan\u7684beginWork"),(0,o.kt)("li",{parentName:"ol"},"\u6267\u884cspan\u7684completeWork"),(0,o.kt)("li",{parentName:"ol"},"\u6267\u884cp\u7684beginWork"),(0,o.kt)("li",{parentName:"ol"},"\u6267\u884cspan2\u7684completeWork"),(0,o.kt)("li",{parentName:"ol"},"\u6267\u884cspan2\u7684completeWork"),(0,o.kt)("li",{parentName:"ol"},"\u6267\u884cp\u7684completeWork"),(0,o.kt)("li",{parentName:"ol"},"\u6267\u884cdiv\u7684completeWork")),(0,o.kt)("p",null,"\u6700\u7ec8\u4f1a\u5f97\u5230\u8fd9\u6837\u7684\u4e00\u9897Fiber\u6811:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-mermaid"},"flowchart LR\n  App--child--\x3ediv--child--\x3espan\n  \n  div--return--\x3eApp\n\n  p--return--\x3ediv\n  p--child--\x3espan2[span]\n  span2--return--\x3ep\n\n  span--return--\x3ediv\n  span--sibling--\x3ep\n")),(0,o.kt)("p",null,"\u81f3\u6b64\uff0crender\u9636\u6bb5\u5168\u90e8\u5de5\u4f5c\u5df2\u7ecf\u5b8c\u6210\uff0c\u6211\u4eec\u5f97\u5230\u4e86WIP\u4ee5\u53ca\u5bf9\u5e94\u7684dom\u6811\uff0c\u4f1a\u88ab\u8d4b\u503c\u7ed9fiberRoot.finishWork\uff0c\u63a5\u4e0b\u6765\u7684\u5de5\u4f5c\u5c31\u662f\u5c06\u6e32\u67d3WIP\uff0c\u4e5f\u5c31\u662f\u63d0\u4ea4\u9636\u6bb5\uff08commit\uff09\u7684\u6d41\u7a0b\u3002"))}u.isMDXComponent=!0},84182:(e,n,r)=>{r.d(n,{Z:()=>t});const t=r.p+"assets/images/react18-\u51fd\u6570\u8c03\u7528\u68081-42f3ffba1fb000b0e08ecae006d115e6.png"},19767:(e,n,r)=>{r.d(n,{Z:()=>t});const t=r.p+"assets/images/react18-\u51fd\u6570\u8c03\u7528\u68082-7015d72d9ac315e37e89e4d3b703ca60.png"},47707:(e,n,r)=>{r.d(n,{Z:()=>t});const t=r.p+"assets/images/react\u6784\u5efa\u4e09\u4e2a\u9636\u6bb5\u53c2\u8003-27d40456ad9d91ac37f0f096c2661e03.png"},92321:(e,n,r)=>{r.d(n,{Z:()=>t});const t=r.p+"assets/images/\u56fe1-Fiber\u7684\u5de5\u4f5c\u8c03\u5ea6\u4e0e\u6d4f\u89c8\u5668\u4ea4\u4e92-221c1216f1cbd14ddb8ee57928adfacc.png"}}]);