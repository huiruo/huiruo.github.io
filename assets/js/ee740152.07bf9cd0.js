"use strict";(self.webpackChunkprogramming_technology=self.webpackChunkprogramming_technology||[]).push([[7015],{3905:(e,r,n)=>{n.d(r,{Zo:()=>u,kt:()=>g});var t=n(67294);function o(e,r,n){return r in e?Object.defineProperty(e,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[r]=n,e}function i(e,r){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);r&&(t=t.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),n.push.apply(n,t)}return n}function s(e){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?i(Object(n),!0).forEach((function(r){o(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))}))}return e}function l(e,r){if(null==e)return{};var n,t,o=function(e,r){if(null==e)return{};var n,t,o={},i=Object.keys(e);for(t=0;t<i.length;t++)n=i[t],r.indexOf(n)>=0||(o[n]=e[n]);return o}(e,r);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(t=0;t<i.length;t++)n=i[t],r.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var a=t.createContext({}),c=function(e){var r=t.useContext(a),n=r;return e&&(n="function"==typeof e?e(r):s(s({},r),e)),n},u=function(e){var r=c(e.components);return t.createElement(a.Provider,{value:r},e.children)},f="mdxType",p={inlineCode:"code",wrapper:function(e){var r=e.children;return t.createElement(t.Fragment,{},r)}},d=t.forwardRef((function(e,r){var n=e.components,o=e.mdxType,i=e.originalType,a=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),f=c(n),d=o,g=f["".concat(a,".").concat(d)]||f[d]||p[d]||i;return n?t.createElement(g,s(s({ref:r},u),{},{components:n})):t.createElement(g,s({ref:r},u))}));function g(e,r){var n=arguments,o=r&&r.mdxType;if("string"==typeof e||o){var i=n.length,s=new Array(i);s[0]=d;var l={};for(var a in r)hasOwnProperty.call(r,a)&&(l[a]=r[a]);l.originalType=e,l[f]="string"==typeof e?e:o,s[1]=l;for(var c=2;c<i;c++)s[c]=n[c];return t.createElement.apply(null,s)}return t.createElement.apply(null,n)}d.displayName="MDXCreateElement"},58434:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>a,contentTitle:()=>s,default:()=>p,frontMatter:()=>i,metadata:()=>l,toc:()=>c});var t=n(87462),o=(n(67294),n(3905));const i={},s=void 0,l={unversionedId:"React/beginWork\u7b2c3\u6b65-Reconciliation-\u53cc\u7f13\u5b58-diff",id:"React/beginWork\u7b2c3\u6b65-Reconciliation-\u53cc\u7f13\u5b58-diff",title:"beginWork\u7b2c3\u6b65-Reconciliation-\u53cc\u7f13\u5b58-diff",description:"workInProgress Fiber(\u5185\u5b58\u4e2d\u6784\u5efa\u7684\u6811)\u548ccurrent Fiber--\x3e\u53cc\u7f13\u5b58",source:"@site/programming-tech/React/21-beginWork\u7b2c3\u6b65-Reconciliation-\u53cc\u7f13\u5b58-diff.md",sourceDirName:"React",slug:"/React/beginWork\u7b2c3\u6b65-Reconciliation-\u53cc\u7f13\u5b58-diff",permalink:"/React/beginWork\u7b2c3\u6b65-Reconciliation-\u53cc\u7f13\u5b58-diff",draft:!1,editUrl:"https://github.com/huiruo/programming-tech-website/edit/main/programming-tech/React/21-beginWork\u7b2c3\u6b65-Reconciliation-\u53cc\u7f13\u5b58-diff.md",tags:[],version:"current",sidebarPosition:21,frontMatter:{},sidebar:"docs",previous:{title:"render\u9636\u6bb51-beginWork",permalink:"/React/render\u9636\u6bb51-beginWork"},next:{title:"render\u9636\u6bb52-completeWork",permalink:"/React/render\u9636\u6bb52-completeWork"}},a={},c=[{value:"workInProgress Fiber(\u5185\u5b58\u4e2d\u6784\u5efa\u7684\u6811)\u548ccurrent Fiber--&gt;\u53cc\u7f13\u5b58",id:"workinprogress-fiber\u5185\u5b58\u4e2d\u6784\u5efa\u7684\u6811\u548ccurrent-fiber--\u53cc\u7f13\u5b58",level:2},{value:"\u6027\u80fd\u4f18\u5316\u4e4b1:Fiber\u53cc\u7f13\u5b58",id:"\u6027\u80fd\u4f18\u5316\u4e4b1fiber\u53cc\u7f13\u5b58",level:3},{value:"\u6027\u80fd\u4f18\u5316\u4e4b2:Fiber\u7684\u5b58\u5728\u4f7f\u5f02\u6b65\u53ef\u4e2d\u65ad\u7684\u66f4\u65b0\u6210\u4e3a\u4e86\u53ef\u80fd",id:"\u6027\u80fd\u4f18\u5316\u4e4b2fiber\u7684\u5b58\u5728\u4f7f\u5f02\u6b65\u53ef\u4e2d\u65ad\u7684\u66f4\u65b0\u6210\u4e3a\u4e86\u53ef\u80fd",level:3},{value:"workInProgress fiber tree\uff1a\u5185\u5b58\u4e2d\u6784\u5efa\u7684\u6811\u3002",id:"workinprogress-fiber-tree\u5185\u5b58\u4e2d\u6784\u5efa\u7684\u6811",level:3},{value:"current fiber tree\uff1a\u6b63\u5728\u89c6\u56fe\u5c42\u6e32\u67d3\u7684\u6811\u3002",id:"current-fiber-tree\u6b63\u5728\u89c6\u56fe\u5c42\u6e32\u67d3\u7684\u6811",level:3},{value:"\u53cc\u7f13\u5b58\uff0c\u4ee5current tree\u4e3a\u4e3b\uff0cworkInProgress tree\u4e3a\u8f85",id:"\u53cc\u7f13\u5b58\u4ee5current-tree\u4e3a\u4e3bworkinprogress-tree\u4e3a\u8f85",level:3},{value:"\u57fa\u78401-\u6784\u5efafiber \u904d\u5386\u6d41\u7a0b",id:"\u57fa\u78401-\u6784\u5efafiber-\u904d\u5386\u6d41\u7a0b",level:2},{value:"\u904d\u5386\u6d41\u7a0b",id:"\u904d\u5386\u6d41\u7a0b",level:3},{value:"\u57fa\u78402\uff1aDiff",id:"\u57fa\u78402diff",level:2}],u={toc:c},f="wrapper";function p(e){let{components:r,...n}=e;return(0,o.kt)(f,(0,t.Z)({},u,n,{components:r,mdxType:"MDXLayout"}),(0,o.kt)("h2",{id:"workinprogress-fiber\u5185\u5b58\u4e2d\u6784\u5efa\u7684\u6811\u548ccurrent-fiber--\u53cc\u7f13\u5b58"},"workInProgress Fiber(\u5185\u5b58\u4e2d\u6784\u5efa\u7684\u6811)\u548ccurrent Fiber--\x3e\u53cc\u7f13\u5b58"),(0,o.kt)("p",null,"\u771f\u5b9edom\u5bf9\u5e94\u5728\u5185\u5b58\u4e2d\u7684Fiber\u8282\u70b9\u5f62\u6210Fiber\u6811:current Fiber"),(0,o.kt)("p",null,"workInProgress Fiber\u548ccurrent Fiber\u8fd9\u4e24\u9897\u6811\u7684\u8282\u70b9\u901a\u8fc7alternate\u76f8\u8fde."),(0,o.kt)("p",null,"performUnitOfWork \u4f5c\u7528\u521b\u5efa\u4e0b\u4e00\u4e2a Fiber \u8282\u70b9\uff0c\u5e76\u8d4b\u503c\u7ed9 workInProgress\uff0c\u540c\u65f6\u628a workInProgress \u4e0e\u5df2\u521b\u5efa\u7684 Fiber \u8282\u70b9\u8fde\u63a5\u8d77\u6765\u6784\u6210 Fiber \u6811\u3002"),(0,o.kt)("h3",{id:"\u6027\u80fd\u4f18\u5316\u4e4b1fiber\u53cc\u7f13\u5b58"},"\u6027\u80fd\u4f18\u5316\u4e4b1:Fiber\u53cc\u7f13\u5b58"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Fiber\u53cc\u7f13\u5b58\u53ef\u4ee5\u5728\u6784\u5efa\u597dwip Fiber\u6811\u4e4b\u540e\u5207\u6362\u6210current Fiber\uff0c\u5185\u5b58\u4e2d\u76f4\u63a5\u4e00\u6b21\u6027\u5207\u6362\uff0c\u63d0\u9ad8\u4e86\u6027\u80fd")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"React\u4e2d\uff0c\u6e32\u67d3\u673a\u5236\u5c31\u662fReact\u4f1a\u8c03\u7528render()\u51fd\u6570\u6784\u5efa\u4e00\u68f5Dom\u6811\uff0c \u5f53\u6211\u4eec\u9700\u8981\u5bf9DOM\u8fdb\u884c\u4e8b\u4ef6\u76d1\u542c\u65f6\uff0c\u9996\u5148\u5bf9VirtualDom\u8fdb\u884c\u4e8b\u4ef6\u76d1\u542c\uff0cVirtualDom\u4f1a\u4ee3\u7406\u539f\u751f\u7684DOM\u4e8b\u4ef6\u4ece\u800c\u505a\u51fa\u54cd\u5e94\u3002\n\nReact\u4e2dworkingProgress Fiber\u6811\u5b58\u5728\u7684\u610f\u4e49\u662f\u4ec0\u4e48?\n\u5728React\u4e2d\u6700\u591a\u4f1a\u540c\u65f6\u5b58\u5728\u4e24\u68f5Fiber\u6811\uff0c\u5f53\u524d\u663e\u793a\u5728\u9875\u9762\u662fcurrent Fiber\u6811\uff0c\u5728\u5185\u5b58\u4e2d\u6784\u5efa\u7684Fiber\u6811\u79f0\u4e3aworkInProgress Fiber\u6811\uff0cworkingProgress Fiber\u8fd9\u68f5\u6811\u662f\u5728\u5185\u5b58\u4e2d\u6784\u5efa\u7684\uff0c\u6784\u5efa\u5b8c\u6210\u624d\u7edf\u4e00\u66ff\u6362\uff0c\u8fd9\u6837\u4e0d\u4f1a\u4ea7\u751f\u4e0d\u5b8c\u5168\u7684\u771f\u5b9edom\u3002\u4e00\u65e6\u66f4\u65b0\u5b8c\u6210\uff0creact\u4f1a\u76f4\u63a5\u5c06current\u6811\u66ff\u6362\u6210workingProgress Fiber\u6811\uff0c\u4ee5\u4fbf\u5feb\u901f\u5b8c\u6210DOM\u7684\u66f4\u65b0\u3002\u4e5f\u662freact\u63d0\u5347\u6027\u80fd\u7684\u4e00\u90e8\u5206\n\n\u56e0\u4e3a workInProgress Fiber \u5728\u66f4\u65b0\u7684\u8fc7\u7a0b\u4e2d\uff0c\u662f\u5728\u5185\u5b58\u4e2d\u6784\u5efa\u7684\uff0c\u6240\u6709\u901f\u5ea6\u662f\u975e\u5e38\u5feb\u7684\uff0c\u5f97\u5230\u6700\u7ec8\u66f4\u65b0\u540e\u7684 Fiber\uff0c\u76f4\u63a5\u66ff\u6362 Current Fiber\u3002\n\ncurrent Fiber \u6811\u6709\u4e00\u4e2a alternate \u5c5e\u6027\u6307\u5411 workInProgress Fiber \u6811\uff0cworkInProgress Fiber \u6811\u5185\u4e5f \u6709\u4e00\u4e2aalternate \u5c5e\u6027\u6307\u5411current Fiber \u6811\n\n\u5728state/props\u53d1\u751f\u6539\u53d8\u7684\u65f6\u5019\uff0crender()\u51fd\u6570\u4f1a\u88ab\u518d\u6b21\u8c03\u7528\u6e32\u67d3\u51fa\u53e6\u5916\u4e00\u68f5\u6811\uff0c\u91cd\u65b0\u6e32\u67d3\u6240\u6709\u7684\u8282\u70b9\uff0c\u6784\u9020\u51fa\u65b0\u7684\u865a\u62dfDom tree\u8ddf\u539f\u6765\u7684Dom tree\u7528Diff\u7b97\u6cd5\u8fdb\u884c\u6bd4\u8f83\uff0c\u627e\u5230\u9700\u8981\u66f4\u65b0\u7684\u5730\u65b9\u6279\u91cf\u6539\u52a8\uff0c\u518d\u6e32\u67d3\u5230\u771f\u5b9e\u7684DOM\u4e0a\uff0c\u7531\u4e8e\u8fd9\u6837\u505a\u5c31\u51cf\u5c11\u4e86\u5bf9Dom\u7684\u9891\u7e41\u64cd\u4f5c\uff0c\u4ece\u800c\u63d0\u5347\u7684\u6027\u80fd\u3002 \n")),(0,o.kt)("h3",{id:"\u6027\u80fd\u4f18\u5316\u4e4b2fiber\u7684\u5b58\u5728\u4f7f\u5f02\u6b65\u53ef\u4e2d\u65ad\u7684\u66f4\u65b0\u6210\u4e3a\u4e86\u53ef\u80fd"},"\u6027\u80fd\u4f18\u5316\u4e4b2:Fiber\u7684\u5b58\u5728\u4f7f\u5f02\u6b65\u53ef\u4e2d\u65ad\u7684\u66f4\u65b0\u6210\u4e3a\u4e86\u53ef\u80fd"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Fiber\u7684\u5b58\u5728\u4f7f\u5f02\u6b65\u53ef\u4e2d\u65ad\u7684\u66f4\u65b0\u6210\u4e3a\u4e86\u53ef\u80fd\uff0c\u4f5c\u4e3a\u5de5\u4f5c\u5355\u5143\uff0c\u53ef\u4ee5\u5728\u65f6\u95f4\u7247\u5185\u6267\u884c\u5de5\u4f5c\uff0c\u6ca1\u65f6\u95f4\u4e86\u4ea4\u8fd8\u6267\u884c\u6743\u7ed9\u6d4f\u89c8\u5668\uff0c\u4e0b\u6b21\u65f6\u95f4\u7247\u7ee7\u7eed\u6267\u884c\u4e4b\u524d\u6682\u505c\u4e4b\u540e\u8fd4\u56de\u7684Fiber")),(0,o.kt)("p",null,"\u4ece\u800c\u4f7f\u5f97\u6d4f\u89c8\u5668\u5904\u7406\u65f6\u5019\u53ef\u4ee5\u5c06\u63a7\u5236\u6743\u4ea4\u51fa\u53bb\uff0c\u907f\u514d\u4e86js\u7ebf\u7a0b\u8fc7\u591a\u5360\u7528\u800c\u963b\u585e\u6e32\u67d3\u7ebf\u7a0b\uff0c\u5b9e\u73b0\u4e86\u66f4\u7ec6\u7c92\u5ea6\u7684\u8c03\u5ea6\uff0c\u5373\u4e3a\uff1a\u534f\u7a0b\u548c\u7ebf\u7a0b\u7684\u8c03\u5ea6"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Fiber\u53ef\u4ee5\u5728reconcile\u7684\u65f6\u5019\u8fdb\u884c\u76f8\u5e94\u7684diff\u66f4\u65b0\uff0c\u8ba9\u6700\u540e\u7684\u66f4\u65b0\u5e94\u7528\u5728\u771f\u5b9e\u8282\u70b9\u4e0a")),(0,o.kt)("h3",{id:"workinprogress-fiber-tree\u5185\u5b58\u4e2d\u6784\u5efa\u7684\u6811"},"workInProgress fiber tree\uff1a\u5185\u5b58\u4e2d\u6784\u5efa\u7684\u6811\u3002"),(0,o.kt)("p",null,"\u66f4\u65b0\u8fc7\u7a0b\u4e2d\u6784\u5efa\u7684 new fiber tree"),(0,o.kt)("h3",{id:"current-fiber-tree\u6b63\u5728\u89c6\u56fe\u5c42\u6e32\u67d3\u7684\u6811"},"current fiber tree\uff1a\u6b63\u5728\u89c6\u56fe\u5c42\u6e32\u67d3\u7684\u6811\u3002"),(0,o.kt)("p",null,"old fiber tree\uff0c\u5bf9\u5e94\u5f53\u524d\u5c4f\u5e55\u663e\u793a\u7684\u5185\u5bb9\uff0c\u901a\u8fc7\u6839\u8282\u70b9 fiberRootNode \u7684 current \u6307\u9488\u53ef\u4ee5\u8bbf\u95ee\u3002"),(0,o.kt)("h3",{id:"\u53cc\u7f13\u5b58\u4ee5current-tree\u4e3a\u4e3bworkinprogress-tree\u4e3a\u8f85"},"\u53cc\u7f13\u5b58\uff0c\u4ee5current tree\u4e3a\u4e3b\uff0cworkInProgress tree\u4e3a\u8f85"),(0,o.kt)("p",null,"\u53cc\u7f13\u5b58\u673a\u5236\u662fReact\u7ba1\u7406\u66f4\u65b0\u5de5\u4f5c\u7684\u4e00\u79cd\u624b\u6bb5\uff0c\u4e5f\u662f\u63d0\u5347\u7528\u6237\u4f53\u9a8c\u7684\u91cd\u8981\u673a\u5236\u3002"),(0,o.kt)("p",null,"\u5f53React\u5f00\u59cb\u66f4\u65b0\u5de5\u4f5c\u4e4b\u540e\uff0c\u4f1a\u6709\u4e24\u4e2afiber\u6811\uff0c\u4e00\u4e2acurrent\u6811\uff0c\u662f\u5f53\u524d\u663e\u793a\u5728\u9875\u9762\u4e0a\u5185\u5bb9\u5bf9\u5e94\u7684fiber\u6811\u3002\u53e6\u4e00\u4e2a\u662fworkInProgress\u6811\uff0c\u5b83\u662f\u4f9d\u636ecurrent\u6811\u6df1\u5ea6\u4f18\u5148\u904d\u5386\u6784\u5efa\u51fa\u6765\u7684\u65b0\u7684fiber\u6811\uff0c\u6240\u6709\u7684\u66f4\u65b0\u6700\u7ec8\u90fd\u4f1a\u4f53\u73b0\u5728workInProgress\u6811\u4e0a\u3002"),(0,o.kt)("p",null,"\u5f53\u66f4\u65b0\u672a\u5b8c\u6210\u7684\u65f6\u5019\uff0c\u9875\u9762\u4e0a\u59cb\u7ec8\u5c55\u793acurrent\u6811\u5bf9\u5e94\u7684\u5185\u5bb9\uff0c\u5f53\u66f4\u65b0\u7ed3\u675f\u65f6\uff08commit\u9636\u6bb5\u7684\u6700\u540e\uff09\uff0c\u9875\u9762\u5185\u5bb9\u5bf9\u5e94\u7684fiber\u6811\u4f1a\u7531current\u6811\u5207\u6362\u5230workInProgress\u6811\uff0c\u6b64\u65f6workInProgress\u6811\u5373\u6210\u4e3a\u65b0\u7684current\u6811\u3002"),(0,o.kt)("p",null,"\u6700\u7ec8commit\u9636\u6bb5\u5b8c\u6210\u65f6\uff0c\u4e24\u68f5\u6811\u4f1a\u8fdb\u884c\u5207\u6362\u3002\n\u5728\u672a\u66f4\u65b0\u5b8c\u6210\u65f6\u4f9d\u65e7\u5c55\u793a\u65e7\u5185\u5bb9\uff0c\u4fdd\u6301\u4ea4\u4e92\uff0c\u5f53\u66f4\u65b0\u5b8c\u6210\u7acb\u5373\u5207\u6362\u5230\u65b0\u5185\u5bb9\uff0c\u8fd9\u6837\u53ef\u4ee5\u505a\u5230\u65b0\u5185\u5bb9\u548c\u65e7\u5185\u5bb9\u65e0\u7f1d\u5207\u6362\u3002"),(0,o.kt)("p",null,"\u6e32\u67d3\u6d41\u7a0b\u4e2d\uff0c\u5148\u590d\u7528current\u6811\uff08rootFiber\uff09\u7684alternate \u4f5c\u4e3a workInProgress\u3002\n\u6784\u5efaworkInProgress Fiber\u53d1\u751f\u5728createWorkInProgress\u4e2d\uff0c\u5b83\u80fd\u521b\u5efa\u6216\u8005\u590d\u7528Fiber"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"  function createWorkInProgress(current, pendingProps) {\n    var workInProgress = current.alternate;\n    // \u533a\u5206\u662f\u5728mount\u65f6\u8fd8\u662f\u5728update\u65f6\n    if (workInProgress === null) {\n      // We use a double buffering pooling technique because we know that we'll\n      // only ever need at most two versions of a tree. We pool the \"other\" unused\n      // node that we're free to reuse. This is lazily created to avoid allocating\n      // extra objects for things that are never updated. It also allow us to\n      // reclaim the extra memory if needed.\n      console.log('==createWorkInProgress--\x3e,\u6ca1\u6709\u5c31\u521b\u5efa\u4e00\u4e2a')\n      workInProgress = createFiber(current.tag, pendingProps, current.key, current.mode);\n      workInProgress.elementType = current.elementType;\n      workInProgress.type = current.type;\n      workInProgress.stateNode = current.stateNode;\n\n      {\n        // DEV-only fields\n        workInProgress._debugSource = current._debugSource;\n        workInProgress._debugOwner = current._debugOwner;\n        workInProgress._debugHookTypes = current._debugHookTypes;\n      }\n      console.log('==createWorkInProgress--\x3e,workInProgress.alternate\u6307\u5b9a\u4e3acurrent')\n      workInProgress.alternate = current;\n      current.alternate = workInProgress;\n    } else {\n      // \u590d\u7528\u5c5e\u6027\n      workInProgress.pendingProps = pendingProps; // Needed because Blocks store data on type.\n\n      workInProgress.type = current.type; // We already have an alternate.\n      // Reset the effect tag.\n\n      workInProgress.flags = NoFlags; // The effects are no longer valid.\n\n      workInProgress.subtreeFlags = NoFlags;\n      workInProgress.deletions = null;\n\n      {\n        // We intentionally reset, rather than copy, actualDuration & actualStartTime.\n        // This prevents time from endlessly accumulating in new commits.\n        // This has the downside of resetting values for different priority renders,\n        // But works for yielding (the common case) and should support resuming.\n        workInProgress.actualDuration = 0;\n        workInProgress.actualStartTime = -1;\n      }\n    } // Reset all effects except static ones.\n    // Static effects are not specific to a render.\n\n\n    workInProgress.flags = current.flags & StaticMask;\n    // \u590d\u7528\u5c5e\u6027\n    workInProgress.childLanes = current.childLanes;\n    workInProgress.lanes = current.lanes;\n    workInProgress.child = current.child;\n    workInProgress.memoizedProps = current.memoizedProps;\n    workInProgress.memoizedState = current.memoizedState;\n    workInProgress.updateQueue = current.updateQueue; // Clone the dependencies object. This is mutated during the render phase, so\n    // it cannot be shared with the current fiber.\n\n    var currentDependencies = current.dependencies;\n    workInProgress.dependencies = currentDependencies === null ? null : {\n      lanes: currentDependencies.lanes,\n      firstContext: currentDependencies.firstContext\n    }; // These will be overridden during the parent's reconciliation\n\n    workInProgress.sibling = current.sibling;\n    workInProgress.index = current.index;\n    workInProgress.ref = current.ref;\n\n    {\n      workInProgress.selfBaseDuration = current.selfBaseDuration;\n      workInProgress.treeBaseDuration = current.treeBaseDuration;\n    }\n\n    {\n      workInProgress._debugNeedsRemount = current._debugNeedsRemount;\n\n      switch (workInProgress.tag) {\n        case IndeterminateComponent:\n        case FunctionComponent:\n        case SimpleMemoComponent:\n          workInProgress.type = resolveFunctionForHotReloading(current.type);\n          break;\n\n        case ClassComponent:\n          workInProgress.type = resolveClassForHotReloading(current.type);\n          break;\n\n        case ForwardRef:\n          workInProgress.type = resolveForwardRefForHotReloading(current.type);\n          break;\n      }\n    }\n\n    return workInProgress;\n  } // Used to reuse a Fiber for a second pass.\n")),(0,o.kt)("h2",{id:"\u57fa\u78401-\u6784\u5efafiber-\u904d\u5386\u6d41\u7a0b"},"\u57fa\u78401-\u6784\u5efafiber \u904d\u5386\u6d41\u7a0b"),(0,o.kt)("p",null,"react\u628a\u6bcf\u4e2afiber\u5f53\u6210\u751f\u6210fiber\u6700\u5c0f\u5355\u5143,\u53ea\u8981\u8fed\u4ee3\u6240\u6709fiber\u5219\u5230\u9876\u7ea7Fiber\u65f6\u751f\u6210\u6574\u9897FiberTree\u3002"),(0,o.kt)("h3",{id:"\u904d\u5386\u6d41\u7a0b"},"\u904d\u5386\u6d41\u7a0b"),(0,o.kt)("p",null,"Tree \u6784\u5efa\u7684\u904d\u5386\u987a\u5e8f\uff0c\u5b83\u4f1a\u4ee5\u65e7\u7684fiber tree\u4e3a\u84dd\u672c\uff0c\u628a\u6bcf\u4e2afiber\u4f5c\u4e3a\u4e00\u4e2a\u5de5\u4f5c\u5355\u5143\uff0c\u81ea\u9876\u5411\u4e0b\u9010\u8282\u70b9\u6784\u9020workInProgress tree\uff08\u6784\u5efa\u4e2d\u7684\u65b0fiber tree\uff09:"),(0,o.kt)("p",null,"\u6df1\u5ea6\u4f18\u5148\u904d\u5386"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"\u4ece\u9876\u70b9\u5f00\u59cb\u904d\u5386"),(0,o.kt)("li",{parentName:"ol"},"\u5982\u679c\u6709\u5b50\u8282\u70b9\uff0c\u5148\u904d\u5386\u5b50\u8282\u70b9\uff1b"),(0,o.kt)("li",{parentName:"ol"},"\u5982\u679c\u6ca1\u6709\u5b50\u8282\u70b9\uff0c\u5219\u770b\u6709\u6ca1\u6709\u5144\u5f1f\u8282\u70b9\uff0c\u6709\u5219\u904d\u5386\u5144\u5f1f\u8282\u70b9\uff0c\u5e76\u628aeffect\u5411\u4e0a\u5f52\u5e76"),(0,o.kt)("li",{parentName:"ol"},"\u5982\u679c\u6ca1\u6709\u5144\u5f1f\u8282\u70b9\uff0c\u5219\u770b\u6709\u6ca1\u6709\u7236\u5144\u5f1f\u8282\u70b9\uff0c\u6709\u5219\u904d\u5386\u7236\u5144\u5f1f\u8282\u70b9"),(0,o.kt)("li",{parentName:"ol"},"\u5982\u679c\u6ca1\u6709\u90fd\u6ca1\u6709\u4e86\uff0c\u90a3\u4e48\u904d\u5386\u7ed3\u675f")),(0,o.kt)("mermaid",{value:"flowchart TD\n\n  A0(workLoopSync)--\u5f02\u6b65--\x3eA0Aif\n  A0A(workLoopConcurrent)--\u540c\u6b65--\x3eA0Aif{{workInProgress!==null}}\n  A0Aif--\x3eA1\n  A0Aif--\u4e3anull--\x3eendW(\u7ed3\u675f\u5f53\u524d\u5faa\u73af)\n\n  A1(performUnitOfWork)--\x3eA2(beginWork\u5904\u7406\u5b8c\u8fd4\u56denext)--\x3eA2if{{next=null?}}\n\n  A3A(\u5c06\u4e0b\u4e00\u5de5\u4f5c\u5355\u5143\u4e3a\u5f53\u524d\u5de5\u4f5c\u5355\u5143:workInProgress=next)\n  A3A--\x3eA0Aif\n  A2if--next\u4e3anull--\x3eA3B(completeUnitOfWork)\n  A2if--next\u4e0d\u4e3anull--\x3eA3A\n\n  A3Bif{{\u8282\u70b9\u662f\u5426\u7a7a:completedWork!=null?}}\n  A3B--\x3eA3Bif--\u4e3anull--\x3eA0Aif\n  A3Bif--\u975enull--\x3eA3Bif2{{\u662f\u5426\u5b58\u5728\u5144\u5f1f\u8282\u70b9:siblingFiber!=null?}}\n\n  A3Bif2--\u5144\u5f1f\u8282\u70b9null--\x3eA3C1(\u56de\u6eaf\u5230\u7236\u8282\u70b9:completedWork=returnFiber)--\x3eA3Bif\n  A3Bif2--\u5144\u5f1f\u8282\u70b9!null--\x3eA3C2(\u5c06\u5144\u5f1f\u8282\u70b9\u4f5c\u4e3a\u4e0b\u4e00\u5de5\u4f5c\u5355\u5143)--\x3eA0Aif"}),(0,o.kt)("h2",{id:"\u57fa\u78402diff"},"\u57fa\u78402\uff1aDiff"),(0,o.kt)("p",null,"diff\u672c\u8d28\u4e0a\u662f\u4e00\u4e9b\u8ba1\u7b97\uff08\u904d\u5386\u3001\u6bd4\u8f83\uff09\uff0c\u662f\u53ef\u62c6\u5206\u7684\uff08\u7b97\u4e00\u534a\u5f85\u4f1a\u513f\u63a5\u7740\u7b97\uff09 "),(0,o.kt)("p",null,"diff\u7684\u8fc7\u7a0b\uff0c\u4e5f\u5c31\u662feffect\u7684\u6536\u96c6\u8fc7\u7a0b\uff0c\u6b64\u8fc7\u7a0b\u4f1a\u627e\u51fa\u6240\u6709\u8282\u70b9\u7684\u53d8\u66f4\uff0c\u5982\u8282\u70b9\u65b0\u589e\u3001\u5220\u9664\u3001\u5c5e\u6027\u53d8\u66f4\u7b49\uff0c\u8fd9\u4e9b\u53d8\u66f4 react \u7edf\u79f0\u4e3a\u526f\u4f5c\u7528\uff08effect\uff09\uff0c\u968f\u7740\u6240\u6709\u7684\u8282\u70b9\uff08\u5de5\u4f5c\u5355\u5143\uff09\u5728\u5e27\u7a7a\u95f2\u65f6\u95f4\u9010\u4e2a\u6267\u884c\u5b8c\u6bd5\uff0c\u6700\u540e\u4ea7\u51fa\u7684\u7ed3\u679c\u662feffect list\uff0c\u4ece\u4e2d\u53ef\u4ee5\u77e5\u9053\u54ea\u4e9b\u8282\u70b9\u66f4\u65b0\u3001\u54ea\u4e9b\u8282\u70b9\u589e\u52a0\u3001\u54ea\u4e9b\u8282\u70b9\u5220\u9664\u4e86\u3002"),(0,o.kt)("p",null,"diff \u6bd4\u8f83\uff0c\u5c31\u662f\u5728\u6784\u5efa workInProgress fiber tree \u7684\u8fc7\u7a0b\u4e2d\uff0c\u5224\u65ad current fiber tree \u4e2d\u7684 fiber node \u662f\u5426\u53ef\u4ee5\u88ab workInProgress fiber tree \u590d\u7528\u3002"),(0,o.kt)("p",null,"\u80fd\u88ab\u590d\u7528\uff0c\u610f\u5473\u5728\u672c\u6b21\u66f4\u65b0\u4e2d\uff0c\u9700\u8981\u505a: \u7ec4\u4ef6\u7684 update \u4ee5\u53ca dom \u8282\u70b9\u7684 move\u3001update \u7b49\u64cd\u4f5c\uff1b"),(0,o.kt)("p",null,"\u4e0d\u53ef\u590d\u7528\uff0c\u5219\u610f\u5473\u7740\u9700\u8981\u505a: \u7ec4\u4ef6\u7684 mount\u3001unmount \u4ee5\u53ca dom \u8282\u70b9\u7684 insert\u3001delete \u7b49\u64cd\u4f5c\u3002"),(0,o.kt)("p",null,"\u5f53\u66f4\u65b0\u5b8c\u6210\u4ee5\u540e\uff0cfiberRootNode \u7684 current \u6307\u9488\u4f1a\u6307\u5411 workInProgress fiber tree\uff0c\u4f5c\u4e3a\u4e0b\u4e00\u6b21\u66f4\u65b0\u7684 current fiber tree"),(0,o.kt)("p",null,"\u6700\u540e\uff0c\u6df1\u5ea6\u8c03\u548c\u5b50\u8282\u70b9\uff0c\u6e32\u67d3\u89c6\u56fe\n\u904d\u5386fiber\u6811\uff0c\u4ee5workInProgress \u4f5c\u4e3a\u6700\u65b0\u7684\u6e32\u67d3\u6811\uff0c\u5373current Fiber \u6811\u3002"))}p.isMDXComponent=!0}}]);