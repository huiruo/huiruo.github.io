"use strict";(self.webpackChunkprogramming_technology=self.webpackChunkprogramming_technology||[]).push([[9777],{3905:(e,n,t)=>{t.d(n,{Zo:()=>u,kt:()=>v});var r=t(67294);function o(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function s(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function l(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?s(Object(t),!0).forEach((function(n){o(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):s(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function a(e,n){if(null==e)return{};var t,r,o=function(e,n){if(null==e)return{};var t,r,o={},s=Object.keys(e);for(r=0;r<s.length;r++)t=s[r],n.indexOf(t)>=0||(o[t]=e[t]);return o}(e,n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)t=s[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}var c=r.createContext({}),p=function(e){var n=r.useContext(c),t=n;return e&&(t="function"==typeof e?e(n):l(l({},n),e)),t},u=function(e){var n=p(e.components);return r.createElement(c.Provider,{value:n},e.children)},i="mdxType",d={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},m=r.forwardRef((function(e,n){var t=e.components,o=e.mdxType,s=e.originalType,c=e.parentName,u=a(e,["components","mdxType","originalType","parentName"]),i=p(t),m=o,v=i["".concat(c,".").concat(m)]||i[m]||d[m]||s;return t?r.createElement(v,l(l({ref:n},u),{},{components:t})):r.createElement(v,l({ref:n},u))}));function v(e,n){var t=arguments,o=n&&n.mdxType;if("string"==typeof e||o){var s=t.length,l=new Array(s);l[0]=m;var a={};for(var c in n)hasOwnProperty.call(n,c)&&(a[c]=n[c]);a.originalType=e,a[i]="string"==typeof e?e:o,l[1]=a;for(var p=2;p<s;p++)l[p]=t[p];return r.createElement.apply(null,l)}return r.createElement.apply(null,t)}m.displayName="MDXCreateElement"},55515:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>l,default:()=>d,frontMatter:()=>s,metadata:()=>a,toc:()=>p});var r=t(87462),o=(t(67294),t(3905));const s={},l=void 0,a={unversionedId:"http-browser-promise/B-sse-\u5bf9\u6807webSocket",id:"http-browser-promise/B-sse-\u5bf9\u6807webSocket",title:"B-sse-\u5bf9\u6807webSocket",description:"\u4f46\u5982\u679c\u53ea\u662f\u5355\u5411\u63a8\u9001\u6d88\u606f\u7684\u8bdd\uff0cHTTP \u5c31\u6709\u8fd9\u79cd\u529f\u80fd\uff0c\u5b83\u5c31\u662f Server Send Event\u3002",source:"@site/programming-tech/http-browser-promise/B-sse-\u5bf9\u6807webSocket.md",sourceDirName:"http-browser-promise",slug:"/http-browser-promise/B-sse-\u5bf9\u6807webSocket",permalink:"/http-browser-promise/B-sse-\u5bf9\u6807webSocket",draft:!1,editUrl:"https://github.com/huiruo/programming-tech-website/edit/main/programming-tech/http-browser-promise/B-sse-\u5bf9\u6807webSocket.md",tags:[],version:"current",frontMatter:{}},c={},p=[{value:"\u4f46\u5982\u679c\u53ea\u662f\u5355\u5411\u63a8\u9001\u6d88\u606f\u7684\u8bdd\uff0cHTTP \u5c31\u6709\u8fd9\u79cd\u529f\u80fd\uff0c\u5b83\u5c31\u662f Server Send Event\u3002",id:"\u4f46\u5982\u679c\u53ea\u662f\u5355\u5411\u63a8\u9001\u6d88\u606f\u7684\u8bddhttp-\u5c31\u6709\u8fd9\u79cd\u529f\u80fd\u5b83\u5c31\u662f-server-send-event",level:2},{value:"\u4f8b\u5b50\uff1a\u5f88\u591a\u6784\u5efa\u65e5\u5fd7\u90fd\u662f\u901a\u8fc7 SSE \u7684\u65b9\u5f0f\u5b9e\u65f6\u63a8\u9001\u7684\u3002",id:"\u4f8b\u5b50\u5f88\u591a\u6784\u5efa\u65e5\u5fd7\u90fd\u662f\u901a\u8fc7-sse-\u7684\u65b9\u5f0f\u5b9e\u65f6\u63a8\u9001\u7684",level:2},{value:"\u4f8b\u5b502:\u65e5\u5fd7\u4e4b\u7c7b\u7684\u53ea\u662f\u6587\u672c\uff0c\u90a3\u5982\u679c\u662f\u4e8c\u8fdb\u5236\u6570\u636e\u5462\uff1f",id:"\u4f8b\u5b502\u65e5\u5fd7\u4e4b\u7c7b\u7684\u53ea\u662f\u6587\u672c\u90a3\u5982\u679c\u662f\u4e8c\u8fdb\u5236\u6570\u636e\u5462",level:2},{value:"WebSocket \u7684\u901a\u4fe1\u8fc7\u7a0b\u662f\u8fd9\u6837\u7684\uff1a",id:"websocket-\u7684\u901a\u4fe1\u8fc7\u7a0b\u662f\u8fd9\u6837\u7684",level:3},{value:"HTTP \u7684 Server Send Event \u662f\u8fd9\u6837\u7684\uff1a",id:"http-\u7684-server-send-event-\u662f\u8fd9\u6837\u7684",level:3},{value:"\u5728nestjs",id:"\u5728nestjs",level:3},{value:"App.tsx",id:"apptsx",level:3},{value:"sse",id:"sse",level:2},{value:"\u4e3b\u8981\u914d\u7f6e",id:"\u4e3b\u8981\u914d\u7f6e",level:2}],u={toc:p},i="wrapper";function d(e){let{components:n,...t}=e;return(0,o.kt)(i,(0,r.Z)({},u,t,{components:n,mdxType:"MDXLayout"}),(0,o.kt)("h2",{id:"\u4f46\u5982\u679c\u53ea\u662f\u5355\u5411\u63a8\u9001\u6d88\u606f\u7684\u8bddhttp-\u5c31\u6709\u8fd9\u79cd\u529f\u80fd\u5b83\u5c31\u662f-server-send-event"},"\u4f46\u5982\u679c\u53ea\u662f\u5355\u5411\u63a8\u9001\u6d88\u606f\u7684\u8bdd\uff0cHTTP \u5c31\u6709\u8fd9\u79cd\u529f\u80fd\uff0c\u5b83\u5c31\u662f Server Send Event\u3002"),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://zhuanlan.zhihu.com/p/653136937"},"https://zhuanlan.zhihu.com/p/653136937")),(0,o.kt)("p",null,"\u4e00\u4e9b\u53ea\u9700\u8981\u670d\u52a1\u7aef\u63a8\u9001\u7684\u573a\u666f\u5c31\u7279\u522b\u9002\u5408 Server Send Event\u3002"),(0,o.kt)("p",null,"\u8fd9\u79cd\u63a8\u9001\u7528 WebSocket \u5c31\u6ca1\u5fc5\u8981\u4e86\uff0c\u53ef\u4ee5\u7528 SSE \u6765\u505a\u3002"),(0,o.kt)("p",null,"\u90a3\u8fde\u63a5\u65ad\u4e86\u600e\u4e48\u529e\u5462\uff1f"),(0,o.kt)("p",null,"\u4e0d\u7528\u62c5\u5fc3\uff0c\u6d4f\u89c8\u5668\u4f1a\u81ea\u52a8\u91cd\u8fde\u3002"),(0,o.kt)("p",null,"\u8fd9\u70b9\u548c WebSocket \u4e0d\u540c\uff0cWebSocket \u5982\u679c\u65ad\u5f00\u4e4b\u540e\u662f\u9700\u8981\u624b\u52a8\u91cd\u8fde\u7684\uff0c\u800c SSE \u4e0d\u7528\u3002"),(0,o.kt)("h2",{id:"\u4f8b\u5b50\u5f88\u591a\u6784\u5efa\u65e5\u5fd7\u90fd\u662f\u901a\u8fc7-sse-\u7684\u65b9\u5f0f\u5b9e\u65f6\u63a8\u9001\u7684"},"\u4f8b\u5b50\uff1a\u5f88\u591a\u6784\u5efa\u65e5\u5fd7\u90fd\u662f\u901a\u8fc7 SSE \u7684\u65b9\u5f0f\u5b9e\u65f6\u63a8\u9001\u7684\u3002"),(0,o.kt)("p",null,"\u6211\u4eec\u6765\u6d4b\u8bd5\u4e0b\uff1a"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"touth log\n# tail -f \u547d\u4ee4\u53ef\u4ee5\u5b9e\u65f6\u770b\u5230\u6587\u4ef6\u7684\u6700\u65b0\u5185\u5bb9\uff1a\n")),(0,o.kt)("p",null,"\u6211\u4eec\u901a\u8fc7 child_process \u6a21\u5757\u7684 exec \u6765\u6267\u884c\u8fd9\u4e2a\u547d\u4ee4\uff0c\u7136\u540e\u76d1\u542c\u5b83\u7684 stdout \u8f93\u51fa\uff1a"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"// test.js\nconst { exec } = require(\"child_process\");\n\nconst childProcess = exec('tail -f ./log');\n\nchildProcess.stdout.on('data', (msg) => {\n    console.log(msg);\n});\n\n// \u7528 node \u6267\u884c\u5b83\nnode ./test.js\n")),(0,o.kt)("p",null,"\u7136\u540e\u6dfb\u52a0\u4e00\u4e2a sse \u7684\u63a5\u53e3\uff1a\n\u76d1\u542c\u5230\u65b0\u7684\u6570\u636e\u4e4b\u540e\uff0c\u628a\u5b83\u8fd4\u56de\u7ed9\u6d4f\u89c8\u5668\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"@Sse('stream2')\nstream2() {\nconst childProcess = exec('tail -f ./log');\n\nreturn new Observable((observer) => {\n  childProcess.stdout.on('data', (msg) => {\n    observer.next({ data: { msg: msg.toString() }});\n  })\n});\n")),(0,o.kt)("p",null,"\u6d4f\u89c8\u5668\u8fde\u63a5\u8fd9\u4e2a\u65b0\u63a5\u53e3\uff1a"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"import { useEffect } from 'react';\n\nfunction App() {\n\n  useEffect(() => {\n    const eventSource = new EventSource('http://localhost:3000/stream2');\n    eventSource.onmessage = ({ data }) => {\n      console.log('New message', JSON.parse(data));\n    };\n  }, []);\n\n  return (\n    <div>hello</div>\n  );\n}\n\nexport default App;\n")),(0,o.kt)("p",null,"\u53ef\u4ee5\u770b\u5230\uff0c\u6d4f\u89c8\u5668\u6536\u5230\u4e86\u5b9e\u65f6\u7684\u65e5\u5fd7\u3002"),(0,o.kt)("h2",{id:"\u4f8b\u5b502\u65e5\u5fd7\u4e4b\u7c7b\u7684\u53ea\u662f\u6587\u672c\u90a3\u5982\u679c\u662f\u4e8c\u8fdb\u5236\u6570\u636e\u5462"},"\u4f8b\u5b502:\u65e5\u5fd7\u4e4b\u7c7b\u7684\u53ea\u662f\u6587\u672c\uff0c\u90a3\u5982\u679c\u662f\u4e8c\u8fdb\u5236\u6570\u636e\u5462\uff1f"),(0,o.kt)("p",null,"\u4e8c\u8fdb\u5236\u6570\u636e\u5728 node \u91cc\u662f\u901a\u8fc7 Buffer \u5b58\u50a8\u7684\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"const { readFileSync } = require(\"fs\");\n\nconst buffer = readFileSync('./package.json');\n\nconsole.log(buffer);\n")),(0,o.kt)("p",null,"\u800c Buffer \u6709\u4e2a toJSON \u65b9\u6cd5\uff1a"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"// \u8fd9\u6837\u4e0d\u5c31\u53ef\u4ee5\u901a\u8fc7 sse \u7684\u63a5\u53e3\u8fd4\u56de\u4e86\u4e48\nconsole.log(buffer.toJSON());\n\n@Sse('stream3')\nstream3() {\n    return new Observable((observer) => {\n        const json = readFileSync('./package.json').toJSON();\n        observer.next({ data: { msg: json }});\n    });\n}\n")),(0,o.kt)("p",null,"\u524d\u7aef\uff1a"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"import { useEffect } from 'react';\n\nfunction App() {\n\n  useEffect(() => {\n    const eventSource = new EventSource('http://localhost:3000/stream3');\n    eventSource.onmessage = ({ data }) => {\n      console.log('New message', JSON.parse(data));\n    };\n  }, []);\n\n  return (\n    <div>hello</div>\n  );\n}\n\nexport default App;\n")),(0,o.kt)("p",null,"\u57fa\u4e8e sse\uff0c\u9664\u4e86\u53ef\u4ee5\u63a8\u9001\u6587\u672c\u5916\uff0c\u8fd8\u53ef\u4ee5\u63a8\u9001\u4efb\u610f\u4e8c\u8fdb\u5236\u6570\u636e\u3002"),(0,o.kt)("h3",{id:"websocket-\u7684\u901a\u4fe1\u8fc7\u7a0b\u662f\u8fd9\u6837\u7684"},"WebSocket \u7684\u901a\u4fe1\u8fc7\u7a0b\u662f\u8fd9\u6837\u7684\uff1a"),(0,o.kt)("p",null,"\u9996\u5148\u901a\u8fc7 http \u5207\u6362\u534f\u8bae\uff0c\u670d\u52a1\u7aef\u8fd4\u56de 101 \u7684\u72b6\u6001\u7801\u540e\uff0c\u5c31\u4ee3\u8868\u534f\u8bae\u5207\u6362\u6210\u529f\u3002"),(0,o.kt)("p",null,"\u4e4b\u540e\u5c31\u662f WebSocket \u683c\u5f0f\u6570\u636e\u7684\u901a\u4fe1\u4e86\uff0c\u4e00\u65b9\u53ef\u4ee5\u968f\u65f6\u5411\u53e6\u4e00\u65b9\u63a8\u9001\u6d88\u606f\u3002"),(0,o.kt)("h3",{id:"http-\u7684-server-send-event-\u662f\u8fd9\u6837\u7684"},"HTTP \u7684 Server Send Event \u662f\u8fd9\u6837\u7684\uff1a"),(0,o.kt)("p",null,"\u670d\u52a1\u7aef\u8fd4\u56de\u7684 Content-Type \u662f text/event-stream\uff0c\u8fd9\u662f\u4e00\u4e2a\u6d41\uff0c\u53ef\u4ee5\u591a\u6b21\u8fd4\u56de\u5185\u5bb9\u3002"),(0,o.kt)("p",null,"Sever Send Event \u5c31\u662f\u901a\u8fc7\u8fd9\u79cd\u6d88\u606f\u6765\u968f\u65f6\u63a8\u9001\u6570\u636e\u3002"),(0,o.kt)("p",null,"\u53ef\u80fd\u4f60\u662f\u7b2c\u4e00\u6b21\u542c\u8bf4 SSE\uff0c\u4f46\u4f60\u80af\u5b9a\u7528\u8fc7\u57fa\u4e8e\u5b83\u7684\u5e94\u7528\u3002"),(0,o.kt)("p",null,"\u6bd4\u5982\u4f60\u7528\u7684 CICD \u5e73\u53f0\uff0c\u5b83\u7684\u65e5\u5fd7\u662f\u5b9e\u65f6\u6253\u5370\u7684\u3002"),(0,o.kt)("p",null,"\u90a3\u5b83\u662f\u5982\u4f55\u5b9e\u65f6\u4f20\u8f93\u6784\u5efa\u65e5\u5fd7\u7684\u5462\uff1f"),(0,o.kt)("p",null,"\u660e\u663e\u9700\u8981\u4e00\u6bb5\u4e00\u6bb5\u7684\u4f20\u8f93\uff0c\u8fd9\u79cd\u4e00\u822c\u5c31\u662f\u7528 SSE \u6765\u63a8\u9001\u6570\u636e\u3002"),(0,o.kt)("h3",{id:"\u5728nestjs"},"\u5728nestjs"),(0,o.kt)("p",null,"\u8fd4\u56de\u7684\u662f\u4e00\u4e2a Observable \u5bf9\u8c61\uff0c\u7136\u540e\u5185\u90e8\u7528 observer.next \u8fd4\u56de\u6d88\u606f\u3002"),(0,o.kt)("p",null,"\u53ef\u4ee5\u8fd4\u56de\u4efb\u610f\u7684 json \u6570\u636e\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"@Sse('stream')\nstream() {\n    return new Observable((observer) => {\n      observer.next({ data: { msg: 'aaa'} });\n\n      setTimeout(() => {\n        observer.next({ data: { msg: 'bbb'} });\n      }, 2000);\n\n      setTimeout(() => {\n        observer.next({ data: { msg: 'ccc'} });\n      }, 5000);\n    });\n}\n")),(0,o.kt)("h3",{id:"apptsx"},"App.tsx"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"import { useEffect } from 'react';\n\nfunction App() {\n\n  useEffect(() => {\n    const eventSource = new EventSource('http://localhost:3000/stream');\n    eventSource.onmessage = ({ data }) => {\n      console.log('New message', JSON.parse(data));\n    };\n  }, []);\n\n  return (\n    <div>hello</div>\n  );\n}\n\nexport default App;\n")),(0,o.kt)("p",null,"\u8fd9\u4e2a EventSource \u662f\u6d4f\u89c8\u5668\u539f\u751f api\uff0c\u5c31\u662f\u7528\u6765\u83b7\u53d6 sse \u63a5\u53e3\u7684\u54cd\u5e94\u7684\uff0c\u5b83\u4f1a\u628a\u6bcf\u6b21\u6d88\u606f\u4f20\u5165 onmessage \u7684\u56de\u8c03\u51fd\u6570\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"\u5728 devtools \u91cc\u53ef\u4ee5\u770b\u5230\uff0c\u54cd\u5e94\u7684 Content-Type \u662f text/event-stream\uff1a\n\nEventStream \u91cc\u53ef\u4ee5\u770b\u5230\u6bcf\u4e00\u6b21\u6536\u5230\u7684\u6d88\u606f\uff1a\n")),(0,o.kt)("h2",{id:"sse"},"sse"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"\u5982\u679c\u53ea\u9700\u8981\u670d\u52a1\u7aef\u5411\u5ba2\u6237\u7aef\u63a8\u9001\u6d88\u606f\uff0c\u63a8\u8350\u4f7f\u7528SSE")),(0,o.kt)("p",null,"\u95ee\u7b54\u5de5\u5177\u6d41\u5f0f\u8f93\u51fa\u786e\u5b9e\u7528\u7684sse\uff0cchatgpt\u5c31\u662f"),(0,o.kt)("p",null,"eventsource\u9650\u5236\u633a\u5927\u7684\uff0cSSE\u672c\u8d28\u8fd8\u662f\u6d41\u5f0f\u6570\u636e\uff0c\u53ef\u4ee5\u81ea\u5df1\u5c01\u88c5\u4e2afetch\uff0c\u6216\u8005github\u6709\u4e2a\u7b2c\u4e09\u65b9\u5e93fetch-event-source"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-html"},'<!DOCTYPE html>\n<html lang="en">\n<head>\n    <meta charset="UTF-8">\n    <meta http-equiv="X-UA-Compatible" content="IE=edge">\n    <meta name="viewport" content="width=device-width, initial-scale=1.0">\n    <title>Document</title>\n</head>\n<body>\n    <ul id="ul">\n        \n    </ul>\n</body>\n<script>\n\n//\u751f\u6210li\u5143\u7d20\nfunction createLi(data){\n    let li = document.createElement("li");\n    li.innerHTML = String(data.message);\n    return li;\n}\n    \n//\u5224\u65ad\u5f53\u524d\u6d4f\u89c8\u5668\u662f\u5426\u652f\u6301SSE\n  let source = \'\'\n if (!!window.EventSource) {\n    source = new EventSource(\'http://localhost:8088/sse/\');\n }else{\n    throw new Error("\u5f53\u524d\u6d4f\u89c8\u5668\u4e0d\u652f\u6301SSE")\n }\n\n //\u5bf9\u4e8e\u5efa\u7acb\u94fe\u63a5\u7684\u76d1\u542c\n source.onopen = function(event) {\n   console.log(source.readyState);\n   console.log("\u957f\u8fde\u63a5\u6253\u5f00");\n };\n\n //\u5bf9\u670d\u52a1\u7aef\u6d88\u606f\u7684\u76d1\u542c\n source.onmessage = function(event) {\n   console.log(JSON.parse(event.data));\n   console.log("\u6536\u5230\u957f\u8fde\u63a5\u4fe1\u606f");\n   let li = createLi(JSON.parse(event.data));\n   document.getElementById("ul").appendChild(li)\n };\n\n //\u5bf9\u65ad\u5f00\u94fe\u63a5\u7684\u76d1\u542c\n source.onerror = function(event) {\n   console.log(source.readyState);\n   console.log("\u957f\u8fde\u63a5\u4e2d\u65ad");\n };\n\n<\/script>\n</html>\n')),(0,o.kt)("h2",{id:"\u4e3b\u8981\u914d\u7f6e"},"\u4e3b\u8981\u914d\u7f6e"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"'Content-Type': 'text/event-stream'")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},'const express = require(\'express\'); \nconst app = express();\nconst port = 8088;\n\n//\u8bbe\u7f6e\u8de8\u57df\u8bbf\u95ee\napp.all("*", function(req, res, next) {\n    //\u8bbe\u7f6e\u5141\u8bb8\u8de8\u57df\u7684\u57df\u540d\uff0c*\u4ee3\u8868\u5141\u8bb8\u4efb\u610f\u57df\u540d\u8de8\u57df\n    res.header("Access-Control-Allow-Origin", \'*\');\n    //\u5141\u8bb8\u7684header\u7c7b\u578b\n    res.header("Access-Control-Allow-Headers", "Content-Type, Authorization, X-Requested-With");\n    //\u8de8\u57df\u5141\u8bb8\u7684\u8bf7\u6c42\u65b9\u5f0f \n    res.header("Access-Control-Allow-Methods", "PUT,POST,GET,DELETE,OPTIONS");\n    // \u53ef\u4ee5\u5e26cookies\n    res.header("Access-Control-Allow-Credentials", true);\n    if (req.method == \'OPTIONS\') {\n        res.sendStatus(200);\n    } else {\n        next();\n    }\n})\n\napp.get("/sse",(req,res) => {\n    res.set({\n        \'Content-Type\': \'text/event-stream\', //\u8bbe\u5b9a\u6570\u636e\u7c7b\u578b\n        \'Cache-Control\': \'no-cache\',// \u957f\u94fe\u63a5\u62d2\u7edd\u7f13\u5b58\n        \'Connection\': \'keep-alive\' //\u8bbe\u7f6e\u957f\u94fe\u63a5\n      });\n\n      console.log("\u8fdb\u5165\u5230\u957f\u8fde\u63a5\u4e86")\n      //\u6301\u7eed\u8fd4\u56de\u6570\u636e\n      setInterval(() => {\n        console.log("\u6b63\u5728\u6301\u7eed\u8fd4\u56de\u6570\u636e\u4e2ding")\n        const data = {\n          message: `Current time is ${new Date().toLocaleTimeString()}`\n        };\n        res.write(`data: ${JSON.stringify(data)}\\n\\n`);\n      }, 1000);  \n})\n\napp.listen(port, () => {\n    console.log(`\u9879\u76ee\u542f\u52a8\u6210\u529f-http://localhost:${port}`)\n})\n')))}d.isMDXComponent=!0}}]);