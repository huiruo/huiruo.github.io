<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-build-webpack/webpack基础原理" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.3">
<title data-rh="true">webpack基础原理 | Programming tech</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://huiruo.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://huiruo.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://huiruo.github.io/build-webpack/webpack基础原理"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="webpack基础原理 | Programming tech"><meta data-rh="true" name="description" content="Webpack"><meta data-rh="true" property="og:description" content="Webpack"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://huiruo.github.io/build-webpack/webpack基础原理"><link data-rh="true" rel="alternate" href="https://huiruo.github.io/build-webpack/webpack基础原理" hreflang="en"><link data-rh="true" rel="alternate" href="https://huiruo.github.io/build-webpack/webpack基础原理" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.0527b3af.css">
<link rel="preload" href="/assets/js/runtime~main.74644ce5.js" as="script">
<link rel="preload" href="/assets/js/main.9586da8b.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"dark")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="My Site Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.svg" alt="My Site Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">programming-tech</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/">Main</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/huiruo/programming-tech-website/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently dark mode)" aria-label="Switch between dark and light mode (currently dark mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/">Readme</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/React概览">React概览</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/Vue概览">Vue概览</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/React/编译阶段-jsx-ast">React</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/Vue/vue3/库-状态管理">Vue</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/JavaScript/继承/es6-extends">JavaScript</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/html-css/requestAnimationFrame/requestAnimationFrame-是宏任务吗">html-css</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/http-browserCache/浏览器请求-渲染的流程">http-browserCache</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/parsing-interpretation-compilation/模块化/esm">parsing-interpretation-compilation</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/promise-eventLoop-security/promise/promise基础">promise-eventLoop-security</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/build-webpack/dynamic-import/动态加载">webpack</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/build-webpack/dynamic-import/动态加载">dynamic-import</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/build-webpack/webpack基础原理">webpack基础原理</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/build-webpack/浏览器正常运行流程-静态-同步">浏览器正常运行流程-静态-同步</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/build-webpack/dynamic-import-动态-异步">dynamic-import-动态-异步</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/build-webpack/构建包大小优化">构建包大小优化</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/build-webpack/构建速度优化">构建速度优化</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/build-webpack/webpack4-增量构建">webpack4-增量构建</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/build-webpack/06-1-webpack5新特性">webpack5新特性</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/build-webpack/06-2-webpack5-Persistent-Caching">webpack5-Persistent-Caching</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/build-webpack/loader-plugin">loader-plugin</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/build-webpack/resolve-devServer-等参数">resolve-devServer-等参数</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/build-webpack/vite">vite</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/build-AST-Babel/AST">AST-Babel</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/build-monorepo-turbopack/monorepo">monorepo-turbopack</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/SSR-Nodejs/react-ssr渲染">SSR-Nodejs</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/web-optimization/总结">web optimization</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/C++-V8/v8/v8基础">C++-V8</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/backend/nextjs/">backend</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docker/Docker基础">docker</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/design-patterns/">design patterns</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/regular-string/正则-基础">regular-string</a></div></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">webpack</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">webpack基础原理</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>webpack基础原理</h1></header><h2 class="anchor anchorWithStickyNavbar_LWe7" id="webpack">Webpack<a href="#webpack" class="hash-link" aria-label="Direct link to Webpack" title="Direct link to Webpack">​</a></h2><p><a href="https://webpack.docschina.org/concepts/" target="_blank" rel="noopener noreferrer">官方文档</a></p><p>定义：webpack是一个打包模块化 javaScript的工具，它会从main.js出发，</p><p>它能够根据配置的入口路径（entry），通过模块间的依赖关系（import/export），识别出源码中的模块化导入语句，递归地找出出入口文件的所有依赖，通过Loader转换文件，将入口和其所有依赖打包到一个单独的文件中。</p><ul><li>1.模块打包</li></ul><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">一切文件如 js,css,scss,图片对于webpack都是一个个模块,经过webpack 的处理，最终会输出浏览器使用的静态资源。</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li><p>2.编译兼容
通过webpack的Loader机制，不仅仅可以帮助我们对代码做polyfill，还可以编译转换诸如.less, .vue, .jsx这类在浏览器无法识别的格式文件</p></li><li><p>3.能力扩展。通过webpack的Plugin机制，我们在实现模块化打包和编译兼容的基础上，可以进一步实现诸如按需加载，代码压缩等一系列功能，帮助我们进一步提高自动化程度，工程效率以及打包输出的质量。</p></li></ul><p>需要通过配置指定的加载器（loader）对相应文件进行转换，也可以通过配置指定的插件（plugins）对上下文进行优化输出（output）为代码块（chunk）</p><p>将各种类型的资源，包括图片、css、js等，转译、组合、拼接、生成输出bundle.js,一个IIFE的执行函数。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="babel在webpack处理js代码转译-在构建阶段">Babel在Webpack处理Js代码转译-&gt;在构建阶段<a href="#babel在webpack处理js代码转译-在构建阶段" class="hash-link" aria-label="Direct link to Babel在Webpack处理Js代码转译-&gt;在构建阶段" title="Direct link to Babel在Webpack处理Js代码转译-&gt;在构建阶段">​</a></h2><p>在Webpack中，Babel通常作为一个&quot;loader&quot;来使用，用于处理应用程序的源代码。Webpack中的配置通常包括以下部分：</p><ul><li><p>安装Babel依赖：您需要安装与Babel一起使用的相关依赖，如 babel-loader、Babel核心包、预设（preset，用于指定要转译的语法规则）、以及任何需要的Babel插件。</p></li><li><p>Webpack配置：在Webpack配置文件中，您需要配置Babel loader，以指定哪些文件需要经过Babel转译。通常，您将在Webpack配置的module.rules中添加一个包含Babel loader配置的规则。</p></li><li><p>Babel配置：您可能需要创建一个Babel配置文件（如.babelrc或babel.config.js）来指定Babel的详细配置选项，包括预设、插件和其他选项。</p></li></ul><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">module</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token property-access">exports</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token comment" style="color:rgb(98, 114, 164)">// ...其他Webpack配置...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token literal-property property">module</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token literal-property property">rules</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token literal-property property">test</span><span class="token operator">:</span><span class="token plain"> </span><span class="token regex regex-delimiter">/</span><span class="token regex regex-source language-regex">\.js$</span><span class="token regex regex-delimiter">/</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">// 匹配JavaScript文件</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token literal-property property">exclude</span><span class="token operator">:</span><span class="token plain"> </span><span class="token regex regex-delimiter">/</span><span class="token regex regex-source language-regex">node_modules</span><span class="token regex regex-delimiter">/</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">// 排除node_modules目录</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token literal-property property">use</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          </span><span class="token literal-property property">loader</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;babel-loader&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">// 使用Babel loader</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="webpack核心完成了内容转换--资源合并两种功能过程包含三个阶段">webpack核心完成了:<code>内容转换 + 资源合并</code>两种功能，过程包含三个阶段：<a href="#webpack核心完成了内容转换--资源合并两种功能过程包含三个阶段" class="hash-link" aria-label="Direct link to webpack核心完成了内容转换--资源合并两种功能过程包含三个阶段" title="Direct link to webpack核心完成了内容转换--资源合并两种功能过程包含三个阶段">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="1初始化阶段">1.初始化阶段<a href="#1初始化阶段" class="hash-link" aria-label="Direct link to 1.初始化阶段" title="Direct link to 1.初始化阶段">​</a></h3><ol><li>初始化参数：从配置文件、 配置对象、Shell 参数中读取，与默认配置结合得出最终的参数</li><li>创建编译器对象：用上一步得到的参数创建 Compiler 对象</li><li>初始化编译环境：包括注入内置插件、注册各种模块工厂、初始化 RuleSet 集合、加载配置的插件等</li><li>开始编译：执行 compiler 对象的 run 方法</li><li>确定入口：根据配置中的 entry 找出所有的入口文件，调用 Compilation .addEntry 将入口文件转换为 dependence 对象</li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="2构建阶段">2.构建阶段：<a href="#2构建阶段" class="hash-link" aria-label="Direct link to 2.构建阶段：" title="Direct link to 2.构建阶段：">​</a></h3><ol><li>编译模块(make)：根据 entry 对应的 dependence 创建 module 对象，调用 loader 将模块转译为标准 JS 内容，调用 JS 解释器将内容转换为 AST 对象，从中找出该模块依赖的模块，再递归本步骤直到所有入口依赖的文件都经过了本步骤的处理</li><li>完成模块编译：上一步递归处理所有能触达到的模块后，得到了每个模块被翻译后的内容以及它们之间的依赖关系图</li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="3生成阶段">3.生成阶段：<a href="#3生成阶段" class="hash-link" aria-label="Direct link to 3.生成阶段：" title="Direct link to 3.生成阶段：">​</a></h3><ol><li>输出资源(seal)：根据入口和模块之间的依赖关系，组装成一个个包含多个模块的 Chunk，再把每个 Chunk 转换成一个单独的文件加入到输出列表，这步是可以修改输出内容的最后机会</li><li>写入文件系统(emitAssets)：在确定好输出内容后，根据配置确定输出的路径和文件名，把文件内容写入到文件系统</li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="单次构建过程自上而下按顺序执行webpack-编译过程都是围绕着这些关键对象展开的">单次构建过程自上而下按顺序执行,webpack 编译过程都是围绕着这些关键对象展开的<a href="#单次构建过程自上而下按顺序执行webpack-编译过程都是围绕着这些关键对象展开的" class="hash-link" aria-label="Direct link to 单次构建过程自上而下按顺序执行,webpack 编译过程都是围绕着这些关键对象展开的" title="Direct link to 单次构建过程自上而下按顺序执行,webpack 编译过程都是围绕着这些关键对象展开的">​</a></h2><ul><li><p>Entry：编译入口，webpack 编译的起点</p></li><li><p>Compiler：编译管理器，webpack 启动后会创建 compiler 对象，该对象一直存活直到结束退出</p></li><li><p>Compilation：单次编辑过程的管理器，比如 watch = true 时，运行过程中只有一个 compiler 但每次文件变更触发重新编译时，都会创建一个新的 compilation 对象</p></li><li><p>Dependence：依赖对象，webpack 基于该类型记录模块间依赖关系</p></li><li><p>Module：webpack 内部所有资源都会以“module”对象形式存在，所有关于资源的操作、转译、合并都是以 “module” 为基本单位进行的</p></li><li><p>Chunk：编译完成准备输出时，webpack 会将 module 按特定的规则组织成一个一个的 chunk，这些 chunk 某种程度上跟最终输出一一对应</p></li><li><p>Loader：资源内容转换器<br>
参考: <a href="/build-webpack/loader-plugin">loader-plugin</a></p></li><li><p>Plugin：webpack构建过程中，会在特定的时机广播对应的事件，插件监听这些事件，在特定时间点介入编译过程</p></li></ul><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">插件可以用来处理各种特定的任务，比如代码的压缩，静态文件打包优化等等。如下面所示的自动生成 html 文件的插件:</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li><p>import/export 某个模块通过import导入其他模块的变量及对象，通过export导出自身的变量及对象，webpack内部通过import可以构建出模块关系图。</p></li><li><p>source-map：打包后会生成 map 格式的文件，里面包含映射关系的代码
eval：用 eval 的方式生成映射关系代码，效率和性能最佳。但是当代码复杂时，提示信息可能不精确</p></li></ul><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">开发环境：</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">devtool: &#x27;cheap-module-eval-source-map&#x27;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">生产环境</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">devtool: &#x27;cheap-module-source-map&#x27;,</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="初始化阶段">初始化阶段<a href="#初始化阶段" class="hash-link" aria-label="Direct link to 初始化阶段" title="Direct link to 初始化阶段">​</a></h2><p>webpack 的初始化过程,从创建 compiler 实例到调用 make 钩子，逻辑链路很长,这个过程需要在 webpack 初始化的时候预埋下各种插件，经历 4 个文件，7次跳转才开始进入主题，前戏太足了，如果读者对 webpack 的概念、架构、组件没有足够了解时，源码阅读过程会很痛苦。</p><ul><li>启动 webpack ，触发 lib/webpack.js 文件中 createCompiler 方法</li><li>createCompiler 方法内部调用 WebpackOptionsApply 插件</li><li>WebpackOptionsApply 定义在 lib/WebpackOptionsApply.js 文件，内部根据 entry 配置决定注入 entry 相关的插件，包括：DllEntryPlugin、DynamicEntryPlugin、EntryPlugin、PrefetchPlugin、ProgressPlugin、ContainerPlugin</li><li>Entry 相关插件，如 lib/EntryPlugin.js 的 EntryPlugin 监听 compiler.make 钩子</li><li>lib/compiler.js 的 compile 函数内调用 this.hooks.make.callAsync</li><li>触发 EntryPlugin 的 make 回调，在回调中执行 compilation.addEntry 函数</li><li>compilation.addEntry 函数内部经过一坨与主流程无关的 hook 之后，再调用 handleModuleCreate 函数，正式开始构建内容</li></ul><p><img loading="lazy" src="/assets/images/流程1-036fc879455a6ad9123039da0e3f1d24.jpg" width="2954" height="1874" class="img_ev3q"></p><ol><li>将 process.args + webpack.config.js 合并成用户配置</li><li>调用 validateSchema 校验配置</li><li>调用 getNormalizedWebpackOptions + applyWebpackOptionsBaseDefaults 合并出最终配置</li><li>创建 compiler 对象</li><li>遍历用户定义的 plugins 集合，执行插件的 apply 方法</li><li>调用 new WebpackOptionsApply().process 方法，加载各种内置插件</li></ol><p>主要逻辑集中在 WebpackOptionsApply 类，webpack 内置了数百个插件，这些插件并不需要我们手动配置，WebpackOptionsApply 会在初始化阶段根据配置内容动态注入对应的插件，包括：</p><ol><li>注入 EntryOptionPlugin 插件，处理 entry 配置</li><li>根据 devtool 值判断后续用那个插件处理 sourcemap，可选值：EvalSourceMapDevToolPlugin、SourceMapDevToolPlugin、EvalDevToolModulePlugin</li><li>注入 RuntimePlugin ，用于根据代码内容动态注入 webpack 运行时</li></ol><p>到这里，compiler 实例就被创建出来了，相应的环境参数也预设好了，紧接着开始调用 compiler.compile 函数：</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">// webpack-helloworld\node_modules\webpack\lib\Compiler.js</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">compile</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token parameter">callback</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">log</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;compile=====&gt;&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">callback</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> params </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">this</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">newCompilationParams</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">this</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token property-access">hooks</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token property-access">beforeCompile</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">callAsync</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">params</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token parameter">err</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)">// ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> compilation </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">this</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">newCompilation</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">params</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">this</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token property-access">hooks</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token property-access">make</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">callAsync</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">compilation</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token parameter">err</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token comment" style="color:rgb(98, 114, 164)">// ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">this</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token property-access">hooks</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token property-access">finishMake</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">callAsync</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">compilation</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token parameter">err</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)">// ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        process</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">nextTick</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          compilation</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">finish</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token parameter">err</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            compilation</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">seal</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token parameter">err</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token spread operator">...</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="构建阶段">构建阶段<a href="#构建阶段" class="hash-link" aria-label="Direct link to 构建阶段" title="Direct link to 构建阶段">​</a></h2><p>从 entry 开始递归解析资源与资源的依赖，在 compilation 对象内逐步构建出 module 集合以及 module 之间的依赖关系，核心流程：
<img loading="lazy" src="/assets/images/流程2-32d73b3bc56d582d3b1e6a2585a2292c.jpg" width="2574" height="1854" class="img_ev3q"></p><p>解释一下，构建阶段从入口文件开始：</p><ol><li>调用 handleModuleCreate ，根据文件类型构建 module 子类</li><li>调用 loader-runner 仓库的 runLoaders 转译 module 内容，通常是从各类资源类型转译为 JavaScript 文本</li><li>调用 acorn 将 JS 文本解析为AST</li><li>遍历 AST，触发各种钩子</li></ol><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">1. 在 HarmonyExportDependencyParserPlugin 插件监听 exportImportSpecifier 钩子，解读 JS 文本对应的资源依赖</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">2. 调用 module 对象的 addDependency 将依赖对象加入到 module 依赖列表中</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="5"><li>AST 遍历完毕后，调用 module.handleParseResult 处理模块依赖</li><li>对于 module 新增的依赖，调用 handleModuleCreate ，控制流回到第一步</li><li>所有依赖都解析完毕后，构建阶段结束</li></ol><p>这个过程中数据流 module =&gt; ast =&gt; dependencies =&gt; module ，先转 AST 再从 AST 找依赖。这就要求 loaders 处理完的最后结果必须是可以被 acorn 处理的标准 JavaScript 语法，比如说对于图片，需要从图像二进制转换成类似于 export default &quot;data:image/png;base64,xxx&quot; 这类 base64 格式或者 export default &quot;http://xxx&quot; 这类 url 格式。</p><p>compilation 按这个流程递归处理，逐步解析出每个模块的内容以及 module 依赖关系，后续就可以根据这些内容打包输出。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="示例层级递进">示例：层级递进<a href="#示例层级递进" class="hash-link" aria-label="Direct link to 示例：层级递进" title="Direct link to 示例：层级递进">​</a></h3><p>假如有如下图所示的文件依赖树：</p><p><img loading="lazy" src="data:image/png;base64,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" width="506" height="218" class="img_ev3q"></p><p>其中 index.js 为 entry 文件，依赖于 a/b 文件；a 依赖于 c/d 文件。初始化编译环境之后，EntryPlugin 根据 entry 配置找到 index.js 文件，调用 compilation.addEntry 函数触发构建流程，构建完毕后内部会生成这样的数据结构：</p><p><img loading="lazy" src="/assets/images/流程2-2-dd11d74571a1a2106a85b34a40b3475a.jpg" width="1234" height="554" class="img_ev3q"></p><p>此时得到 module<!-- -->[index.js]<!-- --> 的内容以及对应的依赖对象 dependence<!-- -->[a.js]<!-- --> 、dependence<!-- -->[b.js]<!-- --> 。OK，这就得到下一步的线索：a.js、b.js，根据上面流程图的逻辑继续调用 module<!-- -->[index.js]<!-- --> 的 handleParseResult 函数，继续处理 a.js、b.js 文件，递归上述流程，进一步得到 a、b 模块：
<img loading="lazy" src="/assets/images/流程2-3-afef17fa5f234f58ca81d9348eb9681e.jpg" width="1494" height="1094" class="img_ev3q"></p><p>从 a.js 模块中又解析到 c.js/d.js 依赖，于是再再继续调用 module<!-- -->[a.js]<!-- --> 的 handleParseResult ，再再递归上述流程：</p><p><img loading="lazy" src="/assets/images/流程2-4-2a27868d452f4a71b08ca840be9f3071.jpg" width="1501" height="1454" class="img_ev3q">
到这里解析完所有模块后，发现没有更多新的依赖，就可以继续推进，进入下一步。</p><ul><li>Webpack 编译过程会将源码解析为 AST 吗？webpack 与 babel 分别实现了什么？</li></ul><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">构建阶段会读取源码，解析为 AST 集合。</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Webpack 读出 AST 之后仅遍历 AST 集合；babel 则对源码做等价转换</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>Webpack 编译过程中，如何识别资源对其他资源的依赖？</li></ul><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">Webpack 遍历 AST 集合过程中，识别 require/ import 之类的导入语句，确定模块对其他资源的依赖关系</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>相对于 grant、gulp 等流式构建工具，为什么 webpack 会被认为是新一代的构建工具？</li></ul><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">Grant、Gulp 仅执行开发者预定义的任务流；而 webpack 则深入处理资源的内容，功能上更强大</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="生成阶段">生成阶段<a href="#生成阶段" class="hash-link" aria-label="Direct link to 生成阶段" title="Direct link to 生成阶段">​</a></h2><p>这一步的关键逻辑是将 module 按规则组织成 chunks ，webpack 内置的 chunk 封装规则比较简单：</p><ul><li>entry 及 entry 触达到的模块，组合成一个 chunk</li><li>使用动态引入语句引入的模块，各自组合成一个 chunk</li></ul><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">chunk 是输出的基本单位，默认情况下这些 chunks 与最终输出的资源一一对应，那按上面的规则大致上可以推导出一个 entry 会对应打包出一个资源，而通过动态引入语句引入的模块，也对应会打包出相应的资源，我们来看个示例。</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>构建阶段围绕 module 展开，生成阶段则围绕 chunks 展开。经过构建阶段之后，webpack 得到足够的模块内容与模块关系信息，接下来开始生成最终资源了。代码层面，就是开始执行 compilation.seal 函数：</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">// 取自 webpack/lib/compiler.js </span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token function" style="color:rgb(80, 250, 123)">compile</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token parameter">callback</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token console class-name">console</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">log</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;compile=====&gt;&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> callback</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> params </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">this</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">newCompilationParams</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">this</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token property-access">hooks</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token property-access">beforeCompile</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">callAsync</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">params</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token parameter">err</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token keyword control-flow" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">err</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">callback</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">err</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">this</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token property-access">hooks</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">compile</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">call</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">params</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> compilation </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">this</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">newCompilation</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">params</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> logger </span><span class="token operator">=</span><span class="token plain"> compilation</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">getLogger</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;webpack.Compiler&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            logger</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">time</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;make hook&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">this</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token property-access">hooks</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token property-access">make</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">callAsync</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">compilation</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token parameter">err</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                logger</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">timeEnd</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;make hook&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token keyword control-flow" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">err</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">callback</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">err</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                logger</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">time</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;finish make hook&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">this</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token property-access">hooks</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token property-access">finishMake</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">callAsync</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">compilation</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token parameter">err</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    logger</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">timeEnd</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;finish make hook&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    </span><span class="token keyword control-flow" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">err</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">callback</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">err</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    process</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">nextTick</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        logger</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">time</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;finish compilation&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        compilation</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">finish</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token parameter">err</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                            logger</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">timeEnd</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;finish compilation&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                            </span><span class="token keyword control-flow" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">err</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">callback</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">err</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                            logger</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">time</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;seal compilation&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                            compilation</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">seal</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token parameter">err</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                                logger</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">timeEnd</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;seal compilation&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                                </span><span class="token keyword control-flow" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">err</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">callback</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">err</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                                logger</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">time</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;afterCompile hook&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                                </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">this</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token property-access">hooks</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token property-access">afterCompile</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">callAsync</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">compilation</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token parameter">err</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                                    logger</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">timeEnd</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;afterCompile hook&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                                    </span><span class="token keyword control-flow" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">err</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">callback</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">err</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                                    </span><span class="token keyword control-flow" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">callback</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token keyword null nil" style="color:rgb(189, 147, 249);font-style:italic">null</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> compilation</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                                </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                            </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>seal 原意密封、上锁，我个人理解在 webpack 语境下接近于 “将模块装进蜜罐” 。seal 函数主要完成从 module 到 chunks 的转化，核心流程：
简单梳理一下：</p><ol><li>构建本次编译的 ChunkGraph 对象；</li><li>遍历 compilation.modules 集合，将 module 按 entry/动态引入 的规则分配给不同的 Chunk 对象；</li><li>compilation.modules 集合遍历完毕后，得到完整的 chunks 集合对象，调用 createXxxAssets 方法</li><li>createXxxAssets 遍历 module/chunk ，调用 compilation.emitAssets 方法将资 assets 信息记录到 compilation.assets 对象中</li><li>触发 seal 回调，控制流回到 compiler 对象</li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="示例多入口打包">示例：多入口打包<a href="#示例多入口打包" class="hash-link" aria-label="Direct link to 示例：多入口打包" title="Direct link to 示例：多入口打包">​</a></h2><p>假如有这样的配置：</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> path </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">require</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;path&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">module</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token property-access">exports</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token literal-property property">mode</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;development&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token literal-property property">context</span><span class="token operator">:</span><span class="token plain"> path</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">join</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">__dirname</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token literal-property property">entry</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token literal-property property">a</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;./src/index-a.js&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token literal-property property">b</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;./src/index-b.js&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token literal-property property">output</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token literal-property property">filename</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;[name].js&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token literal-property property">path</span><span class="token operator">:</span><span class="token plain"> path</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">join</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">__dirname</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;./dist&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token literal-property property">devtool</span><span class="token operator">:</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token literal-property property">target</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;web&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token literal-property property">plugins</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>实例配置中有两个入口，对应的文件结构：
<img loading="lazy" src="/assets/images/流程2-5-33173c5efd2518fb4c6103b64d5013ed.jpg" width="1294" height="434" class="img_ev3q"></p><p>index-a 依赖于c，且动态引入了 e；index-b 依赖于 c/d 。根据上面说的规则：</p><ul><li>entry及entry触达到的模块，组合成一个 chunk</li><li>使用动态引入语句引入的模块，各自组合成一个 chunk</li></ul><p>生成的 chunks 结构为：
<img loading="lazy" src="/assets/images/流程2-6-16be1a767b05389a5d62503f6a6b8066.jpg" width="802" height="804" class="img_ev3q"></p><p>也就是根据依赖关系，chunk<!-- -->[a]<!-- --> 包含了 index-a/c 两个模块；chunk<!-- -->[b]<!-- --> 包含了 c/index-b/d 三个模块；chunk<!-- -->[e-hash]<!-- --> 为动态引入 e 对应的 chunk。</p><p>不知道大家注意到没有，chunk<!-- -->[a]<!-- --> 与 chunk<!-- -->[b]<!-- --> 同时包含了 c，这个问题放到具体业务场景可能就是，一个多页面应用，所有页面都依赖于相同的基础库，那么这些所有页面对应的 entry 都会包含有基础库代码，这岂不浪费？为了解决这个问题，webpack 提供了一些插件如 CommonsChunkPlugin 、SplitChunksPlugin，在基本规则之外进一步优化 chunks 结构。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="splitchunksplugin-的作用">SplitChunksPlugin 的作用<a href="#splitchunksplugin-的作用" class="hash-link" aria-label="Direct link to SplitChunksPlugin 的作用" title="Direct link to SplitChunksPlugin 的作用">​</a></h3><p>SplitChunksPlugin 是 webpack 架构高扩展的一个绝好的示例，我们上面说了 webpack 主流程里面是按 entry / 动态引入 两种情况组织 chunks 的，这必然会引发一些不必要的重复打包，webpack 通过插件的形式解决这个问题</p><p>回顾 compilation.seal 函数的代码，大致上可以梳理成这么4个步骤：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">1.遍历 compilation.modules ，记录下模块与 chunk 关系</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">2.触发各种模块优化钩子，这一步优化的主要是模块依赖关系</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">3.遍历 module 构建 chunk 集合</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">4.触发各种优化钩子</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>webpack 插件架构的高扩展性，使得整个编译的主流程是可以固化下来的，分支逻辑和细节需求“外包”出去由第三方实现，这套规则架设起了庞大的 webpack 生态，关于插件架构的更多细节，下面 plugin 部分有详细介绍，这里先跳过。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="写入文件系统">写入文件系统<a href="#写入文件系统" class="hash-link" aria-label="Direct link to 写入文件系统" title="Direct link to 写入文件系统">​</a></h2><p>经过构建阶段后，compilation 会获知资源模块的内容与依赖关系，也就知道“输入”是什么；而经过 seal 阶段处理后， compilation 则获知资源输出的图谱，也就是知道怎么“输出”：哪些模块跟那些模块“绑定”在一起输出到哪里。seal 后大致的数据结构：</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">compilation </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token comment" style="color:rgb(98, 114, 164)">// ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token literal-property property">modules</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)">/* ... */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token literal-property property">chunks</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token literal-property property">id</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;entry name&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token literal-property property">files</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;output file name&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token literal-property property">hash</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;xxx&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token literal-property property">runtime</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;xxx&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token literal-property property">entryPoint</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain">xxx</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token comment" style="color:rgb(98, 114, 164)">// ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)">// ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>seal 结束之后，紧接着调用 compiler.emitAssets 函数，函数内部调用 compiler.outputFileSystem.writeFile 方法将 assets 集合写入文件系统，实现逻辑比较曲折，但是与主流程没有太多关系，所以这里就不展开讲了。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="总结资源形态流转">总结：资源形态流转<a href="#总结资源形态流转" class="hash-link" aria-label="Direct link to 总结：资源形态流转" title="Direct link to 总结：资源形态流转">​</a></h2><p>面已经把逻辑层面的构造主流程梳理完了，这里结合资源形态流转的角度重新考察整个过程，加深理解：</p><p><img loading="lazy" src="/assets/images/流程总结-a4c25862336422dd9a30271740acabeb.jpg" width="1254" height="814" class="img_ev3q"></p><ul><li>compiler.make 阶段：</li></ul><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">entry 文件以 dependence 对象形式加入 compilation 的依赖列表，dependence 对象记录有 entry 的类型、路径等信息</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">根据 dependence 调用对应的工厂函数创建 module 对象，之后读入 module 对应的文件内容，调用 loader-runner 对内容做转化，转化结果若有其它依赖则继续读入依赖资源，重复此过程直到所有依赖均被转化为 module</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>compilation.seal 阶段：</li></ul><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">遍历 module 集合，根据 entry 配置及引入资源的方式，将 module 分配到不同的 chunk</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">遍历 chunk 集合，调用 compilation.emitAsset 方法标记 chunk 的输出规则，即转化为 assets 集合</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>compiler.emitAssets 阶段：将 assets 写入文件系统</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="什么是插件">什么是插件<a href="#什么是插件" class="hash-link" aria-label="Direct link to 什么是插件" title="Direct link to 什么是插件">​</a></h2><p>从形态上看，插件通常是一个带有 apply 函数的类：</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">class</span><span class="token plain"> </span><span class="token class-name">SomePlugin</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token function" style="color:rgb(80, 250, 123)">apply</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token parameter">compiler</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>apply 函数运行时会得到参数 compiler ，以此为起点可以调用 hook 对象注册各种钩子回调，例如： compiler.hooks.make.tapAsync ，这里面 make 是钩子名称，tapAsync 定义了钩子的调用方式，webpack 的插件架构基于这种模式构建而成，插件开发者可以使用这种模式在钩子回调中，插入特定代码。webpack 各种内置对象都带有 hooks 属性，比如 compilation 对象：</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">class</span><span class="token plain"> </span><span class="token class-name">SomePlugin</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token function" style="color:rgb(80, 250, 123)">apply</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token parameter">compiler</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        compiler</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token property-access">hooks</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token property-access">thisCompilation</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">tap</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;SomePlugin&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token parameter">compilation</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            compilation</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token property-access">hooks</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token property-access">optimizeChunkAssets</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">tapAsync</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;SomePlugin&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token arrow operator">=&gt;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>钩子的核心逻辑定义在 Tapable 仓库，内部定义了如下类型的钩子：</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token maybe-class-name">SyncHook</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token maybe-class-name">SyncBailHook</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token maybe-class-name">SyncWaterfallHook</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token maybe-class-name">SyncLoopHook</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token maybe-class-name">AsyncParallelHook</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token maybe-class-name">AsyncParallelBailHook</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token maybe-class-name">AsyncSeriesHook</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token maybe-class-name">AsyncSeriesBailHook</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token maybe-class-name">AsyncSeriesWaterfallHook</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">require</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;tapable&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>不同类型的钩子根据其并行度、熔断方式、同步异步，调用方式会略有不同，插件开发者需要根据这些的特性，编写不同的交互逻辑，这部分内容也特别多，回头展开聊聊。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="webpack中最常用的插件">Webpack中最常用的插件：<a href="#webpack中最常用的插件" class="hash-link" aria-label="Direct link to Webpack中最常用的插件：" title="Direct link to Webpack中最常用的插件：">​</a></h3><ol><li>html-webpack-plugin: 这个插件用于自动生成HTML文件，并自动将打包后的JavaScript文件引入HTML中。这样可以减少手动操作，确保HTML文件与生成的资源一致。</li><li>clean-webpack-plugin: 用于在每次构建之前清理输出目录，以确保旧的构建文件不会干扰新的构建结果。</li><li>MiniCssExtractPlugin: 用于将CSS文件从JavaScript代码中分离出来，以提高性能并允许更好的缓存。这在生产构建中特别有用。</li><li>OptimizeCSSAssetsPlugin: 用于优化和压缩CSS资源，以减小文件大小。</li><li>CopyWebpackPlugin: 用于复制静态文件或目录到输出目录，例如，复制字体文件、图片等。</li><li>DefinePlugin: 允许您在编译时创建全局常量，这对于在开发和生产构建之间切换不同的配置非常有用。</li><li>HotModuleReplacementPlugin: 启用热模块替换，使在开发过程中可以在无需刷新整个页面的情况下更新应用程序。</li><li>ProvidePlugin: 自动加载模块，而不必每次都导入或要求它们。</li><li>BundleAnalyzerPlugin: 用于分析构建结果，可视化输出文件的大小和依赖关系，以帮助优化构建。</li><li>SplitChunksPlugin: 用于拆分公共代码块，以减小生成的文件大小，同时提高缓存效果。</li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="什么时候会触发钩子">什么时候会触发钩子<a href="#什么时候会触发钩子" class="hash-link" aria-label="Direct link to 什么时候会触发钩子" title="Direct link to 什么时候会触发钩子">​</a></h3><p>了解 webpack 插件的基本形态之后，接下来需要弄清楚一个问题：webpack 会在什么时间节点触发什么钩子？这一块我认为是知识量最大的一部分，毕竟源码里面有237个钩子，但官网只介绍了不到100个，且官网对每个钩子的说明都太简短，就我个人而言看完并没有太大收获，所以有必要展开聊一下这个话题。先看几个例子：</p><p>compiler.hooks.compilation ：
时机：启动编译创建出 compilation 对象后触发
参数：当前编译的 compilation 对象
示例：很多插件基于此事件获取 compilation 实例</p><p>compiler.hooks.make：
时机：正式开始编译时触发
参数：同样是当前编译的 compilation 对象
示例：webpack 内置的 EntryPlugin 基于此钩子实现 entry 模块的初始化</p><p>compilation.hooks.optimizeChunks ：
时机： seal 函数中，chunk 集合构建完毕后触发
参数：chunks 集合与 chunkGroups 集合
示例： SplitChunksPlugin 插件基于此钩子实现 chunk 拆分优化</p><p>compiler.hooks.done：
时机：编译完成后触发
参数： stats 对象，包含编译过程中的各类统计信息
示例： webpack-bundle-analyzer 插件基于此钩子实现打包分析</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/huiruo/programming-tech-website/edit/main/programming-tech/build-webpack/webpack基础原理.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/build-webpack/配置实例2"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">配置实例2</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/build-webpack/浏览器正常运行流程-静态-同步"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">浏览器正常运行流程-静态-同步</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#webpack" class="table-of-contents__link toc-highlight">Webpack</a></li><li><a href="#babel在webpack处理js代码转译-在构建阶段" class="table-of-contents__link toc-highlight">Babel在Webpack处理Js代码转译-&gt;在构建阶段</a></li><li><a href="#webpack核心完成了内容转换--资源合并两种功能过程包含三个阶段" class="table-of-contents__link toc-highlight">webpack核心完成了:<code>内容转换 + 资源合并</code>两种功能，过程包含三个阶段：</a><ul><li><a href="#1初始化阶段" class="table-of-contents__link toc-highlight">1.初始化阶段</a></li><li><a href="#2构建阶段" class="table-of-contents__link toc-highlight">2.构建阶段：</a></li><li><a href="#3生成阶段" class="table-of-contents__link toc-highlight">3.生成阶段：</a></li></ul></li><li><a href="#单次构建过程自上而下按顺序执行webpack-编译过程都是围绕着这些关键对象展开的" class="table-of-contents__link toc-highlight">单次构建过程自上而下按顺序执行,webpack 编译过程都是围绕着这些关键对象展开的</a></li><li><a href="#初始化阶段" class="table-of-contents__link toc-highlight">初始化阶段</a></li><li><a href="#构建阶段" class="table-of-contents__link toc-highlight">构建阶段</a><ul><li><a href="#示例层级递进" class="table-of-contents__link toc-highlight">示例：层级递进</a></li></ul></li><li><a href="#生成阶段" class="table-of-contents__link toc-highlight">生成阶段</a></li><li><a href="#示例多入口打包" class="table-of-contents__link toc-highlight">示例：多入口打包</a><ul><li><a href="#splitchunksplugin-的作用" class="table-of-contents__link toc-highlight">SplitChunksPlugin 的作用</a></li></ul></li><li><a href="#写入文件系统" class="table-of-contents__link toc-highlight">写入文件系统</a></li><li><a href="#总结资源形态流转" class="table-of-contents__link toc-highlight">总结：资源形态流转</a></li><li><a href="#什么是插件" class="table-of-contents__link toc-highlight">什么是插件</a><ul><li><a href="#webpack中最常用的插件" class="table-of-contents__link toc-highlight">Webpack中最常用的插件：</a></li><li><a href="#什么时候会触发钩子" class="table-of-contents__link toc-highlight">什么时候会触发钩子</a></li></ul></li></ul></div></div></div></div></main></div></div></div>
<script src="/assets/js/runtime~main.74644ce5.js"></script>
<script src="/assets/js/main.9586da8b.js"></script>
</body>
</html>